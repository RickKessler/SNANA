
   v9_00 [Sep 3, 2010]  

             ***** ACTION ITEMS for ALL SNANA USERS *****

    => one mandatory action item for all users:
         cp $SNANA_DIR/kumacs/snana.kumac ~/kumacs

    => one recommended action item for all users:
         remove "OPT_SNXT=2" from your &FITINP namelists


             ***** OVERVIEW OF MAJOR CHANGES *****

     *  Integrate SNOOPY model (optical + IR) into simulation 
        (not yet in the fitter). Model gives shape, not absolute flux. 
        Peakmag in each filter must be specified in 
          $SNDATA_ROOT/models/snoopy/snoopy.[version]/SNooPy.INFO

     *  For models using host-galaxy extinction, exact CCM89 
        calculation is done for each filter instead of 
        approx parametrization,
        ==> no longer need the alphabeta.dat & zeta.dat files  
        ==> start removing OPT_SNXT=2 from your &FITINP namelists !!!
  
     *  Expand allowed filter-chars to include A-Z, a-z, and 0-9

     *  Allow up to 50 observer-filters (instead of 10) for SALT2,
        but models using K-corrections are still limited to 10
        obs-filters and 10 in the rest-frame (see MXFILT_KCOR).
        Extended filter set motivated by J-PAS .

     * add  "NON1A" model in simulation to compute observer-frame
       mags from SED (SALT2-like) instead of "rest-frame mag + K-cor"
       as done with the "non1a" model. With NON1A we can use
       many more observer-frame filters (since we don't need
       Kcor tables), although we cannot apply host-galaxy extinction.
       See new file genmag_NON1A.c and updated Sec 3.4 of manual.

     * several memory-saving changes to allow more 
       filter definitions:
        size of snana.exe    : 1.15 GB -> 0.83 GB
        size of snlc_fit.exe : 1.39 GB -> 1.08 GB
        size of snlc_sim.exe : 1.19 GB -> 0.89 GB

     * To view light curve fits with v9_00 you must do
         cp $SNANA_DIR/kumacs/snana.kumac ~/kumacs

       This snana.kumac is NOT BACKWARD COMPATIBLE. SORRY !


                   Details:

   - integrate C.Burns' SNooPy code into simulation:
     add files genmag_snoopy.c, gloes.c and gloes.h .
     Invoke snoopy in simulation with
        GENMODEL:  snoopy
           or
        GENMODEL:  snoopy.v01

     and then specify DM15 parameters using
        GENMEAN_DM15:   1.2
        GENRANGE_DM15:  0.7  2.0
        GENSIGMA_DM15:  0.3  0.3
     and also specify ranges for RV and AV (similar to MLCS).

   - snana.car : 
     *  new INIT_XTHOST to compute/initialize host-galaxy 
        extinction (XTHOST) on grid of  {filter,epoch,RV}.  
        &FITINP namelist options are

          OPT_SNXT = 1   ! exact - default
          OPT_SNXT = 2   ! SJ approximation (previous default)

        BEWARE that extinctions are negative in the IR for RV < 1 !!!
        We recommend removing  OPT_SNXT=2 from your namelist files.

     * save memory by using sparse filter indices in kcor arrays;
       see R4KCORTABLE, LC_PHOTO_TEMPLATE and MWXT_TABLE, each
       indexed by MXFILT_KCOR instead of MXFILT_ALL.
       Saves 90 MB, and allows MXFILT_ALL to be much larger.

     * define MXFILT_SNRMAX to limit the number of SNRMAX cuts.
       Also see NFILT_SNRMAX and IFILT_SNRMAX(1:NFILT_SNRMAX).

     * save 200 MB more memory by splitting SNLC_CUTVAR into SNLC_CUTVAR
       and SNEP_CUTVAR, where only the latter has the MXEPOCH dimension.

     * Finally, after the memory redcutions,
         MXFILT_ALL = 40  -> 80  (only 62 allowed chars, but just being safe)
         MXFILT_OBS = 10  -> 50  

   - snlc_sim.h
        MXFILTINDX 40 -> 80
     and note that simulated random sequence changes since 
     random numbers are generated for every filter.

   - snlc_sim.c
     * init_host & rdxtpar called from init_kcor() instead of 
       from init_genmodel().
     * GENFRAME_OPT set in prep_user() so that init_kcor 
       knows if model is rest-frame or observer-frame.

   - genmag_SEDtools.h :
     increase MXFILT_SEDMODEL from 12 to MXFILTINDX .

   - extend user-input arrays for filter strings
       FILTLIST_FIT*20 -> *80

   - general: fix a few evil code-lines where '20' was hard-wired 
     for the number of filters. 

   - sntools.c
     Fix dumb bug in rd_sedflux() related to reading the optional 
     flux error. Bug occured when DAYrange or LAMrange window resulted 
     in skipped entries. Main effect was frequent aborts in 
     SIMSED_extractSpec.exe .

   - genmag_SEDtools.c
     add new function zero_flux_SEDMODEL() to zero the entire 
     flux table.  Called after malloc_SEDMODEL, and also called
     by genmag_NON1A() each time the NON1A SED changes.
     May also need this feature later for the SNLS3 data where
     each SN has its own separate filter response.

   - genmag_NON1A.c - new function for simulation:
       GENMODEL:  NON1A
     See updated Sec 3.4 of manual.

   - identified bug util/sednon1a_install.cmd :
     if original SED surface extends earlier than -30 days, then 
     the avove script shifts the SED in time rather than truncating 
     at -30 days. This bug means that some non-Ia SEDs are time-shifted 
     relative to the coresponding light curve (.DAT) file.     
     For K-corrections in the "nonIa" model, spectral warping
     more or less fixes the problem. However, for the new "NONIA" 
     model that relies solely on the SEDs, some of the light curves 
     are mysteriously shifted compared to the expected PEAKMJD.
     Bug not fixed here, but hopefully will be fixed next version.


   v9_01 [Sep 8, 2010]  
    - src/Makefile :  snlc_fit.shfca -> ./snlc_fit.shfca

    - in previous version, genmag_NON1A.c clobbers genmag_non1a.c.
      Thus rename files as follows
        genmag_non1a.c -> genmag_non1a.c
        genmag_NON1A.c -> genamg_NON1ASED.c

    - [init_]genmag_NON1A -> [init_]genmag_NON1ASED
      to distinguish from  "genmag_non1a" if these are
      ever called by a fortran program.

    - SIMSED_fudge.c : restructure with new functions
       sedSmooth() and sedWrite() so that the former can
       be written independently.

    - util/sednon1a_install.cmd :
      More or less fix bug by setting TREST_RANGE: -40 100
      in kcor input file.
      Apply SN_MAGOFF to final SED so that SED and rest-frame
      mags are consistent. Previous version left Nugent's SEDs
      with strange normalization because it did not matter
      for K-corrections ... but the SED norm is important
      for the new "NON1A" model that uses only the SEDs.

   - sedinterp.cc :
     Read 3rd argument "fluxScale" to scale the SED fluxes.


   v9_02 [Sep 18, 2010]  

   - MWgaldust.h : removed 'getline' since this was causing
                   compilation error on another machine.

   - snana.car : 
     * rearranged common blocks to isolate memory-hogging 
       arrays with MXSNLC index.
      
     * for routines used by simulation, exclude arrays
       indexed by MXSNLC.

   - "size snlc_sim.exe" is now 600 MB instead of close to 900 MB,
      ==> works with valgrind without UME error.

   - SIMSED_fudge.c : call sedSmooth() after reading input sed,
      but before applying analytic fudge.
     Install Rahul's sedSmooth function.
     See new option
     OPT_SMOOTH:  1  # 1=tophat  2=Gauss filter

     Add SHAPEPAR fudge options for SALT2x1,
       SHAPEPAR_NAME:    S2x1
       SHAPEPAR_RANGE:  -4.0 4.0
       SHAPEPAR_BINSIZE: 2.0
       SHAPEFUN_PAR: 0.11  # alpha

   - ../ups/snana.table : add setup pgplot for psnid

   - install psnid.c, psnid.h and psnid_tools.c for 
     SDSS only (not public until Masao's paper is published)
     Code from 
       web-facstaff.sas.upenn.edu/~brianco/psnid/psnid.tar.gz

   - snlc_sim.c[h]
     Add new user-input flag 
       SPECTYPE_SEARCH:  1
     to set spec type for SN passing search eff.
     This is mainly for SDSS pipeline+human search function.


   v9_03 [Sep 27, 2010]  

   - snana.car
     fix dumb bug in WRSAT2_2 to prevent flux and fluxerr
     from being gluded together in the output.

     in SET_LAMRANGE, set upper I-band limit to lower
     Y-band limit if Y-band exists. Replaces hard-wired
     9700 A limit for I-band, and fixes bug in which 
     both I & Y satisfy nearest filter for K-corrections.

   - SIMSED_fudge.c ... fix dumb oopsy ...
     For shape fudge, actually stretch the light curve.
     In previous update I had applied only the alpha*x1 
     mag-correction, but forgot to stretch the light curve.
    
     Stretch w.r.t. Tpeak(lambda) = polynommial function
     of lambda given by user input key
        LAMPOLY_TPEAK: <a0>  <a1>  <a2>

   - snlc_sim.c :
     initialize default 
        INPUTS.EPCUTWIN_LAMREST[1] = 22000.0 ;
     instead of 10000 A so that IR filters pass cuts
     at low redshift.

     modify dmp_simlib() to compute m5sig and to call
     template function SNcadenceFoM() for each filter.
     See snana manual Sec 3.18.2 for details.

  - combine_fitres.c :
    Allow "ROW:" or "SN:" keyword, and allow first
    variable to be either LIBID or CID. This allows
    converting the SIMLIB_DUMP output into an ntuple.

   v9_04 [Sep 30, 2010]  

   - snana.car : remove obsolete +CDE,SNFITCOM  statements.

     in subroutine WRSALT2_2, add cut-variables in header,
     and write [SURVEY]_CUTVAR.DAT file with master list
     and human-readable definitions.

   - New SNANA user Emille Ishida found many format bugs 
     using compiler at IPMU (and snana v9_02).
     Make minor fixes in
        snana.car  snlc_fit.car  sntools.c  sntools.h 
        snlc_sim.c  kcor.c  
        genmag_SALT2.c  genmag_SEDtools.c  genmag_non1a.c

     Fixes include changing the 'dangerous' function gets()
     with scanf() in clr_VERSION().

     Moved function  ZPTpsFields() out of sntools.c and into
     SDSS_simlib.c since this is only used for SDSS.

     Other fixes are mostly 'sprintf' syntax errors.


   v9_05 [Oct 14, 2010]  

    - remove SALT2_DIR declaration from ../ups/snana.table.

    - kcor.c: fix dumb bug reading SED with errors
              see rd_sn1a() function.

    - snana.car : in WRSALT2_2, add @SURVEY key, and
      clarify cutvar definitions.

    - manual: 
      * Clarify ZPTAVG description in Sec 3.5.
      * Add new Sec 3.6 explaining overlapping fields.

    - snlc_sim.c, function MJDGAP: 
      pass float MJD array to sortzv instead of double
      (bug found by Pavel @ DESY)

      Inside dmp_simlib(), replace NREAD-1 with NREAD for first 
      argument to SIMLIB_angsep_min(...) ; 
      Can't recall why NREAD-1 was passed ?

   - snlc_sim.h : add FOM to SIMLIB_DUMP structure

   - sntools.h : defin RADIAN = TWOPI/360.0 and replace
         RAD -> RADIAN in snlc_sim.c


   v9_06 [Oct 26, 2010]
  
    - snlc_sim.c :
      implement "GENSOURCE: GRID" option to generate a simulated
      sample on a grid for use in Masao's 'psnid' program.
      See new manual section 3.18.4 (GRID option).
      Add new file 'sngridtools.c' with all parameters, declarations
      and functions.
        WARNING: GRID option generation is working, but output
                 to FITS file is still not done ... hopefully 
                 will be ready for next snana version.

      Update SIMLIB_m5sig form DESY group.

    - snana.car : in RDKCOR skip ifilto = IFILT_BESS_BX to 
      protect kcordump when BX is the 11'th filter and
      exceeds MXFILT_KCOR=10.

      in PRINT_SNSTATS, if CUTWIN_CID cut always fails then make 
      sure that the "NEVER FOUND" message is printed only for the
      CID cut and not for REDSHIFT & TELESCOPE. These other messages 
      had made it more difficult to isolate the bad CID range.

      MNFIT_PKMJD: remove "SET PRInt" command to that correlation
      matrix is printed for 'anyfun'.

      Add new subroutine call to SNMJD_INTERP_ANYLC(isn,ifilt_obs)
      so that the current SNMJD_LIST_FILE works with the ANYLC 
      function used to estimate peak-MJD. Unlike the fitter that
      writes the interpolated fluxes to a separate file, the snana-
      interpolated fluxes are printed to the screen with the 
      following grepable format:
         INTERP-FLUX(CID=7876-u MJD=53685.102)=  1716.     +-  104.7    
      For more details, see updated manual sec 4.13


   v9_07 [Nov 2, 2010]

     - sngridtools.c : finish debugging FITS output and update
       snana manual sec 3.24 (GRID Option).
       Include special option for SNOOPY using NGRID_LOGZ=1 to
       store relative flux (instead of mags) from 0 to 1,
       multiplied by 20000 ... allows using snoppy grid to
       simulate and fit light curves (instead of really slow code.)

     - snana.car
       PARSE_HEAD: abort on insane value of NVAR_TERSE

       WRSALT2_2 :
       if ITERSE_FLUXZPT > 0 then use SNLC_FLUXZPT to write 
       native flux instead of FLUXCAL. Initial use is for
       SNLS3 files ... need to preserve native fluxes
       to be consistent with their covariance matrices.

       Also defined ITERSE_FLUXZPT and SNLC_FLUXZPT to read the
       native zeropoint from the ZPT-column of a terse-formatted
       file. Note that even if the ZPT is given, the terse 
       FLUXCAL still uses the SNANA FLUXCAL_ZPT = 27.5 .

       SNRECON :
       set LLAM=T if ZZ = 1+z < 0 to allow seeing Fischer's
       faint light curves that have no redshift info 
       (i.e,, z=-9 and ZZ=-8).

     - snlc_sim.c 
       fix bug related to NON1A (non1a was OK);
       for NON1A make sure to read standard NON1A.LIST
       instead of the LIST file in the KCOR directory.
       (see prep_non1a()).

       in readme_doc(), print NON1A_ROOT after SNANA_DIR
       so that it's there for both non1a and NON1A.

       for 'non1a' model, change kcor/NON1A -> kcor/non1a
       since K-corrections are used only for the lower-case
       'non1a' model.

      SIMLIB units for PSF and SKYSIG can be changed with
      simlib header keys:
        PSF_UNIT:     ARCSEC_FWHM
        SKYSIG_UNIT:  ADU_PER_SQARCSEC  
      See udpate manual section 3.5 .
  
   - snlc_fit.car :
     Implement 'snoopy' model in fitter. Problem is that it's
     VERY slow ... 3 minutes to fit a simulated BV light curve !
     Traced slowness to the gloes function. Chris says that a
     tuned ATLAS library is needed to speed things up, but 
     another option is to store/read the snoopy values from
     the GRID option.
  
   - snana manual: add Sec 3.4.1 about how to use a private non-Ia 
             directory ($NON1A_ROOT).
             Add description of optional simlib header keys
             for PSF and SKYSIG units (Sec 3.5)

   - installation manual: add gsl.


   v9_08 [Nov 11, 2010]

     IMPORTANT UPGRADE:
        Can now update filter response for each SN when fitting
        an observer-frame SED model (SALT2 or SIMSED).
        Application to rest-frame models with K-corrections will
        come later. For speed, the updated filterTrans causes the
        SEDMODEL to re-initialize at just 1 redshift bin (z=Z_SN);
        this differs from the larger redshift grid for the previous 
        constant-filter option. For updated filter responses,
        there are therefore slight differences in the SEDMODEL-
        interpolation using the FILTER_UPDATE feature; below
        are some comparisons using the SNLS_Ast06 sample.
        'SAMEFILT' uses the same filter response for each SN, but 
        the SEDMODEL grid has just one redshift bin at z=Z_SN,
           
             quantity          mean         rms
          x0(SAMEFILT)/x0      1.000       5.1E-4
          c(SAMEFILT - c      -5E-5        7.0E-4
          x1(SAMEFILT) - x1   -2E-5        3.1E-3

        Also note that additional differences may also arise 
        from slight differences in how the updated filter 
        responses are re-binnned; this effect is NOT included
        in the table above.

   - snana.car
     * update SET_LAMRANGE to handle more dense-packed
       filters (BVugri)

     * fix dumb bug in PARSE_SIM to prevent NPAR_SIMSED=0 just 
       because the last SN was skipped. 

     * parse new namelist input FILTER_UPDATE_PATH to read
       FilterFile.INFO instructions. Needed to udpate filter
       transmission for each SN

   -kcor.c:
    new input flags  PLOTFLAG_SN and  PLOTFLAG_PRIMARY to turn 
    off these plots and reduce output storage. Might be useful 
    if KCOR file is needed for each SN in the SNLS(DES) sample.
    A five-filter system takes just 25 kb, or 25 MB for 1000 SNe.

    ... after FILTER_UPDATE_PATH change to snana, probably won't
    need this new kcor feature.

   - sngridtools.c ->
     sngridtools.c and sngridtools.h.
 
     abort when NEPTOT  >= MXEPSIM to avoid mem overwrite.

     Include generic read utility (see manual)
            fits_read_SNGRID(file);
    
   - genmag_snoopy.c :
     if "GRIDFILE: <gridfile>" is read from SNooPy.INFO file,
     then read/store GRID with snoopy model, and skip the
     calculations. This feature speeds up the generation
     and fitting by a large factor.

  - genmag_stretch2.c :
    Argument is modelPath instead of a file;
    the template filename is hard-wired.

  - snlc_sim.c
    move some of the clumsy init stuff from init_genmodel() into
    prep_user_input().  

  - snlc_sim.h :
    MXEPSIM -> 10*MXEPOCH (was 600) to allow more bins (NFILT * NTREST)
    for GRID option.  Also defined new parameter
      #define MXEPSIM_PERFILT MXEPOCH
    to be used for the GENFILT structure and use less memory
    when MXEPSIM is increased.
    Current MXEPSIM is now 6000, so for example, 50 filters and 
    120 epochs/filter will work with GRID option.
    'size ../bin/snlc_sim.exe' increased from 611 MB to 615 MB.

   - snlc_fit.car :
     * change MODEL_MLCS -> MODEL_MLCS2k2

       warn users to change FITMODEL_NAME = 'mlcs' to
       FITMODEL_NAME = 'mlcs2k2'. The former 'mlcs' still works
       due to hard-wired kluge, but it may not work forever.

     * New subroutine FITMODEL_INIT to compute 
          FITMODEL_INDEX, FITMODEL_ROOT, 
          FITMODEL_VERSION, FITMODEL_LIST

     * To clean up model-dependent logic in FITPAR_INI, new 
       subroutine SEDMODEL_INI() does generic init for
       SED-based models (SALT2 & SIMSED).  This cleanup in
       FITPAR_INI in needed for SN-dependent filters.

   - genmag_SEDtools.c[h]
     add new function 'init_redshift_SEDMODEL(NZBIN,zmin,zmax)'
     to setup arbitrary z-range. Now used by both the simulation
     and fitter for SALT2 & SIMSED models. In both cases the
     number of z-bins is hard-wired to be
         NZBIN = 100 * ( log10(Zmax) - log10(Zmin) ) + 1
     with Zmin forced to be >= 0.005.

   v9_09 [Nov 12, 2010]

    - snlc_sim.c
      fix dumb bug in simulation that causes snoopy to abort.
      Not sure how it worked for mlcs2k2 and SALT2 tester jobs ?

   - kcor.c
     for rest-frame filters, define internal K-corrections
     so that magobs is computed for rest-frame filters at z=0.
     These 'magobs' are needed by snana fitting program. 
     Users no longer need to specify K_xx (x = rest-filter) 
     in the input file; this was a Klugy way to define the
     magobs for rest-frame filters.


   v9_10 [Nov 16, 2010]

   - snana.car
     organize FILT_XXX arrays into FILTOBS_XXX and FILTREST_XXX
     so that the same filter-char can be used for both rest
     and obs-frame. For example, can define BVugriYJH for
     snoopy/CSP rest-frame, and then also define SDSS ugri.
     Note that a filter-char still cannot be repeated
     with the rest-frame set, or the obs-frame filter set.

     Fix some old/dumb bugs in RDSIMEFF and SNLC_SIMEFF.
     Probably just caused extra error messages.

     Put back SNRECON code to compute SNLC_FLUXCALMAX(ifilt,isn).
     For some strange reason, this was accidentally removed
     in snana v8_60 [July 20, 2010].  Now the FUDGE_FITERR 
     options work again.

  - mv genmag_mlcs.c genmag_mlcs2k2.c
    and mlcs -> mlcs2k2 for variable and function names inside.

  - snlc_fit.car:
    remove MON_MAGERR since it is nearly redundant with
    PEAKMAG_CALC calls at end of fitting.

    USRFUN:
    when Z <= Zat10pc, set ISREST=T and assume that IFILT_OBS
    is really a rest-frame filter. Needed to get REST-FRAME
    peak-mags.

    FITPAR_INI: fix  snoopy RESTLAMBDA_MODEL  = 2900, 20000
    (instead of mlcs2k2 range of 3200-9500)

  - snana.kumac : minor bug-fux for fluscale option
  

  v9_11 [Nov 16, 2010]

   - snlc_sim.c : fix CRAZYFLUX bug when FUDGE_SNRMAX option is used.

   - snana.car : fix SET_LAMREST_RANGE bug when neighbor filters
                 have no overlapping lambda bins. This occurs, for
                 example, in the i -> Y gap for with CSP ugriYJH.

  
  v9_12 [Dec 11, 2010]

   - snana.car
     Fix a few bugs to allow CID strings with more than 6 chars:
     PARSE_CID,

     in CIDASSIGN, print 'Assign intger CID=,I4 ' for SN ', CCID
     when CCID is not an integer. This allows identifying any 
     specific CID in the ntuple or in the hbook sub-directories
     (originally needed by Goobar).

   - add new subsec in manual for PRIVATE_DATA_PATH (Sec 4.16) 

   - fix obsolete manual section 4.17 about changing primary mags
     and zeropoints; fix now reflects recent change in 
     variable names:
        MAGSHIFT_PRIMARY -> MAGOBS_SHIFT_PRIMARY
        MAGSHIFT_ZP      -> MAGOBS_SHIFT_ZP

   - SALT2mu.c : minor updates/bug-fixes from J.Marriner.

   - snlc_sim.c : fix dumb bug for MAG20 option ; see prep_user_input()


  v9_13 [Dec 16, 2010]
   - snlc_sim.c :
     Include ccdnoise in fluctuations in gen_observerSmear().
     'ccdnoise' was passed, but I had just forgot to use it.
     Note that simulated random sequence will change a little !

   - sngridtools.c :
     few minor changes requested by B.Connolly.
     See notes at top of wrhead_GRIDfile_fits(void).

   - snana.car : modify WRSALT2_2 to read arbitrary new key
     from REFORMAT_KEY namelist string. Initial use is to
     add  @TRAINING_FOR_G10 0' into the SALT2 files.


  v9_14 [Dec 27, 2010]

   - genmag_SIMSED.c :
     Allow binary table to have wider z-range than current z-range.
     See new function read_SIMSED_TABBINARY().

   - snana.car (PARSE_SIM): 
     in addition to SIMSED_PARAM, also allow SIMSED_param
     and SIMSED_GRIDONLY so that they all show up in ntup 7788.
     
   - sndata_build.c :
     read type_boss and fill SNDATA.TYPE_BOSS

   - sntools.c :
     For SDSSFLAG, write BOSS_XXX keys after 
     SEARCH_XXX keys in wr_SNDATA().

   - add new SDSS utility "build_sdss_files.pl"

  v9_15 [Dec 27, 2010]
   - snlc_sim.c :
     few tweaks to allow re-defining both the TELESCOPE and
     PIXSIZE within a simlib entry (e.g., DES + VIDEO).
     private test area: ~/DES/sim/test_simlib
     Note that since the default NOISE(SKY,CCD) and PSF are 
     both given in PIXELS, the results don't depend on PIXSIZE
     unless the simlib uses either 
      SKYSIG_UNIT: ADU_PER_SQARCSEC or PSF_UNIT: ARCSEC_FWHM

   - snana.car : fix v9_14 bug related  to checking header cuts.


                   ***** 2011 *****

  v9_16 [Jan 6, 2011]

   - snana.car :
     protect KCORFUN8 from crazy K-correction values.
     See new parameter KCOR_CRAZYVAL.

     in LOAD_FILTTRANS, ilam_max +=1 and ilam_min -=1 to include one
     zero-trans bin on each side of the transmission function;
     may be needed for interpolation at the min/max region.
     This change may have a tiny effect on the SALT2 model.

   - snlc_fit.car :
     Add FITPROB into fitres file (FITRES_DMPFILE = 'xxx.fitres')

   - simid_renumber.pl :
     copy over any extra subdirs along with auxiliary files.

   - snlc_sim.c :
     new GENPREFIX option (sim-input file or command-line override)
     to allow output data filenames to have a different prefix
     than the GENVERSION. Default GENPREFIX = GENVERSION unless
     GENPREFIX is given.

     If NGEN_LC = NGENTOT_LC = 0, abort after VT_redshift() is called
     so that we get N/season printed out to stdout.

     Write filter responses to new subdir 
         [VERSION]/[VERSION].FITLERS/[cfilt].dat
     => for non-SNANA programs only.
     At the end  of the program, this new subdir is listed 
     among the AUXILIARY FILES.

   - add new public utilities  : 
        sim_SNmix.pl  
        split_and_fit.pl  (works on data and sims)
     to generate and fit large simulated samples containing
     a random mix of Ia and non-Ia. Both are designed to handle
     a list of systematic variations.  

   - combine_fitres.c (sntools.c:: fitresFile_init): 
     minor fixes to handle both CID and LIBID properly as 
     first element of ntuple.


  v9_17 [Jan 8, 2011]

   - snlc_sim.c : allow  'APPLY_CUTWIN_OPT: 3' to apply cuts to
     the data files, but NOT to the SIMGEN_DUMP entries ...
     allows keeping track of absolute efficiencies.
     Also updated manual section.

     In genperfect_override(), improve GENPERFECT dump-comments
     to include the GENPERFECT value and bit (instead of just the
     bit); some users had mistakenly used the bit numberas the value.
 
  - combine_fitres.c : fix WRNTUP() to work with much larger ntuples.
    Previous hrput() only allowed up to 8 MB; now much larger
    ntuples can be written.

  - sndata.h : increase HLIM to 15 million (from 10 million)

  - Makefile : add (cd $OBJ ; rm <prefix>.o ) after making programs 
               whose .o file is not needed by another program.

  - install SIMSED_prep.c [.h] from B.Diemer. Used to convert
    SED models into SNANA format to generate simulations with
    the SIMSED model.


  v9_18 [Jan 10, 2011]

   - sim_SNmix.pl : allow "NODELIST: <node1> <node2> ..." in 
     master input file to distribute jobs.

   - split_and_fit.pl : works without any NODELIST => interactive.

   - snlc_sim.c : 
     fix init_CIDRAN to check used CIDs more quickly with logical USED
     array ... initialization is much faster for large jobs.
     
   - utils/
     * remove obsolete scripts:
       rm version_archive.cmd copy_SNDATA_version.cmd
       rm lcmerge2SALT.py backup_sndata.cmd snvlist
     * Update manual to use backup_SNDATA_version.cmd instead 
        of version_archive.
     * Update backup_SNANA_PUBLIC.cmd to read from PUBLIC.LIST 
        instead of using hard-wired list.

  v9_19 [Jan 13, 2011]

   - snlc_sim.c
     in dmp_simlib(), fix dumb bug in definition of ZPT_pe
     (remove accidental semicolon).  This has no impact on
     the simulation, but was making it harder to diagnose
     the simlib.

   - add new file  SNcadenceFoM.c from Belov & Glazov.
     Later this file may get integrated into sntools.c,
     but for now it's easier for them to make changes 
     in a separate file.

  v9_20 [Jan 18, 2011]

   - cleanup  MXCID usage so that data will allow discovery
     CIDs up to 10 million-1 instead of 1 million-1.
     MXCID => MXCID_SIM = 999000  in simulation
           => MXCID_SDSS = 30000  for SDSS-only  utils
           => 9999000 in snana.car

     The simulation still has a limit of ~1 million since
     there is no discovery junk in the simulation.
     Only the data need large discovery IDs because there
     are many non-SN transients discovered in real searches.

     Remove VERSION_INFO.SNINDX[cid]
     Remove a few obsolete variables from sndata.h
     (MXRUN, MXNRUN) and move them to SDSS_utilities.h since 
     these are used only for SDSS utils.

   - snana.car and snlc_fit.car : replace I6.6 with call to
     CIDSTRING to print either I6.6 or I8.8.

   - snana.car : 
     INTEGER CIDMASK(MXCID) -> BYTE CIDMASK(MXCID)
     and MXCID -> 9.999 million (from 900,000) to allow
     for much larger discovery IDs in the data.
     For CID > 1 million the format is I8.8 to eventually
     allow up CIDs up to 100 million - 1. For now the limit 
     is 10 million - 1 so that BYTE CIDMASK(MXCID) does not 
     take an insane amount of memory.

  - sngridtools.c : fix dumb bug so that GRIDGEN_I2LCPACK is set
    for both FITS and TEXT format. Previously the TEXT format had
    mag=0 for everything (while FITS format was fine).
    [bug found by Ishida at Subaru]

  - genmag_XXX.c :
    Allow optional environment variable $SNANA_MODELPATH
    to override $SNDATA_ROOT/models/[model] so that test
    models can be used from a private area.  genmag_snoopy.c
    and genmag_stretch2.c were modified to pass *version
    instead of *modelPath, so that the modelpath can be
    constructed locally the same way in all of the genmag_XXX
    functions.

    See manual Sec 7.16.

  - snlc_sim.c : pass INPUTS.GENMODEL (i.e, version) instead
    of GENLC.MODELPATH to init_genmag_snoopy/stretch2.
    Also, if getenv(SNANA_MODELPATH) exists, then override
    GENLC.MODELPATH.

  - snlc_fit.car :  pass model name (instead of path) to
     INIT_GENMAG_SNOOPY and INIT_GENMAG_STRETCH2.


  v9_21 [Jan 19, 2011]

   - combine_fitres.c :
     for values < 1E-3 use %10.4le format instead of %f ...
     needed to keep precision  for small numbers.

   - snlc_fit.car :
     for DOFIT_PHOTOZ, extend zmax for SALT2-SEDMODEL init.

   - genmag_SEDtools.c :
     fix small bug in z-binning so that bins go from
     ZMIN to ZMAX; previous code went 1 bins short of
     ZMAX. This fix impacts only photoz fits that probe
     the entire z-range.

  v9_22 [Jan 27, 2011]

  - snlc_sim.c :
    for SIMLIB_DUMP option, compute <GAP> excluding gaps > 100 days.
    Also print <GAP> as part of filter-summary.

    fix dumb bug in gen_hubble to avoid divide-by-zero when
    zmax is very small (see NZ variable)

    For GENPERFECT option to turn off mag-smearing,
    set MODELSMEAR_FILE = "BLANK" ; see genperfect_override()

    add new input option GENSIGMA_MWEBV to allow fixed
    error intead of just the fractional error.
    Note that one extra random number is burned, and therefore
    the random sequence is changed from previous version.

    for 'SIMLIB_DUMP 0' option, print SIGSKY in pe/pix instead
    of ADU/pix.

    New sim-input option  
      SIMLIB_CADENCEFOM_PARLIST <par1> ... <parN>
    to pass optional list of parameters to SNcadenceFoM().

  - snana.car
    in DFINT and UTILEX, replace computed goto (arithmetic IF)
    with "IF () GOTO nnn".  The pads machine is giving warnings
    about these obsolete fortran commands.

  - SALT2mu.c : increase MAXSN from 10,000 to 100,000.
                Need a way to check array bound to avoid
                seg-fault ?

  - update SNcadenceFoM.c from Pavel:
    use rand() instead of snran1().
    RK made changes to how arguments are passed
     and added several #define parameters at the top.


  v9_23 [Feb 9, 2011]

    - snlc_sim.c :
      allow command line override for 
        FUDGESCALE_PSF[SKYNOISE] and FUDGESHIFT_ZPT

      change SIMLIB_m5sig() -> SIMLIB_maglimit()  and pass
      SNR as argument instead of hard-wired SNR=5.0.

      Allow new sim-input arguments
        SIMLIB_IDSKIP:  3
        SIMLIB_IDSKIP:  34
        etc ...
      to skip an arbitrary set of SIMLIB ids.
      For example, can skip those with large MWEBV.

      For SIMGEN_DUMP,  allow SNRMAX1 (same as SNRMAX) so that 
      when combining fitres files, SNRMAX1 -> SNRMAX12 instead 
      of the degenerate SNRMAX2.

    - sim_SNmix.pl :
      fix dumb bug so that CIDs & randoms are synced when
      processing only SN Ia (worked before only if doing both
      nonIa and Ia). See CIDOFF and LAST_NGEN variables.

    - sim_SNmix.pl & split_and_fit.pl :
      New input key  
         SNANA_LOGIN_SETUP:  setup bla bla
      to allow arbitray command to setup snana for each ssh session.
      Also fix scripts to allow using the same node multiple times
      (for multi-cores)

    - snlc_fit.car : 
       FITRES_DMPFILE option now includes
       SNRMAX1, SNRMAX2 and SNRMAX3 in the fitres output.

    - SIMSED_extractSpec.c :
      Update from J.Mosher to interpolate time dimension (days).

  v9_24 [Feb 14, 2011]
    - snlc_sim.c
      allow  arguments 
          EXPOSURE_TIME <t>  EXPOSURE_TIME_FILTER r <tr>
      to set r-band  exposure time = tr instead of t*tr.
      If order of arguments is swithced, then r-band
      exposure is t*tr  as in previous versions.

    - SIMSED_extractSpec.c 
      Incude FLUX_SCALE factor from SED.INFO file.

      read new options
         --z <z>  --mu <mu> --snr <snr>
      and call new functions  
         obsSpec()   to transform from rest-frame to obs-frame
         fudgeSNR()  to fudge errors to enfore S/N fudge

    - snana.car :
      For LSIM=T in WRSALT2_2 write 
         @SIM_SNANAFILE  $SNDATA_ROOT/SIM/xxx/xxx_[snid].DAT
      to trace back to original SNANA data file.

   - snlc_fit.car :
     in RESIDUAL_TUP, increase MXNTVAR=80 (from 40).

   - sim_SNmix.pl 
     fix bug in simcopy() that affects DUMP files for multiple RANSEEDs.


  v9_25 [ Feb 24, 2011]

   - SIMSED_extractSpec.c :
     Allow new argument '--tlist <file>' to give a list of Trest values.
     Hopefully will speed up the generation of spectra for the 
     SALT2 training script.

   - SIMSED_fudge.c :
     Fix colroFudge() function to work for SALT2colorlaw1.

   - snlc_fit.c :
     in READ_DEFAULT_PRIORS do NOT set PRIOR_LUMIPAR_RANGE to the
     mlcs2k2 DELTA-range of -0.5 to +1.8 because this range messes 
     up the SALT2 fits. Default is now -9 to +9 (wide open), 
     consistent with manual Sec 4.5 (FItting Priors). Previously 
     the manual was wrong because the default prior-range was set 
     to the mlcs2k2 range.

  - sngridtools.c :
    Fix aweful bug in which I2LCMAGs were written into the 
    NONIa-INFO table since the NONIa-info table was the 
    last table created.

    New read-back scheme is now based on the table name 
    rather than its absolute HDU.

    SNPAR-INFO table has extra column so that there are two
    name colums: TBL_NAME and PAR_NAME.

    Create new duplicate functions 
       load_EXTNAMES_GRIDGEN 
       load_EXTNAMES_GRIDREAD
    to initialize the table names for the grid variables.
    The duplicate functions are needed to go separately 
    in the "ifdef SNGRIDGEN" and "ifdef SNGRIDREAD" parts
    without causing a linking conflict.

  - rename get_xxx.c and sndata_build.c to have "SDSS_" prefix
    since these are used only by internal SDSS.
       SDSS_get_forcephoto.c  SDSS_get_searchphoto.c
       SDSS_get_modelphoto.c  SDSS_get_SMP.c  SDSS_sndata_build.c

   - SDSS_utlities.h :
     MXRUN = 900000 (was 90000) to cover larger run numbers
     for templates.  Previous versions had memory overwrite
     when reading the run-list, but only v9_24 caused a segfault
     for sndata_build.exe

   - fitresVar_init inside sntools.c :
     pass new 'mxlen' argument to store max size of array.
     Then in fitresVar_read(), abort if NSN > MXLEN_FITRES.
     Update the following programs that use fitres-reading:
       combine_fitres.c     SALT2mu.c       ==> commonly used
       SNchallenge_eval.c   snpar_unfold.c  ==> likely obsolete

  v9_26 [Mar 01, 2011]

    - snlc_sim.c
      in the output README file after BRIEF DESCRIPTION, 
      replace 'with model = ' by 'with GENMODEL = '
      to have a unique key.

    - snana.car :
      new input variable  VERSION_REPLACE for command-line
      only ... replaces any previous VERSION_PHOTOMETRY overrides.
      Useful for scripting.

      for translating SNANA format into SALT2 format,
      allow new and optional @PREFIX key in the namelist,
         REFORMAT_KEYS  = '@INSTRUMENT SLOAN  @MAGSYS AB   @PREFIX RKTEST'
      otherwise the default prefix is the survey name.

      Fix aweful bug in RDKCOR_FITS_KCOR:
      The BX filter was added after (instead of before) call to
      INIT_KCOR_INDICES. Affects BX correction for rest-U.
      SNANA_tester did not catch this because the test SDSS SN 1032
      does not probe rest-U ... added another test with SN 1112 and
      z=.26 so that g->U.

    - split_and_fit.pl : a few adjustments to handle data with NSPLIT=1
                         (i.e, do NOT split)

    - move Z2CMB out of SDSS_sndata_build.c into new  file Z2CMB.c .
      Also put back exact calculation and comment out approx calc
      that was used to check JRK07, and then left there by accident.
      SDSS data files prior to Feb 28, 2011 were made using approx
      calc instead of exact calc.  Note that Z2CMB is NOT part of
      public release because it needs SLALIB product to get sla_eqgal.

    - snlc_fit.car :
      Fix logic for SALT2-x1 value in model-error calc.
      When DOCHI2_SIGMA=F, SALT2xx1 = previous x1 rather
      than 1st-iteration x1 ... allows using NFIT_ITERATION=3
      to get better convergence for x1.

    - genmag_SALT2.c : 
      read new keys from SALT2.INFO
          MAGERR_LAMOBS:   <err>  <minlam>  <maxlam>
          MAGERR_LAMREST:  <err>  <minlam>  <maxlam>
      and apply fudged errors in new function magerrFudge_SALT2().

    - sntools.c :
      add new utility functions  'laminterp' and rd2columnFile()
      to process files having 'lambda value'.  Use these tools
      to process INPUTS.MODELSMEAR_FILE.


  v9_27 [Mar 4, 2011]

   - snana.car :
     Major change to FILTER_UPDATE_READ to read filter-trans
     for each SN. Reads two sets of transmissions:
     transSN and transREF.  Code still not done ...
     hopefully in next version.

   - genmag_SEDtools.c
     'trans' -> transSN and transREF to allow for different
     transmissions to convolve with the SN (numerator) and
     the primary ref (denominator, or zeropoint).
     Calls to INIT_FILTER_SEDMODEL must now include
     two transmission-pointers.

   - genmag_SALT2.c :
     Implemented color-dispersion (KCOR) errors with
       read_SALT2colorDisp()
       get_SALT2colorDisp().
     Also see new flag 'ERRMAP_KCOR_OPT: 1' in the SALT2.INFO 
     file (default is 1,  or ON, if not defined).
     Using diagonal KCOR errors only, a quick test on SDSS 
     data indicates that this term is totally negligible.

     Change "ColerTerm" dump to "LAMINFO:" dump to include
     more information:

                                   peak     color  
                LAMBDA(A)   CL     dS0/S0   disp   
      --------------------------------------------- 
      LAMINFO:    2000     0.000   0.0578   0.000  
      LAMINFO:    2500     0.000   0.0578   0.589  
      LAMINFO:    3000     0.017   0.0714   0.179  
      LAMINFO:    3500     0.250   0.0227   0.073  
      etc ...
 
   - snlc_fit.car: 
      allow FITMODEL_NAME to be 40 chars instead of 20.

      in SEDMODEL_INI, do NOT pass BX filter to 
      init_FILTER_SEDMODEL unless BX is defined in
      the KCOR file; set new global logical LKCOR_BXDEF .

   - SIMSED_fudge.c :
     print colorlaw parameters in SED.INFO file so that 
     they can be parsed, particularly the BETA value used
     to fudge the color law.

   - sntools.c :
     Fix subtle bug in SALT2colorlaw1 which caused
     crazy result for lam = LAM_MIN = 2800.000 .
     Had small Impact SALT2.Guy10 fits if the model-grid 
     includes LAM_MIN, and effected colorFudge.dat file
     produced by SIMSED_fudge.exe.  This bug did NOT effect 
     the previous SALT2.Guy07 model that used SALT2colorlaw0.

   - snlc_sim.exe
      Scolnic (PS1) found a Seg fault running the SIMLIB_DUMP option,
      although it works fine on FNAL server. I ran valgrind and
      found problems with arguments to SIMLIB_angsep_min(),
      so this is now fixed. Also, the main function skips
      to the SIMLIB_DUMP part more quickly to avoid executing
      lots of unnecessary functions before the dump.
      
      Also ran valgrind on several other sim and fit jobs; all OK.

  v9_28 [Mar 9, 2011]

    - sntools.c :
      in fitresVar_init(), allow 'GAL:' key (along with SN: and ROW:)
      so that combine_fitres.exe works on HOSTLIBs too.

      Fix dumb bug in lamInterp.

    - combine_fitres.c :
      updated to work on HOSTLIB files keyed by 'GAL:'

    - snlc_sim.c
      Update fudge_EXPOSURE_TIME() function so that
      first iteration has x100 exposure time to get
      better estimate of S/N.

      Install new FUDGE2_SNRMAX key and blank fudge_SKYNOISE()
      function to do analgous fudge with sky noise to get
      fixed errors at all epochs (rather than fixed S/N).
      Will fill out this function in the next version.

   - snana.car :
     update FILTER_UPDATE_READ (from R.Biswas) to read both 
     SN and REF transmissions. Initial use is for SNLS3year,
     but this general structure will work on any survey.
     Also note that filter-updates work only with SALT2 ...
     needs more work for rest-frame models that use K-corrs.
     
     Add extra TRANSREF output arg  to get_filttrans(), and fix
     calling sequence in snlc_fit.car and snlc_sim.c

   - new utility from R.Biswas:
         $SNANA_DIR/util/convertsalt2snana.pl

  v9_29 [Mar 11, 2011]

   - snlc_sim.c
     fudge_EXPOSURE_TIMES() ->  fudge_SNR() to treat both
     FUDGE_SNRMAX and FUDGE2_SNRMAX. The former scales
     S/N, while the latter scales only the skynoise 
     (keeping SN flux unchanged).  The latter FUDGE2 
     is used to get more-or-less fixed errors at all epochs.

     in gen_lumipar, fix logical test on SIMSED model to avoid
     crazy behavior when SIMSED parameters are left in
     the sim-input file for a different [non-SIMSED] model.

   - SALT2mu.c 
     in read_data(), skip SN if any fit-par error is zero
     to avoid divide-by-zero.

     inside read_data(), move all raw-data arrays with [MAXSN]
     to global struct rawdata ... allows arbitrary MAXSN.
     Large local arrays inside a function give valgrind errors.


  v9_30 [Mar 21, 2011]

   - kcor.c
     in rd_filter(), use r2column() utility to allow
     comments at the top of the filter-trans files.

   - snlc_sim.c 
     Default GEN_SNDATA_SIM=2 (instead of 1) to get terse format.

     If FUDGE_SNRMAX>0 or FUDGE2_SNRMAX>0  then turn off
     zeropoint  smearing to avoid confusion if you forget
     to change 'SMEARFLAG_ZEROPT: 1' in the sim-input file.

   - snlc_fit.car
     new variable  FITWIN_CHI2SIGMA to cut on the extra
     chi2-sigma term (if used). In PHOTOZ fits this 
     chi2-sigma term can sometimes be very large and
     negative, which is likely a symptom of bad error
     evaluations. Default cut is -10, +50.     

   - util/split_and_fit.pl
     Few bug-fixes related to copying README and DUMP files
     from simulated directories.

   - mv candidateHostInfo.c  SDSS_candHostInfo.c
     and fix a bug found by Galbany and Dilday.

   - snana.car
     change  SNLC_RA, SNLC_DEC, SNLC_MJD ->
     REAL*8  SNLC8_RA, SNLC8_DEC, SNLC8_MJD.
     Will need better RA,DEC precision for SN position 
     near galaxy.


  v9_30G [Mar 27, 2011]

        !!!!! Install new  HOSTLIB Package !!!!!

   - snlc_sim.c : 
     install new HOST-GALAXY package with  include "snhost.c".
     Remove old HOSTLIB code and remove SDSS_galsim code.

     Note that random number sync changes.

     Each SN mag -> mag + SNHOSTGAL.SNMAGSHIFT .

  - snlc_sim.h :
      GENLC.SIMLIB_FILTERS_GLOBAL[20] ->
      GENLC.SIMLIB_FILTERS_GLOBAL[MXFILTINDX]
    to avoid overwrite with JPAS filters.

  - kcor.c :
    To allow more than 50 [JPAS] filters without hbook
    interference, hids 250-252 -> 290-292. Also create 
    new histogram hid=1 with version=2 so that RDKCOR
    knows what to do (see below).

    replace large multi-dimensional static arrays with
    multi-dim. pointers that are allocated based on
    needed size. Program size shrinks from 1.6 GB
    to under 100 MB. See new  function malloc_ini().

  - snana.car :
    Update RDKCOR to read IVER_KCOR from hid=1 and set
    hids accordingly. In particular, hids 250-252 
    become 290-292 when IVER_KCOR=2 for kcor files 
    created with this snana version and higher.
    However, RDKCOR can still read old kcor files 
    that have the default IVER_KCOR=1.

    Increase MXFILT_OBS -> 62 (was 50) ... to handle
    56 JPAS filters !


  v9_31 [Mar 29, 2011]

       !!! fix problems related to 56 filters !!!
       !!! fix dumb bug for kcor error        !!!

   - snana.car 
     in SNANATUP, increase MXNTVAR from 300 to 400.
     In main keep, MXFITSTORE -> 500 (was 400)

   - sntools.c , wr_SNDATA();
     for list of filter-dependent quanities (such as SIM_PEAKMAG: xxx)
     put <CR> after every 10 variables to prevent char-overflow
     for parsing routines. Fixes problem with 56 filters.
     The problem before was that 56 values took more than 400 chars,
     which is the limit per line for the parsing function.

   - genmag_SALT2.c : fix dumb bug in  fracerr_kcor.
       Now the diagonal kcor errors will be reasonable.

   - snlc_fit.car : 
      if CUTWIN_REDSHIFT is not set, set zmax=3 inside SEDMODEL_INI
      for the initialization of the SALT2 model. Prevents trying
      to init SALT2 for Zmax up to 1E9.


  v9_32 [Mar 29, 2011]

   - sntools.c : add new utility file_timeDif(file1,file2) to return
                 the time-stamp difference between two files.

   - genmag_SIMSED.c : 
     Use new file_timeDif() function to abort if the flux-table binary
     file is older than the SED.INFO file. Avoids mistaken use of
     a stale binary when the SIMSED model is updated.

   - snana.car :
     IFILT_OBS_EVAL_MASK -> INTEGER*8 IFILT_OBS_EVAL_MASK(2)
     to handle 64 filters. New functions FILTBSET and FILTBTEST 
     are the 128-bit analogs of IBSET and BTEST.
     Note that the 42 filters for JPAS over-write IFILT_OBS_EVAL_MASK
     in previous snana versions ... not sure what the impact was.


  v9_33 [April 4, 2011]

   - sntools.c  fitresVar_ini():
     bugfix: IDGAL -> GALID

     new function interp_1DFUN() combines functionality
     of interp8() and lamInterp().  Use only interp_1DFUN()  
     in all snana programs; the old interp8() and lamInterp()
     are now obsolete.

     New utilities  init_1DINDEX() and get_1DINDEX  to handle
     converting multi-dimensional indices into a single index.

   - split_and_fit.pl: 
      fix a bugs for interactive use and when there is no
      SIMGEN_DUMP file.     

   - snlc_fit.car :
     F7.3 -> F8.4 for fit-parameters in fitres file

   - snhost.c : 
     Replace buggy IGRIDOFF stuff with new 1DINDEX
     functions.
     Previous version worked only if NGRID was the same
     in each wgtmap dimension.

   - genmag_SEDtools.c :
     fix really dumb bug in function get_SEDMODEL_INDICES();
     I0SED and I1SED were switched ?!?!? Not clear if this
     bug had any negative impact, but this fix is needed in 
     the upgraded SIMSED_extractSpec.c (below).

   - SIMSED_extractSpec.c :
     finally upgrade code to do the interpolation in 
     SED-parameter space.


  v9_34 [April 7, 2011]

   - snlc_sim.h :
     char  CUTWIN_SNRMAX_FILTERS[MXCUTWIN_SNRMAX][20];
      ->
     char  CUTWIN_SNRMAX_FILTERS[MXCUTWIN_SNRMAX][MXFILTINDX];

   - genmag_SEDtools.h: :
     increase MXZBIN_SEDMODEL -> 500 (was 300)

   - snhost.c : 
     *  fix dumb bug that always set b = a, resulting in
        circular profiles instead of elliptical.
     *  fix rotation bug that had  ygal -> -ygal.

  - snana.car : 
     * increase MXBIN_LCPLOT -> 600 (was 500)  for JRK07 
     * print $MACHTYPE and SNANA_DIR_NAME near top for
       better identification.


  v9_35 [April 11, 2011]

       !!! switch from F77 to gfortran !!!

   - combine_fitres.c :
     replace large arrays XVAR8 and XNTVAR with pointers
     and dynamically alloate in function fitres_malloc().
     Program size is now 130 MB, x10 smaller than before.

   - in Makefile, set FC = gfortran and make associated changes.

   - genmag_SIMSED.c :
     read/write name of kcor file to fluxtable binary file
     to make additional checks. Make sure that name of kcor file
     is the same, and that the kcor file was created BEFORE
     the binary file.

     Also read/write size of REDSHIFT_SEDMODEL struct to 
     protect if/when MXZBIN_SEDMODEL changes.

   - SIMSED_extractSpec.c :
     --tlist filename can  now contain the name of the
     output file after each Trest value. If this file exists,
     spectrum is appended; else the spectrum is written
     to a newly created file.  Old-style Trest files with
     only Trest (and now spec filename) still work, using
     a default file-name of SIMSED_[Trest].SPEC.


  v9_36 [April 13, 2011]

   - genmag_SEDtools.h :
     MXZBIN_SEDMODEL -> 500 (mistakenly left this at 300 while
     debugging previous version)

   - genmag_SIMSED.c 
     BINARYFLAG_KCORFILENAME -> 1 after having mistakenly
     left this flag at 0  in previous version.

   - SALT2mu.c : 
      * bug fix to allow longer fitres-filenames.
      * other bug fixes for output SALT2mu.fitres file.

   - util/split_and_fit.pl  
     source the FIT scripts to allow 'setenv' commands
     in the login setup

   - util/split_version.pl : fix dumb bug



  v9_37 [April 25, 2011]

   - snlc_fit.car :
     Inside FITMODEL_INI,
       USER_FITMODEL_NAME*20 -> USER_FITMODEL_NAME*60
     to allow longer fit-model names. This is really just
     a dumb-bug fix.

     new function FCNCHI2_SIGMA to clean up code and fix 
     bug when new filter is added in 2nd iteration of photoz 
     fit. When a new filter is added,  FLUXERR=0 and thus 
     FLUXERR/LAST_FLUXERR is nan.
     The fix is to just set this chi2-term = 0 and to 
     set LREPEAT_ITER=T if a filter will be added next iteration.
     In short, a repeated iteration is done when a filter is added;
     previously a repeated iteration was done only when a filter
     is dropped. See changes in PHOTOZ_ANA.


  v9_38 [April 27, 2011]

     - fix OPT_LANDOLT-related bug in FITPAR_INI

     - snlc_sim.c : 
       new input EXPOSURE_TIME_MSKOPT=7 (default) to control
       applying exposure time to ZPT, SKYSIG and CCDNOISE.

       new function get_SIMLIB_SCALES()  to determine EXPOSURE_TIME
       shift/scale separately for ZPT, SKYSIG, CCDNOISE.

       EXPOSURE_TIME works the same as before (default),
       but the CCDNOISE can be fixed by setting
          EXPOSURE_TIME_MSKOPT: 3
  
   - SDSS_sndata_build.c :
     more efficiency lookup for USER_PEAKMJD, and write
     comment 'SQLDB' or 'SNANA-FIT' next to SEARCH_PEAKMJD.


   - snlc_sim.c and snana.car
     fix simulation bug for very red obs-filter with 
     <LAMOBS>/(1+z) > 12000 A causing an abort.
     Inside NEAREST_IFILT_REST, allow new bit-option so that
     function returns -9  when a nearest-filter is not found
     (instead of aborting). 
     Inside snlc_sim.c, use this bit-option so that it does
     not abort, but rather returns IFILT_NEAR = -9.

     This bug crept in on Nov 15, 2010 when I changed
     NEAREST_IFILT_REST to abort (intead of return -9)
     if near-filt match is not found.


  v9_39 [May 03, 2011]

     !!! With help from J.Guy, SYNC SNANA-SALT2 mags   !!!
     !!! to original SALT2/snfit code                  !!!

   - snlc_fit.car : fix ABORT-message bug in FITINI_AVPRIOR.

   - snana.car
       MXLAMBIN_FILT = 1000  (was 600:  Request from Rodney/HSTMCT)

   - kcor.c :
     in booking function wrkcor_hbook(), change rebin=2 to rebin=1.
     This ancient memory-saving feature was causing subtle errors
     in the SALT2 mag calc because the filter-binning did not match
     the SED binning.

     in rd_input(), abort if FILTPATH key is repeated 
     without the MAGSYSTEM_IGNORE option

   - genmag_SALT2.c :  
     Major change to do brute-force integration instead of using
     CFIT logic. Even with 4th order CFIT polynomial, there were 
     always cases that did not work so well. The CFIT functions 
     are all excluded by the [missing] C-pre-processor flag 
     SALT2_CFIT_FLAG. To prevent too much loss of speed, the color 
     correctionand Galactic extinction are read from lookup maps.
     The integration is over obs-frame filter-lambdas.

     Add new SALT2.INFO option
       SEDFLUX_INTERP_OPT:  2  # 1=linear(default) 2=spline
     To prevent speed degradation, the interpolation is done 
     during initialization and the SED is stored on a finer
     grid so that fast linear interpolation is done inside
     the filter-integration.  The current 'spline' function
     is really just  quadratic interpolation in LAMBDA followed
     by quadratic interp in TREST.  Perhaps in a later version
     bi-cubic interpolation will be installed.  Note that
     spline-interpolation in the TREST dimension is much more
     crucial than in the LAMBDA dimension.

     Fixed bug compute 'relx1' used in error calc.

     SPEED DEGRADATION: simulation and fitting is now 40% slower.

     NLAMPOW_SEDMODEL=4 (was 2) to get better parametrization
     of color within each filter. With c=0.5, previous version
     gives ~.01 mag SALT2-mag discrepancies (SNANA vs. snfit),
     and with 3rd-order polynomial this discrepancy is .001 mag,
     or x10 smaller.
     new function set_SALT2_CFIT to define lambda bins to 
     fit colorlaw vs. lambda at each epoch. THere is also
     a special check for u-leakage, but the logic is somewhat
     specialized for the SDSS-u filter.


  v9_39b [May 4 2011]

      [Mainly dumb-bug fixes related to changes in previous version.]

    - split_and_fit.pl : if HFILE_KCOR exists, copy it to outDir.

    - snlc_fit.car  SUBROUTINE PLOTPREP_FITRES
      don't plot SIM flux vs. epoch if sim-model is SIMSED,
      otherwise c=-9 and we get segfault. See new logical SKIP_SIMLC.

      Fix small bug in RESID_TUP (ntuple 7799);
      related to artifical Trest=0 values.

    - genmag_SALT2.c
      fix dumb bug; forgot to protect 'ic' color index
      inside the INTEGSALT2 function.


  v9_40 [May 7 2011]

    - genmag_SEDtools.c
      For better numerical precision, major re-write in 
            init_flux_SEDMODEL()
            interp_flux_SEDMODEL()
      See comments at top of each function.

      rename function fetchpar_SIMSED() (from genmag_SIMSED.c) 
      to fetchpar_SEDMODEL(), and move into genmag_SEDtools.c.
      Also add *NBPAR return argument. Then call this function
      for each parameter after reading SED.INFO file and print
      one-line summary per parameter to screen.
 
   - genmag_SEDtoos.h:
     define arrays NBIN_PARVAL[ised], PARVAL_MIN[ised], PARVAL_MAX[ised].
     They are not needed now, but they may be useful at some later time.

   - genmag_SIMSED.c
     pass PATH_BINARY and SURVEYNAME to construct more robust
     name of binary file. See new sim-input key
       SIMSED_PATH_BINARY:  <path>
     Env variable $SIMSED_PATH_BINARY can also be used.
     See updated Sec 8.4 of manual.

   - sndata.h :  SURVEYNAME[20] -> SURVEYNAME[40]
   - snlc_sim.h: GENLC.survey_name[40] -> GENLC.SURVEYNAME[40

   - snlc_fit.car
     Include SIMSED parameters in fitres file.

   - SALT2mu.c  allow SIMSED representation for SALT2 color and x1

   - util/split_and_fit.pl :
     Count GRACEful finishes and ABORT and give more info than
     just the number of DONE files.



  v9_41 [May 15, 2011]

   - snlc_sim.c
     For rate calc, replace  "rtmp = rate_model(ztmp);"
     with  "rtmp  = genz_rewgt(ztmp);"   so that the
     rate-calc includes any user-fudges such as from
     DNDZ_ZPOLY_REWGT. 
     [Bug caught by B.Hayden at Notre Dame.]
     Also get rid of options for DNDZ: DATA.

   - snlc_sim.h : increase INPUTS.GENMODEL[40] -> GENMODEL[60]
     May need longer names for combined-versions used in
     SALT2 training

   - new SDSS program SDSS_reCalib_SMP.c  to re-calibrate
     SDSS SNe based on DEC. Current code just reads Holtzman's
     data files, reads John's corrections, and writes out 
     the data files with no changes. May need to also read
     calib stars for each SN to apply proper re-calib.

   - sntools.c
     red_sedflux() has new arguments MXDAY and MXLAM to allow
     internal checks that passed array bounds are not exceeded.
     ABORTs if either array bound is exceeded.

   - kcor.c , genmag_SIMSED.c , genmag_SALT2.c : 
       pass new array bound args to rd_sedflux()

   - snana.car
     MXLAMBIN_SNSED -> 3000 (was 1600)

   - genmag_SEDtools.h :
     MXBIN_LAMSED_SEDMODEL -> 5000 (from 2100)


  v9_42 [May 27, 2011]

   - remove obsolete SDSS programs:
     SDSS_get_forcephoto.c SDSS_get_modelphoto.c SDSS_get_searchphoto.c 

   - genmag_SIMSED.c 
     inside interp_flux_SIMSED(), fix bug to allow just 1 SED.      

   - fitresFile_init(char *inFile) inside sntools.c:
     ABORT if EOF is reached without any fitres keys,
     or after reading 10,000 items without any keys.
     => prevents infinite loop searching for non-existant keys.

   - genmag_SALT2.c :
     fix dumb bug checking interpolation at nodes.
     => avoid checking first DAY and LAMBDA bin where
        there are extreme variations.

   - util/split_and_fit.pl
     add optional input key  DONE_STAMP: <filename>

   - sndata.h:
     SNDATA.RA[DEC] -> double (was float)
     define new char SNDATA.CCID[20] 

   - snfitsio.c
     new utility to write/read data files in fits format.
     Currently called by snlc_sim.exe to write sim-data
     files in fits format. Note that this feature is
     still under development ==> NOT ready yet.

   - updates for SIMSED_prep.c[h] from B.Diemer.
     Reads SEDs generated by Pheonex and translates
     non-uniform lambda binning into uniform lambda
     binning.

   - snlc_sim.c :
     set GENLC.NOBS=0 inside fudge_SNR() to fix bug
     of NOBS being double when FUDGE_SNRMAX is set.

   - snana.car :
     GLOBAL_BANNER*80 -> GLOBAL_BANNER*120 to allow
     Benedict's really long version names.

   - snhost.c :
     for GALMAG option compute Galactic extinction in each
     filter and add to the observer-mags given in the HOSTLIB.

  v9_43 [June 03, 2011]

   - snana.car [RDSNNML] and snlc_fit.car [RDFITNML]
     add END=902 when reading namelists in order to
     properly flag non-existent namelist.  Previous 
     code just gave segfault for non-existant  namelist.

     WRSATL2_2: write redshifts with F8.5 instead of F7.4

   - in /util, 
         rm  ntprint.cmd   ntdump.cmd  ntappend2fitres.cmd  
     and then create ntprint.pl  ntappend2fitres.pl
     In short, C-shell scrupts ntprint.cmd and ntappend2fitres.cmd
     have been replaced with perl scripts that are much faster.

   - create util/mkfitplots.pl  (perl version of mkfitplots.cmd).
     The older mkfitplots.cmd will be kept for a few more versions
     before I remove it.

   - in /util many of the SDSS-specific scripts  xxx.cmd(tcl)
     have been re-named to SDSS_xxx.cmd(tcl). However, internal
     dependencies have not been checked so beware running
     any of these old scripts if it cannot find the original
     xxx.cmd (or xxx.tcl) script.

   - snlc_sim.c, append_SNDATA_ters()
     write FLUXCAL as %11.4le insteadl %10.3le

   - snlc_fit.car
     Remove obsolete routines PLOT_COVAR and TEST_COVAR.
     "size of snlc_fit.exe" reduced by 144 MB after 
     removing large 2-d COV arrays that are not needed. 
     Program size : 1140 MB -> 996 MB.

     Integrate gencovar_SALT2() the same way as gencovar_mlcs2k2().
     OPT_COVAR >= 1 now uses colorDispersion covariance.

   - genmag_SALT2.c :
     add new function gencovar_SALT2() to return covariance matrix
     using color dispersion.

   - split_version.pl:
     fix aweful bug that lost the IGNORE epochs ;
     now the SPLIT*.IGNORE file is linked back the original IGNORE
     file the same way as the SPLIT*README file.


  v9_44 [June 9, 2011]

   - new util/SNANA_tester.pl  to replace SNANA_tester.cmd

   - snlc_fit.car
     For OPT_COVAR=2, make fix to pass current color/stretch/PEAKMJD
     to FITINI_COV instead of using value from previous iteration.
     For SALT2 model, xx1 = last x1_fit is passed if DOCHI2_SIGMA=F.

   - SNcadenceFOM.c : RK made a few changes, mainly passing MJDGAP_IGNORE.
       
   - SIMSED_extractSpec.c :
     use SNANA_MODELPATH if it is defined.

  v9_45 [Jun 10, 2011]

  - genmag_SEDtools.c :
    IFILTSTAT_SEDMODEL now checks min/max lambda as well
    as the mean.

  - genmag_SALT2.c & genmag_SEDtools.c: 
    fill new elements SEDMODEL.MINLAM_ALL and SEDMODEL.MAXLAM_ALL
      to use in IFILTSTAT_SEDMODEL() above.

  - snlc_fit.car 
    modify WRHEAD_FITRES to include SIMx0 and SIMmB if either
    FITMODEL or SIM_MODEL = SALT2. Needed to ensure the same
    FITRES headers when combining SALT2 and NON1a fitres files.

  - snlc_sim.c
    define NON1A_SDIR = "non1a" instead of "NON1A" because
    Mac OS cannot distinguish upper/lower case.
    Removed symbolic links NON1A/ -> non1a/  under
    $SNDATA_ROOT/snsed and in $SNDATA_ROOT/models.


  v9_46 [Jun 23, 2011]

   - snhost.c : split into  snhost.c & snhost.h

   - sntools.c :
     install getInfo_SNANA_VERSION() to get directory and
     listFile for arbitray version. Needed for general
     data-readback utility for fits-files.

   - new utilities snfitsio.c & snfitsio.h to write/read 
     sndata files in fits format.

   - Makefile : 
       * add   make ../obj/snfitsio.o  
       * link sim, snana.exe and snlc_fit to snfitsio.o


   - snana.car 
     PARSE_WORDS:  for LUN=0 option where FILE = STRING,
     break up string into multiple lines if len(STRING)>350.
     Also remove slow initialization of FILEWORD_LIST(iwd) ;
     text-file reads are noticably faster !

     Integrate snfitsio functions into snana.car.
     Subroutine RDSNDATA -> RDSVERSION_TEXT & RDSURVEY_FITS
     New subroutine CHECK_FORMAT sets FORMAT_FITS logical.

     In PARSE_EPOCH  call LCUTEPOCH inside LTEMP2 if-block
     for FORMAT_TERSE => apply epoch cuts for TERSE format.
     Previously only the MJD/Trest cut was applied for
     TERSE format; now it also checks IDTEL and FIELD.

     Remove these obsolete variables
     &   REDSHIFT_VAL(MXZSPEC,MXSNLC)  ! redshift value
     &  ,REDSHIFT_ERR(MXZSPEC,MXSNLC)  !  "       error
     &  ,REDSHIFT_MJD(MXZSPEC,MXSNLC)  !          MJD
     &  ,REDSHIFT_MEAN                 ! <REDSHIFT_FINAL> after cuts
     &  ,REDSHIFT_RMS                  ! RMS of REDSHIFT_FINAL
     &   REDSHIFT_SOURCE(MXZSPEC,MXSNLC)*20  ! 'SN-SPECTRUM' or 'HOST-SPECTRUM'
     &  ,REDSHIFT_TELESCOPE(MXZSPEC,MXSNLC)*20  ! MDM, HET, etc ...
     &  ,SNLC_PHOT_SN(MXSNLC)
     &  ,SNLC_PHOT_SNHOST(MXSNLC)

    and remove CUTBIT_PHOT_SN[HOST]
    Remove obsolete  +KEEP,REDSHCOM.

  - Makefile
    fcasplit -> "fcasplit -f gfortran"  so that libraries
    are compiled with gfortran instead of f77.  Note that
    f77 was replaced with gfortran several versions ago,
    but I did not notice that the libraries were still
    compiled with f77.

  - sim_SNmix.pl : minor fix to suppress useless STDOUT  (>2/dev/null)

  - new perl function  Killjobs.pm so that any script
    can easily pass @NODELIST to ssh and kill all jobs
    on all nodes.

  - snlc_sim.c :
    change syntax of SIMSED_PARAM in sndata files.
    Combine two keys into one,
      SIMSED_PARAM: COSANGLE -> SIMSED_PARAM(COSANGLE):
    Change needed to read TEXT or FITS with same 
    READ_HEADKEY() function.

    WARNING: current version cannot read the SIMSED_PARAM
             values from previous versions.

  - cat Parse.pm Killjobs.pm > sntools.pm 
    and remove Parse.pm and Killjobs.pm.  
    Modify all other pl scripts to use sntools.pm.

  - remove SNANA_test.cmd (use only SNANA_tester.pl)

  - Updated SNcadenceFoM.c from Belov.
    Ignores large seasonal gaps.
    Minor fix by RK: if there is just 1 epoch, return 0 instead of -9.

  - util/mkfitplots.pl   &    kumacs/snana.kumac
    ==> new macro options 
        vscale=[vscale]  -> scale vertical size of plot
        grid=0   -> turn off grid
        vert=0   -> switch to horizontal layout
        eps=1    -> eps file per SN
     See top of mkfitplots.pl for precise syntax.
     To use the horizontal format the chi2 plots must be
     turned off,
       mkfitplots.pl --h <hfile> NOCHI2 H1 --vscale 1 [etc ...]
     and adjust the vscale parameter to optimize the vertical height.

  - SALT2mu.c : updates from J.Marriner;see Jun 20 comments at top of file.



  v9_50 [July 7, 2011]

    WARNING: 
      To get same SEARCHEFF functionality as in previous versions, 
      replace
          "APPLY_SEARCHEFF_OPT: 1"
      with
          "APPLY_SEARCHEFF_OPT: 3"
      
      If using default "APPLY_SEARCHEFF_OPT: 0" then no change 
      is needed. See manual Sec 3.12 for details. 

  - snlc_sim.c :
    Write SIM_STRETCH only for STRETCH-model;
    no need to confuse with approx stretch in other models.

    At end of writing TERSE format write "END_PHOTOMETRY:"
    instead of "END :" ... because SPEC information may follow.

    Significant re-organization for init_SEARCHEFF and gen_SEARCHEFF.
    New spec-efficiency is now multi-dimensional map rather than
    analytic function. Legacy keys SPECTYPE and HUMAN_SEARCHEFF_OPT
    are now slated to be deleted at some point when the new
    option is debugged.

    Allow new SIMGEN_DUMP variable MKSIMEFF to match ntuple name.

    New function SPECTYPE_EFF to evaluate efficiency from
    "SPECTYPE:" key. Called from gen_SEARCHEFF_SPEC() as
    a legacy option.

  - manual:    
      new: UNCONFIRMED_SPECZ_FRACPOLY
      modified: APPLY_SEARCHEFF_OPT -> bit-mask

  - rename snpar_unfold.c -> unfold_snpar.c
    Fix a few dumb bugs.
    Allow command-line override for DATA_FILE and HFILE_OUT

  - new utility  util/unfold_MCstaterr.pl
    Chop up large simulated fitres file and measure the
    spread in MEAN and RMS from unfolded distributions.

  - snana.car 
    Fix RDEPIGNORE to skip when reading same file on
    2nd version.

    Upgrade WRSALT2_2 to read and write spectra if
    they exist in the SNDATA files.

  - split_and_fit.pl :
    Upgrade to handle both data and sim-versions together.

  - new script  util/HOSTLIB_randomizer.pl  to randomize the
    galaxy entries (By D.Cinabro)

  - sntools.c[h]
    New functions  init_interp_GRIDMAP and interp_GRIDMAP
    to simplify multi-dimensional interpolation.
    See new struct GRIDMAP.

    Modify sndata_open() to return fp=NULL instead of aborting
    when file is not found.

  - kcor.c :
    if sndata_open() returns NULL then abort.

  - snhost.c[h]: modify to use interp_GRIDMAP() utility 
    function in sntools.c .


  v9_51 [July 11, 2011]
    - atmosphere_sim.c: add to Makefile and to PUBLIC.LIST

    - snlc_sim.c :
      for SIMSED model include all baggage "SIMSED_param" parameters
      by default. Ignore "SIMSED_param:" keyword in sim-input file.
      Also, all SIMSED_PARAM/params get added automatically
      to the SIMGEN_DUMP list.

     increase MXSIZE_SPECEFF to 300,000.
     Free temp SPECEFF memory after it's used.


  v9_52 [July 12, 2011]

   - kcor.c : 
       in kcor_ini() add extra K_XX if BX filter is defined.
       Fix dumb bug in function kcor_input_override

   - kcor.h: FILTER[ifilt].PATH[40] -> .PATH[200]

   - snana.car : another BX filter fix in RDKCOR. Define X as rest-frame
                 filter when it is NOT part of any K-correction,
                 but is flagged as a rest-frame filter.
 
   - snlc_sim.c :
     fix bug in init_SEARCHEFF_SPEC: abort of user-requested
     file does not exist.

   - new utility  get_fitresValue.pl


  v9_53 [July 20, 2011]

   - SALT2mu : 
      bug fix, "S2ERR" -> "ERRCODE " (with blank space)
      Dynamically allocate memory instead of MAXSN=100,000;
      use stat() function to get size, then uze file size
      and NVAR to estimate number of SN to allocate memory.

   - split_and_fit.pl
     New option "COMBINE_ALL_FLAG: 1" to combine all fitres 
     and ntuple files into a summed file.

   - snana.car : 
     in PARSE_HOSTGAL  make special hack for SDSS so that
     host-galaxy info is read for ugriz and not for 'ugrizUGRIZ'

     Fix bug in FILTMATCH that matched filters when LEN=0 for
     one of them, but not the other. This fix is needed to
     fit ugrizUGRIZ where the kcor file also has rest-frame
     Bessell-UBVRI; need to distinguish Bessell-U from SDSS-U,
     etc ...

     re-organize MAIN a little;
     SNRECON, U3BAND, SET_CUTMASK and MON_SNANA are all
     inside the same 'isn' loop as the fitting/USRANA loop.
     SNRECON and U3BAND now have ISN as input argument
     instead of looping over all SN inside.

     re-organize SET_ZPOFF to be used by RDKCOR and also
     by FILTER_UPDATE_DRIVER.

   - snlc_fit.car :
     ABORT if there are zero K-cor tables when FITMODEL_NAME
     is a rest-frame model.

     Fix bug in FITINI_COV that essentially removed the
     FUDGE_FITERR options. Problem was that PEAKMJD=0
     on ITER=0 leading to TREST that never satisfies 
     FUDGE_FITERR_TREST window.

     Call new function GET_FUDGE_FITERR_MAXFRAC(..)
     to clean up FITINI_COV function.

     New &FITINP namelist options
       FUDGE_FITERR_MAXITER
       FUDGEALL_MAXFRAC
       FUDGEALL_ITER1_MAXFRAC
       (see manual update)

    Write WARNING message if fitting subset of SURVEY_FILTERS.

  - kcor.c :  use sndata_open() utility to find filter-trans
              files and to find ZPOFF.DAT file.
              Now the ZPOFF.DAT file is found when using
              private filters.

   - snlc_sim.c :
     inside snlc_to_SNDATA(), write out INPUTS.GENFILTERS to
     data files  instead of writing  the SIMLIB filters. 
     This allows writing out only a subset of the SIMLIB filters, 
     and avoids exceeding KCOR table bound in the fitter program.

     in readme_doc(), write info about APPLY_SEARCHEFF_OPT

  - SDSS_reCalib_SMP.c : write IDCCD as extra column in SMP data file.



  v9_54 [July 25, 2011]

      *** More than 200 MB reduction in program size ***
      *** for snana.exe and snlc_fit.exe             ***
      *** &FITINP namelist OPT_SIMEFF removed        ***

   - snana.car
     in GET_FILTTRANS abort if filter is unknown. 
     This is to catch simulations that define an observer
     filter for which there is no transmission function
     in the KCOR file.

     Replace multi-dimensional R4KCORTABLE(...) with 1-d
     R4KCORTABLE1D(KBIN), and use GET_1DINDEX to connect
     5 indices onto 1 index. KCOR memory is reduced from 
     176 MB -> 32 Mb.  Same trick for option I2KCORTABLE,
     where a patchy flag is needed to switch from R*4
     to I*2 (see snlc_fit.cra).  Also switch to 1D indices
     for LCMAG_TABLE1D, MWXT_TABLE1D and AVWARP_TABLE1D.
     The KCOR-related max-bins have been increased since 
     the add neglible memory and allow for a broader range
     of K-cor files,

       Increase MXTBIN_KCOR  (110 -> 150)
       Increase MXZBIN_KCOR  (80  -> 100)
       Increase MXAVBIN_KCOR (50  -> 100)
       Decrease MXEPOCH      (600 -> 500)  [and also in sndata.h]

     Beware 2000cx 1994D that have more than 500 observations,
     but only if the CUTWIN_TREST extends more than 100 days
     past peak.

     Here are the static program  sizes 
     (previous version -> current):

       size snana.exe      =  882 MB -> 652 MB
       size snlc_fit.exe   = 1009 MB -> 776 MB
       size snlc_sim.exe   =  661 MB -> 479 MB

      Remove routines RDSIMEFF and SNLC_SIMEFF()
 
   - /kumacs/snana.kumac and mkfitplots.pl
     new option --nrowpage <nrowpage> to specify number
     of filters to show per page. Default is min(7,nfilt).

   - remove obsolete program "simeff_rewgt.c"

   - new script util/SIMEFF_MAPGEN.pl (to replace SIMEFF_MAPGEN.cmd)
     See example in
        $SNDATA_ROOT/analysis/sample_input_files/simeff_mapgen/

   - sntools.c :
     Fix interp_GRIDMAP() to allow interpolated function to be zero.
     Add new utilities to read and interpolate SIMEFF maps:
      init_SIMEFFMAP(),   get_SIMEFF(),   malloc_SIMEFFMAP()

   - snlc_fit.car
     Remove obsolete nml variables OPT_SIMEFF ande OPT_PRIOR_WV07
     Remove subroutine WV07_SIMEFF.
     Actually, if OPT_SIMEFF is set to non-zero, the fitter 
     will ABORT with a message to use SIMEFF_FILE instead.

     Use new functions INIT_PRIOR_SIMEFF and  SNLC_FIT_SIMEFF() 
     to initialize and fetch efficiency for prior. The main goal
     here is to use the generic multi-dimensional interp utility
     "interp_GRIDMAP()" and to allow for arbitrary parameters
     to describe the efficiency.

   - snlc_sim.c
     new input key GENRANGE_MWEBV[2], mainly for generating
     effic. map that depends on MWEBV.


  v9_55 [July 29, 2011]

   - snlc_fit.car 
     In FITINI_COV abort if OPT_COVAR>0 for model that
     does not have covariances.

     FUDGE_FITERR_PASSBANDS*8 -> FUDGE_FITERR_PASSBANDS*80

     Make photoZ fits more robust by requiring that the final
     photoz satisfies the bound for each filter.  See end of
     PHOTOZ_ANA().  Motivated by frequent aborts when J.Marriner
     processed the SDSS TYPE=104 sample.  This new cut rejects
     84 SNe, but  there are only 19 fewer SNe after all cuts:
     the fitted TYPE=104 sample is reduced from 769 to 750.

   - kumacs/snana.kumac : fix bug print Zph or MU on top of page.

   - genmag_snoopy.c 
     read EXCLUDE_RANGE keys from SNOOPY.INFO file
     extrapolate early times to have continuous model; see Textrap  

   - snlc_sim.c
     Install COVMAT_SCATTER code to apply intrinsic scatter
     matrix to SALT2. 
       PARSE_COVMAT_SCATTER()
       INIT_COVMAT_SCATTER()
       GEN_COVMAT_SCATTER()
     Need to burn three more randoms per SN, so random
     sync may change relative to previous snana version.

   - SIMSED_extractSpec.c : update from J.Mosher.

   - /util
     Remove SALT2train_simprep.pl
     Add new scripts from J.Mosher:
        TRAIN_SIM.pl
        SALT2train_translate.pl

   - snana.car 
     increase MXLISTNML from 30  to 50


  v9_56 [Aug 03, 2011]

   - update snana manual about COVMAT_SCATTER options 

   - remove broken 'snmake' and create/update  util/snmake.pl

   - update obsolete 'snana_private.cra' and 'snlc_fit_private.cra'

   - remove util/mkfitplots.cmd (use only mkfitplots.pl)

   - ../util: "use strict" in several perl scripts.

   - fix lots of compilation bugs/WARNINGS found on Ishida's compilier.


  v9_57 [Aug 8, 2011]

   - snana.car :
     * MXLINE -> 40,000 (was 20,000)
     * fix dumb bugs related to using PRIVATE_DATA_PATH
       
   - wfit.c[h] : fix compile warnings with void* -> Cosparam*

   - lots of updates to SALT2-training scripts.

   - snlc_fit.car 
     * abort if OPT_LANDOLT>0 but BX filter is not defined.


  v9_58 [Aug 12, 2011]

   - new script util/survey_update.pl

   - genmag_snoopy.c :
     read error map based on ERRORFILE key in SNooPy.INFO file.
     Do NOT yet replace current SNOOPY_GRID.FITS file => 
     mag errors are still fixed at 0.1 mag.
     The FITS-grid will be updated when a better errorm model
     is available; current errors vary wildly with dm15.

  - snlc_fit.car
     fix bug aborting when OPT_LANDOLT>0 and no BX filter (from v9_57).
     Check BX in OBS-frame and REST-frame separately.


  v9_59 [Aug 22, 2011]

   - snlc_sim.c:
     if SEARCHEFF_SPEC_FILE is set then internall set
     INPUTS.SPECTYPE_SEARCH_FLAG = 1 

   - update util/SALT2train_run.pl from JLM

   - util/split_and_fit.pl :
     add Error checking after merging; create DEBUG version(s)
     to quickly re-fit SN with errors.

     Cleanup final fitres files by removing excess NVAR and VARNAMES
     keys, and add comments at top to specify VERSION and FITOPT.


   - snana.car 
     - add a few more FLUSH(6) calls.

     - make  perl versions of util/backup* scripts,
        backup_SNANA_PUBLIC.cmd    -> backup_SNANA_PUBLIC.pl  
        backup_SNDATA_ROOT.cmd     -> backup_SNDATA_ROOT.pl
        backup_SNDATA_version.cmd  -> backup_SNDATA_VERSION.pl

  - snlc_fit.car :
      RDFITNML: remove default cut on FITWIN_CHI2SIGMA (from v9_30)
      SALT2xx1: adjust DOCHI2_SIGMA logic for PHOTOZ fits.

      Add SIGCHI2 into fitres-ntuple to show chi2-contribution
      from the log(sigma) term.

      in FITINI_COV, add R4FIT_FUDGEFLUX_ERR**2 to cov-matrix
      so that FITERR_FUDGE_XXX options are used when OPT_COVAR > 0.
      Before this version the FITERR_FUDGE_XXX options were ignored
      when OPT_COVAR > 0 for SALT2. However, since the regular chi2
      is always used on the 1st iteration, Benedikt's FLASH fits 
      were OK because the FITERR_FUDGE is applied only on the 1st 
      iteration.
  
      I realized that OPT_COVAR>0 was NOT compatible with photoz fits
      because the log(sigma) "SIGCHI2" term was NOT included in the
      CHI2 that was based on the covariance matrix. Even worse, a bug
      caused the fit-function to return the nominal CHI2 when only the 
      log(sigma) term was requested, and the default FITWIN_CHI2SIGMA 
      cut (-10 to +50, see v9_30) was rejecting many SNe for no good 
      reason. Recall that the log(sigma) term is automatically included
      for photoZ fits. The fixes are 
        1) remove default FITWIN_SIGMACHI2 cut 
        2) add sum of log(sigma) to the CHI2 when using the covariance 
           matrix; this allows using OPT_COVAR > 0 with photoZ fits, 
        3) include the SIGCHI2 term in the fitres ntuple (7788) so 
           that users can adjust FITWIN_CHI2SIGMA (&FITINP namelist) 
           as needed, and 
        4) fix bug so that correct log(sigma) term is returned for 
           any value of OPT_COVAR. 
      The SALT2-photoz difference between OPT_COVAR = 0 & 1 is likely 
      small; for SDSS-II photometrically identified candidates (TYPE=105), 
      the fitted Zphot difference averages to 0.001 with an rms of 0.006. 
      The corresponding SIGCHI2 distributions have means below 1 with 
      RMS of 2.8 and 2.6 for OPT_COVAR=0,1, respectively.  Beware that 
      bad fits may have large values of SIGCHI2, so setting FITWIN_SIGMACHI2 
      may be needed to avoid pathological fits.

      I also noticed how a seemingly harmless change inside FCNSNLC
      (the MINUIT-callable function) can change the fit-results at
      the 4th or 5th significant digit:
          chi2 = chi2 + delchi2 + delchi2_sigma
               and
          chi2 = chi2 + delchi2 ; chi2 = chi2 + delchi2_sigma
      look the same but give slightly different results.
      Not sure if this is a compilier problem. Below are the 
      v9_58(OLD) vs. v9_59(NEW) discrepancies in the SNANA_tester
      photoZ fits due to the above difference in how the chi2 
      is defined:      
       ZPHOT_SDSS_SNnoHOST_4PAR:     mis-match (OLD != NEW) 
           ==> OLD: ZPHOT-1032 = 0.11041 +/- 0.6206E-02(m)     
           ==> NEW: ZPHOT-1032 = 0.11035 +/- 0.6176E-02(m)     
       ZPHOT_SDSS_SNnoHOST_5PAR:     mis-match (OLD != NEW) 
           ==> OLD: ZPHOT-1032 = 0.73357E-01 +/- 0.2111E-01(m)     
           ==> NEW: ZPHOT-1032 = 0.73004E-01 +/- 0.2082E-01(m)     
       ZPHOT_SDSS_SN+HOST_5PAR:      mis-match (OLD != NEW) 
           ==> OLD: ZPHOT-1032 = 0.10621 +/- 0.1695E-01(m)     
           ==> NEW: ZPHOT-1032 = 0.10622 +/- 0.1695E-01(m)     

  v9_60 [Aug 26, 2011]

   - fix dumb bug in backup_SNANA_PUBLIC.pl; chnage SDSS stamp to PUBLIC.

   - util/SALT2training_simPipeline.pl :
     Update to auto-generate GENVERSION name(s) for the training sample(s).

   - lots of upgrades to SIMSED_extractSpec.c 

   - snlc_fit.car :
     inside PHOTOZ_ANA fix bug to catch crazy photoz shift
     when LREPEAT_ITER=T.  Identify these skipped SN with
       grep PHOTOZ  <mylogFile> | grep WARN


  v9_61 [Aug 31, 2011]

  - util/split_and_fit.pl and 
    util/split_version.pl :
       Abort if split-version already exists.

  - util/mkfitplots.pl :
    ABORT on missing hbook file.

  - snlc_sim.c :
    Fix evil 'MAPSISE' bug inside init_SEARCHEFF_SPEC();
    effected SPECEFF files that have more than 1 map.
 
  - sntools.c :
    interp_GRIDMAP(): fix subtle bug related to  VAL ~ VALMAX.


  v9_62 [Sep 8, 2011]

            !!! WORKS WITH 64-bit COMPILATION !!!

   - SALT2train_simPipeline.pl :
     Read new config file: $SNDATA_ROOT/models/SALT2/SALT2training.config.
     Add ISTAGE_CLEAN to purge/gzip the 2 GB of files for each training.
     Read SNANA_MODELPATH from config file and write into nml files
     for split_and_fit.

   - SALT2train_run.pl : updates from JLM.

   - snana.car & snlc_fit.car : 
     REAL HSTATI,PROB -> REAL*8 HSTATI,PROB to work on both 32-bit
     and 64-bit machines. First 64-bit test is on fulla.fnal.gov.
    
     Install CERNLIB's POLINT as POLINT8 and make everything
     double precision.

     GET_KCOR8: replace POLINT with double precision POLINT8.

   - add SALT2train*.pl script to  util/PUBLIC.LIST so that
     we can use those scripts on fulla.

   - util/split_and_fit.pl
     Updates to use arbitrary batch queue (fulla.fnal.gov)

   - snlc_fit.car :
     CHI2_PRIOR: POLINT -> POLINT8
     FITINI_AVPRIOR: define REAL*8 AVRES = DBLE(PRIOR_AVRES)
       to use in calculations.


  v9_63 [Sep 22, 2011]

   - snlc_fit.car : remove obsolete SRUN and RUNINDX.

   - sntools.pm :
     Add new utility sed_strReplace
     Add new utility setEnvString to define env with 'setenv' for csh
         or 'export' for bash.
    
   - split_and_fit.pl
      modify BATCH template with new utility sntools::sed_strReplace(...)
 
   - wfit.c :
      MXSN -> 100,000 and add options to select GENTYPE and SNTYPE

   - util/TRAIN_SIM.pl            : udpate from JLM.
   - util/SALT2train_translate.pl : JLM fix so that it works on fulla too.
   - util/SALt2train_run.pl    : JLM fix to use batch qsub on fulla
                                 RK  fix to define env based on bash or csh.

   - kumacs/snana.kumac: 
       fix macro lcplot to see chi2 ~ 0
       fix macro fitres to 'pict/del *' after each page to 
        allow more pages in ps file.

   - util/snmake.pl
     Allow multiple --lib args.

   - snlc_sim.c and snhost.c :
     New sim-input keys
       HOSTLIB_GENRANGE_RA:    xxx yyy
       HOSTLIB_GENRANGE_DECL:  xxx yyy
     to select host-galaxies in a particular coordinate range,
     such as a particular CCD.

  v9_64 [Sep 29, 2011]

   - snlc_sim.c
     * float -> double in several functions (genz_xxx, etc ...)

     * new sim-input key GENRANGE_DLMAG: xx xx 
       works only with delta-function so that SIMEFF_MAPGEN
       can compute EFF(MU,...).

     * new SIMSED option  SIMSED_GRIDSTEP  to step through
       each grid-value sequentially (and see manual)

   - SIMEFF_MAPGEN.pl :
     Allow keys containing "OMEGA" or "LAMBDA" to study
     effic. vs. cosmo params.

   - new perl function wait_for_files.pl

   - SALT2train_*.pl: lots of changes to work with batch systems
     such as  fulla.fnal.gov.


  v9_65 [Oct 04, 2011]

   - snana.car :
     fix SNANA->SALT2 translator to include @SURVEY $SURVEY
     in the spec files.
       
     For TERSE format, read MAG if MAG-column exists.
     Needed to determined zeropoint when converting
     data cadence into a SIMLIB.

     new namelist variable JOBSPLIT(2) to split jobs
     when data are in FITS format; but should work
     for both TEXT and FITS.

   - snmake.pl : abort on compilation error and remove old exe
                 before starting. Avoids mistakenly using
                 previous exe or using badly compiled exe.
 
   - SIMSED_fudge.c :
     New key "SMEAROPT: <SMEARMODEL>  <par1> <par2> ..."
     To arbitrarily smear a SIMSED. See instructions at top
     of code to add a new function.

   - split_and_fit.pl:
     Modify to work with FITS-formatted data files. Instead
     of physically splitting the version, pass new JOBSPLIT 
     variables to snana-fitting job.

   - combine_fitres.c:
     new optional argument --outprefix <outprefix> .
     This otion is needed to avoid multuiple jobs clobbering
     the same combine_fitres.tup file.

  v9_66 [Oct 18, 2011]

    - SALT2mu.c : 
      write fit par results inside fitres file.
      Output fitres file now includes ALL original fitres parameters
       instead of a select few.

    - util/split_and_fit.pl
      new  option to run SALT2mu on all fitted results,
           SALT2mu_INFILE: <SALT2mu input filename>
      The  output FITOPT[nnn].FITRES and  FITOPT[nnn].TUP
      files contain the SALT2mu variables.

    - SIMSED_extract.c : update from JLM

    - util/ : lots of updates to SALT2train*.pl scripts

  v9_67 [Oct 19, 2011] 
    util/  lots of SALT2train* updates from JLM and RK

  v9_67b
    - genmag_SIMSED.c: abort if PATH_BINARY does not exist.

    - SALT2train_simPipeline.pl : abort if any outDir can't be created

    - TRAIN_SIM.pl : few bug-fixes by JLM.

  v9_68 (Oct 28, 2011)

   - sntools.c:
     fix bug checking blank lines in rd2column.

   - kcor.c: fix in malloc_ini so that it works for both
      32-bit and 64 bit.

   - genmag_SIMSED.c :
     Replace a few hard-wired sizes with sizeof() to be
     more robust ... does not fix any bugs, but this change
     is just for safety in the future.

   - SALT2mu.c : remove <CR> from line when writing ntuple
     so that old + new variables are on the same line.
     See 'strchr' and *ptrCR.

   - snlc_fit.car :
     New &FITINP namelist option OPT_NTUP_FITRES to apply
     options; see manual section 4.21 . New option here
     is to allow filling only the fitted filters in the
     fitres-ntuple (7788). Also remove LTUP_FITRES_ALL
     from the namelist and make this an internal logical.

  v9_69 (Nov 02, 2011)

   - util/backup_SNANA_PUBLIC.pl:   Copy manual to web-page.

   - util/SALT2train_run.pl : update fomr JLM to allow training
                            twice (default) or just once.

   - genamg_SEDtools.h:  MXBIN_DAYSED_SEDMODEL -> 200 (was 130)
     (to allow finer DAY-binning from SALT2 trainings)

   - genmag_SEDtools.c :
      fix redshift-bin bug in interp_flux_SEDMODEL that
      was affecting interpolation in last redshift bin.

   - genmag_SIMSED.c:
     read 1st SIMSED to get number of epoch (DAY) bins,
     and use this information to allocate memory for
     storing the flux tables. See SEDMODEL.MXDAY

  v9_70 (Nov 4, 2011)
   - snana.car
     MXVERS -> 50 (was 20) to handle all of the SDSS versions (year x type)

     split WRSALT2_2 into WRSALT2_2 and INI_WRSALT2_2.
     Add new @REPLACE option to substitute filter names in
     the SNANA -> SALT2 translations; i.e, UGRIZ -> ugriz.

   - sntools.c:
     in rd2column read 180 chars per line instead of just 80.
     Fixes kcor bug reading filter files with very long comment line.

   - split_and_fit.pl : fix bug to prevent NSPLIT=0 for batch jobs.

   - snlc_fit.car :
     fix very rare format bug writing SNRMAX to fitres file.
     See UPD_FITRES.

   - util/SALT2train_simPipeline.pl : 
      lots of changes to train and fit real data.
      Also added QUICKTEST option.

   - util/SALT2train_run.pl:
     new option  "RUN_PCAFIT: QUICKTEST" replaces training
     with symbolic link to existing SALT2 model.

  v9_71 (Nov 10, 2011)

   - snlc_sim.h :  GENLC.MJD[MXEPSIM] -> double (was float)

   - util/SALT2train_simPipeline.pl :
     Few bug-fixes to work on data.

        RENAME to SALT2train_pipeline.pl

   - snana.car : modify WRSALT2_2 to include SIM_XXX information.
        (for N.Regnault)

   - new script  util/convertsnana2salt2.pl to translate 
     a version from snana-format into SALT2 format.
     Works for version with more than MXSNLC files
     by splitting large versions.

  v9_72 (Nov 17, 2011)

       Replaced CERNLIB's undeclared HSTATI and PROB functions
       ==> hopefully will be more robust on 64 bit machines.

   - kcor.c : bug fix in malloc_ini()

   - SALT2mu.c : updates from J.Marriner

   - snana.car :
     New namelist options FUDGE_FLUXCAL_OFFSET and FUDGE_FLUXCAL_ERROR
     to apply global flux-fudges per filter. See manual section 4.20.

     Compute filter MEAN and RMS in LOAD_FILTTRANS and comment
     out calls to HSTATI; CERNLIB's HSTATI function has no cast 
     and may be causing problems on 64 bit machines.

     Replace CERNLIB's PROB function with PROB_CHI2NDOF that
     is in sntools.c (calls gsl function)

   - sntools.c: add PROB_Chi2Ndof() to replace CERNLIB's PROB().

   - /util/SALT2train_run[translate].pl: updates from JLM

   - Makefile  link to gsl lib for all programs that use sntools.c
     since there is now a utility (PROB_Chi2Ndof) using gsl.

   - remove primary_mag_interp.c


  v9_73 (Nov 21, 2011)

   - util/SALT2train_pipeline.pl : 
     . Abort if data-version is already split.
     . Fix dumb/harmless bug; copy training-list file only for $DATAFLAG.
       This copy bug just leaves an ugly message to the screen but does
       no harm.      

   - snlc_sim.c:
     Fix bug reading multiple CUTWIN_SNRMAX on command-line; 
     previous code would overwrite last CUTWIN_SNRMAX cut 
     instead of adding a new one. Fix now resets NCUTWIN_SNRMAX 
     on 1st command-line  override, and then adds each new one.

   - genmag_SIMSED.c : 
     Allow arbitrary order of SIMSED params in sim-input file.
     
   - util/split_and_fit.pl
     new input key "H2ROOT_FLAG: 1" to convert his file into root.

   - create snacc.cra and snacc.car to analyze SNACC filters.
     Just reads namelist and parses filter strings.

   - SIMSED_extractSpec.c
     If a parameter value is -999 then ignore this [baggage]
     parameter in the interpolation.

  v9_74 (Nov 25, 2011)

   - snlc_sim.c:
     EXPOSURE_TIME_FILTER can now specify multiuple filters instead
     of just one: i.,e 
      EXPOSURE_TIME_FILTER:  gr 3.0
      EXPOSURE_TIME_FILTER:  iz 5.0

      New SIMSED option "SIMSED_GRIDONLY: SEQUENTIAL" to generate
      each grid-point once. Older SIMSED_GRIDSTEP option is gone.
      See updated manual section 8.4. Can also use command-line
      override
         snlc_sim.exe <myFile> SIMSED_GRIDONLY SEQUENTIAL
      to override SIMSED_PARAM[GRIDONLY] keys in the input file.

    - genmag_SALT2.c : read new SALT2.INFO key "MAG_OFFSET: .27" .
      Need to normalize the SALT2 model to the SNLS3 cosmology fit.
      Previous versions were .27 mag too bright; this defect affects
      the simulations but not the light curve fits. This new key
      has bee included in the SALT2.Guy10 model on sdssdp62 and on
      fulla.fnal.gov.  Note that the fitted x0 values for data
      and old sims are about 30% different to compensate the new
      model norm; for new simulations the difference in x0 is very 
      small since the model has changed in both the sim and fitter.

  v9_75 (Nov 29, 2011)

   - snlc_sim.c:
     in the simlib file, the PIXSIZE key can now be updated
     within a LIBID entry, allowing multiple instruments to
     be defined.

     Abort if GENRANGE_TREST is not set.

   - genmag_SIMSED.c:  Fix dumb bug in interp_flux_SIMSED().

   - New script "util/dump_lcfitOutliers.pl" to dump outliers
     from light curve fit. Format is same format as for the
     [VERSION].IGNORE files.  Also see manual section 7.2

   - kumacs/snana.fitres: new macro  resids_error. As shown below, 
     this new macro is called by mkfitplots --h <hisFile>  RESIDS

   - util/mkfitplots.pl : new option
       mkfitplots.pl --h <hisFile>  RESIDS
     to plot residual from ntuple 7799.

   - snlc_fit.car
     Add TYPE to residual ntuple 7799.

  v9_76 (Dec 01, 2011)

      Starting with this version, users should 
      1. replace GEN_SNDATA_SIM  key with FORMAT_MASK 
         in the simulation
      2. start writing sims in FITS format,
            FORMAT_MASK: 32
         The default will remain text-terse (FORMAT_MASK=2)
         for a few more versions.
      
    - JLM updates for TRAIN_SIM.pl, SALT2train_translate.pl
      and SIMSED_extractSpec.c

   - snana.car SNRECON: fix bug by skipping when threshold fails for filter.
     SNRMAX should NOT be incremented when a obs. fails threshold.
     Thus is only two filters pass threshold, SNRMAX3 is now -9.

   - snlc_sim.c :
     replace GEN_SNDATA_SIM key with FORMAT_MASK key.
     But still allow legacy key with warning.

     new function sort_CIDRAN() to sort random CIDs;
     needed as part of preparation for fits format.

     replace WRBIT_XXX parmaters with WRMASK_XXX parameters
     so that they are easier to parse/use in sim_SNmix.pl.
    
   - snfitsio.c :
     fix RD_SNFITSIO_PARVAL to re-determine pointers on first SN in 
     new fits file; allows reading files with different headers,
     such as mixing Ia and NONIa sims.
 
     WR_SNFITSIO_INIT has new argument *prefix so that the
     fits filename does not have to match the version name.

  - sim_SNmix.pl : update to work with both TEXT and FITS format.     

  v9_77 (Dec 6, 2011)

   - snlc_fit.car
     Define EP_SNRMAX_SORT to sort SNRMAX for fitted passbands.
     In fitres file and ntuple, replace SNLC_SNRMAX_SORT with
     EP_SNRMAX_SORT. Note that SNLC_SNRMAX_SORT is based on
     all passbands regardless of whether or not they were
     used in the fitting. Now the ntuple and fitres variables
     SNRAMX1, SNRMAX2, SNRMAX3 are based only on the bands
     used in the light curve fit.

   - snlc_sim.c :
     Allow multiple rate-powerlaws in different redshift ranges.
     See new key
       DNDZ:  POWERLAW2 <R0>  <beta>  <Zmin>  <Zmax>
     (see manual sec 3.16)

     Allow new error-cor map in the simlib file,
        FLUXERR_COR:  <filter(s)>  log10(SNR)  errcor1 errcor2 ...
     to correct flux-error calculations. 
     See manual Sec 3.9 (Noise Correction)

   - sntools.c:
     rd_sedflux(): allow comment-lines and blank lines in SED file.

   - new script util/sednon1a_install.pl to prepare NON1A spectral
     templates for the simulation. Older tools src/sedinterp.cc
     and util/sednon1a_install.cmd are destined to become obsolete.
     Note that the sednon1a_install.pl script is still under
     development.

   - SALT2mu.c : write MU and MB as %7.4f instead of %6.3f.


  v9_78 (Dec 12, 2011)

   - snlc_sim.c :
     bug fix so that $SNANA_MODELPATH works for non1a & NON1A models.

     Add ZPT to each obs in TERSE and FITS format.
     May need to convert FLUXCAL back to FLUX in ADU(pe) for 
     SNACC analysis.

     Allow summing filter-fluxes (e.g., SNACC teeth) by specifying
     SIMLIB zpt as 2+3+4+5 instead of a floating number.
     Filters that are summed have "sum:" key instead of "OBS:"
     key in the terse-text output.

     Remove obsolete function SDSS_IDEXPT().
     Remove obsolete variables GENLC.srun[.trun .sfld .tfld]
     Remove obsolete FAKES code and params (also from SDSS_simlib_gen.c)

   - snana.car :
     Fix PARSE_HEAD to allow changing the survey if ABORT_ON_BADSURVEY=F.
     See ISTAT_READAGAIN. Needed to process non1a verification on
     sample that spans several different surveys.
      ==> this new option does not work anyway, so ignore it.

     SET_PEAKMJD: evaluate min and wgted-average errors on fitted 
                  T0 and  F0err/F0.
     WRSALT2 now writes errors on T0 and F0 if OPT_SERPKMJD>0.
     SNANATUP includes new error variables from SET_PEAKMJD
        
     Remove obsolete subroutine RDFITRES_WV07

   - kcor.c:
     allow new input keys  "PRIMARY_SED: <name>  <sed filename>"
     for arbitrary reference definition. 
     Legacy BD17_SED and VEGA_SED keys are still allowed.
     Needed to run  verification on non1a templates.

  - SALT2train_pipeline.pl :
    require GENSPEC keys after each GENPHOT key to allow
    different spec-sim for each phot sim. Can use [] to repeat.

  - SIMSED_extractSpec.c:  
      add  "--dump LAMDUMP" option.
      Fixes by JLM
 
  - util/SNANA_tester.pl :
    Allow new test-file option  "TESTJOB_ARGS: ....."
    to include the complex list of args for SIMSED_extractSpec.

  - util/TRAIN_SIM.pl, SALT2train_translate.pl, SALT2train_run.pl
    --> updates from JLM


  - util/sednon1a_prep.pl : finished script.
      OBSOLETE:  util/sednon1a_intall.pl and src/sedinterp.cc
      -> remove these obsolete sed codes in a few versions.


  v9_79 (Dec 15, 2011)

    - snlc_fit.car :
      FCN_FILTCHI2(ifilt) is computed from un-fudged error;
      no impact on total chi2 or fitprob, but allows seeing
      correct data-model chi2 for downweighted filters.

    - snlc_sim.c :
      New key "NON1A_STOP:" to stop reading NON1A entries;
      allows removing NON1A entries with minimal change to input file.
  
      Init GENLC.NOBS_REMOVE and increment inside gen_filtsum().
      Then print NOBS-NOBS_REMOVE for terse format.

      Allow LUMIPAR range to be "0 0", but abort if lower
      limit > hi limit.

    - snana.car :      
      FUDGE_FLUXCAL: abort if SQERR < 0.

      SNRECON: set XNSIG = -999 if FLUXCAL = -9 since I mistakenly
        left a valid error in the SDSS data files when FLUXCAL = -9.
        Next SDSS data-build will have FLUXCAL and its ERROR set to -9.

   - sednon1a_prep.pl : few more tweaks.


  v9_80 (Dec 26, 2011)

    - snlc_sim.c :  
         Abort if SNACC filter mag is undefined.
         Abort if zmin <= 0 for model using SEDMODEL tools
            (to avoid log(0) for redshift binning)

         Fix too sensitive abort-bug in gen_filtsum()

    - snana.car :
        * fix dumb bug in PARSE_ZEXTRA that set ZERR = Z
          for making a redshift-error cut.
        * getenv 'HOST' instead of 'HOSTNAME' so that
          it works on ssh.

    - snlc_fit.car
        * FITANA_MARG, set 'discard' flag if filter gets dropped
          after marginalization; avoids abort.

    - sntools.c:
      fix dumb bug in rd_sedflux() reading fluxerr.

    - fix v9_79 compile bugs found by Emille,
       ../src/kcor.c:1902: warning: format not a string literal ...
       ../src/snlc_sim.c:14168: warning: format %7.2e expects ...
       ../src/wfit.c:821: warning: ' ' flag used with %o gnu_printf ...

  v9_81 (Jan 2, 2012)

   - SIMSED_fudge.c fix a few dumb bugs applying colorlaw fudge.

   - SALT2train_pipeline.pl: fix a few bugs found by Rahul.

   - snana.car:  
       call INIT_SNDATA(isn) from RDSNFITS 
       create RDSIMSED_FITS to read SIMSED info from fits format.
       Create PARSE_SIMSED_KEYWORD to strip parname from ().
   
       WRSALT2_2: skip filters cut in SNRECON so that, for example,
           EPCUT_SNRMIN = 'u 200000' will cut out u band from the
           SALT2 training sample.
           

  v9_82 (Jan 5, 2012)

    - snlc_sim.c :
      No longer read legacy key GEN_SNDATA_SIM;
      must use FORMAT_MASK: <mask>

      Default FORMAT_MASK = 32 (fits) instead of 2 (terse-text)

      Fix compile  bugs found by Dilday
        ../src/snlc_sim.c:14214: warning: format %7.2e expects type
        double, but argument 3 has type double *
        ../src/snlc_sim.c:14214: warning: format %7.2e expects type
        double, but argument 4 has type double *

   - TRAIN_SIM.pl : update from JLM to fix bug in which rest-frame
        wavelength range to define SNR was used to clip obs-frame
        spectra.

   - SIMSED_extractSpec.c : update from JLM

   - SALT2train_pipeline.pl :
     Abort if GEN_SNDATA_SIM key is used or if
     bit2 of FORMAT_MASK is not set.

  - sntools.c :
    fitresfile_init() returns gracefully if EOF is reached
    (avoids infinite loop if there are no entries)

   - snfitsio.c : 
      call init_SNDATA from rd_snfitsio_open
      If SIMSED_NPAR key does not exist, set NPAR_SIMSED=0
        (to fix dumb bug in v9_81)

   - snlc_fit.car:
     Replace MJD_REJECT -> FITWIN_MJD and TREST_REJECT -> FITWIN_TREST.
     Allow legacy nnl variables using EQUIVLANCE to new variables.

     New &FITINP namelist variable string FITWIN_TREST_FILTER
     to set filter-dependent TREST selection.
     See new subroutine SETCUTS_FITWIN_TREST.

     EP_SNRMAX -> EP_SNRMAX_FIT and EP_SNRMAX_RAW ;

     Ntuple SNRMAX variables are now based only on
     the fitted epochs.


  v9_83 (Jan 9, 2012)

    - sim_SNmix.pl : 
      fix ssh command to use single quote (') instead of ".
      Single quote allows defining $SNANA_MODELPATH as part
      of SNANA_LOGIN_SETUP.

    - split_and_fit.pl :
      For FITRES comment replace single quotes with double quotes
      to avoid 'sed' errors.

   - snlc_sim.h : MXNON1A_TYPE -> 1000 (was 100)

   - sednon1a_prep.pl :
     Major change to SED.LIST syntax.
     Generated NON1A part of sim-input file.

   - SIMSED_extractSpec.c
     bug fix from JLM (for galaxy contam)


  v9_84 (Jan 17, 2012)

      !!! BEWARE: pacthy-flag bugfix from v8_64 in snlc_fit.car !!!
          ==> KCOR/model error are now smaller for mlcs2k2 & snoopy

    - snana.car
      in SET_PKMJD abort if more then MXFILT_OBS filters
      instead of MXFILT_KCOR filters.

      Fix bugs interpolating with ANYFUN and write ANYFUN
      interp values to SNMJD_OUT_FILE.

      RDSNMJDINTERP -> RDSNMJDINTERP & UPDSNMJDINTERP 
      The latter appends SN from the new 'ALL' option.

    - genmag_NON1ASED and snlc_sim.c:
      Pass RV and AV to genmag_NON1ASED to allow host extinction.
      Set default GENRANGE_AV 0 0 in snlc_sim.defaults to avoid
      accidentally applying host extinction for NON1A;
      but beware that there is no longer a default AV for mlcs2k2.

      Also note that the random sync changes this version.

    - snlc_fit.car :
      Fix aweful patchy bug (from v8_64) that allowed old test 
      code to increase KCOR error to be difference between nominal
      KCOR and KCOR without warping => error too large.
      Bug was "+SELF,NOAVWARP" instead of +SELF,IF=NOAVWARP.
      ==> mlcs & snoopy fit-model errors will no be a little smaller.
      Simulation is NOT affected.

      Abort it FITMODEL_NAME exceeds 50 chars.

   - sednon1a_prep.pl : 
        add MAGOFF and MAGSMEAR columns to
        SNTYPE keys in the SED.LIST file

  v9_85 (Jan 30, 2012)

   - split_and_fit.pl & SALT2train_pipelne: 
        chmod -R g+rw $OUTDIR and each $STAGE_PATH
 
     New option "OPT_SPLIT: 0" to not physically split
     the version(s) => avoids interference with multiple
     split_and_fit jobs, but reading text format is much slower.

   - SALT2train_pipeline.pl:
     New option OPT_SPLIT: <opt> gets written into 
     fitter-namelist; see split_and_fit.pl above.
     -> avoids interference from multiple pipeline jobs.

     Read GLOBAL_TRAINRUN_KEYNAMES from master input file,
     and pass these keys into the TRAIN_RUN input file.
     --> options for plots after training.

   - snlc_sim.c :
     if NON1A key specifies MAGSMEAR > 0 then set
     INPUTS.GENMAG_SMEAR +- 0.001 to ensure random
     numbers are generated.

     Bit 32 of HOSTLIB_MSKOPT allows each host gal to be
     used only once.

   - doc/snana_install.tex[pdf] updated for Mac by S.Rodney

   - sntools.c : add fflush(stdout) in madend().

   - SALT2train_run.pl (JLM): new TRAINPLOTS_XXX keys


  v9_86 (Feb 2, 2012)

   - init_genmag_SIMSED.c : 
       replace chdir() call with stat() call to fix evil bug 
       in which the next file could not be opened.

   - SIMSED_fudge.c : fix SMEAR-KRW09 bugs when FLUX is zero (late times)

   - snana.car: 
     found bug but did NOT fix it yet. With FITS format, if no
     MJD values pass MJD-window then code aborts. Works OK for TEXT.
     Easy fix is to require CUTWIN_TRESTMIN/MAX in the simulation
     to avoid lightcurves that peak way before or after the observations.
     ==> Need to fix SOON since FITS format is now the sim default.

   - snlc_sim.c: read new optional keys GENSKIP_PEAKMJD from simlib header.
     Allows combining multiple years into 1 simlib and specifying off-season
     MJD range to skip => faster generation. See manual update section
     on simulating multiple seasons.

   - sntools.pm:
     New utility get_namelistValue($nmlFile,$key) to strip out
     value from quotes. Update split_and_fit.pl to use this.

   - new script  util/photoz_dataMC.pl to generate sims,
     run photoz fits on data and sims, and make data/MC
     comparison plots. See instructions at top of script.
   
   - util/split_and_fit.pl    
     use new utility get_namelistValue to extract
     VERSION_PHOTOMETRY, HFILE_KCOR, SIMEFF_FILE ...
 
     his-link name is lnk_lc($HFILE) to have distinct name
     if $HFILE has all lower case. Remove sym-links after
     hmerge to clean up a bit. For NSPLIT=1 don't even
     bother to make links.

  v9_87 (Feb 4, 2012)

    - split_and_fit.pl: replace hard-wired 'qsub' with $BATCH_COMMAND

    - SALT2train_pipeline.pl: allow "RESTART $ISTAGE" command-option

    - sntools.c :
      protect PROB_Chi2Ndof() from Ndof < 0 ... 
      Dan found this case for PS1 SN 730.

    - snlc_sim.h:
      remove OPT_FILTOBS and OPT_FILTREST and use GENFRAME_OBS[REST]
      in the simulation.

    - snana.car:
      OPT_FILTREST[OBS] => 1,2 instead of 2,1 to match
      convention in the simulation.

    - snlc_sim.c:
      new sim-input option  "GENMAG_SMEAR_FILTERS: xyz INTERP"
      to interpolate the smearing for filters xyz using the
      filter-dependent smearing in the other filters. 
      Original use is for SNACC teeth.


  v9_88 (Feb 9, 2012)

    - SALT2train_pipeline.pl : 
      Allow path for DATATRAIN_LISTFILE: path/bla

      Two-digit training IDs -> 3-digit IDs.

      Abort if duplicate pipeline job is deteceted (abort_on_duplicate)

      Simplify logic inside 'sub RUN_pipepline' : submit job, then wait.
      Old logic was wait for previous job to finish, then submit job.

      Add "SALT2STAT_TESTLIST_FILE:"  to  @GLOBAL_TRAINRUN_KEYNAMES 

    - split_and_fit.pl : set NSPLIT=1 instead of 2 if there
        not enough nodes -> avoid passing queue limit on
        batch/torque system.

    - sednon1a_prep.pl :
      Plot peakmags for both raw and nominal. See comments
      in history part of script.

    - snlc_sim.c: 
      fix few bugs summing SNACC filters when
      intrinsic mag-smearing is turned on.
 
      New sim-input option 'DNDZ: FLAT' to simulate flat 
      redshift distribution

    - SALT2train_run.pl: update from JLM related to 'salt2_stat' call.   

  v9_89 (Feb 13, 2012)

    - snlc_sim.c 
      Apply rest-frame model ranges !!!
      This was always applied in snlc_fit, but not in the sim;
      affects external programs like psnid that use the simulated
      data files.

    - snlc_fit.car
      Fits for FILTLIST_FITRESTMAG = 'UBV' by fixing t0 and lumipar;
      then floating c and x0 separately for each rest-frame band.
      See manual and new &FITINP namelist variables
          FILTLIST_FITRESTMAG
          LUMIFIX_FITRESTMAG

  v9_89b (Feb 14, 2012)

    - snlc_sim.c: fix dumb bug : uncomment code to check min/max
      wavelength range of filters for SALT2 and SIMSED

    - snlc_fit.car:
      add new &FITINP variable "LAMEXTRAP_FITRESTMAG".
      Still need to update manual to explain how FITRESTMAG works.

  v9_90 (Feb 25, 2012)

   - sednon1a_prep.pl : bug fix and make upgrades.
      
   - doc/snana_manual.tex : explain XXX_FITRESTMAG parameters.

   - snlc_fit.car : 
     Fix subtle bug for INIVAL in FITINI_PARVAL.
     Few fixes to FITRESTMAG_PREP

   - snlc_sim.c : in prep_user_input when FUDGE_SNRMAX is set then
          INPUTS.APPLY_SEARCHEFF_OPT -> 0
          INPUTS.GENSIGMA_MWEBV_RATIO -> 0

     for FLUXERR_COR map in simlib, if SNR is outside the map-range,
     then return the value at the min or max edge of the map.
     Previous versions returned 1 in this case.
   
   - snana.car :
     add new &SNLCINP variables  EXCLUDE_MJD; added to 
     exclude run 6930 from SDSS-2007 season.

     SET_ZPOFF: bug-fix so that ZP offsets are properly
        defined when RDKCOR is called multiple times.
        Previous bug kept adding the same AB offsets.
        Bug noticed when using FITRESTMAG_XXX options 
        with SDSS.

     Remove obsolete variables SNLS_KSUM and SNLS_ZEROPT_SIG.
 
     Rename SNLC_FLUX_ERRCALC -> SNLC_FLUXCAL_ERRCALC

     Major change/fix to  subroutine FLUXERRCALC.

  - SDSS_simlib_gen.c :
    Several changes to implement updated method.
    No more template lines, ZPTERR -> 0.01  and 
    paste in header file containing FLUXERR_COR map.


  v9_91 (Mar 02, 2012)

   - snfitsio.c, snana.car, : for FITS format, add the following
          variables: ZEROPT, ZEROPT_ERR, GAIN, RDNOISE.
       
   - sntools.c : add NoiseEquivAperture (moved from SKY_APERTURE in snana.car)

   - snana.car : 
      * remove SKY_APERTURE.
      * in RDSNNML initialinze CUTWIN_SNRMIN_FILT = -999, +9999  
           (instead of static default of 0,0) 
           Bug caused negative fluxes to be removed if 
           EPCUT_SNRMIN was not set.
      * Fix aweful bug: MJDMASK8(isn) bit mask was overwritten
          when NEPOCH > 64 !!! Replace with MJDMASK(imjd,isn) array.

   - snlc_sim.c :
     read new simlib key FLUXERR_ADD

   - util/split_and_fit.pl:
     COMBINE_ALL_FLAG now combines the hbook files 
     (in addition to the fitres files).

   - MWgaldust.c
     Fix array-bound bug found by S.Rodney.


  v9_92 (Mar 12, 2012)

    - update manual secions about simulated noise.
      See Eq. 1 in the sim-overview Sec 3.1.

    - wfit.c and SALT2mu.c : 
      updates from JLM. See comment history in each file.

    - remove old codes that have not been used for years:
        src/ make_contours.cra cosmosyst2k9.cra rate_fits.*  snacc.*
        util/ SDSS_getflux20.cmd SDSS_candidateHostInfo.cmd

    - new SDSS scripts
       SDSS_get_candHostInfo.pl  (extract host-gal info)
       SDSS_build_hostlib.pl     (build SDSS.HOSTLIB)

    - snana.car:
      new &SNLCINP namelist cut SNCUT_HOST_SBFLUX = 'r 1000.' 
      to require r-band surface brightness < 1000 (FLUXCAL units).
      Also added SBFLUX (per asec^2) and SKYFLUX (per pixel)
      to epoch-ntuple 7799; beware of different area units.

      Read new header key PIXSIZE to translate surface brightness.
      See SNLS_PIXSIZE(isn).

    - SALT2train_pipeline.pl  SALT2train_run.pl 
      A few minor updates by JLM.

    - snlc_sim.c[h]:
      Fix array bound problem with MXEPOCH.
      MXEPSIM is now MXEPOCH from sndata.h so that the GENLC arrays
      are the same length as the SNDATA arrays.  Hard-wire
      MXEPSIM_PERFILT = 500 to match MXEPOCH in snana.car.
      This problem was caught by Rodney's 1 day simlib that 
      exceeded MXEPOCH=500.

   - util/survey_update.pl : fix bug found by Rodney.

   - util/split_and_fit.pl
     Abort if NGENTOT_LC-sum of Ia+NONIa exceeds MXCID_SIM.
     Clear abort up front avoid confusing abort later.

   - sntools.c 
     New intrinsic_magSmear_XXX function to play with
     intrinsic smearing models. Not yet integrated into
     the simulation.


  v9_92b (Mar 14, 2012)
    - snlc_sim.c
      New sim-input option HOSTLIB_GALID_FORCE: <galid>
      to force a particular GALID ... for debugging only.

      Integrate intrinsic_magSmear_INIT and intrinsic_magSmear_SETRAN.

    - genmag_SALT2.c : call instrinsic_magSmear_EVALFUN();

    - split_and_fit.pl:  fix dumb 'farg' bug related to SALT2mu.

    - SALT2mu.c: fix read_data() function to avoid crashing for
                 on nonIa sims when sim_mb = -2.5*log10(x0)
                 and x0 = -9 for nonIa sim.


  v9_93 (Mar 28, 2012)

   - sncosmo_mcmc.f90 -> sncosmo_mcmc.c (J.Marriner)

   - dump_lcfitOutliers.pl : few upgrades; see comments at top.

   - snlc_fit.car :
     Fix bug in FITRESTMAG_INI to allow fitting  rest-filter
     that is already defined as a survey filter.

     GET_DIST8 has new "SCALE" argument (default should be 1.00)
 
     FITINI_PHOTOZ    
     Add '57' loop over lumipar and analytically minimiize
     for x0/MU. This fix reduces photoz outliers between
     NO-smear and COH-smear sims, but has little effect
     on the overall resolution.

   - sednon1a_prep.pl : 
     minor update to add user comments to SIM-INCLUDE file

   - SIMEFF_MAPGEN.pl: 
      Fix bug, GEN_SNDATA_SIM -> FORMAT_MASK
      Check for sim-abort.  (caught by Eve K).


  v9_94 (April 12, 2012)

   - more fixes for sncosmo_mcmc.c (JM and JLM)

   - SIMSED_fudge.c: better abort trap for invalid 'day'

   - sntools.c: 
     add SIGCOH param to magSmear_XXX functions
     Update MAGSMEAR  function to include a coherent term as 1st arg
      (update manual section on intrinsic smearing to include method 6)

   - new file 'genSmear_models.c' with G10, C11 and  USRFUN 
     models of intrinsic SN brightness variations. These models
     are all wavelength-dependent.

   - snlc_sim.c: 
     Fix so that INPUT_FILE_INCLUDE <file> can be given on command-line.

     New input key FUDGESCALE_FLUXERR to scale entire error.

     Major re-work to use new genSmear_models.c. genmag models like
     SALT2 use lambda dependence. Other models use smear at central
     wavelength (see IFLAG_GENSMEAR) until they are fixed to use
     lambda dependence.
 
     Change default SIGMACLIP on Gaussian randoms to +- 3sigma
     (was +-2 sigma).
     Note that random sync changes with this version.

   - split_and_fit.pl :
     Speed up init stage by putting hbooks symbolic links
     in the FIT* scripts.

  v9_95 (May 3, 2012)

   - genSmear_models.c :
     More updates, particualarly to G10 smearing.

   - SALT2mu.c :
     See "SIGNIFICANT UPGRADES" in history section.

   - util/sim_SNmix.pl 
     Read CIDOFF from sim-input file to avoid overlapping CIDs.

   - snlc_fit.car :
     Add photoz-cheat option to start with correct redshift;
        OPT_PHOTOZ=16

   - snana.car
     MXFILT_REST -> 20 (was 12) as requested by Rodney.
     MXEPOCH_IGNORE -> 1000 ( was 300)

   - sntools.c
     init_SNPATH() abort gracefully if SNDATA_ROOT does not exist.

   -  kcor.c  wrkcor_hbook() 
      hid offset 320 -> 400 to avoid over-writing histos
      when there are more than 20 filters. These are just
      diagnostic plots, so no harm with the over-write other
      than confusing WARNING messages.

      New FASTDEBUG option to quickly get to hbook problems,
         kcor.exe mykcor.input FASTDEBUG

   - SALT2train_run.pl : reduce batch memory to 3gb (from 4gb)
                         to address request by B.Diemer.

   - snlc_sim.c:
     Allow input distribution for SALT2ALPHA and SALT2BETA.
     Random sync changes for this version.
     A little surgury using GENGAUSS struct to define 
     MEAN,SIGMA,RANGE for many variables.
     New functions read_GENGAUSS(), sscanf_GENGAUSS and genran_ASYMGAUSS.


  v9_96 (May 09, 2012)

   - split_and_fit.pl :
     Check for 'combine_fitres.tup' before moving file to avoid
     confusing error message to screen. No change in output or results.

   - snlc_sim.c:
     Write new key to data file header 
        MWEBV_ERR:  <err>
     Works for both TEXT and FITS format.

   - snana.car:
     New array SNLC_MWEBV_ERR(isn) to use in fitting.
     New &SNLCINP namelist variable CUTWIN_MWEBV to 
      cut on Galactic extinct.

   - snlc_fit.car
     &FITINP namelist option OPT_XTMW_ERR=1 will use
     MWEBV_ERR in fit by computing full covariance
     where the reduced correlation is 1 everywhere.
     Also fixed subtle bug for OPT_COVAR=1 ...
     fitted errors are now larger when using OPT_COVAR=1.

   - more compiler problems found by Ishida:
     fixes in snana.car, snlc_fit.car, genSmear_models.c

  v9_96b (May 9, 2012 )

    - snlc_fit.car:
      Comment out line in FCNSNLC that adds diagonal error term
      from Galactic extiontion, but did so only for rest-frame models.
      Now all SNIa models use same covariance model from v9_96.

  v9_97 (May 17, 2012)
    - snlc_sim.c : new input key RVMW: <RVMW> to change
      RV for MilkyWay Galactic extinction.
      Write SIM_RVMW in both TEXT and FITS format.

   -  JLM updated util/TRAIN_SIM.pl  and util/SALT2train_run.pl
 
   - snana.car
     Fix ZZ=1+z in a few places to set ZZ=1 if z<0.
      (found bug reading fits format for data)

     new option  VERSION_REFORMAT_FITS='xxx' to translate
     data files into FITS format.

     Fix subtle bug reading FITS format;
     do not abort if all epochs fail cut,
     but do abort if variable does not exist.

     RDVERSION_FITS: more efficient algorithm for JOBSPLIT;
       Process every NJOBTOT'th SN instead of consecutive
       ranges of NTOT/NJOBTOT.

   - util/dump_lcfitOutliers.pl
     fix MJD-truncation bug that prevented 3rd digit.
     Now the precision is .001 day instead of .01 day.
     Output from this script into an IGNORE file was
     usually ignored by snana.exe & snlc_fit.exe
     because the MJDs didn't match.

   - SIMSED_fudge.c : minor bug-fix for CORRECT_XXX keys.


  v10_00 (May 22, 2012)
          !!!! MXSNLC -> 50,000 (from 3100) !!!!!
          !!!! no more ISN index in arrays  !!!!!
   - snana.car : 
     remove HZPROF
     New &SNLCINP parameter MINUIT_PRINT_LEVEL = -1 (default)
     to control print-level from MINUIT. Default is none.

   - snlc_fit.car 
     Remove obsolete function DMP_FITSORT and &FITINP namelist 
     parameter FITSORT_DMPFILE

   - restructure snana.car to prepare for removing the
     ISN index from arrays. Fixed dumb bug in which
     SNLC_MWEBV(1) -> 0.0 for SIMEFF monitoring (mlcs),
     but was not restored.

   - remove MXSNLC indices from most arrays in snana.car
     and in snlc_fit.car . Reduces memory.
        snana.exe     691 MB -> 257 MB
        snlc_fit.exe  793 MB -> 389 MB
        snlc_sim.exe  492 MB -> 350 MB

     Next increase MXSNLC from 3100 -> 50000

   - doc/snana_manual.pdf :
     Sec 7.13 describes TEXT -> FITS translation for data.

   - util/snmake.pl: few fixes.
   - snana_private.cra    : remove ISN indices from USRANA.
   - snlc_fit_private.cra : idem

  v10_01 (May 22, 2012)

    - doc/snana_manual.tex
      Improve Sec 5.1 to be more clear about how to use
      the same filter-char in rest-frame and obs-frame.

    - snana.car :
      In RDKCOR call new function CHECK_DUPLICATE_FILTER
      to track multiply-defined filters. Then abort if
      more than 1 is found.

    - snlc_fit.cra :
      Fix really dumb bug from v10_00:
      Left ISN index in dummy USRANA.


  v10_02 (May 25, 2012)

    - snlc_sim.c :
      Fix bug in DMP_FITRES for setting SIMSED parameters.

   - SALT2mu.c :
     Write SN with errcode bits that overlap user-input
     'errmask_write'. See usage instructions near top of file.
     Default is still to write out everything (errmask_write=-1).
     
   - snana.car 
     INIT_SURVEY: require both U & B to set BX and increment 
     NFILTDEF_SURVEY. In next snana version need to require 
     'BX' instead of just 'X' to avoid possible confusion
     with other "X" filters like HST-F775W-X. Also, X filter
     is currently added in INIT_SURVEY if U&B are defined, 
     but this should be done from LANDOLT_PREP in the same way 
     that FITRESTMAG adds obs-filters.

     Call INIT_SURVEY only once when header is read.
     Fixes bug with FITRESMAG option in which filters
     are added after the first call to INIT_SURVEY.
     
     New control variable FREEZE_SURVEY_FILTERS to 
     suppress re-reading filters from header in 2nd 
     version. Needed for FITRESTMAG option if there 
     are  multiple versions.


  v10_03 (May 29, 2012)

    - snlc_fit.car
      Fix aweful bug in SETCUTS_FITWIN_TREST.
      FITWIN_TREST_FILT was initialized only to MXFILT_OBS=62
      instead of to MXFILT_ALL=80. Filters with IFILT_OBS>62
      (hjklmnopqstvwx) were probably dropped on 2nd fit iteration.

      New subroutine FITPAR_INI2 called after 1st event is read
      but before fit. Needed to call routines that need variable 
      names and other info that is not in the header. This fixes
      SIMNAME problems in fitres file and ntuple 7788.

    - snana.car/snlc_fit.car
      Cleanup BX logic. New function ISBXFILT explicitly checks
      for 'BX' rather than just 'X'. Intended to avoid 
      BX-assumption for X-filter that is not a BX filter.
      No changes expected, as the previous code seems to
      handle BX and BLABLA-X, but this new logic should be
      more robust.
      INIT_SURVEY no longer has the clumsy part of adding
      the X filter to the SURVEY_FILTER list; this is now
      done in LANDOLT_PREP if needed.


    - SALT2mu.c:
      Fix a few dumb bugs from previous updates (v10_02)
      and do some cleanup.


  v10_04 (June 8, 2012)
    - snana.car
      Fix bug in PARSE_SNDATA so that SN are not skipped
      when spectra are present.

    - SALT2train_translate.pl:  abort if LC files are missing (JLM)

    - SALT2train_pipeline.pl 
      JLM added cosmology-fitting stage (uses wfit or sncosmo_mcmc)

    - snlc_sim.c : VT_redshift(),
      print POWERLAW MODEL and rate-vs-redshift before 
      printing "Number of SN per season".

    - util/split_and_fit.pl
      New option  "H2ROOT_FLAG: 3" keeps log file instead of 
      removing it.

    - sndata.h
      Remove SNDATA.REDSHIFT_SN[ERR] and SNDATA.REDSHIFT_HOSTGAL[ERR]
   
    - SIMSED_fudge.c:
      Add G10 and C11 models and call functions in genSmear_models.c


  v10_05 (Jun 19, 2012)

   - snlc_fit.car
     In function FITINI_ADJUST, adjust DLMAG if INISTP_DLMAG>0;
     allows fixing DLMAG to known cosmology and doing 3-param fit.
     [bug found by Dilday fitting SDSS SN 6295]

   - SALT2mu.c :
     Reads up to 2000 chars per line in fitres file (instead of just 400)

   - snana.car : 
     New bit-option in OPT_SETPKMJD to NOT-ABORT when 
     cannot find PKMJD.

   - sndata.h:
     remove BOSS-specific variables and add SNDATA.AUXHEADER_LINES
     to add arbitrary info strings at end of header.
     AUXHEADER_LINES used by SDSS_sndata_build.c to add z-BOSS info.

     Define VERSION_INFO.IGNORE_FILE and fill this in init_SNDATA 
     inside sntools.c

   - wfit.c [JLM] add refit flag

   - Integrate PSNID into snana:
     New files psnid.cra & psnid_fit.c.
     Reads new &PSNIDINP namelist from snana-input file.

   - sngridtools.c[h] modify struct GRIDGEN_INFO -> 
     typedef SNGRID_DEF  so that duplicate structures
     can be defined to store grids from multiple FITS files.


  v10_06 (Jun 29, 2012)

   - snana.car
     New PATCH,*CALIB containging RDKCOR and routines
     the use filters and primary. Cleans up code patched
     into psnid.cra.  Note *CALIB is added to snana.cra
     and snlc_fit.cra.

     test logical LTUP_MCMC before calling MCMCTUP(1,...)

   - snlc_fit.car :
     in HFUNMIN, fix plot to include only USED filters in fit;
     allows compatability with new macro snana#chi2nearmin 

   - kumacs/snana.kumac :
     New macro snana#chi2nearmin  to plot results of LPLOTCHI2=T.

   - sngridtoold.c:  new utility  free_SNGRID().

   - SIMSED_fudge.c :
     Major change to KRW09 option to allow Blondin8 option
     to use all 8 KRW09 models with fixed average reference.

   - snlc_sim.c :
     Init WRFLAG_XXX = 0. THen for GRIDGEN option (for psnid),
     leave all WRFLAG_XXX = 0 so that the nominal data files
     (TEXT or FITS) are NOT written and only the GRID is
     written out (along with .README, .LIST, .IGNORE).

   - sntools.pm
     new utility  checkDirExist($dir,$comment) to make sure
     that $dir can be found after doing cd ~/ or after a
     remote login.  This utility is called by split_and_fit.pl
     and by SALT2train_pipeline.pl.

   - SNANA_tester script shows very small changes compared
     to v10_05, and I don't know why (only re-arranged patches).

    LCFIT_MLCS_ESSE:              mis-match (OLD != NEW) 
        ==> OLD: DLMAG-b013 = 41.919 +/- 0.1897     
        ==> NEW: DLMAG-b013 = 41.926 +/- 0.1927    
    SIMFIT_MLCS_VIDEO-DES:        mis-match (OLD != NEW) 
        ==> OLD: DLMAG-40002 = 37.929 +/- 0.8834     
        ==> NEW: DLMAG-40002 = 37.929 +/- 0.8837     
    ZPHOT_SALT2_SNnoHOST_5PAR:    mis-match (OLD != NEW) 
        ==> OLD: ZPHOT-1032 = 0.89655E-01 +/- 0.1881E-01(M)     
        ==> NEW: ZPHOT-1032 = 0.89656E-01 +/- 0.1881E-01(M)     
    ZPHOT_SDSS_SNnoHOST_4PAR:     mis-match (OLD != NEW) 
        ==> OLD: ZPHOT-1032 = 0.11079 +/- 0.5675E-02(m)     
        ==> NEW: ZPHOT-1032 = 0.11079 +/- 0.5674E-02(m)     
    ZPHOT_SDSS_SNnoHOST_5PAR:     mis-match (OLD != NEW) 
        ==> OLD: ZPHOT-1032 = 0.66135E-01 +/- 0.2365E-01(m)     
        ==> NEW: ZPHOT-1032 = 0.66878E-01 +/- 0.2393E-01(m)     
    ZPHOT_SDSS_SN+HOST_5PAR:      mis-match (OLD != NEW) 
        ==> OLD: ZPHOT-1032 = 0.99881E-01 +/- 0.1721E-01(M)     
        ==> NEW: ZPHOT-1032 = 0.99886E-01 +/- 0.1721E-01(M)     
    ZPHOT_DES_SN+HOST_5PAR:       mis-match (OLD != NEW) 
        ==> OLD: ZPHOT-70001 = 0.49488 +/- 0.1670E-01(m)     
        ==> NEW: ZPHOT-70001 = 0.49488 +/- 0.1672E-01(m)     



  v10_07 (July 10, 2012)

   - snlc_fit.car
     Modify PLOTPREP_FITRES to use arrays in KEEP,BESTFITCOM
     so that arbitrary fit programs can fill the best-fit
     model arrays in 2-day bins (to overlay on data).

   - sngridtools.c
     Pass argument "SNGRID_DEF *SNGRID" to fits_read_SNGRID()
     rather than  filling global SNGRID arg. Avoids problems
     with copying structure and 'free-ing' between reads.

   - genamg_snoopy.c:
     Define "SNGRID_DEF SNGRID_SNOOPY" and pass this to 
     fits_read_SNGRID().

  v10_08 (July 25, 2012)

   - SALT2mu.c : 
     new option NSPLITRAN ; see top of file for details.
     Keep track of NERR for each  ERRMASK and print summary.

   - sim_SNmix.pl
     Copy ZVARIATION_FILE (if defined) in the same way as the
     INCLUDE file.

   - major psnid_fit.c update from Masao.
     rename psnid_fit.c -> psnid_BEST.c
     Created new file psnid_tools.c[h] .
 
   - kumacs/snana.kumnac
     Fix dumb bug displaying x0 or mu.
     Few tweaks for mag-option (fluxscale<0)

     Surgery  to loop over [optional] multiple sub-dirs
     to make multiple light curve fit-function overlays.
     Needed for psnid to see best-fit for each TYPE and
     for each Z-prior.

  v10_08b (July 26, 2012)
   - more psnid updates.  Define SNGRID.NONIA_ITYPE = 1 or 2 only
     to generally classify Type I and Type II.

   - remove unused histograms in PLOTPREP_FITRES to save memory.
     Now uses about 50% less.



  v10_09 (Aug 15, 2012 - caught a few bugs with debugger on)
   
   - simlib_coadd.c
     increase MXMJD and  MXLIBID  to 6000 (from 4000 and 5000).
     Needed by Cinabro for LSST SIMLIBS.

   - snlc_sim.h:
     New parameter 
        #define MXSIMLIB_OBS = 2000 
     to replace 2*MXEPOCH=1000. Needed for 10-year LSST simlib 
     that has more than 1000 observations.

   - snlc_sim.c
     Fix IDLOCK bug in main by initializing GENLC.USE_EPOCH[ep]=0
     at start of epoch loop (before skipping unused filters).

     In SIMLIB_read(), abort  if NLINE_MJD > MXSIMLIB_OBS.
     Previously SIMLIB_TMP[NLINE_MJD] structure was not
     protected, leading to seg fault if NOBS < 1000 and
     there are more than 1000 "S:" lines in a SIMLIB entry.

   - snlc_fit.car
     Fix bug in DMP_SNMJD_INTERP to prevent printing info
     for undefined IFILT_OBS.

   - Makefile
     Take  out '-g' debugger mode.
     9 of 45 test jobs show a change, but they are all
     in the last digit of the error.

  v10_10 (Aug 23, 2012)

   - SALT2mu.c : 
       new option from JLM to iteratively determine
       sigMb to get chi2/dof=1.

       New function avemag0_calc() to fix bug in calculating
       avemag0 (RK)

   - snana.car :
     Add check on NOBS in PARSE_HEAD().
     Previous check got demoted to the routine that reads
     that rarely-used verbose-text format. Fix based on
     seg-fault caught by Rahul with 1999ee that has NOBS=566.

     In subroutine SNMJD_INTERP_ANYLC fix bug to set MJD=PKMJD
     when MJD=0 (found by Evan at JHU ).

   - backup_SNDATA_ROOT.pl : new "INTERNAL" option to backup
     $SDNATA_ROOT/INTERNAL that contains survey-dependent
     subdirs. For now it has SDSS, DES and LSST, although
     only SDSS/ has anything useful for now.


  v10_10b (Aug 28, 2012 )
  
            !!! Fix aweful snlc_fit  bug from v10_09 !!!

    - snlc_sim.h 
      Increase MXCID_SIM to 3 million (was 999,000) to handle
      10-year simlib for LSST.  Also fix output file names
      to use %8.8 (instead of %6.6) if NGEN> 1 million or
      if the CIDRAN flag is set ... this last change is just
      cosmetic so that all filenames have the same length
      and are listed in CID order.

   - new script util/backup_INTERNAL.pl  to back up
     subdirs in $SNDATA_ROOT/INTERNAL to a public URL
     that is password-protected for each survey.

   - snana.car
     Define new HEADBIT_XXX keys and HEADMASK, along with new
     subroutine HEADMASK_CHECK to make sure that all required
     header keys are found. Inspired by missing MWEBV keys
     when Dan S translated the CSP data into snana format.

     Rest N_SNFILE=0 after call to init-call to RDVERSION_XXX.
     This is cosmetic so that internal ISN starts at 1 instead
     of  at N_SNFILE+1.

  - snlc_fit.car:
    Fix evil bug from v10_09 and v10_10:
       CALL FITINI_ADJUST(isn,iter)
       SUBROUTINE FITINI_ADJUST ( iter )
    I had removed the ISN arg from declaration, but not from 
    the call statement !*#$@&^!

  - SALT2train_pipeline.pl : update from JLM.


  v10_11 (Sep 8, 2012)

   - snlc_fit.car:   
     Set default OPT_XTMW_ERR   = 1  (instead of 0)
     Set default OPT_COVAR=1 for SALT2 model unless user
       specifically sets OPT_COVAR=0 in &FITINP.

     ==> default is to use correlated Galactic extinction errors
         and correlated SALT2 errors.

   - wfit.c - update by JLM.

   - snlc_sim.c :
     Increase hard-wired SALT2ALPHA limit from 0.2 to 0.4 :
     INPUTS.GENGAUSS_SALT2ALPHA.RANGE[1] =  0.40 ; // increase from 0.2
       
   - SIMSED_fudge.c:
     Print SMEAR-MODEL SUMMARY ... still need to check that each
     input parameter is a float and not a string ??

  - simlib_coadd.c:  MXMJD -> 100,000 (was 6000) for 10 year LSST simlibs.

  - remove ISN argument from a few scattered USRANA calls.

  v10_12 (Sep 13, 2012)

      !!! WARNING: no more than 20,000 TEXT FILES ALLOWED !!!
      !!!          for N > 20,000 must use FITS FORMAT    !!!

   - snhost.c 
      *  fix bug in malloc_HOSTLIB().
      *  abort if Sersic index is outside bound.
      *  switch from linear z-grid to logz-grid to allow
         more IGALs at higher redshifts -> avoids running
         out of unique IGALs at high-z.

   - snlc_sim.c: 

     * inside init_CIDRAN() move USED[MXCID_SIM] to global *USEDCID ... 
       avoids valgrind problem with too much local memory.

     * new sim-input "CUTWIN_PEAKMJD: 10 27"  selects SN if any
       filter passes this cut.

   - sntools.c
     ctmp[60] -> ctmp[200] in fitres-reading utilites so that
     combine_fitres.exe does not crash on long comment-names such
     as filenames.

   - snana.car
     split MXSNLC  into MXSNLC = 3 million and  MXSNLC_FILES = 20,000. 
     The former is for fits-format, and the latter is the limit for 
     text files. Fixes memory-overwrite bug that STK found trying
     to process 1.3 million LSST SNe.

  v10_13 (Sep 27, 2012)
    snlc_sim.c/snlc_sim.h/snhost.c :
    new sim-input options
      HOSTLIB_FIXRAN_RADIUS:  #.##   # optional fix radial random number (0-1)
      HOSTLIB_FIXRAN_PHI:     #.##   # optional fix phi random number
    to fix the random numbers for SN position in the galaxy.


    Updates from JLM for
       SALT2train_incdata.pl   <== NEW
       SALT2train_pipeline.pl
       SALT2train_run.pl

   snana.car
     - read SIM_HOSTLIB_GALID

     - in CHECK_ZEXTRA, read from $SNDATA_ROOT/INTERNAL/[SURVEY]
       instead of from $SDNATA_ROOT/[SURVEY].  Needed to read
       BOSS_USER.LIST.

   sntools.h : MXVAR_FITRES -> 200 (was 100) in case Masao needs
               more variables for psnid.
   
   SALT2train_pipeline.pl: update form JLM to parse SALT2_DIR
                           to run non-default versions of pcafit.

   Updates to prepare for fixing snana#fitres to work with the
   merged his-files from split_and_fit.pl :
   - new input variable JOBSPLIT_EXTERNAL(2) for text-format
       (used only by split_and_fit.pl)
   - new function IPLOT_FITRES_TUP(ISN) to compute new IPLOT
     variable for ntuple. IPLOT is a unique index, even for
     merged split jobs.
   - Note that final fix (in snana.kumac) will be in next version,
     along with unexpected code fixes.


  v10_14 (Oct 1, 2012 )

    !!! snana#fitres works with merged hbook files from split_and_fit.pl
         (but not from merging stand-alone snana jobs)

    !!! Row-wise ntuple 7788 ---> Column-wise ntuple (CWNT)

    !!! NTID 7788 includes epoch-dependent arrays ; no more NTID 7799

    !!! combine_fitres.exe produces CWNT instead of RWNT
           (and allows for tag-names up to 20 chars)

    snana.car: 
    - in HFCIDPTR(), replace hid 1600 with CWNT 1600 that has
      CID and IPLOT. This allows snana#fitres to work with merged
      hbook files.

      new CWNT_XXX routines in PATCH,*CWNT, and ntid 7100 is now 
      a CWNT by default.  

      New namelist input 
        OPT_LEGACY_RWNT=1  (use legacy RWNT, no CWNT)
        OPT_LEGACY_RWNT=3  (use legacy RWNT and new CWNT)

    - kumacs/snana.kumac :
      macro getvcid, check if hid 1600 is 1D histo or ntuple.

    - snlc_fit.car :
      FITRES_TUP -> FITRES_RWNTUP and create new function FITRES_CWNTUP.
  
      Added several new R4FIT_XXX arrays for CWNT.
      New function LOAD_FITARRAYS() to load R4FIT and I4FIT arrays.
      
    -  snlc_fit.car and psnid.cra :
       remove ISN argument from PLOTPREP_FITRES()

    - combine_fitres.c :
      replace row-wise with column-wise ntuple.
      8-char tag limit now increased to 20.

    - ntdump.pl: few fixes, mainly checking if first variable name is CID
        (if not, then it;s added internally to avoud abort).
        Also check for hex-formated integers from bit-packing.

    - snlc_sim.c[h]:
      Update SEARCHEFF code to include dependence on PEAKMJD and FIELD.
      See manual sec 3.15 .

    - util/dump_lcfitOutliers.pl :
      BROKEN with column-wise ntuple ... fix later !!!
      Script now just prints message that it is broken.

    - psnid*.c : update from Masao ... but still not done.
      Should produce fitres-text output and plots.

  v10_14b (Oct 1 2012 )
    - few psnid fixes to work with split_and_fit.pl
    - split_and_fit.pl : new option PLOTOPT to run mkfitplots.pl

  v10_15 (Oct 11, 2012)
 
   - split_and_fit.pl :
     Major change to merge logic; merges as each set finishes
     rather than waiting for every job to finish.

  - mkfitplots.pl : 
      new 'eps2gif' option. 
      Clean up mag option with fixed 19-26 range on all plots.

  - snana.car :
    New &SNLCINP cuts
    CUTWIN_TREST2(2)
    CUTWIN_NFILT_TREST2(2)  ! Number of filters passing above (default=no cut)
 
    Example of command-line override
      snana.exe bla.nml CUTWIN_TREST2 -8 5 CUTWIN_NFILT_TREST 1
    (note that CUTWIN_NFILT needs just one argument on command line)
   
  - snlc_fit_private.cra - fix bug from recent changes.
  
  - sim_SNmix.pl :
    Fix to work if GENMODEL_Ia key is not in the master file 
    -> use GENMODEL in SNIa sim-input file.

  -psnid.cra : add OPT_ZPRIOR and CUTWIN_ZERR inputs.

  v10_16 (Oct 17, 2012 )

   - psnid_BEST.c from Masao; implement OPT_ZPRIOR.

   - util/mkfitplots.pl: fix bug with making eps or gif files.

   - snfitsio.c
     Fix bug causing segfault when reading two FITS files
     such as Ia+NONIa.

  v10_16b (Oct 19, 2012)
   - psnid.cra -> psnid.cra and psnid.car  to have same
                  structre and snana and snlc_fit.

   - Makefile : fix psnid.exe make to handle above change.
 
   - snana.car : new global SNDATA_FILE_CURRENT = current data file
           so that 'private.cra' knows the data filename without
           using the internal indexology.

  v10_16c (Oct 23, 2012)
       *** misc. fixes for DES/PSNID pipeline ***
   - snana.car
     read VERSION_REFORMAT_FITS from command line
     Fix bug setting SNDATA_FILE_CURRENT

   - split_and_fit.pl
     check for PRIVATE_DATA_PATH option.
     for FITRES_COMBINE_FILE optoin, apply to FITRES text file
     as well as for the ntuple file.

   - combine_fitres.exe:
     for integers write (int)x to text file.

     No longer combine ifitopt=0 with ifitopt>0 for final ntuple,
     unless specified in the input namelist file.

  v10_16d (Oc 24, 2012)
   - remove src/SDSS_* and util/SDSS_* programs product and from Makefile.
     Copy codes to ~/sdss/src and ~/sdss/util.
     
   - fix snmake.pl to allow upper case filenames.

   - SALT2train_pipeline.pl : update from JLM

   - ups/snana.table: remove 'setup root'

   - psnid.car : fix index problems; see IFILTINV_PSNID array

   - snana.car : fix array bound for IFILE_INDEX
                 -> fixes bug causing segfault at 20,000th SN.

  v10_17 (Oct 26, 2012)

    - snana.car : add HBNAMEC call to include CCID in ntuples.

    - ntappend2fitres.pl 
      * abort if fitres of hbook file does not exist.
      * fix to work with character CCID that is not integer

    - ntdump.pl
      * Uses ntuple variables CCID instead of CID.

    - snlc_fit.car : 
       few bug fixes for FILTLIST_FITRESTMAG option, mainly avoiding
       invalid addresses when valid filters are NOT found.
         (bugs found by Diemer, using nearby SNe)

    - snlc_sim.c
      GENTAU_AV > 50 => flat AV distribution.
      Previously it failed (for S.Rodney) because
      exp[av/(very large tau)] is rounded to zero.

  v10_18 (Oct 31, 2012)

      !!! No longer need private ~/kumacs or to run  paw_setup.cmd !!!
      
    - fix paw-based perl scripts to use $SNANA_DIR/kumacs instead of
      ~/kumacs so that users no longer need to run paw_setup.cmd or
      to update the ~/kumacs directory. The following scripts are 
      modified to call sntools::write_loginMacroLines() and to have
      a PRIVATE option for debugging,
        + ntprint.pl  
        + ntdump.pl
        + ntappend2fitres.pl
        + sednon1a_prep.pl
        + photoz_dataMC.pl
        + mkfitplots.pl

    - update snana_manual with new sections on psnid and SALT2 programs.
      beware: These programs aren't quite ready for public release.

    - snfitsio.c:
      fix evil bug in RD_SNFITSIO_PARVAL that causes snana-ABORT
      for SN with only one epoch.

  v10_18b (Nov 7, 2012)
    - util/backup_INTERNAL.pl: few tweaks, including copy to another disk.

    - util/backup_SNANA_PUBLIC.pl : 
       fix to copy snana_install.pdf. Public install manual was 2 year old!

    - snana.car : 
       * MXLEN_CCID -> 20 (was 12)
       * Fix PRRDSN to print Assign integer CID
       * New global SNLC_CASTCID = 'CHAR' or 'INT'
           (for CFA4 that has some 15 char SN names)

       * MXLAMBIN_FILT -> 2000 (was 1000)
       * in RDKCOR, fix bug checking array bound of filter trans.
       * in RDKCOR, add check on PRIMARY array bound (see MXLAMBIN_PRIM)
           (fixes segfault found by Diemer)


  v10_18c (Nov 20, 2012)

    - snana.car
      * In keeps, replace several *20 with *(MXLEN_CCID)

      * new subroutine PARSE_ARGS to cleanup MAIN.

      * fix bug in RDKCOR:
        init HIDMAG & HIDKCOR here instead of INIT_SNVAR

      * new option LTUP_BITPACK = T (default).
        May need to set LTUP_BITPACK=F for h2root to work with CWNT.

    - psnid.car :  ccid*12 ->  ccid*(MXLEN_CCID)

    - psnid_BEST.c : lots of bug-fixes from Masao

    - sednon1a_prep.pl : fix macro bug in make_PEAKMAG_plots.
         (bug found by Kuhlmann at ANL)
         Remove SIM subdirs by default, unless NOCLEAN
         argument is passed.
       

  v10_18d (Nov 23, 2012)
   - more psnid updates from Masao.

   - snfitsio.c: fix bug in RD_SNFITSIO_PARVAL().
     If first SNID in 2nd file is rejected, pointer logic failed.
     Fixed by doing explicit parName lookup each time.


  v10_18e (Nov 26, 2012)

          !!!! New Feature: write/read PRIVATE variables. !!!!!

   - snana.car
     * new option to read private variables from data files.
       See Sec 5 of manual.
     * include PRIVATE variables into CWNT ntuple.
     * &SNLCINP namelist variable OPT_REFORMAT_FITS=2 -> 
       create blank IGNORE file.
        (by default there is no IGNORE file, often annoying)

   - snlc_fit.car
     fix bug applying optional user-defined  RESTLAMBDA_FITRANGE.
     See new variable RESTLAMBDA_USEFIT ... the range actually used.
     Stdout now includes the following
        SN-MODEL  LAMBDA RANGE:  2250. -  8700.
        USER-DEF  LAMBDA RANGE:  2500. -  7500.
        Final     LAMBDA RANGE:  2500. -  7500.  <== new
     And the 'Final' range is used everywhere.
     This bug mainly affected photoZ fits (caught by Kuhlmann)

  v10_18f (Nov 30, 2012)
   - snana.car, SIMSED_fudge.c :
     Fix compilation errors found by Ishida.

   - combine_fitres.c: include character CCID in ntuple.

   - ntdump.pl : replace 'd+' with 'e+' to work for double precision.
                  (i.e., bug fix)

   - psnid.car:
     * more &PSNIDINP variables added to namelist.
     * set EP_REJECT array for un-used points so that they
       show up as red stars in the plots.
     * call PSNID_MONANA and PSNID_MONEND for type-stat summary

   - psnid_tools[BEST].c :     more fixes from Masao.


  v10_18g (Nov 30, 2012)
   - snana.car
     * new routine GETSIM_STRING to prepare list of SIM_XXX varnames
       and values to append in the fitres file.
     * remove PSNID patchy flags.
     * define N_SNLC_FITCUTS; set N_SNLC_FIT whenever a fit is done.

   - snlc_fit.car:
     * Call GETSIM_STRING.

  - psnid.cra :
    * Remove patches *SNUTIL and *CWNT and link to libsnana.a
    * Wanted to call GETSIM_STRING, but we get NULL values from
      CC sim ?? Need to think more about how to get sim parameters
      for Ia+CC mix.


  v10_19 (Dec 2, 2012)

   - split_and_fit.pl :
     Fix bug with GZIP_FLAG ... see new function gzip_VERSION($iver)

   - psnid_tools.c, psnid_BEST.c:
     * fix a few compilation bugs found by Ishida.
     * fetch and store PSNID_INPUTS.VERSION_[SNANA,PHOTOMETRY]

   - psnid_BEST.c
     Write generic comment-info at top of fitres file (RK)

   - snlc_fit.car
     In POTPREP_FITRES fix hid 4900 to use marginalized 'LC' fit values 
     instead of the minimized 'FIT' values. Bug caught by Y.-L. Kim. 

   - snana.car :
     new routine GET_SNANA_VERSIONS to return version name for 
      snana & photometry;
     C-callable routine used by psnid_tools.c .



  v10_19b (Dec 4, 2012)

   - snfitsio.c : add MODEL_NON1A header info for AV,RV,AVTAU.

   - split_and_fit.pl : allow quotes around name of version,
          VERSION:  'myv1'

   - snlc_sim.[c,h] : MXCID_SIM -> 100million-1 (instead of 3 million).
       Also change static CIDRAN_LIST[] to dynamic *CIDRAN_LIST.

   - psnid_BEST.c: 
      * update frmo MS to implement IGNORED templates.
      * update from RK to write SIM info to fitres file (getsim_string__)

   - snana.car :
     MXCID -> 999,999,999 (8 digits max).
     Use CIDMASK as bit-mask instead of byte-mask to save memory.
     'size snana.exe' is the same as before (within 2 mb).
 
     Move CHECK_LINES function into MAIN instead of in RDSNNML
     so that it runs after reading &SNLCINP only for snana.exe.
     Previous version had a bug such that PSNIDINP command line
     args were causing an ABORT for no reason.


  v10_19c (Dec 13, 2012)

   - split_and_fit.pl:
      * allow quotes around OUTDIR argument

   - sntools.pm 
      get_namelistValue checks line after key if nothing is on
      the same line.
 
   - snana.car : 
     New subroutine DEFINE_PRIVATE_VAR(string) so that users can
     define private variables from private code. Original usage
     is for DES selection.

     SNANA_DRIVER: move MON_SNANA(1) call to end after USRANA call.

     fix minor bug read SN with CID < 8 
       (was setting CIDMASK index to 0 instead of 1).

  v10_19d (Dec 18, 2012)

    - Fix big mess reading & writing HOSTGAL info.
      Changes to snana.car, snfitsio.c, sntools.c.
      Update to write HOSTGAL_MAG if mags are defined.
      
    - snana.car : 
      * add HOSTMAG_[filt] into CWNT.
      * load HOST variables in CWNT only if they exist; 
         see USE_SNHOST_XXX logicals
      * READ_HEADKEY   - pass RETSTR='+ERR' to return VALUE & ERROR
      * PARSE_REDSHIFT - simplify logic with '+ERR' option to READ_HEADKEY

    - kumacs/snana.kumac ; fix RV-label bug for SALT2
            (bug reported by B.Patel)


  v10_20 (Dec 20, 2012)

    - Makefile update to check if library path includes BITNESS for 
      picking 32-bit or 64-bit library.  64-bit mode works on des 
      (64-bit) machines, but not on the older sdssdp (32-bit) machines.
      32-bit mode works on all machines. Other systems that have only
      oen flavor don't need BITNESS-dependent lib-paths.

    - ups/snana.table --> affects only FNAL cluster
        setup cernlib 2006 (32 and 64 bit)
        setup gsl v1_15a   (idem)

    - for getenv calls for HOST, use HOSTNAME instead of HOST.
      Fix in snana.car, SIMSED_fudge.c, snlc_sim.c.

    - idl/ remove everything and remove from Makefile so that
      this subdir does not show up in the cut product. 
      Unfortunately we cannot remove cvs directories, so the
      obsolete idl/ and input/ dirs are still in cvs.

    - WARNING: psnid.exe works fine  32-bit mode, but gives segfault
               in 64 bit mode; to be fixed in next version.

  v10_20b (Dec 20, 2012)
     - fix bugs for &FITINP namelist option LDMP_SNFLUX to 
       dump light curves and best-fit model to text files.
       Uses new routine DMPEND_SNFLUX(). This option had not 
       been used since the SN challenge, and is now requested
       by Brandon Patel.

  v10_20c (Dec 20, 2012)

     - fix aweful photoz-fitting bug; initial x0/dlmag = NaN if
       REDSHIFT = -9 for SN with no redshift info.  Fixes made 
       in both snana.car (SNLC_DLMAG) and in snlc_fit.car (FITINI_PHOTOZ).

     - snlc_fit.car CWNT_HBnAMES_SNFITVAR:
       IFILT_NEARDROPT range is -128,128 instead of -9,128
       because IFILT_NEARDROPT can be set to -IFILT_NEARDROP.


  v10_20d (Dec 21, 2012)

    - doc/snana_manual.tex :
      Complete overhaul of the "Misc Tools" section.

   - HOSTNAME back to HOST for getenv calls so that it works for ssh.

   - nml variable LDMP_SNFLUX is now in &SNLCINP instead of &FITINP
     so that it works for both snana.exe and for snlc_fit.exe

   - snlc_fit.car :
     Fix NaN-bug computing DELMU from SNLC_REDSHIFT < 0.
     Use FITVAL_STORE(IPAR_PHOTOZ) that is always > 0.
     Only affects ntuple; did not effect fitting.

  v10_20e (Dec 24, 2012)

    - util/snmake.pl : fix to check BITNESS-dependent libraries,
                       just lik ein Makefile update last version.

    - kcor.c[h]:  
         start preparing fits-formatted output to remove CERNLIB 
         dependence. New key OUTFILE will eventually replace 
         OUTFILE_GRID_HIS, and two OUTPUT keys are allowed, one for
         .his and another for .fits.  fits option working,
         but snana still does not parse it.

         Fix ZPOFF bug (rd_ZPOFF,get_ZPOFF) when same filter char
         appears in multiple sdirs. Require match in both filt-char
         and path-index to set ZPOFF (hid 292). Affected Bessell URI
         filters when SDSS-ugrigUGRIZ and Bessell UGRIZ are defined
         in the same kcor-input file.

  v10_20f (Dec 28, 2012)

    - few more kcor.c updates for fits format.

    - snana.car : break up some of the RDKCOR code to use the
       same utilities for both HBOOK and FITS format.

    - ups/snana.table: back to 32-bit mode so that paw works
        on all Fermilab nodes. This change does NOT affect
        non-FNAL machines.

  v10_21 (Jan 1, 2013)

        !!! ----------------------------------------------------!!!
        !!! Create and read kcor tables in HBOOK or FITS format !!!
        !!! ----------------------------------------------------!!!

   - snana.car
    * RDKCOR -> RDKCOR_HBOOK & RDKCOR_FITS
    * several new RDKCOR_FIT_XXX routines
    * Better global names for the following
        FILTOBS_MAGPRIMARY    -> FILTOBS_MAG_PRIMARY
        FILTOBS_ZP            -> FILTOBS_ZPOFF_PRIMARY 
        ZPOFF_FILTOBS         -> FILTOBS_ZPOFF_SNPHOT  (i.e, SDSS AB offsets)
        FILTREST_MAGPRIMARY   -> FILTREST_MAG_PRIMARY
        FILTREST_ZP           -> FILTREST_ZPOFF_PRIMARY
        PRIMARY_ZPTOFF_RDKCOR -> ZPOFF_PRIMARY_RDKCOR
        PRIMARY_MAG_RDKCOR    -> MAG_PRIMARY_RDKCOR
        FILTER_ZPTOFF_RDKCOR  -> ZPOFF_SNPHOT_RDKCOR

    * RDKCOR_HBOOK: switch [AV,Z,T]RANGE_KCOR convention to be the
       min,max bin center instead of min,max hbook limit that extends
       an extra half-bin.  This convention is used by FITS format, 
       so now both formats use the same convention and indexing.

    * GET_AVWARP8,GET_KCOR8:
      To reduce subtle changes w.r.t. previous versions, allow
      half-bin extension in AVwarp parameter. In short, 
      extrapolate the extra half-bin.

      With this new convention, 12 of the 50 tests have a mis-match.
      Some DLMAGs differ by 1 mmag, but usually it's just the error
      that is slightly different. See small discrepancies with

   more $SNDATA_ROOT/SNANA_TESTS/logs/130101_v10_21_32bit_SAVE/MASTER.LOG

      which compares OLD vs. NEW HBOOK-format (no FITS comparisons yet).

    * The kcor-FITS format has been tested with only one job, and is
      thus not suitable for public use. This release incorporates the
      global changes that affect both HBOOK and FITS-formatted kcor 
      files. More FITS-format testing will occur in the next version.

  v10_21b (Jan 2, 2013)

    - kcor.c
      if NKCOR=0, skip writing KCOR,LCMAGMWXT tables in fits format.

    - snana.car: few more fixes for reading kcor in fits format.

      SNANA_DRIVER: if LSNCUTS=F ,then call MON_SNANA(1) before RETURN.
        Allows ntuple update for CUTFLAG=0 to allow examining
        why SN faile cuts. This feature used to be there, and was
        mistakenly removed a while back.

    - doc/snana_manual.pdf
      New Sec 3 about K-corrections. Sec 3.1 discusses formats
      and recommends generating hbook and fits formats to compare.



  v10_21c (Jan 4, 2013)

    - snana.car: new routine PRINT_NPASSCUTS to print number of SN
       passing each incremental cut, and versus TYPE. Also prints
       number with valid fit for snlc_fit.exe.

    - ISTAT_FITANA -> ERRFLAG throughout snana.car and snlc_fit.car.
      ERRFLAG is stored in the snana ntuple (along cith CUTFLAG_SNANA)
      to track losses. See new manual sec 5.9 for details.

    - doc/snana_manual: new Sec 5.9 "Tracking vs. SN cuts".
       See new ntuple variables CUTFLAG_SNANA & ERRFLAG_FIT.

    - util/ntdump.pl :
      The 3rd argument $varFile can be a list in quotes,
        ntdump.pl  myfile.his 7100 'CUTFLAG_SNANA TYPE Z'  HEADER
      so that there is no need to create a file with a list
      of variables. Also see instructions at top of ntdump.pl.
 
    - psnid.car :
      ERRFLAG_FIT = PSNID_BEST_DOFIT() so that it propagates
      into snana ntuple 7100.

    - psnic_BEST.c :
      Illustrate ERRFLAG = ERRFLAG_FAIL, but need more explicit
      flags.

  v10_21d (Jan 8, 2013)
    - util/split_and_fit.pl :
      Fix dumb bug so that VERSION_PHOTOMETRY is used if there
      are no VERSION keys. Previous bug overwrote VERSION_LIST with
      null (with no VERSION keys), leading to an ABORT

    - snana.car : update LDMP_SNFLUX option to include extra 
       columns for filter and chi2. DATAFLAG -> -1 if rejected
       from fit.

   - psnid_BEST.c: fix 64 bit bugs: see new ONE8  argument in 
       alloc() and free() functions.

   - util/sim_SNmix.pl :
       ABORT if number of SIMGEN_DUMP variables is different
       for Ia and NONIa -> avoids pathological *.DUMP file.


  v10_21e (Jan 9, 2013)
    - snana.car : remove a few obsolete +CDE statements
                  and one of the CDE is really a DECK.

    - Makefile : add -lpthread link flag.


  v10_22 (Jan 12, 2013)

     !!! Remove CERNLIB SORTZV and replace with local              !!!
     !!! sortFloat,sortDouble,sortInt wrappers using gsl functions !!!

   - replace all of the CERNLIB sortzv calls in 
        snana.car, snlc_fit.car, SALT2mu.c, snlc_sim.c

   - snlc_sim.c : remove obsolete SORT_GENMJD function.

  v10_22b (Jan 16, 2013 )
    - snana.car : 
      * add NFIELD to ntuples.
      * remove GRAND function and CERNLIB RNDM calls.
        Replace with snran1() and gaussran() calls in sntools.c.
        This change affects only the MCMC option.

   - *.cra files: add CERNLIB and MINUIT patchy flags.

   - snlc_sim.c: gran() -> gaussran().

   - snhost.c : replace another CERNLIB sortzv that was missed in v10_22.
     
   - sntools.c: in the new sort[Double,float,int] functions
        from v10_22, replace 'int' with 'size_t' so that
        it works on other platforms such as U.Penn cluster.
         
     To test with separate MINUIT_DIR/lib/libminuit.a:
      * setenv MINUIT_DIR  $SNDP62_DIR/minuit
      * in Makefile set  LCERN = -L$(MINUIT_DIR)/$(LIB_SDIR) -lminuit
      * comment out CERNLIB patchy flag in *.cra files.

      With this version, the following runs without CERNLB:
       * simulation
       * first iteration of snlc_fit.exe
         (for 2nd iter, need to replace matrix inversion with 
          non-CERNLIB code)


  v10_22c (Jan 18, 2013)

    snana.car, FILTER_UPDATE_DRIVER: skip filtes with no obs
         to avoid aborting when there are no updated filters.

    snlc_fit.car :
     * SEDMODEL_INI: fix bug related to OPT_FILTER_UPDATE.
     * FITINI_COV: replace CERNLIB DFINV with INVERTMATRIX(...)
                    that uses GSL functions.

    sntools.c: new function invertMatrix(..) based on gsl.

    snlc_sim.c : for trigger/spec effic function, include
                 new variable DTPEAK (closest T-Tpeak).


  v10_22d (Jan 21, 2013)

    - util/remove_locf_messages.pl : new script to remove annoying
            64-bit CERNLIB messages in log file.

    - psnid_BEST.c : MS bug fixes to implement MCMC_NSTEP>0.


   v10_23 (Jan 24, 2013)

    - util/sim_SNmix.pl : fix bug found by JLM (for multuple RANSEED keys)

    - util/split_and_fit.pl : call remove_locf_messages.pl for each log file.

    - psnid_BEST.c: add print statement for skipped SN, including ERRFLAG.

    - doc/snana_manual: fix up psnid Sec 8, and remove red warning.

    - SALT2mu.c:
      Fix index bug in avemag0_calc that was uncovered by Y.-L. Kim;   
      Bug caused large MU-shift for fits in which z-bins with too few 
      SN are skipped.  Added new SALT2mu test for SNANA_TESTER.


  v10_23b (Jan 27, 2013)

    - genSmear_models.c: minor fix from JLM.

    - snana.car, 
        * WRSALT2_2: use double precision MJD8
        * fix NMKSDIR_TOT bug that messed up psnid plots.

    - util/split_and_fit.pl : set MXLC_PLOT for all jobs, including psnid.exe

    - psnid.car : 
       * new MXLC_PLOT argument to control output for large jobs.
       * fix logic to increment N_SNLC_PLOT once per SN instead of 3 times.

    - psnid_BEST.c :
      * move some hard-wired type-strings to header declarations.
        See "Jan 27, 2013" history.
        --> Grease code to simplify adding more types later.


  v10_23c (Jan 31, 2013)

    - psnid.car : add TEMPLATES_SNIa[SNIA,NONIa,NONIA] to _OVERRIDE routine.

    - genmag_SALT2.c : minor fix to avoid aborting when TREST=50.000000

    - snfitsio.c     -> sntools_fitsio.c 
      sngridtools.c  -> sntools_grid.c 
      snhost.c       -> sntools_host.c   

   - remove obsolete human_search_eff.c  human_search_eff.h
     and remove from Makefile and snlc_sim.c


  v10_24 (Feb 02, 2013)

      !!! BEGIN SURGERY NEEDED TO REPLACE CERNLIB !!!
          (code behaves the same, just added wrappers)

    - snana.car 
      * remove  RWNTUP_SNANA and OPT_LEGACY_RWNT
      * replace CWNT_xxx routines with TABLE_xxx routines
          (and ditto in snlc_fit.car)
      * FILTER_UPDATE_DRIVER: print message for each update.
      * replace most HBOOK/HF1 calls with SNHISTO_XXX calls
        in sntools_output.c

    - new file src/sntools_output.c[h]
      Controls output to hbook, root, hdf5 ...
      Eventually all CERNLIB calls will be here, and controlled
      by a CERNLIB pre-processor flag. The SNANA surgery involves
      making wrappers to call functions in sntools_output.c.
    
    - combine_fitres.c : use sntools_outfile.o to make ntuple.
                         See 'Feb 2 2013' comments at top.

    - remove make_resids.cra program

   v10_24b (Feb 10 2013)
  
    - snana.car : 
      * develop SNLCPAK()
      * MXLC_PLOT is now in &SNLCINP instead of &FITINP.

    - snlc_fit.car : 
      * call new SNLCPACK.
      * for RDKCOR calls, replace HFILE_KCOR with KCOR_FILE
        --> fixes abort-bug using OPT_LANDOLT or FITRESTMAG options.

    This snana version is unique in that it supports the
    old-style hbook subdirs (SN[CID]) and the new-style
    subdirs (XX[CID]), allowing direct comparisons.
    Paw macros snana#fitres and xxana#fitres create plots.
    The resulting plots for the old and new should be the 
    same. The XX[CID] subdirs are created only if OPT_DEBUG>0 
    so that users will not notice.
    In the next version the XX[CID] subdirs will becomare the
    SN[CID] subdirs, and all the old legacy code will be removed. 
    Similarly, xxana.kumac -> snana.kumac in the next snana version.  
    The next snana version should also allow the implementation of 
    root calls in sntools_output.c.


  v10_24c (Feb 10, 2013)
    - snana.car, snlc_fit.car, psnid*
      Remove old plotting codes, and use new plotting codes.
      Subdir XX[CID] --> SN[CID].
      Still using CERNLIB for plotting, but now we can add
      root code in sntools_output.c[h]
      Removed routines have been stored in PATCH,*REMOVE ...
      to be deleted next version.

  v10_24d (Feb 11, 2013)

     READY TO FORBID HBOOK-KCOR files (in about 1 week)
       1. Remove CERNLIB  flag from kcor.c
       2. Remove HBOOKCOR flag from snana.cra
       3. Remove HBOOKCOR flag from snlc_fit.cra

    - remove the *REMOVED  patches in each .car file.
    - remove '+USE,CERNLIB'  from snana.cra and snlc_fit.cra .

    - the remaining CENRLIB pre-processor flags are in
      * kcor.c  (to be removed in about a week)
      * sntools_ouptut.c (will remain as long as CERNLIB works)
      * combine_fitres.c

   - remove file sort_fitres.cra since it is broken and not used.

   - snlc_fit.car : fix bug to implement LDMP_SNFLUX option.

   - snana.car : 
      * remove obsolete subroutine DMP_SNFLUX()
      * RDKCOR: will abort if hbook file is requested when
                +USE,IF=HBOOKCOR patchy flag is turned off.

   - kcor.c : 
     prepare for turning off CERNLIB flag (but leave it on for now).
     Without CERNLIB flag, it will abort if hbook format is requested.

  v10_24e (Feb 12, 2013)
 
      !!! Beware that random sync has changed in simulation !!!

   snlc_sim.c
    * cleanup gen_event() by moving MWEBV-gen code into separate
      function gen_MWEBV(). Move MWEBV-generation from end of 
      gen_event() to just before GEN_SNHOST_DRIVER() so that
      the host galaxy mags get the right MWEBV applied. Note that
      in prevous versions the host mags got MWEBV from the 
      previous event (i.e., bug-fix).

      --> Random sync is changed.

     * for option "SIMLIB_DUMP 0", apply GENRANGE_PEAKMJD as
       MJD-window.

    sntools_host.c : always read/store host mags to be written
                     to data files.


  v10_24f (Feb 13, 2013)
    - genmag_SALT2()
      Add new function set_RVMW_SALT2(RV) to override default RV.

    - kcor.c: fix sizeof(pointer) bug in malloc_ini().
       Affected only 64-bit machines.


  v10_24g (Feb 14, 2013)

    - sntools_output.c
      Fix a few index bugs (caught by Brandon/HST).

    - snana.car : 
      * NPASSCUTS(MXTYPE) -> NPASSCUTS(0:MXTYPE)
      * Fix CIDASSIGN to work when SNID string name is not 
        part of the filename. Thus "SNID: Tiberius" works
        even of the filename is tib.dat. 
        Uses new ISNLC_ABSO_INDEX.


  SNANA_v10_24h (Feb 16, 2013)

   - snana.car : 
     * protect function GETSIM_STRING() against
       exceeding size of string. Aborts if LTOT > LEN(STRING).

     * TABLE_VARLIST_FILTERS():
       Process up to 30 filters to avoid going past hbook limit of 50.
       Maybe later with root we can relax this.

   - snlc_fit.car, psnid_BEST.c :
     For GETSIM_STRING calls, increase string-size from 200 to 400.

   - sntools_output.c:
     Another dumb bug-fix : remove last index allocation with 
     [MXEPOCH] and declare pointer to dynamically malloc:  
     see SNLCPAK_OUTPUT.IFILT.

  - sntools_fitsio.h
     MXPAR_SNFITSIO  -> 200 (was 100) to handle 56 JPAS filters

  - util/sim_SNmix.pl
    To clean up output, re-route log files into one single 
    $TOPDIR_LOG instead of 1 logDir per job. 

    Fix a few subtle bugs related to setting CIDRAN_MAX.

     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
     SNANA_TESTER; add JPAS-56 simulation and fit to make
          sure snana works with many filters.
     ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


  v10_24i (Feb 17, 2013)
    - snana.car, snlc_fit.car, psnid.car : 
      remove KEEP,LCPLOTCOM and KEEP,BESTFITCOM
      and remove its references.
      This removal should have been done in v10_24c, but I forgot.

    - sim_SNmix.pl :
      Lots of changes, mainly to allow batch system use just
      like split_and_fit, using, for example,
         BATCH_INFO:  qsub  BATCH.TEMPLATE  10

    - sntools.pm sed_strReplace()
      Fix so that single quotes in FITOPT will work; i.e.,
        FITOPT:   MAGOBS_SHIFT_ZP  'u .02'
        FITOPT:   MAGOBS_SHIFT_ZP  "g .02"
      both work.

  v10_25 (Feb 19, 2013)

    FORBID HBOOK-KCOR files
       1. Remove CERNLIB  flag from kcor.c
       2. Remove HBOOKCOR flag from snana.cra
       3. Remove HBOOKCOR flag from snlc_fit.cra


  v10_25b (Feb 22, 2013)

    genmag_SEDtools.h:
    #define MXBIN_LAMFILT_SEDMODEL --> 900   (was 800)

    Start preparing to compile with c++.
    Define each struct, declare hbook functions, and make each 
    prototype visible to calling program. There were a few hundred 
    fixes needed to compile with c++, but the SNANA_TESTER worked 
    perfectly in both 32-bit and 64-bit mode.

    genmag_*.c        -> genmag_*.c and genmag_*.h
    genSmear_models.c -> sntools_genSmear.c[h]

    Remove genmag_DMXV.c

    snana.car: fix stat-summary to work with TYPE=0.

    split_and_fit.pl: for SALT2mu option, save original fitres files
                      in SALT2mu_JOBS/ORIG_xxx

    sntools_host.c is now a compiled object, rather than being included.
   
    Makefile: define object-list for each job:
               OBJ_SNANA, OBJ_SNFIT, OBJ_SIM, OBJ_PSNID


  v10_25c (Feb 23, 2013)

    - snlc_fit.cra, snana.cra : add HBOOK flag for open calls.

    - snana.car: 
       use HBOOK patchy flag around OPEN_HFILE
       use ROOT  patchy flag around OPEN_ROOTFILE

    - MWgaldust.c, genmag_SIMSED.c  : fix to work with c++

    - new files included by sntools_output.c
        * sntools_output_hbook.c  (included with HBOOK flag)
        * sntools_output_root.c   (included with ROOT  flag)
        * sntools_output_text.c   (includes with ASCII flag)

      so that output-specific codes are isolate in a single file.

    - sntools.h : move the paw structures into sntools_output_hbook.c


  v10_26 (Feb 24, 2013)
        !!!  ROOT works : ready for development !!!!

    - to develop root code requires two manual changes
        1. sntools_output.c: set "#define ROOT" (uncomment this line)
        2. Makefile : set USE_ROOT=1  (-> compile sntools_output with c++)
      Note that the public snana release does NOT require root.

    - snana.cra, snlc_fit.cra : remove +USE,HBOOK,ROOT 

    - sntools_output.c :
      Add dummy functions OPEN_HFILE, OPEN_ROOTFILE (and for CLOSE_)
      that simply abort. They are defined by #ifndef HBOOK,ROOT;
      i.e., if #define HBOOK/ROOT are not defined.
      With this strategy we do not need extra +USE,HBOOK,ROOT
      patchy flags in the fortran code. The only pre-processor
      HBOOK,ROOT flags are in sntools_output.c .

    - snmake.pl:  Minor bug fix.

    - snana.car : 
      Fix bug identifed by N. Karpenka attempting to reproduce K09 results.
      Bug in RDKCOR_FITS_KCOR affected MLCS fits in which the BX filter is
      defined. The bug was that INIT_KCOR_INDICES() was called before the 
      ADDX function that adds the BX filter to the rest-frame list. This
      bug has probably been there since 8_30 when the AVWARPTABLE was added, 
      for both HBOOK and FITS formatted kcor files. However, we did not see 
      the bug in HBOOK format because the old SNCOSM09 kcor files were created 
      with explicit K_XX  k-corrections and thus BX was properly defined from 
      the KCOR list before INIT_KCOR_INDICES was called.  With thew new FITS 
      format, there is no need to generate the dummy K_XX, K_UU, K_BB etc ..., 
      and this is when the bug showed up.
     
      WARNING: fixed bug for the following snlc_fit.exe options:
       - FITMODEL_NAME = 'mlcs2k2'
       - BX filter is defined
       - used a kcor file that is NOT in $SNDATA_ROOT/kcor/SNCOSM09
             
      In particular, this bug shows up trying to reproduce the K09-mlcs2k2
      results with the newly-created kcor files in kcor/SNCOSM09+fitsFormat.
      If all of the above are part of your analysis, please compare results 
      from v10_26 and your older results. If the results differ, v10_26 is 
      correct.  No need to re-compute k-cor files. If you used any kcor file 
      in $SNDATA_ROOT/kcor/SNCOSM09, then you are immune to this bug. The bug 
      does affect other models (SALT2,snoopy,SIMSED)

      SNANA_tester.pl:
        The bug did not show in LCFIT_MLCS_SDSS (with BX filter) because
        I switched from SNCOSM09(bug immune) to SDSS_Doi2010 (bug expressed).
        The bug is indeed there using SDSS_Doi2010 (which does not define K_XX),
        but the old/new software had the bug and thus it did not show itself.

    - sntools.c, update *1dindex() functions to abort if any index
         exceeds NPT. This catches the snana bug above.

  v10_26b (Feb 26, 2013)
    - fix Makefile to work with/without USE_ROOT flag
      (see SNTOOLS_OUTPUT list)
      Note that 'make' does not work in v10_26 because the
      Makefile needs un-distributed sntools_output_root.c.

    - sntools_output_hbook.c 
      reduce HLIM from 15 million to 1 million 
      Large memory was for reading kcor-hbook files,
      but those are gone now. Only need limited memory
      for disk-resident output.

  v10_26c (Feb 26, 2013)
   - snlc_sim.c
     new sim-input key  RANLIST_START_GENSMEAR to independently
     change genSmear randoms without changing random sync for
     generation. Note that random sync has changed w.r.t.
     previous snana version -> SNANA_TESTER fails on sims.

   - snlc_sim.h: increase MXRANLIST -> 1000 (was 500),
                 and define multiple random-lists (NLIST_RAN=2).

   - sntools*
     char -> const char in declarations for print_banner
     and replace_str to avoid deprecation errors with c++.

     

  v10_26d (Feb 27, 2013)

    - psnid_BEST.c : fix display string to show correct NONIA index
                     and also the name of the nonIa template.
                     Masao still needs to fix this in the fitres output.

    - snlc_sim.h
      MXEPSIM -> 10*MXEPOCH = 6000(x10 increase) to allow for large
      grid-gen needed for PSNID. Change is based on ABORT found by 
      HST group with  NEP x NFILT = 56 x 11 = 616 > 600.

    - snlc_sim.c : for grid-gen, fix minor bug setting NGEN used
        by set_screen_update(). Fixes undefined NGEN.


  v10_26e (Mar 2, 2013)
    - psnid_BEST.c :  
       * add IIN to list (next to IIn).
       
    - snana.car : remove ADUSCALE and ADUSCALE_INVERSE.
         Instead define ZEROPOINT_FLUXCAL_DEFAULT = 27.5.

    - snana.car, snlc_fit.car : 
       * replace ADUSCALE with ZEROPOINT_FLUXCAL_DEFAULT.
       * remove LTUP_BITPACK and remove STRING_IPACK function.
         The bit-packing syntax is difficult to parse for the
         translation to root TTree, so it's easier without bit-packing.

    - sndata.h : 
       * SNDATA.MJD[] -> double (was float)
       * replace FLUXCAL_SCALE=1.E11 with ZEROPOINT_FLUXCAL_DEFAULT=27.5

    - sntools.c: in fluxcal_SNDATA do everything in double.

    - snlc_fit.car :
      In INIT_TABLE_SNFITEP, replace long VARLIST string
      and single SNTABLE_LOAD call with VARNAME for each
      epoch-variable and separate SNTABLE_LOAD call for
      each variable. Needed to work for TTree translation.

    - doc/snana_install.tex :
      Include $MINUIT_DIR as one of 3 tarballs.
      Some general updating (remove/update stale instructions).

  v10_26f (Mar 4, 2013)
     - psnid_BEST.c
       * fix string-length in call to GETSIM_STRING().
         (fixes abort on folio).

     - sntools_output_root.c: 
         lots of updates ... basically working now.

     - split_and_fit.pl:
        Remove functions to make debug-version when NaN are found;
        doesn't work for FITS or PRIVATE_DATA_PATH.

  v10_26g (Mar 8, 2013)
    - snana.car : define internal logical SNANAJOB

    - sntools_output_text.c: fix to work with multiple fits (psnid)

    - psnid_BEST.c: bug-fixes from Masao 
          (fixes NaN problems in Chris' DES-data jobs)

  v10_26h (Mar 10 2013)
   - snlc_sim.c : 
     * new key SNTYPES_Ia: <type_spec> <type_phot>
     * remove legacy SPECTYPE key and associated code.

   - psnid_BEST.c : new function MONPLOT_PSNID_BEST() to make
       arbitrary 1D and 2D plots. Called by psnid.car.

   - sntools_output_root.c: lots of updates.


  v10_26i (Mar 17, 2013)
   - snana.car, subroutine RDKCOR_FITS_FILTERS():
     Abort if there are no oberver-filter matches between
     the survey and the kcor file. Previously the abort
     came later when the PRIMARY SED could not be found,
     but this message is too obscure.

   - kcor.c : fix bug by reading only the USED primary SEDs.

   - snlc_sim.c: 
      * new function GENFILTERS_CHECK() to make sure
        that each GENFILTER is one of the SIMLIB filters.

      * new sim-iput keys to make Gausson + exponent AV distribution
          GENTAU_AV:      xxx          # dN/dAV = exp(-AV/xxx)
          GENSIG_AV:      xxx          #      += Guass(AV,sigma)
          GENRATIO_AV0:   xxx          # Gauss/exp ratio at AV=0
        The first key is old; the next two are new.

   - snlc_fit.car:
     Protect rest-frame models against incorrect
     filters in kcor file. See abort-check just before 
     calls to GENMAG_MLCS2k2 and GENMAG_SNOOPY.

   - split_and_fit.pl: new key VERSION+FITOPT
       to specify version-specific fit-options (requeest by JLM).


  v10_26j (Mar 23, 2013)

    - snana_manual.tex:
      Major overhaul/update of Sec 4.5 (simulating NON1A).

    - snlc_fit.car :
      in FITINI_COV, apply FUDGE_MODELERR_SCALE.
      FUDGE_MODELERR_SCALE=0 should do the same thing as
      FUDGE_MAGERR_MODEL=0, but only the latter has been
      properly tested: simulate with no intrinsic scatter
      and no Galactic extinction, then fit, then run SALT2mu
      and see if chi2/Ndof=1.

      New option FILTER_FITMAGDIF to predict this filter mag
      with filter excluded, and then measure it's peak mag using
      only this filter. magdif is output.

   - util/split_and_fit.pl
     New APPEND_FITRES option to append each fitres file with  
     variable(s) from hbook file.

     Abort if NSPLIT > MAXMERGE to avoid hmerge.exe failure.

  v10_26k (Mar 27, 2013)
    - snana.car
      * call SNLCPAK_SURVEY after all inits instead of from SNFILE_OUT_INIT;
        allows changing NFIT_PER_SN anywhere in the init stage.

      * fix CIDASSIGN to work with split_and_fit on text format.
        Now we get plots to work.

    - snlc_fit.car  
      * FITMAGDIF_CALC make 3 separate LC plots for each fit;
        1. band only
        2. other bands
        3. all bands-> nominal

    - sntools_output_hbook.c: fix dumb bug booking Tobs vs. NOBS (hid 1000).
         It's amazing that it worked before.


    - Lots of updates from JLM
        /home/s1/jmosher/snana/util/sntools.pm
        /home/s1/jmosher/snana/util/SALT2train_biascorr.pl     <== NEW
        /home/s1/jmosher/snana/util/SALT2train_extcolordisp.pl <== NEW
        /home/s1/jmosher/snana/util/SALT2train_run.pl
        /home/s1/jmosher/snana/util/SALT2train_pipeline.pl

  v10_26l (Mar 28, 2013)
    - psnid_BEST.c : 
      * write SIM_ITYPE into fitres file for sims.
      * major overhaul of INIT_OUTFILE and UPDATE_OUTFILE (fitres file)

    - snana.car : new routine GET_SIMNAME_TYPE()

  v10_26m (Mar 31 2013 )
    - psnid*  Add LTUP_FITRES namelist option and add SNTABLE
      (hbook ntuple and/or root tree) with SNANA + SIM + PSNID variables.

    - new script: $SNANA_DIR/util/sim_SNgrid.pl  to generate a grid
      of tempaltes for psnid.  See instructions at top of file.

    - manual: add section 8.1 about sim_SNgrid.pl .

  v10_27 (Apr 2, 2013)

         !!!!! REQUIRE MINUIT LIBRARY !!!!
               (still uses CERNLIB)

   - snana.car:
     MAIN routine calls MNDUMMY() for snana and snlc_fit to ensure
      that new library is used.

   - sntools_output_hbook.c & sntools_output_root.c :
     Allow C_like ':D' and ':F' to specify cast in SNTABLE_LOAD.
 
   - sntools.c:
     Modify fitresVar utility to store optional float array by passing
     [VARNAME]/F or [VARNAME]:F.  Used by psnid code to read nearest
     neighbor arrays with more compact storage.

   - psnid* : 
     * fix a few dumb bugs from previous version.
     * start adding code to nearest nbr.



  v10_27b ( )
    - sntools_output_hbook.c : increase HLIM from 1E6 to 2E6.

    - snana.car  MXLC_PLOT -> 100 (was 200)

    - sntools_grid.c : 
      *  write unique 'GRIDKEY' key in header to identify GRID.
      *  write new IVERSION key for backward-compatiability
      *  write LAMAVG in 2nd column of FILTER table;
          needed to compute Galactic extinction.

    - pnsid* : misc updates by RK for Galactic extinction and NN.


  SNANA_v10_27c (Apr 6, 2013)

    - snlc_sim.c, psnid*, snana.car, snlc_fit.car,  sntoold_grid.c[h]:
      replace 'LUMI' notation with 'SHAPE' in code, input-file examples,
      and in mamual. For backward compatibility, input variables using 
      'LUMI' are still valid, but the documentation points to the 
      corresponding SHAPE variable.
      For example, NGRID_LUMIPAR and NGRID_SHAPEPAR are both accepted
      and have the same meaning for simulating a model on a grid.
    
    - kcor.c: fix compile bugs at lines 883 & 888  (found by Y.-L. Kim)

    - new utility   /util/translate_SALT2dictFile.pl

    - psnid*  : more NN updates

    - sntools_output_hbook.c : fix valgrind bug

  v10_27d ( )
    - psnid_BEST.c:
       * add Galactic extinction.
       * few model-error tweaks from Masao.

    - snlc_sim.c : init_GENLC(), set generr8_obs[ifilt] = NULLFLOAT.
         (model errors were not initialized).

  v10_27e (Apr 17 2013)

    - snana.car
       In SET_SURVEY (used by simulation), set ABORT_ON_BADZ=T
       so that it aborts if simulated redshift is outside
       the KCOR range.

       Fix bug in SNRECON setting LLAM logical when redshift
       is not defined.

       remove PATCH,*HBOOKKCOR.

       new &SNLCINP variable NONSURVEY_FILTERS ; see manual

       NEARBNR_XX variables in &SNLCINP and routine
       SNANA_NEARNBR_INIT() to parse nml variables and
       call appropriate routines in sntools_nearnbr.c.
       Allows any fitting program to use NN method;
       first case is PSNID.

    - util/sim_SNgrid.pl : print message at end with how many
         jobs are OK, and WARNING if job(s) failed.

    - split_and_fit.pl : 
      * Give warning if multiple 'split_and_fit' jobs are detected.
      * MERGE.LOG has warnings if merged hbook file is missing.
      * new HRECOVER option to recover missing merged FITOPT[nnn].his file(s).
      * define @COPY_INPUTFILE_KEYS to copy arbitrary list of input files.
        Check both the namelist and the 'FITOPT:' lines for KEYS.

    - SALT2mu:  require 'z' and 'zERR' instead of 'Z' and 'ZERR'.
           Same change was made to FITRES output 1 or 2 versions back.
           Allow 'z' or 'Z' for back-compatibility.

    - sim_SNmix.pl: abort if sim-input file (Ia or NONIa) is missing.

    - genmag_NON1ASED.c:
       Increase MINLAM,MAXLAM range to 300,25000 (was 1000,12000).
       Requested by S.Rodney.

    - sntools_output_hbook.c: fix c++/malloc bug found by STK.
    - sntools_output_root.c : 
          fix aweful 'ep2' bug causing nasty root problems for Eve

    - new codes  sntools_nearnbr.c[h]  for nearest neighbor method.
         NN method NOT ready for public use.

    - Makefile: snana codes link to obj/sntools_nearnbr.o



  v10_27f (Apr 17, 2013)
    - Makefile: fix so that atmospher_sim.exe works with ROOT flag.
    - sntools_output.c : add cplusplus extern statement around
                         declarations at end of file.

  v10_27g (Apr 22, 2013)
    - new sntable_dump.c[exe] program to dump contents of SNTABLE
      (ntuple or tree). The dump can be either variable names,
      or extracting values for a list of variables.
      Works for both hbook and root files.

    - sntools_output_root[hbook].c:
      Added SNTABLE_DUMP_* utility functions to be used by sntable_dump.c.
      Use hbnamc (instead of hbname) for character strings.
      
    - split_and_fit.pl
      New command-line option '1' to add 1 sec delay after each submit.


  v10_27h (April 23, 2013)
    - new utility  util/sntable_dump.pl to eventually replace
      the nt*.pl utilities. Sntable_dump.pl does not use paw
      (and hence works on 64-bit machines) and will work for 
      both hbook and root files.

    - sntable_dump.c:  more debugging.

    - ntprint.pl, ntdump.pl, ntappend2fitres.pl :
        At end of each job, write NOTICE recommending to switch
        to updated command using sntable_dump.pl, and give exact
        command so that users can cut-and-paste.

    - snmake.pl: add sntools_nearnbr.o and -lminuit.

    - psnid_BEST.c: major bug fix by Masao & add LCQ to fitres output.

    - split_and_fit.pl: new argument '1' for 1 second delay after each submit.
           split_and_fit.pl  <myinput.nml>  1


  v10_27i (Apr 25, 2013)
    - split_and_fit.pl: fix bug in '1' option to set DELAY_SUBMIT
                        between submissions (for batch).

    - sim_SNmix.pl:
      NGEN_UNIT key is now optional; removing this key allows
      generating a fixed NGEN_LC number for each sim job.
      Useful, for example, when changing the SPECEFF function
      and generating the same number of accepted events.

    - snana.car
      in GET_FILTMAP, COPT*12 -> COPT*(*) 
         (bug found by B.Patel).

    - sntools_grid.c
      Fixed aweful cast-argument bug that screwed up
      grid-generation on 64 bit machines, but worked on 32 bit.
         (bug found by B.Patel).
      ILCOFF was defined as unsigned long, but TUINT (usigned int)
      was passed to cfitsio.

    - snmake.pl :
      Fix a few bugs so that it works on 64 bit machines.

  v10_27j (Apr 26, 2013)

    - rename eigen.f -> sntools_eigen.F  

    - new code & program 'merge_outFiles.c' to merge
      hbook or root files. Will eventually repalce hmerge.exe
      New code works, but util scripts still use hmerge.exe.

    - sntools_hmerge.F:
      wrapper for HMERGE since C-function cannot call HMERGE
      with list of files.  Also fixed annoying capital letter 
      problem so cwe an merge fileNames with lower & upper case.
      Next snana version, split_and_fit can be updated so that
      lower-case hbook files are not needed to merge.


  v10_27k (Apr 27, 2013)

    - LQPAW = 30 million (in sntools_hmerge.F) adds 120 MB to program 
      sizes. Fix so that large LQPAW is only in merge_outFiles.exe :
         size(snana.exe)    = 324 MB ->  212 MB
         size(snlc_fit.exe) = 458 MB ->  347 MB
         size(snlc_sim.exe) = 407 MB ->  295 MB

    - SALT2train_pipeline.pl : new option LASTSTAGE to process
          up to a certain stage (requested by Rahul)

    - kcordump.cra : fix with new call to SET_SURVEY.
             (requested by Brandon)


  v10_27l (Apr 28, 2013)
   - SALT2mu.c :
     Few updates, mainly chi2 loop skips rejected events if only
     accepted events are written out -> saves CPU.

   - split_version.pl:
     add optional arg  PRIVATE_DATA_PATH; used by split_and_fit.pl.

   - split_and_fit.pl:
     Fix to work with TEXT format and PRIVATE_DATA_PATH.
     Before PRIVATE_DATA_PATH worked only with FITS format.

   - begin SALT2mu_fit.pl to run SALT2mu fits on output of split_and_fit.

  v10_27m (Apr 30, 2013)

    - snlc_fit.car :
      Fix a few tables names to match those in the text/fitres file.
        PHOTOZ        -> ZPHOT
        ERR_[PARNAME] -> [PARNAME]ERR

      and fix other table names to be more clear:
         ERRFLAG[ipar1]    -> ERRFLAG_[name]
         RHO[ipar1][ipar2] -> REDCOV_[nam1]_[nam2]
           and add COV_[nam1]_[nam2]

    - sntools_output_root.c:
      Modify SNTABLE_LOAD_ROOT() to load one variable at a time
      instead of load several colon-separate variables.

    - snana.car : 
      new &SNLCINP variable DTOBS_MODEL_PLOT (default= 2 days)
      to control binning of best-fit model in light curve plots
      and text dumps. Requested by Diemer.

    - util/SALT2mu_fit.pl  is ready .

    - sntools.c :
      fitresVar_init(): abort if same VARNAME is passed twice.


  v10_27n (May 2, 2013)
    - combine_fitres.c
      * fix bug opening ROOT file  
      * new option to create root file instead of hbook file
           combine_fitres.exe  my.fitres  R    (root file instead of hbook)
           combine_fitres.exe  my.fitres  R H  (both root and hbook)
 
      * hbook file output is combine_fitres.his (not .tup)

    - PAWC problem: cannot define COMMON/PAWC/ twice with different sizes.
      Amazingly it worked until using c++ compiler to include root code.
      PAWC needs only 1 million words for snana/snfit/psnid jobs,
      but 10-20 million are needed for the hbook-merge.

      * merge_outFiles.c ->  merge_root.c   & merge_hbook.F
                         ->  merge_root.exe & merge_hbook.exe
      * remove sntools_hmerge.F (absorb into merge_hbook.F)

    - split_and_fit.pl:  MAJOR OVERHAUL to work with hbook and/or root.

    - snana.car, snlc_fit.car:
      use lowercase 'z' (instead of 'Z') for redshift names.
      zPHOT -> zPHOT, ZERR-> zERR, etc ...

   v10_27o (May 6, 2013)
     - snana.car
       * in GET_SIMSTRING, rename 'SIMT0' -> 'SIMPKMJD' so that 
         name in fitres file matches ntuple/tree name.

     - SIMSED_prep.c[h] : updated from Diemer.

     - snlc_fit.car:
       in FCNCHI2_PRIOR, skip NaN check for IPAR = IPAR_ITER or IPAR_SN
       because INIBND is left at +- 10,000 and hence ISN > 10,000 fails
       and causes wierd problems.



  v10_28 (May 7, 2013)
             !!! Can work with ROOT only !!!!
         (except for mkfitplots.pl to plot light curves)
            
    - fixes to work with root only (i.e., no hbook).
      * Makefile (psnid,SALT2mu) and define separate excutable lists
        ROOT_EXE and HBOOK EXE (merge programs)
      * unfole_snpar.c (extend #ifdef CERNLIB to cover HSTATI call)
      * remove hmerge.cra and remove it from Makefile (see merge_hbook)

        Note that default usage is still with hbook;
        only root experts should start using root.

   - Recall procedure to set root or hbook flag(s);
       Makefile: set USE_ROOT and USE_HBOOK
       sntools_output.h:  #define ROOT, #define HBOOK

      

  v10_28b (May 11, 2013)

    - unfold_snpar(): replace native hbook calls with sntools_output()
      to work with either hbook or root. NOT TESTED -> BEWARE !

    - snlc_sim.c: 
      allow GENMAG_SMEAR_FILTERS and GENMAG_SMEAR_MODELNAME to both
      be specified; allows .1 mag smear in UV to mimic SALT2 model error.

    - split_and_fit.pl, sntable_dump.pl:
      few tweaks to specify unique filenames for 'append' option
      to avoid clobbering append files with multuple jobs.

    - genmag_SALT2.c: 
      fix bug in magerrFudge_SALT2 to add fudged mag-errors in quadrature
      instead of replacing magerr_model. The U/u band model error was 
      previously underestimated !
      In short, The MAGERR_LAMOBS value in 
          $SNDATA_ROOT/models/SALT2/SALT2.Guy10/SALT2.INFO
      was replacing the model error instead of being added
      in quadrature to the model error.

      As a quick test I fit SDSS(ugriz) with v28 and v28b and  
      compared differenecs in SALT2 fitted params. Cuts are
      FITPROB>0.01 and z<0.2 :
 
            param    <dif>    RMS(dif)
           ----------------------------
             mB     -8.0E-4   0.003
             c      -7.7E-4   0.004
             x1     -5.4E-3   0.03
             t0     -5.5E-3   0.05
           ----------------------------

  v10_28c (May 15, 2013)

    - snlc_fit.car
      in SNLCPAK_DISPLAYTEXT_FIT, include FITMAGDIF result.

    - snlc_sim.c: model MAG20 -> FIXMAG and a few bug fixes.
                  new key is  "GENMODEL:  FIXMAG  20"
 
    - sim_SNmix.pl:
      * Fix to use NGEN_LC with Ia and NONIa/FIXMAG sim files.
      * Define FUDGESCALE_READNOISE separately from FUDGESCALE_SKYSIG.
         (Beware: needs testing).

    - snana.car:
      For parsing text files, increase MXCHAR from 400 to 500 ...
      can now read JPAS with 56 filters.


  v10_28d (May 18, 2013)

    - sntools.c,  wr_HOSTGAL(): write no more than 10 per line
      to avoid lines that are too long. This was the real problem
      reading the text/JPAS files with 56 filters.

    - snana.car:
      in PARSE_WORDS, parse each line as it is read instead of
      storing all lines in a text file. Saves 20 MB of static memory.
      See new routine PARSE_LINE(LINE).

    - SALT2train_pipeline.pl: update from JLM.

    - sntools_fitsio.h :
      MXPAR_SNFITSIO  -> 400  (was 200) to handle 56 JPAS filters
      with HOSTLIB

    - genmag_SALT2.c : fix to skip re-reading when re-initialized.
        -> Allows using FILTER_UPDATE_PATH without re-reading the
           SALT2 files for every SN. Hopefully will help run jobs
           on fulla without hanging up.


  v10_28e (May 21, 2013)

    - merge_hbook.F :  allow merging just one file (i.e., a copy).

    - genmag_SALT2.c :
      new function checkLamRange_SALT2() to abort if any part of
      filter transmission is outside SED range.

    - util/split_and_fit.pl:
      Fix merging bug when there is just 1 outFile to merge.

    - snlc_sim.c
      Make separate GENSMEA_RAN lists for filter-smear and model smear
      so that both can be used without introducing artificial correlations.
      Note slight change in random-sync.

      New sim-input key "NGEN_SCALE:" so that
           NGEN *= INPUTS.NGEN_SCALE
      See new Sec 4.20 of manual to describe NGEN keys.

      Remove obsolete yearMJD().

    - snana.car
      in WRSALT2_2, write out RA and DECL in SALT2-formatted files.
      Needed by N.Regnault.

  v10_28f (May 25, 2013)
    - util/sntools.pm : updates from JLM reading fitres files.

    - SIMSED_extractSpec.c: update from JLM.

    - wfit.c :  Fixed bug that hung code for empty fitres file (JLM)

    - sntools_fitsio.c: new form '1K' for long long int (for HOSTGAL_OBJID)

    - sndata.h: int HOSTGAL_OBJID -> long long and printf with %lld.

    - snana.car : SNHOST_OBJID -> INTEGER*8.

    - snlc_sim.c: new input key SALT2mu_FILE to read alpha,beta from here.
         
  v10_28g (May 26, 2013)
    - sim_SNmix.pl:
      new option  DONE_STAMP:  <fileName>   to touch done-file
      when all jobs are done.

    - sntools.pm: remove doneFile and XCMD args from make_batchFile().

    - sim_SNmix.pl, split_and_fit.pl, SALT2mu_fit.pl:
      Modify to work with new make_batchFile() in sntools.pm.
      "touch doneFile" is part of command list for ssh and batch,
      rather than a separate argument.

    - SALT2mu_fit.pl: fix some bugs related to multiple FITOPTs.

    - lots of updates from JLM:
        /home/s1/jmosher/snana/util/SALT2train_biascorr.pl
        /home/s1/jmosher/snana/util/SALT2train_pipeline.pl
        /home/s1/jmosher/snana/util/SALT2train_run.pl
        /home/s1/jmosher/snana/util/SALT2train_translate.pl
        /home/s1/jmosher/snana/util/sntools.pm

  v10_28h (May 28, 2013)

    - util/sim_SNmix.pl :
      if only one SN type (IA or CC) then the following MASTER keys
      are optional:  H0  ZRANGE  RANSEED  FORMAT_MASK 
      since there is no need to syncronize these. Note that
      GENPREFIX is still required.

    - sntools_nearnbr.c :
      Add function nearnbr_makeHis() to make plots needed
      for training.

    - sim_SNmix.pl :  Implement SNANA_MODELPATH key.

  v10_28i (June 1 2013 )

    - sntools.c: 
      fitresVar_read(): read long double (%Lf) instead of double
      to handle 19-digit HOSTGAL_OBJID. Also allow defining
      long long with OBJID:/LL

    - sntools_fitsio.c : new option to read long long ints (for OBJID).

    - psnid_BEST.c: updates from Masao.

    - snana.car : for NONSURVEY_FILTERS option, only add filters that
       are NOT already specified. Thus if NONSURVEY_FILTERS = 'UGRIZ'
       then it works for both SDSS data (ugrizUGRIZ) and for
       simulations with 'ugriz'.

  v10_28j (June 1, 2013)
    - snana.car
      Fix dumb bug related to NONSURVEY_FILTERS.

  v10_28k (Jun 10 2013)

    - SALT2mu.c: avoid NaN when z=0. 

    - sim_SNmix.pl: 
      * fix so that CIDs are unique with RANSEED keys.
      * if job aborts, create DONE-file with _ABORT part of file name.
      * create SIMJOB_SUMMARY.LOG file
      * remove call to wait_for_files.pl;  instead use local check_ALLDONE.

    - update the following from JLM:
       SALT2train_biascorr.pl  SALT2train_run.pl  TRAIN_SIM.pl  
       sntools.pm  wait_for_files.pl  SALT2train_pipeline.pl

    - ../doc :
      Add the following to PUBLIC.LIST :
        snana_install.tex   MAKE_SNANA_*
      to allow anyone to update the manual using latex.

   - snlc_sim.c[h] :
       Define OFFSET_SNTYPE_PHOT = 100 to add to SNTYPE
       for photo-id subset.

       sort_CIDRAN(): fix bug so that NON1A have random CIDs.
          Previously NON1A CIDs were ordered by template.


   - split_and_fit.pl:
      Fix option "COMBINE_ALL_FLAG: 1" so that we can combine
      sim-files with different RANSEEDs.

   - snana.car:
     In INIT_TABLE_SIMVAR, replace SIM_MODEL_INDEX with SIM_TYPE_INDEX

     New nml variable ABORT_ON_MARGPDF0 to control abort when
     marginalized PDF is zero everywhere. Needed to run all
     SDSS candidates with mlcs2k2 using marginalization.

   - sntools_fitsio.c : write SIM_TYPE_INDEX


  v10_28l (Jun 16, 2013)

     Main changes
         * GRID option works with SIMSED model (simulation
         * Vmax option in snlc_fit.exe
         * FILTER_REMAP option (snana,snlc_fit)

    - snana.car
      CHECK_HEADER: give more clear error messages on ABORT.

    - snlc_sim.c:
      SIMLIB_read(); minor fix to apply RA,DEC cuts immediately after
          reading these keys in the LIBID header.

      Fixes so that GRID option works with SIMSED model.
      See INPUTS.IPAR_SIMSED_SHAPE, INPUTS.IPAR_SIMSED_COLOR
      SIMSED_PARAM key is equivalent to 
        SIMSED_SHAPEPAR
        SIMSED_COLORPAR
        SIMSED_COLORLAW
      so that sntools_grid know which SIMSED params are what.

    - sim_SNmix.pl:
      Add 'Dont panic' message in the SIMnorm log files so that
      people to worry about the ABORT message.

    - split_and_fit.pl:
      fix GZIP_FLAG to gzip $VERSION_FITOPT* instead of $VERSION*

    - snlc_fit.car : new VMAX_XXX routines for 1/Vmax method
         New namelist variables are 
           OPT_VMAX  = 3  ! 0,1,2,3 l see OPTBIT_XXX params
           MAGLIM_VMAX = 'r 21.5  i 22.'

    - sntools_grid.c[h]: 
      Fix to work with SIMSED model.


  v10_28m (Jun 18, 2013)

    - sntools_output*
      * new SNHIST_RD* utilities to read histograms.
        They work for HBOOK, but just have dummies for root.
        CLOSE_HFILE calls hrout  only for NEW file.

    - SIMSED_fudge.c: updates from JLM.
  
    - psnid_BEST.c :
      fix bug setting NONIA_INDEX_[type] in fitres file.
      [bug found by Dillon]

    - snana.car
      Define new string-length paramters:
         MXCHAR_CCID, MXCHAR_VERSION,  MXCHAR_SURVEY
         MXCHAR_PATH, MXCHAR_FILENAME, MXCHAR_MODELNAME
      and use throughout snana.car and snlc_fit.car .
        MXCHAR_VERSION   -> 72 (was 60)
        MXCHAR_MODELNAME -> 72 (was 60)


  v10_28n (Jun 24, 2013)
    - snlc_sim.c, SIMLIB_read(): for USE_SIMLIB_REDSHIFT option
      apply redshift cut to avoid SIMSED abort when Z(simlib)
      exceeds binary range.

    - few fixes to translate_SALT2dictFile.pl

    - split_and_fit.pl: minor fix to avoid clobbering LOG file 
        with batch-LOG file.

    - snana.car:
      for VERSION_REFORMAT_FITS, open and update IGNORE file.

      for SNTABLE make sure that zHOST,zHOSTERR,HOST_ANGSEP
      are always written.

  v10_28o ( )
   - snana.car
     * in subroutine TABLE_VARLIST_FILTERS(), ignore filters that
       are in the FILTER_REMAP list.

     * finally fix "SET PRI" to work (was missing NARG=1).
       To get minuit printout
         &SNLCINP
            MINUIT_PRINT_LEVEL = 0 (or higher)

     * define parameter NFIT_VERBOSE=500 and reduce printout
       after this many fits.

   - snlc_fit.car:  for plotting, ignore FILTER_REMAP filters.

    

  v10_28p (Jul 2 2013 )
    - snlc_fit.car: 
      VMAX_ANA():  Fix x0 re-calculation used for zmax 
      VMAX_ANA():  Vmax -> 4*I*Vmax

   - All psnid*.* files were updated by Masao. 
     Includes major bug-fix and new &PSNIDINP variables TEMPLERR_SCALE_*

   - psnid_BEST.c:
     RK updated psnid_best_store_finalPar() to store absolute
     NONIA_INDEX instead of internal (untraceable) index.
     This propagates to the fitres file so that now the fitres
     file NONIA_INDEX matches that on the 'mkfitplots' labels.
     Note that the stdout dump still prints the internal index.

  v10_29 (Jul 3, 2013)

        ***** BUG-FIX for SALT2 MODEL-ERROR CALCULATION *****

   - genmag_SALT2.c:
     Fix aweful bug in gencovar_SALT2;
     was double-counting kcor term on diagonals.
 
   - snlc_fit.car : 
      * new option OPT_SALT2FIT=4 to emulate Julien's snfit.

      * SALT2xx1: xx1=0 in ITER=1 (instead of 1) ->
         causes very slight changes in SNANA_tester script.

   - snana.car : MXCHAR -> MXCHAR_LINE = 700 (was 500)


  v10_29b (July 12, 2013)

    - snana.car: 
      * SET_FILTINFO_UPD() fix string-usage problem that caused
        segfault  when compiled in debug mode.

      * NONSURVEY_FILTERS_ADD -> common block to fix dumb bug.

      * WRSALT2_2: write name of ascii sndata file ONLY for FORMAT_TEXT=T.
           --> avoids seg fault when translating more than 20,000 .

    - genmag_SALT2.c: 
      MXBIN_VAR_SALT2 -> 120,000 (was 20,000) to read fine-binned
      error maps. Increases program size by 9 MB.
 
      in SALT2magerr, when vartot<0 set it to .01^2 as JG does
           (i.e., no longer sets to -vartot)

      in SALT2magerr replace magerr_model with EXACT calculation 
      instead of approximation.

    - SALT2.c: write M0avg to fitrs file
    - SALT2mu_fit.pl: include M0avg in summary

    - snlc_fit.car:  
         INIBND(AVmin) -> -3 (was -1)  for mlcs2k2
         INIBND(cmax)  -> +2 (was 0.8)  for SALT2


  v10_29c (July 18, 2013)
    - snlc_sim.c  new input HOSTLIB_GALID_NULL [=-9] to set
      default value of HOSTID when there is no host.
      Needed to set to -20 for FIXMAG fakes.

      Set INPUTS.MODELSMEAR_FILE from model rather than hard-wired 
      value. Allows using extended SALT2 models such as UV2IR.

      With the above bug-fix, must do
    cp $SNDATA_ROOT/models/modelSmear/colorSmear_SNLS3_extend.dat \
       $SNDATA_ROOT/models/SALT2/SALT2.Guy10/salt2_color_dispersion.dat 


    - snana.car:
      * fix bug writing FIELD names to FITS format;
        SNLC_FIELD*20 -> SNLC_FIELD(MXEPOCH)*20
      * for snana->SALT2 translation, include new header key
         @FIELD <list of overlapping fields
      * Fill new list of overlapping fields, SNLC_FIELD_OVPLIST
             in functino COUNTFIELDS

      * for TERSE format add optional PSFSIG and SKYSIG
        for each epoch.  BEWARE -> UNTESTED.

  v10_29d (Jul 19, 2013)
    - snlc_fit.car: fix subtle bug in LFITFUN_FILT that caused
       unecessary ABORT using the NONSURVEY_FILTERS option.
       Affects fitting SDSS sims when using NONSURVEY_FILTERS='UGRIZ'

  v10_29e (Jul 23, 2013)

    - sntools_genSmear.c: 
      for G10 scatter model, set MINLAM properly instead of 
      hard-wired to 1700.

    - snana.car:
      * new nml input  PREFIX_DMP_SNFLUX (for split_and_fit)
      * SNFILE_OUT_INIT, default prefix is VERSION instead  
           of SURVEY for text-dump
      * LDMP_SNFLUX outfile has two new columns: SNID & MJD;
          allows catenating them all into one file.

    - sntools_output:  new *MJD argument to SNLCPAK_DATA,
         and added arg in snana.car, snlc_fit.car and psnid.car.

    - split_and_fit.pl: 
      *  *BATCH.LOG ->  *BATCH-LOG so that ls *.LOG ignores batch-logs.

      * works with LDMP_SNFLUX=T. All text-dump files for a given
        VERSION+FITOPT are catenated into a single file,
           /VERSION/FITIOT###_LIGHTCURVES.TXT
        and the original text files in SPLIT_JOBS are stored
        in a single tarball.


  v10_29f (July 28, 2013)

     - genmag_SALT2.c, function INTEGSALT2_SEDFLUX():
       inside integraton loop return if TRANS < 1.0E-12 so that
       TRANS=0 in leakage regions are skipped.

    - util/split_and_fit.pl
      * works with snana.exe
      * internal re-org/cleanup; FITRES format is treated more
        like the hbook and root formats.

      * new function check_APPEND_FITRES() to make sure that
        7788 or FITRE corresponds to HFILE_OUT or ROOTFILE_OUT.

      * fix aweful bug in DONE_CHECK_LCFIT; loop over all merged 
        outFile types instead of checking only the merged HBOOK 
        files. Affects ROOTFILE_OUT option.

    - sntools_output_hbook.c 
      add pad-space on ptrC before calling trim_blank_spaces().

    - psnid updates from Dillon:
         psnid_BEST.c, psnid.car, psnid_tools.c[h]

  v10_29g (Aug 8, 2013)

    sndata.h: MXVERLEN -> 72 (was 60) to match MXCHAR_VER in snana.car

    snana.car: 
    * add MJDMIN/MJDMAX to snana table.
    * fix INIT_SURVEY to read list of SURVEY_FIELDS from SURVEY.DEF
      so that SNLC_FIELD_forC can be sorted base on order in SURVEY.DEF.
      e.g., E1+E2 or E2+E1 overlap always get written as E1+E2 overlap.

    snlc_sim.c: 
     * fix bug computing limiting mag in SIMLIB_maglimit().
       Affects M5SIG column in SIMLIB_DUMP option.

     * SIMLIB_DUMP is now a bit mask;
       bits 0,1 -> one line dump per LIBID,MJD
       SIMLIB_DUMP = 0 is no longer valid -> ABORT 

  v10_29h (Aug 19, 2013)

   - remove header-cut on redshift and zERR so that the
     cut-bookkeeping is correct. Also add ITYPE=-1 to summary
     that includes cut-stats for all types combined.

   - add NEPOCH to SNANA table (NTID=7100)

   - backup_INTERNAL.pl: use EXCLUDE_FILE just like backup_SNDATA_ROOT
      to leave out large test-dirs.


  v10_29i (Aug 20 2013)
   - snana.car:
     in PARSE_ZEXTRA fix dumb bug remove header-cut on Z and ZERR
     so that it works for +BOSS sample.


  v10_29j (Aug 22, 2013)
    - add MODEL_S11DM15 into simulation;
      See new codes src/genmag_S11DM15.c[h]
      Generates Ia model used by psnid, particularly the SDSS DR.

   - util/mkfitplots.pl: major overhaul to work with hbook or root.
     See new files 
       util/mkfitplots_hbook.pl
       util/mkfitplots_root.c  (root-script written by E.Kovacs)
         (warning: won't work with root until next update by Eve)

   - psnid_BEST.c: fix plotting bugs ... does not affect results or
       [RK]         FITRET-text files.


  v10_29k (Aug 25, 2013)
    - mkfitplots.pl now works with root !  
      But DISPLAYTEXT strings don't appear yet.

    - more work on genmag_S11DM15.c[h] ... 
      peakmags match Jennifer's SIMSED.S11DM15 model.

    - genmag_SALT2.c: move a few utilities into genmag_SEDtools.c
       to share with S11DM15 model.

    - psnid.car: read PRIVATE_TEMPLATES_PATH in override.


  v10_29l (Sep 1, 2013)

   - mkfitplots.pl
     * allow 1 or 2 dashes for each key
     * lots of internal cleanup
     * new MAG option does same as '-fluxscale -1'

   - sntools.c[h]: major overhaul of fitres* functions.

   - combine_fitres.c:
     major overhaul to work with string-variables such as FIELD.

   - SALT2mu.c: fix to work with new fitresXXX utilities. 
                Also fix printf bug that showed up with valgrind.

   - snana.car
     New &SNLCINP namelist array SNCCID_PLOT = list of CIDs (strings)
     to plot. This is OR-ed with MXLC_PLOT. See new logical function
     DOPLOT_SNLC().

     H0_DEFAULT -> 70  (was 65??)

   - sntools_grid.c[h]:
     for NONIA, write and read  WGT, MAGOFF and MAGSMEAR for each
     NONIA index. Can be used in psnid to apply relative weights,
     and to assign error = MAGSMEAR.

   - psnid_tools.c:
     Minor change to print WGT and MAGSMEAR for each CC template.

   - psnid_BEST.c - RK : fix aweful init bugs:

     in psnid_best_set_zprior_onez(..) add
	  for (i=0; i<PSNID_NZPRIOR; i++) 
            { PSNID_BEST_RESULTS.ZPRIOR_DO[i] = 0 ; } 
     at the beginning, otherwise the CUTWIN_ZERR cut results in 
     undefined ZPRIOR_DO with crazy value.

     Also, in PSNID_BEST_DOFIT(... ) must check ZPRIOR_DO:
      psnid_best_set_zprior_onez(REDSHIFT, REDSHIFT_ERR);  
      if ( PSNID_BEST_RESULTS.ZPRIOR_DO[0] == 0 ) { return ERRFLAG ; } // NEW

  v10_29m (Sep 8, 2013)

    - snana.car :  new header key  FLUXCAL_OFF to correct for
         SN light in the template.

    - snlc_sim.c: in README output file, include Current dir
        to help find privately-used files.

   - doc/snana_manual : new Sec 8.2,8.3 on redshift,rate priors for psnid.
 
   - psnid changes by RK
     * new wrapper "psnid_best_modelErr" to compute model mag-errors.
       Ensures that plots and fitter use the same errors.

     * add rate-prior option; see namelist OPT_RATEPRIOR.

     * cleanup for speed -> x2 faster 
         pow(X,2.) -> X*X
         replace mag->fluxcal calc with lookup table (see psnid_pogson2fluxcal)
         avoid a few redundant calculation (see tFrac, chisq_z ...)

     * rename nml input PHOTOZW -> WGT_ZPRIOR 

     * in psnid_pogson2fluxcal(), fix fluxcal-err calculation from mage.
        -> fluxcal error is slightly smaller -> chi2 slightly larger.

     * for dLmag() calls, replace hard-wired cosmo params with 
         PSNID_INPUTS[H0,OMAT,OLAM,W0] passed from &SNLCINP.

  v10_29n ( )

    - split_and_fit.pl :
      fix MERGE.LOG and PSNID_SUMMARY.LOG so that the entries
      are in order of version and fitopt. Method is to catenate
      individual summary files in SPLIT_JOBS/MERGELOGS

    - psnid.car:
      New namelist parameter  MODELNAME_MAGERR = 'S13' by default
      to determine magerr model.

    - psnid_BEST.c
      separate model-dependent wrappers for mag-error model;
      psnid_best_modelErr_[S11,S13]

    - kcor.c : fix to allow non-uniform lambda binning for filter trans.

    - snana.car :
      FITERRMAT_PKMJD(NPAR_ANYLC,NPAR_ANYLC,MXFILT_OBS) ->
      FITERRMAT_PKMJD(NPAR_ANYLC,NPAR_ANYLC,MXFILT_ALL)
       [uses absolute filter index, not sparse index]

      Fix dimension-declaration bug in SNLCPLOT(); see VFILTOBS array.

      MXTYPE -> 400 (was 140)

   - sntools.c:
     in CCMextinct(), reduce/remove pow calls to save CPU.
   
      rename CCMextinct -> GALextinct since the color law 
      is not necessarily CCM, but CCM is an option.

     new function  which_GALextinct(opt,string) to return
     string-definition.

   - OPT_MWCOLORLAW options added to 
        kcor.c, snlc_fit.car, snlc_sim.c
      options are:  89(CCM89)  94(ODonnel) , 99(Fitzpatrick)
      Current default is still 94.

   
  - sntools_fitsio.c: read and write SIM_MWCOLORLAW in global header.

  - doc/snana_manual : new sec 5.29 on Galactic reddening options.


  v10_30 (Sep 24, 2013)

     MAJOR UPGRADE TO GALACTIC EXTINCTION (Search 'OPT_MW' in manual)
       * Fitzpatrick 99 color law option
       * can change RV in fitting programs
       * Options now work the same for obs- and rest-frame models,
         and in both the simulation and fitting programs.

     WARNING: include "MWgaldust.h" in any C code calling GALextinct()

   - snlc_fit.car:
     for FITRESTMAG option, call SNLCPAK for each two-band fit.
     PROBLEM: snana#fitres doesn't work if any fit fails.
     
     Old &FITINP namelist variable OPT_XTMW_ERR -> legacy variable
                 (but still accepted)
     New &FITINP namelist variable OPT_COVAR_MWXTERR replaces OPT_XTMW_ERR
     
   - snlc_sim.c: remove obsolete variables
        SNDATA.XTINC_MILKYWAY[ifilt_obs]
        GENLC.XTINC_MILKYWAY[ifilt_obs]
     since MWgaldust returns an array of extinctions only
     for SDSS ugriz. Noticed by Kyle & Ravi.

     genmag_MWXT() -> genmag_MWXT_fromKcor() and remove RV/OPT_MWCOLORLAW
       correction. Intead, pass RV and OPT_MWCOLORLAW to GET_MWXT8.

   - snana.car
      GET_MWXT8: add arguments RV and OPT_MWCOLORLAW and make 
            correction of different than that in the kcor file.

      New &SNLCINP variable RV_MWCOLORLAW to vary RV

   - MWgaldust.c[h] : mv GALextinct and *MW* function here
       and out of sntools.c[h].

   - sntools.c[h]:
     new function  modify_MWEBV_SFD() to apply Shclafly-style 
     corrections. 

   - doc/snana_manual.pdf: See updated sections on Galactic extinction
      (search OPT_MW)

   - simlib_coadd.c: cleanup to link to sntools.o

   - util/SNANA_test.pl: fix to work when test returns blank strings.
        Two blank strings now return FAILURE instead of SUCCESS.


  v10_30b (Oct 10, 2013)

   - util/SALT2mu_fit.pl:
     Fix bug to work with multiple FITOPTs in 'sum' mode.
    
   - util/convertsnana2salt2.pl :
     * New command-line arg -salt2dir
     * works with PRIVATE_DATA_PATH

   - udpates from JLM:
       /project/rkessler/jmosher/snana/src/wfit.c
       /project/rkessler/jmosher/snana/util/SALT2train_pipeline.pl
       /project/rkessler/jmosher/snana/util/SALT2train_biascorr.pl

   - sntools_host.c:
     Slight change to  WGT_select calculatio:
     ranval -> ranval*0.95 to leave a little more room
     to find a host when ranval ~ 1.


  v10_30c (Oct 15, 2013)

   - snana.car
     * call MWEBV_FLUXCAL() inside SNRECON instead of in MAIN.

   - sntools_output_text: fix file-closing bug in SNLCPAK_FILL_TEXT().
      (fixes bug using LDMP_SNFLUX with psnid)

  v10_30d (Oct 22, 2013)

   - util/split_and_fit.pl:
     * Fix to work without hbook or root; just text-fitres output.
     * New NORPOMPT command-line option to NOT check for 
       multiple jobs; needed by SALT2train jobs.

   - util/SALT2train_pipeline.pl: hard-wire NOPROMPT option
        for split_and_fit.pl calls

   - util/sntools.pm; few new functions added by JLM.

   - snana.car:
     New &SNLCINP namelist option VPEC_FILE to read in vpec and 
     its error, and to compute ZHD = ZCMB + VPEC/c_light.
     See new snana-manual section 5.29.

   - sntools.c:
     New utility to read fitres files using auto-store so that
     the user does not have to allocate arrays. See new functions
        fitresAutoStore_init( file, 'comma-separate varName list') ;
        val = getVal_fitresAutoStore(CCID, varName, istat) ;
     This utility is used in snana to find VPEC,VPEC_ERR for
     a given CCID name, without allocating any fortran variables.


  v10_30e (Oct 24, 2013)

    - snana.car 
      * new &SNLCINP namelist variables  FUDGE_MAG_ERROR
        to fudge the data errors. Similar to existin FUDGE_FLUXCAL_ERROR.

    - psnid_BEST.c : 
      Fix bug in PSNID_BEST_GET_FITFUN that gave pathological
      chi2 values in the LDMP_SNFLUX output and in the hbook plots.
      psnid-fitres/ascii dump was not affected.

      Major overhaul to plot residuals in the FITRES ntuple.
      See new function  psnid_best_malloc_resids() and variables within.

      Remove hard-wired cut CHIR = CHI2/Ndof < 2 (replace with CHIR<20)
      to let FITPROB_IA_CUT decide what is accepted.
 
   - psnid_tools.h: new typedef struct RESIDS_PSNID_DOFIT.

  v10_30f (Nov 2 2013)
    - MWgaldust.c/h : move slalib routines to sntools.c/h

    - sntools.c/h: 
      * add slalib routines (from MWgaldust)
      * add Z2CMB function

    - psnid*.c/.car:
      New &PSNIDINP variable  FILTLIST_PEAKMAG_STORE = 'ri'
      to select list of filters for which peak-mags are stored
      for each type. Default is '', or no peak mags.

      If redshift error < 0, print '-> flat' comment after
      z_prior printout to be clear.


  v10_30g (Nov 12, 2013)
    - snlc_sim.c: fix gen_spectype() function to work for FIXMAG option.

    - psnid_BEST.c: some code cleanup in _DOFIT() for readability.

    - util/split_and_fit.pl : few minor fixes to work with SALT2mu option

    - snana.car: new &SNLCINP namelist option SNCID_LIST_FILE to 
         specify list of CIDs in a text file.


  v10_30h (Nov 23, 2013)

    - snlc_sim.c: new magSmear option 
         GENMAG_SMEAR_MODELNAM: G10FUDGE <sigma_coh>  
      To allow for arbitrary sigma_coh values.

    - sntools.c: 
       * test and fix Z2CMB function; all args are degrees
         instead of radians.
       * fix bug in arrayStat(); set return args *AVG and *RMS.


  v10_31 (Nov 30, 2013)

       !!! No more limit of 20,000 SNe with text/ascii files       !!!
       !!! FITS and TEXT format have same limit of MXSNLS=3E6 SNe  !!!

    - remove MXSNLC_FILES [=20,000] and fix TEXT-file option
      so that the the processing limit is the same for FITS and 
      TEXT/ascii format. Initial motivation is that DES data
      files are first generated in ascii format before FITS
      format, and thus will need an arbitrary large limit.
      New parameter MXSNLC_FILTUPD = 20,000 still limits
      the number of SN using filter-updates.

   - snlc_sim.c: call checkval_F when reading simlib values and
        abort on crazy values. 

   - sntools.c: checkval -> checkval_F and add explicit check for nan.
 
   - snlc_fit.car :  fix USESIM_PEAKMJD by subtracting MJDOFF from INIVAL.

  v10_31b (Dec 4 2013)
    - snlc_sim.c: fix rewind bug for simlib in SIMLIB_read().
       This bug causes abort because of the checkval_F calls
       added last version.

      fix sim_input_override() to work with multiple 'DNDZ POWERLAW2 ... '


    - snana.car:
      When reading kcor/fits file without redshift range,
      protect ZRANGE_KCOR from being set to 0,0.

      New &SNLCINP variables USESIM_SNIA and USESIM_SNCC

   - snlc_fit.car:
     New &FITINP nml variable ISCALE_COURSEBIN_PHOTOZ to scale
     the number of bins for the chi2 minimization that determines
     initial photoz values. Also print course-grid info to screen.

     for SALT2, INIBND cmax -> 1 (instead of 2);
     hence slight changes in photo-z results due to 
     the course-grid minimiziation.


  v10_31c (Dec 8, 2013)

    - snana.car: 
      * remove obsolete function PROB_SIMFIT and SIMFIT_XXX variables.

    - snlc_fit.car
      * inside FITINI_PHOTOZ, compute SIMCHI2_CHEAT on last iteration
        using exact SIM parameters.  For LSIM=T, load new variable
        'SIMCHI2' in the fitres tree/ntuple.

    - sim_SNmix.pl: small fix creating SIMJOB_SUMMARY.LOG file.

    - sntools_fitso.c: fix bug writing PRIVATE header keys in 
            wr_snfitsio_create(); write PRIVATE keys before
            checking SIMFLAG.

    - util/snmake.pl: add MWgaldust.o to object list


  v10_32 (Dec 29, 2013)

          !!! SIMULATION INCLUDES PECULIAR VELOCITIES !!!
          !!! SIMULATION COMPUTES ZHELIO and ZCMB     !!!

          !!! New manual section
          !!! 4.23 Generating Redshifts: zhel and zcmb

    - snana.car : 
      * new &SNLCINP variable SNTYPE_IGNORE
      * define parameter MXCHAR_PARNAME=20 for consistent usage.
        Fix bug where PARNAME_STORE(IPAR_SHAPE) = ''

    - snlc_sim.c
      compute HELIO and CMB redshifts separately, and report
      both in data files just like for real data. Also add
      new input keyword "GENSIGMA_VPEC" to select a peculiar
      velocity distribution. See new function gen_redshift_helio(...)
      to translate zcmb and vpec into zhelio.

      Fix override so that 'DNDZ HUBBLE' works on command-line override.

   - combine_fitres.c: fix bug setting LEN_APPROX when 2nd file
          is much smaller than 1st file.

  v10_32b ( )
    - sntools.c : fix numerical issue with linear relation in quadInterp().

    - psnid_BEST.c : 
       add new output variables TOBSMIN_[Ia,II,Ibc] and TOBSMAX_[Ia,II,Ibc]
       computed in psnid_best_check_lc_quality(). These new variables
       appear in the output ntuple/tree and fitres/text file.
       Note that LCQ is computed even when mjd[i]=0 and epoch ~ -50000 
       ... I asked Masao to check for bug.

  v10_32c (Jan 11, 2014)
    - snana.car : in subroutine COUNTFIELDS, if FIELD is blank then
       set it to 'NULL' to avoid blank elements in tables.

    - sntools.c: new function remove_string_termination(string,LENTOT)

    - combine_fitres.c:
        for HBOOK option, call remove_string_termination(string,LENTOT)
        to use fortran-like padding instead of \0.

    - snlc_sim.c :
      fix ZVARIATION option to work with SIMSED parameters.

  v10_32d (Jan 24, 2014)

    - fix convertsalt2snana.pl (Rahul), but still a bug dumping
      garbage epochs at the end.

    - snlc_sim.c 
      push trigger code into separate files,
           sntools_trigger.c[h]
      so that trigger logic (pipeline & spec) can be used 
      in other programs.

      Also change lots of float -> double.

      After 100-200 generated SN the random sync changes,
      likely because of some of the float->double updates.

      Remove  IFILTOBS_fromMAP function.
      Replace IFILTOBS_fromMAP calls with existing INTFILTER().
 
      For genSmear, generate flat [0-1] randoms in addition to
      Gaussian randos. Flat randoms needed for new VCR model.

      Minor fixes for option to write rest-frame info using 'FORMAT_MASK: 6'
      See append_SNDATA_MODEL().
 
      For TERSE FORMAT_MASK=2 and rest-frame model,  write 
      FLT_REST and SIM_MAGREST as additional terse-format variables.  
      These variables are NOT written to FITS-formatted output 
      (FORMAT_MASK=32) ... maybe later ?

    - sntools.c :

      * New utility 'fitresVar_ABORT()'; see usage in SALT2mu.c

    - sntools_genSmear.c[h]: new Velocity-Color-Relation [VCR]
            model based on Foley input.  see _VCR functions and variables.

    - genmag_SALT2.c:  fix sign error applying magSmear. Only matters
         for new VCR model that has asymmetric B-V smearing distribution.

    - sntools_output_text.c: 
      For rest-frame models write new columns for rest-frame filter and flux.

    - snlc_fit.car: 
       * pass rest-frame info to SNLCPAK_DATA function.
       * add SIM_MAGREST and SIM_FLUXLCAL_REST to SNTABLE function.
          -> more epoch variables in ntuple/tree.

       * FITRESTMAG option with SALT2 model now computes k-corrected 
         MAGREST and FLUXREST for each epoch. See new routine SALT2_FLUXREST.
         Analogous to rest-mag/flux using mlcs2k2 or snoopy.
         Output OK for LDMP_SNLFUX option, but problem with ntuple
         because IFILTREST1[2] are not filled ; see next snana version.

    - snana.car:
      Update GET_FILTTRANS to accept a mask indicating OBS and/or REST
      frame filters. Needed by new VCR model that requires B & V filters,
      so this update allows B & V to be defined as rest-frame [MLCS]
      filters as well as obs-frame filters.  See MASKFRAME args.

      Read new/optional terse-format variables FLT_REST and SIM_MAGREST.


  v10_32e (Feb 1, 2014)

    - snlc_fit.car 
      serious internal surgery to cleanup mess with EP_XXX arrays.
      See new arrays R4EP_ALL, R4EP_FIT, I4EP_ALL, I4EP_FIT.
      This change has no effect on fitting; it's just a long
      overdue cleanup.

      There is one discrepancy with SNANA_tester.pl: 
         ZPHOT_SDSSa_SALT2_SNnoHOST_5PAR:  mis-match (OLD != NEW) 
         ==> OLD: ZPHOT-1032 = 0.89907E-01 +/- 0.2127E-01(M)     
         ==> NEW: ZPHOT-1032 = 0.98901E-01 +/- 0.1892E-01(M)     
       so there is a .01 photo-z change here, half the size of the error.
       For further photo-z testing I ran photo-z fits on LSST sims
       with four different intrinsic scatter models. With ~4000 passing
       cuts the photoz-outlier fractions (|dz|/(1+z) > 0.1) are
       identical for both v10_32d and v10_32e:
           NONE  .012
           COH   .011
           G10   .013
           C11   .015

       To get SIMCHI2_CHEAT call FCNSNLC from FITPAR_ANA (last iteration)
       instead of from FITPAR_INI. 
      

     - convertsalt2snana.pl: more fixes from Rahul.

     - snlc_sim/c/sntools_host.c[h]:
       new hostlib option, HOSTLIB_MSKOPT += 64, to return
       SN parameters (c,x1,dm15, etc ...) from hostlib. 
       See snlc_sim function SNPARVAL_from_SNHOST().
       Sim uses whatever SN paramers are defined in the hostlib;
       if option is set and no SN params are in the hostlib,
       program aborts.  Code is written for this version,
       but not tested since we don't have a HOSTLIB with
       SN parameters.

     - snlc_sim.c:
       Abort on undefined filters following CUTWIN_SNRMAX key.

       Define and increment NGEN_ALLSKIP ; abort in simEnd() if
       every observation was skipped because of invalid passbands.
       
     - sntools_fitsio.c :
       Fix bug writig HOST mags in FITS-formatted output

     - snana.car:
       For processing simulations, subroutine PARSE_SNDATA aborts 
       if SIM_REDSHIFT_HELIO=0 ; to catch analyzing older sims 
       (before ZCMB was added) with undefined sim-redshifts.

  v10_32f (Feb 1, 2014)
    - sntools_output_root.c
      forgot to change  SNLCPAK_EPFLAG_DATA to
      SNLCPAK_EPFLAG_FLUXDATA -> cannot compile with root.
      Quick fix here.

  v10_32g (Feb 2, 2014)
   - snlc_fit.car:
     new routine GET_SIMCHI2_CHEAT to make sure that all 
     obs-filters are defined in the rest-frame by the fitting model.
     If not, set SIMCHI2_CHEAT  -NFILT_UNDEFINED and skip
     SIMCHI2_CHEAT calculation to avoid abort. 
     !!!  Fixes rare-but-annoying aborts with photo-z fits !!!
     Can also search for SIMCHI2 in manual.

   - snana.car
     for SNCID_LIST_FILE, allow comma-separated CIDs as well
     as space-separated (and update manual).

   - Makefile: fix psnid depencies to allow
          make clean ; make ../bin/psnid.exe


  v10_33 (Feb 5, 2014)

      !!! Fix SALT2 Photo-z Fitting bug in snlc_fit.exe !!!!

     Bug affected SALT2 photo-z fits (data or sim) that have NO 
     redshift infomation; i.e., REDSHIFT_FINAL = -9 +- -9.  
     A valid REDSHIFT_FINAL was not used to inform the photo-z fit, 
     but it was preventing the implemenation of the bug.
     For simulations, setting 'GENSIGMA_REDSHIFT: 1' (or >=1) is a
     flag to write REDSHIFT_FINAL = -9  ---> undefined.

     Detailed explanation (if anyone really wants to know):
     During the initialization of initial parameters, a course-grid 
     search is performed to get close to the global minimum. To set
     parameter bounds for the chi2, REDSHIFT_FINAL is converted into 
     x0, and the x0-range is defined to be x0/100 to x0*100. When x0 is
     outside this range, chi2-> 1E9 to reject these out-of-bound values.
     For any reasonable REDSHIFT_FINAL, the x0 range is adequate, but 
     not informative in the fit. However, if REDSHIFT_FINAL is undefined 
     then x0 was arbitrarily converted from MU=35.5, and the 
     corresponding x0 range (x0/100 to x0*100) is not wide enough for 
     high redshifts. Thus the course-grid search was forbidding 
     higher redshifts. When all of the grid-search chi2=1E9,
     the fitting program was simply setting the initial photo-z to
     the middle of the user photo-z range defined by &FITINP namelist 
     variable PHOTOZ_BOUND. For most of the fits with bad initial 
     parameters the fit will still work OK; but about 10-20% of the
     fits will fail to find the global minimum, resulting in a noticably
     large fraction of photo-z outliers.
     
     The fix is very simple. For photo-z fits the x0 range is explicitly
     set to 1.0E-15 to 1E4 and is not based on REDSHIFT_FINAL: 
     INIBND(1:2,IPAR_X0) -> 1.0E-15,1E4 .

     To check that REDSHIFT_FINAL was not used to cheat, I tested the
     before/after snlc_fit.exe on four independent LSST simulations 
     that have valid REDSHIFT_FINAL values. Defining the outlier fraction 
     as those with |dz/(1+ztrue)| > 0.1, the outlier fractions are ~1.5%.
     These fractions are consistent (before/after) to within 0.1%.
     The before-fix code (that used REDSHIFT_FINAL for x0 range) gives
     outlier fractions that are 0.1% lower in two cases and 0.1% higher 
     in two cases. These difference are likely some kind of subtle 
     statistical variation, and clearly show that REDSHIFT_FINAL was 
     not informing the fit.

   - snlc_sim.c[h]: DNDZ_ZPOLY_REWGT now has cubic (z**3) term.

   - udpate new manual section 12.1 to explain how to define
     hbook and root files.

  v10_33b (Feb 7, 2014)
    - sntools.c[h]: new utility polyEval() to compute
      polynomial function

      fitresVar_init() now accepts list of variable names
      and will check each one. ABorts if more than 1 are found.
      SALT2mu.c uses this feature to check for "z Z zSPEC".

    - snlc_sim.c: new input option 
            DNDZ:  ZPOLY  <a0> <a1> <a2> <a3>
      to specify cubic polynomial for redshift distribution 
      (not a re-weight).

      Cleanup printout of dN/dz to be after RATE MODEL is printed.

      For ASCII output, the legacy SEARCH_PEAKMJD key is replaced
      with PEAKMJD.

    - snana.car:
      Fix bug setting SNLC_TOBSMIN/MAX when there is no redshift info.
      

  v10_33c (Feb 10, 2014)

     - snlc_fit.car
       Fix LVBOSE bug in FITANA_CUTS that was putting failed fits
       in the output after 500 fits (per job).  There was no problem
       if cuts are applied to the ntuple/fitres variables; the 
       problem is if you relied on the snlc_fit.exe cuts.

       in FITANA_CUTS(), skip  FITWIN_TREST cut for photo-z to
       allow for more slop in PKMJD. This is a very old feature
       written before the photo-z option was written.

    - split_and_fit.pl
      in sub append_FITRES_text, return if .his or .root file does
      not exist, and also leave message in MERGE2.LOG.      

    - sntools_output_hbook.c :
      update get_cwnt_ivar() function to make case-insensitive 
      comparisons; affects sntable_dump program/script and
      the split_and_fit key APPEND_FITRES can be followed by
      variable names without worrying about upper/lower case.
      
    - snanac.car:
      New routine ABORT_ON_CUTWIN_TREST() called by snlc_fit.exe
      in PHOTO-z mode; abort if any CUTWIN_TREST* cuts are made.
      Avoids making redshift-dependent cut before fitted photo-z
      is known. Note that TRESTMIN, TRESTMAX, etc are determined
      after the fit and stored in the SNTABLE.
      Need to add this call in psnid.car after Masao sends his
      updates.

    - SALT2mu.c : fix subtle z-bin counting in setup_zbins().
      Fix to include events where z lies exactly on a bin boundary.
      Note that the SNANA_tester script shows very slight
      SALT2mu differences because the z-boundary events are
      now included in the fit.

  v10_33d (Feb 13, 2014)

     - !!! New HOSTLIB_STOREVAR key passes arbitrary list of 
           HOSTLIB variables into data files and SNTABLE(s).

     - sntools_fitsio.c[h], sntools_host.c[h]
       Write and read host LOGMASS.

       Add SNFITSIO_CODE_IVERSION into headers to allow
       for back-compatibility.
     
     - snana.car: 
       * read LOGMASS[_ERR]

     - snlc_sim.c : for NONIA, GENMAG_SMEAR_MODENAME -> ""
         so that SNIa scatter model can change in sim_SNmix
         script without changing the CC model.


  v10_33e (Feb 13, 2014)
    - snlc_sim.c[h]:  GENRANGE_REDSHIFT[SIGMA] are now double
          instead of float.

    - sntools_host.c :
        Fix redshift safety binning to be less fragile.

  v10_33f (Feb 16, 2014 )
    - snlc_sim.c[h], sntools_host.c[h]
      Allow defining SNMAGSHIFT as one of the HOSTLIB VARNAMES
      --> alternative to WGTMAP for applying SN magshift based
          on host properties.  See GENLC.SNMAGSHIFT_HOSTCOR.

      For NONIA, add new variable SIM_MAGSMEAR_COH  to the 
      data file and SNTABLEs. [requested by STK]

    - sntools_host.c:
      Print list of valid SNPAR variables for subset found,
      and separately for subset NOT found.

  v10_33g (Feb 25 ,2014)
    - psnid bug-fix from Masao ... for new outlier rejection option.

    - snlc_sim.c, sntools_genSmear.c[h]: 
      add sim-input option  "GENMAG_SMEAR_MODELNAME: COH"
      Allows specifying SNIa-COH  option for SNIa without
      affecting the NONIA sim.

    - new SIMGEN_DUMP variable MAGSMEAR_COH
 
    - define LOGMASS_ERR in set_SNDATA() in sntools.c

  v10_33h (Feb 28, 2014)

    - snlc_sim.c[h]: new function doReject_SIMGEN_DUMP().

    - new option SIMGEN_DUMPALL: to dump every SN regardless
      of whether it was rejected.

    - snlc_sim.c[h]:  new SIMLIB keys
        TEMPLATE_SKYSIG: <list value for each filter>  ! ADU/pix
        TEMPLATE_CCDSIG: <list value for each filter>  ! e-/pix
      to simulate coherent template noise.
      The template noise units must be the same as for the
      search image.  The above keys can appear once before the
      first LIBID, or it can appear in the header of each LIBID.

      Finally, the random sync has changed because a new set
      of filter-dependent randoms are generated. SNANA_tester 
      was verified with the new randoms commented out.

      Initial use is for a JPAS-related paper, and early DES science
      with not-so-deep templates.

  v10_33i (Mar 3 2014)

         !!! Reported sim-error in data file based    !!!
         !!! on observed flux instead of true flux.   !!!

         !!! Correlated template noise option in sim  !!!

    - sndata.h: remove obsolete variables
        SNDATA.TEMPLATE_RUN
        SNDATA.SEARCH_RUN
        SNDATA.QMASK
        SNDATA.zpt*_trun

    - snlc_sim.c[h]: lots of cleanup with SIMLIB arrays and in
          SIMLIB_read, gen_smearFlux.
       Search and Template info are now treated more-or-less the same.

       Add new simlib key  "TEMPLATE_ZPT: <list>" which should have
       been in the previous version wtih TEMPLATE_SKYSIG and 
       TEMPLATE_CCDSIG.  TEMPLATE_ZPT is used in gen_smearFlux to 
       normalize the template noise to each search image.

       in gen_smearFlux(), reported error is based on observed
       flux instead of exact flux --> SNANA_tester shows very 
       slight differences for SIMFIT jobs.

       SNRMAX for cutwin now uses errstat instead of errtot since
       errstat is written to data files. Errtot includes ZPTERR
       contribution and is used to compute the actual fluctuation.

       sim-input  SMEARFLAG_ZEROPT=2 --> report total error with
       ZPT*F. SMEARFLAG_ZEROPT=1 --> report error with ZPTSIG as before.

    - snana_manua.pdf : see sec 4.8 for Template noise.

    - Makefile: add a few missing dependencies related to sndata.h.

  v10_33j (Mar 7 2014 )
    - psnid_BEST.c : 
      * major bug-fix in MCMC option using z-prior.
      * new S14 model-error option; need to fix notation since S13
          refers to data-release ??

  v10_33k (Mar 18, 2014)

        !!! Major overhaul on simulating redshift dependence !!!
        !!! Works on SIMSED and on any population parameter  !!!
        !!! Added GENSKEW_XXX population parameter; see manual !!!
        !!! Add new VCR model for intrinsic scatter           !!!

    - sntools_genSmear.c[h] : work on VCR model.

    - snlc_sim.c: 
      * fix bug with sqerr_ran in gen_smearFlux; 
        don't include negative fluxObs in computation.
        --> in SNANA_tester restults, three values change
            by a tiny amount; the 4th digit in the error.


      * fix bug related to SNTYPES_Ia key so that user can specify
        PHOTID type rather than being forced to have photid type
        = specid type + 100.

      * fix bug setting SNDATA.HOSTGAL_OBJID when hostlib is not used;
        needed to set HOSTLIB_GALID_NULL for FIXMAG option.
   
      * new sim-input key  ZVARIATION_POLY:  VARNAME  a0 a1 a2 a3
        ZVARIATION_FILE still works.
   
      * PREP_SIMGEN_DUMP: fix bug to avoid naming conflicts with SIMSED model

    - util/SNANA_test.pl : include 3-digit index in master/summary file.

    - SIMSED_fudge.c :
      * Fix hard-wired path to Bessell filters
          [following re-organization of SNDATA_ROOT]

      * add VCR model and include VSI in SED.INFO. Also write
        3-dimensional SIMSED model (S2c, S2x1, VSI).
            [VSI is 100% correlated with FLATRAN1]

    - snana.car: load SNHOST_SB vs. filter into SNTABLE

    - sntools.c : 
       * fluxcal_SNDATA, remove requirement of asinh mag < 28.
       * put back read/write for SEARCH_RUN, TEMPALTE_RUN, QMASK
            [needed to make SDSS files]

       * remove obsolete BIGAUSSRAN function

       * new functions skewGaussRan(...) and skewGauss(...) to process
         new GENSKEW_XXX parameters.

    - sndata.h: put back SNDATA.SEARCH_RUN,TEMPALTE_RUN,QMASK


  v10_33l (Mar 22, 2014)

    - update SALT2train_biascorr.pl  from JLM.

    - snlc_sim.c, sntools_genSmear.c:
      New GENMAG_SMEARPAR_OVERRIDE option to override genSmear 
      params from sim-input file or from command line.
 
    - SIMSED_fudge.c :
      New input key "SALT2_VERSION_INPUT: <version>" to 
      translate SALT2 model into SIMSED model with c and x1 bins.
      No longer need paw macro simsed.kumac to make intermediate
      x1-only SIMSED.

  v10_33m (Mar 22, 2014)
    - repeat, since I forgot to 'cvs ci' for v10_33l.

  v10_33n (Apr 2 2014)
     - snlc_sim.c :
      * bug-fix in init_zvariation by JLM

     - snlc_fit.car: 
       * PARSE_HEAD: fix dumb bug applying MWEBV_SCALE to SNLC_MWEBV_ERR.

       * FITRESTMAG_CALC: fix error to use x0err/x0 instead of error
         based on fitted color.  With OPT_COVAR=0 and FUDGE_MAGERR_MODEL=0,
         the fitRestMag errors are within about a factor of 2 of the
         actual RMS.

    - snana.car
      new &SNLCINP variable SNRMAX_FILTERS = 'gri' to select which
      filter-subset to use for SNRMAX cuts. Default is to use all filters.
    
  v10_33o (Apr 6, 2014 )
    - psnid_BEST.c : bug-fixes by Masao
    - finish nearnbr_maxFoM.c

  v10_34 (April 10, 2014)

        !!! Nearest Neighbor working with snlc_fit.exe !!!
        !!! and new program nearnbr_maxFoM.exe         !!!

    - manaul section 8 (Classification) has separate sub-sections
      for PSNID and for Nearest Neighbor.

    - sntools_output_root.c
      Fix bug to allow root histogram to update for each SN.
      But is NOT protected against duplicates in same subdir.

      Write code for empty (placeholder) SNHIST_RDBINS_ROOT and
      SNHIST_RDCONT_ROOT functions so that we can read back 
      1D and 2D histograms inside a root file.

    - fix OPEN_ROOTFILE to have COPT argument (like OPEN_HFILE)
      to specifiy READ or RECREATE open-option. 

    - sntools_nearnbr.c[h] and nearnbr_maxFoM.c : Lots of updates.

    - snana.car: add new variable
          SNLC_SNRSUM(ifilt)= sum Flux / sqrt(sum Fluxerr^2)
      to estimate light curve quality without fitting.
      See SNRSUM_[band] variables in snana ntuple/tree.


  v10_34b (Apr 21, 2014)

       !!! CAN FINALLY USE SNANA WITHOUT CERNLIB and WITHOUT ROOT     !!!
       !!! ypatchy and fcasplit are part of snana; don't need CERNLIB !!!

    - sntools_genSmear.c: fix bug in init_genSmear_USRFUN()
        setting LAMDIF. Preivously NRANGauss was under-estimated.

   - sntools_nearnbr.c : book untrained efficiency
   - nearnbr_maxFoM.c : read/print untrained effic.

   - snlc_sim.c[h]: new function readme_doc_GENPERECT().

   - install CERNLIB's fcasplit 
        $SNANA_DIR/src/fcasplit.F  (from D.Cinabro)
        $SNANA_DIR/bin/fcasplit
     and use the local $SNANA_DIR/bin/fcasplit in Makefile 
     instead of CERNLIB's fcasplit. A 'ypatchy' replacement 
     is the last thing needed to get rid of CERNLIB.

   - new script util/ypatchy.pl to replace cernlib's ypatchy program.
     It is used in  src/Makefile.

   - remove obsolete scripts:
       ntappend2fitres.pl  ntdump.pl  ntprint.pl
       kcor_gen_non1a.cmd

   - ../util/snmake.pl: ypatchy -> ypatchy.pl

   - fix  snana_private.cra  and snlc_fit_private.cra 
       [both work with snmake.pl]

   - snana.car :
     Fix broken JOBSPLIT logic for text-format. This bug was 
     introduced in v10_31 (Nov 30 2013) when the 20,000 text-file
     limit was removed. Bug affected split_and_fit jobs that use
     1) ascii/text format and also 2) a batch-queue system. 
     There were no problems using FITS format, or using NODELIST 
     option with either FITS or TEXT format.


  v10_34c (Apr 22, 2014)

    - snlc_sim.c :
      fix memory-overwrite bug in prep_user_input().
        [but found by B. Patel]

    - snana.car:
      in SET_PKMJD, if PKMJD cannot be determined then print it !

    - snana.car: MAIN
      inside +SELF,IF=PSNID, if OPT_SETPKMJD is not set by user,
      then OPT_PKMJD -> -1 so that PKMJD is not determined in SNANA, 
      and is determined only in psnid. Beware that CUTWIN_TRESTxxx cannot
      be used unless PEAKMJD is in the data file, or if OPT_SETPKMJD>0.


  v10_34d (Apr 27, 2014)

    - snlc_fit.car :
      For FITRESTMAG option, fix SNRMAX logic to be applied
      before searching BRACKET filters, instead of after.

    - NEARNBR_ANAL: call new function IPAR_PARNAME_STORE(varname)
      to associate NEARNBR variable name with SNANA-IPAR index.
      Avoids hard-coded list.  Also check for FITRESTMAG filters
      (in addition to z, colorPar, shapePar).

    - sntools_output* :
      add wrappers TABLEFILE_INIT() and TABLEFILE_OPEN(...)
      so that snana codes only call wrappers in sntools_output.c,
      
      In sevaral codes, replace OPEN_HFILE & OPEN_ROOTFILE with 
      TABLEFILE_OPEN(..).
      
      HBOOK & ROOT calls are now made ONLY by sntools_output.c.

    - split_and_fit.pl and combine_fitres.c  and sntable_dump.c :
       Change hbook suffix ".his" -> ".hbook"

    - genmag_SEDtools.h :
         MXFILT_SEDMODEL[20] -> MXFILT_SEDMODEL[MXFILT_SEDMODEL]
      to fix memory overwrite bug. Affected JPAS with 56 filters
      that exceeded old bound of 20.

    - snlc_fit.car, &NNINP and sntools_output*
      NEARNBR_TRAINFILE_LIST can point to .FITRES, .hbook or .root 
      file to read for using snlc_fit.exe for NN_training.
      Works fine with hbook-output, but root-output does not work
      if NEARNBR_TRAINFILE_LIST is also a root file.

      
  v10_34e (Apr 27, 2014)
    - sntools_output.c, sntools_output_root.c :
      Fix a few compilation warnings related to string-handling
  
     Fix a few dumb bugs from v10_34d related to reading
     back histograms.


  v10_34f (April 28, 2014)
    - nearnbr_maxFoM.c :  dumb fix for --truetype option.

    - sntools_output.c: new function TABLENAME_INIT_VERIFY
      called everywhere for safety.

    - for NN analysis/traning:
      + fix NEARNBR_SEPMAX_VARDEF to use a single string
          so that it works with split_and_fit FITOPT
      + if M0_B is requested as SEPMAX var, check that
          FITRESTMAG option is selected !


  v10_34g ( )
    - sntools_output.c :  fix logic resetting NLCPAK using CCID_LAST.

    - sim_SNmix.pl :
      If multiple RANSEEDs are all the same, combine versions
      into one single version.

    - sntools_nearnbr.c : upgrade to speed up training

    - snlc_sim.c : allow PEAKMJD in hostlib.

    - psnid_BEST.c:
      * fix index bug in psnid_best_flag_epochs (see init loop for maxsnr)

    - psnid_tools.c
      Call new function psnid_check_filtlist_fit() to abort if any
      fit-filter is missing from the template filters. 
      e.g., FILTLIST_FIT = 'ugriz' and using DES-grid templates
      will abort since there is no 'u' band in the DES templates.


# ===================================================================
                     v10_35 (May 4 2014)

              ***** IMPORTANT(v10_35) *****

    - SIM-WARNING: Must add SIGMA_INT key to SALT2.INFO files 
              
   - sntools_genSmear.c :
     Update G10 smear-model to work with any SALT2 version.
     Dispersion file and SIGCOH read from SALT2 version. Note
     that 'G10' refers to the SALT2 method and user-selected
     SALT2 version; not necessary the 2010 published model.
     Also note that SIGMA_INT: key is now requred in SALT2.INFO.

                *****  USEFUL(v10_35) *****

   - new user input
         GENMODEL_UNCONFIRMED_WRONGHOST:  <wrong-fractino> <zspread>
     to assign wrong redshifts corresponding to bad SN-host matches.
     See new function setz_unconfirmed_wronghost().

   - snlc_sim.c[h]:
     New sim-input option  USE_SIMLIB_GENOPT -> use all header keys
     to override events. Used to re-simulate FAKE SN with the real
     simlib file.  See new structure SIMLIB_HEADER.

   - doc/snana_manual.pdf :
     Describe sim_SNmix.pl script in Sec 12.3.1.


                *****  MISCELLANEOUS(v10_35) *****

   - sntools.pm: new subs  loadArray_fromFile() and parse_array().
 
   - sim_SNmix.pl : 
     lots of cleanup. No longer require H0 and ZRANGE keys.
     Instead, new sub syncVerify_GENPAR checks that key parameters
     are the same in the Ia and NONIa input files: cosmo params,
     redshift range, peakMJD range, etc ...

     If any sim-job aborts, SUMMARY files gives clear message !

   - sntools_host.c (bug-fix):
     If SN coords are replaced with host coords, call gen_MWEBV()
     to compute extinction. Snlc_sim calls gen_MWEBV only if
     the host coords are NOT replaced.


        v10_35 again (May 4 2014)
             cleanup rubble 
    - sntools.pm   : fix parse_array.
    - snlc_sim.c   : write UNCONFIRMED_WRONGHOST params to README
    - sim_SNmix.pl : abort on duplicate GENVERSION name.

# =================================================================
                     v10_35b (May 6, 2014)

                *****  IMPORTANT(v10_35b) *****

                *****  USEFUL(v10_35b) *****

   - split_and_fit.pl:
      New input flag 'NN_FLAG: 1'  to run nearnbr_maxFoM.exe 
      at end if each fitting job.

                *****  MISCELLANEOUS(v10_35b) *****

    - sntools.c  CLEAN-UP:
      float rangen(float*range) -> double FlatRan(ilist,range)
      snran1(ilist) -> FlatRan1(ilist)

    - snlc_sim, SIMSED_fudge, sntools.c (more cleanup):
      * Replace snran1 -> FlatRan1, rangen -> FlatRan
      * in genz_hubble(), replace last few floats -> double (randoms stuff)
         --> miraculously there is no change in random sync.

   - sntools_fitsio.c :
     Fix subtle bug in RD_SNFITSIO_PARVAL() to reset *iptr on the
     first SN in each file. SIM_MAGSMEAR_COH is now read back
     properly for mixed Ia+CC sims (before, was always zero,
     or worked only for CC-only sims).

   - genmag_SALT2: 
     * add output arg Fratio to INTEGSALT2_SEDFLUX().

     * For error calculation , Fratio = Finteg[1]/Finteg[0]
       without Galactic extinction instead of with Gal-extinct.
       Bug found by R. Biswas.  
       Impact on JLA-cosmology sample is negligible.

   - nearnbr_maxFoM.c :  
      * add VBOSE option (default is minimial screen output)
      * print &NNINP string NEARNBR_SEPMAX_VARDEF = 'xxx' so that
        it can be easily pasted back ito the &NNINP namelist.




# ======================================================================= 
		 v10_35c (May 8 2014) 
                
         ***** IMPORTANT(v10_35c) ***** 

   $SNANA_DIR/doc/README_UPDATES is now broken into 3 categories:
       1. IMPORTANT : must-read
       2. USEFUL    : new features, bug-fixes -> recommended reading
       3. MISC      : under-the-hood updates, small bug-fixes, misc.
                         (not necessary to read)
   
         ***** USEFUL(v10_35c) ***** 

   - SALT2mu.c: fix command-line override to work with CUTWIN.

   - sntools_trigger.c, snlc_sim.c:
     For UNCONFIRMED SN, use new lookup map to get probability-vs-z
     to acquire a host-galaxy redshift. See new key SEARCHEFF_zHOST_FILE
     and discussion in manual. 
     Removed obsolete key UNCONFIRMED_SPECZ_FRACPOLY.
     
         ***** MISCELLANEOUS(v10_35c) ***** 

   - util/startSNANAversion.pl : 
       modified to implement categories in README_UPDATES.

   - more readme_doc cleanup:
     new functions  readme_doc_FUDGES, readme_doc_CUTWIN().


# ======================================================================= 
         v10_35d (May 11, 2014) 

         ***** IMPORTANT(v10_35d) ***** 

         ***** USEFUL(v10_35d) ***** 

   - snlc_fit.car :
     fit-resid table (part of fitres tree/ntuple) includes 
     rejected epochs and REJECT flag; NFIT = NFIT_DATA + NREJECT.

         ***** MISCELLANEOUS(v10_35d) ***** 

   - snlc_sim.c :
     Fix logic reading/parsing  HOSTLIB_MSKOPT.

   - sntools_output* : 
     * rename SNTABLE_LOAD -> SNTABLE_ADDCOL 
     * new function parse_ADDCOL_VARLIST()
     * major overhaul to use struct SNTABLE_ADDCOL_VARDEF
       so that text-format (fitres files) can be included
       later under the same structure as root and hbook.

     * In principle no changes from this refactoring,
       but beware of SNTABLEs and lightcurve plots.

# ======================================================================= 
         v10_35e (  ) 

         ***** IMPORTANT(v10_35e) ***** 

     LAST SNANA VERSION at FNAL compiled on 32-bit mode

         ***** USEFUL(v10_35e) ***** 

         ***** MISCELLANEOUS(v10_35e) ***** 

    - sntools_output* : 
         more refactoring to integrate TEXT option (TEXTFILE_PREFIX).
         Still need to update user-interface in snana.car.
         All snana output still the same as before.

    - SNANA_tester.pl : new 'LCPLOT' option to create hbook/root
         files, then run mkfitsplots to make pdfs.  Only runs on
         current snana version, so no comparison with last version.

# ======================================================================= 
         v10_35f (  ) 

         ***** IMPORTANT(v10_35f) ***** 

         ***** USEFUL(v10_35f) ***** 

         ***** MISCELLANEOUS(v10_35f) ***** 

    SIMLIB_maglimit (in snlc_sim.c) moved to maglimit() in sntools.c

    psnid.cra,Makefile: include snana.car patch instead of linking
       to libsnana.a; links faster for outfile refactoring.

    More refactoring of text output. New method with TEXTFILE_PREFIX
    and SNTABLE_LIST now works in parallel with legacy method using
    FITRES_DMPFILE. Many routines and variables have _LEGACY suffix.
    The refactoring works for snana.exe, snlc_fit.exe, psnid.exe.
    Still need to re-work split_and_fit to use the new system,
    but that's for next version.

    kcor.c: fix bug causing 666 in the SN-mag dump.
            Bug caused no harm other than confusion.

    Makefile: default is m64 instead of m32.

    sntools.c, SALT2mu.c : minor fixes (from S.Rodney) to fix 
                           compilation errors.

# ======================================================================= 
  Tasks for text-file refactoring:
   - modify split_and_fit.pl to use new SNTABLE_LIST input.
   - manual section explaining SNTABLE_LIST string
   - eventually the default is NO text output --> text only on demand.
   - SALT2mu reads text or root or hbook file.
   - wfit reads text or root or hbook file.
# =======================================================================
         v10_35g (Jun 4 2014  ) 

         ***** IMPORTANT(v10_35g) ***** 

         ***** USEFUL(v10_35g) ***** 

         ***** MISCELLANEOUS(v10_35g) ***** 

    snlc_sim.c: fix minor bug to set GENLC.SIMTYPE at generation
         instead of for accepted events. Needed to give correct
         SIMTYPE in simgen-dump file when using option to write
         out all generated events.

    SNANA_tester.pl : fix to work with same node used multiple times.

    FNAL issues: begin move away from sdss machines that are long
          out of warranty. SNDATA_ROOT -> des20.b disk.
          Local 'make' now on 64-bit des10.
          Still need to work on 'make' for des20.
          Still need new server to host snana.

# ======================================================================= 
   v10_36 (  ) 

         ***** IMPORTANT(v10_36) ***** 

   + New URL:  http://das.sdss2.org/ge/sample/sdsssn/SNANA-PUBLIC

   + backup_SNDATA_ROOT.pl: fix to propery backup fits-formatted versions,
        in particular the SDSS_allCandidates data-release version.


         ***** USEFUL(v10_36) ***** 


         ***** MISCELLANEOUS(v10_36) ***** 

      snana.car : Fix bug reading multiple versions in text format
                   [see RDVERSION_TEXT]

   + ups/snana.table :
     Define $SNANA_PUBLIC_LOCAL and $SNANA_PUBLIC_URL

   + backup_SNANA_DIR.pl : scp files to  $SNANA_PUBLIC_URL
 
   + backup_SNDATA_ROOT.pl : scp tarball to  $SNANA_PUBLIC_URL


# ======================================================================= 
         v10_36b (  ) 

         ***** IMPORTANT(v10_36b) ***** 

     +  sntable_dump.pl[exe] now accepts  '--outlier <Nsig1> <Nsig2>'
          and writes out the outlier epochs to an ascii file.
          See updated manual section 12.1.2 .

         ***** USEFUL(v10_36b) ***** 

     + snana.car : new &SNLCINP option ABORT_ON_DUPLCID=F will
         skip duplicate CID rather than abort. NOT recommended
         unless you really know what you are doing.

        new &SNLCINP variable ABORT_ON_NOPKMJD.
        ABORT_ON_NOPKMJD=F is the same as OPT_SETPKMJD=4,
        but hopefully easier to find.

    + snlc_sim.c:  can specify FIELD in list following SIMGEN_DUMP.
         See new SIMGEN_DUMP[index].CVAL

         ***** MISCELLANEOUS(v10_36b) ***** 

     + snlc_fit.car :  in residual tree  NFIT -> NPTFIT to be clear
        that its the number of points and not the number of fits.


# ======================================================================= 
         v10_36c (Aug 5, 2014 ) 

         ***** IMPORTANT(v10_36c) ***** 

    + sntable_dump.pl: outlier option now works with root.
                       And can combine --outlier with --v <extra args>

         ***** USEFUL(v10_36c) ***** 

         ***** MISCELLANEOUS(v10_36c) ***** 

# ======================================================================= 
         v10_36d (Aug 7, 2014) 

         ***** IMPORTANT(v10_36d) ***** 

    + snlc_fit.car: Added SIM_MAGOBS into hbook ntuple or root tree.

    + sntable_dump.pl: new '--outlier_sim option to extra dataFLux-simFLux
                       outliers. Recall that'--outlier' extracts
                        dataFlux-fitFlux outleirs. See manual.

         ***** USEFUL(v10_36d) ***** 


         ***** MISCELLANEOUS(v10_36d) ***** 

    + snlc_fit.car, sntoold_fitsio.c: 
        new DATATYPEs 'SIM_SNANA' and 'SIM_MAGOBS'
        The latter is just like data, but includes SIM_MAGOBS;
        useful for things like fakeSN overlaid onto real images
        that are processed exactly like data.

# ======================================================================= 
         v10_36e (Aug 7, 2014) 

         ***** IMPORTANT(v10_36e) ***** 

         ***** USEFUL(v10_36e) ***** 

  + snana.car, sntools_fitsio.c :
    New snana variables read from data files:
      NXPIX, NYPIX (header)
      XPIX, YPIX, SKYSIG_T  (epoch)

  + snana.car: compute new SNLC_AREAFRAC(ep) using XPIX, YPIX
      and include in the residual ntuple/tree in snlc_fit.car.

  + mkfitplots.pl : new option 'cid <cid>' to make LC plot for this one only.
       The pdf file has the cid as part of the file name.

         ***** MISCELLANEOUS(v10_36e) ***** 

   + lots of comilation fixes based on warnings sent by A.Quick from TAMU.

# ======================================================================= 
         v10_36f (  ) 

         ***** IMPORTANT(v10_36f) ***** 

         ***** USEFUL(v10_36f) ***** 

     sntable_dump.exe: for outlier dump, add FLUXCAL_DATA and then
       add either FLUXCAL_MODEL or FLUXCAL_SIM (for --outlier_sim).

         ***** MISCELLANEOUS(v10_36f) ***** 

     sntools_output.h: define MXCHAR_VARLIST and fix awful bug:
       ADDCOL_VARLIST_LAST[200] -> ADDCOL_VARLIST_LAST[MXCHAR_VARLIST]

     snlc_sim.c: for text-format, replace SIM_MAG key --> SIM_MAGOBS

# ======================================================================= 
         v10_36g (Aug 21, 2014) 

         ***** IMPORTANT(v10_36g) ***** 

   + psnid_BEST.c : fix a few bugs related to plotting;
                    no impact on fits.

         ***** USEFUL(v10_36g) ***** 

   + new sim-input key HOSTNOISE_FILE to specify model for anomalous
     host-subtraction, typically modeled from pre-explosion epochs
     in real difference-images.  Code in separate file
     sntools_imageNoiseModels.c[h] to be used in both the simulation
     and in snana/analysis programs. 

   + allow HOSTMAG_[band] in SIMGEN_DUMP list.

         ***** MISCELLANEOUS(v10_36g) ***** 


# ======================================================================= 
         v10_36h (Aug 27, 2014) 

         ***** IMPORTANT(v10_36h) ***** 

         ***** USEFUL(v10_36h) ***** 

         ***** MISCELLANEOUS(v10_36h) ***** 

    + snlc_sim.c:  
       * move init_RANLIST call so that SIMLIB_IDSTART option works.

       * use calculated SNR_CALC for trigger lookup instead of SNR_MEAS,
         but use SNR_MEAS for SDSS.

       * fix treatment of correlated template noise to work with
         FIELD overlaps.  See SIMLIB_TEMPLATE.NFIELD_OVP.
         Note that extra randoms in genran_obsNoise() changes the
         random sequence.

    + snana.car: fix a few swapped arguments to function calls
         inside INIT_TABLE_SNANAVAR ... was causing abort when
          HOSTMAGs were added to snana table.


# ======================================================================= 
         v10_36i (Sep 3, 2014) 

         ***** IMPORTANT(v10_36i) ***** 

         ***** USEFUL(v10_36i) ***** 

         ***** MISCELLANEOUS(v10_36i) ***** 

    + startSNANAversion.pl : few fixes.

    + fix snana.car and sntools_fitsio.c so that HOSTGAL_MAG
      and HOSTGAL_SB are written to the fits-header file.
      Previously it was controlled by buggy if-logic, but not 
      worth it to make it optional... easier to just write them  
      out.


# ======================================================================= 
         v10_36j (Sep 3 2014) 

         ***** IMPORTANT(v10_36j) ***** 

         ***** USEFUL(v10_36j) ***** 

         ***** MISCELLANEOUS(v10_36j) ***** 

    + snlc_sim.c : fix dumb bug setting HOSTGAL_MAGOBS and HOSTGAL_SB
    + snana.car, sntools_fitsio.c: fix dumb bug for HOSTGAL_SB


# ======================================================================= 
         v10_37 (Sep 9, 2014) 

         ***** IMPORTANT(v10_36k) ***** 

   + finish re-factoring outFile code; see new &SNLCINP variable SNTABLE_LIST.
     Legacy variables should still work, including
       &SNLCINP : LTUP_SNANA, LDMP_SNFLUX
       &FITINP  : LTUP_FITRES, LTUP_RESIDUAL, FITRES_DMPFILE
     Old defaults with old variables are the same as before,
     and default SNTABLE_LIST='DEFAULT' --> '' if any old
     input var is used.  Old input variables are internally 
     converted into new system.

         ***** USEFUL(v10_37) ***** 

   + snana.car, sntools_fitsio.c :
        add new data variable HOSTGAL_SPECZ[_ERR].
     Note that this is redundant with REDSHIFT_FINAL unless the
     SN redshift is more accurate.


         ***** MISCELLANEOUS(v10_37) ***** 

     + snlc_fit.car : FITRES_DMPFILE now works as a legacy option
         via call to SET_LEGACY_SNTABLE_FITRES.
         
       Remove subroutines
            DMP_FITRES, WRHEAD_FITRES, UPD_FITRES

     + in SNANA_TESTS/inputs, modify all .nml files to have
         LTUP_SNANA=F    LTUP_FITRES=F     LTUP_RESIDUAL=F
         SNTABLE_LIST = ''


# ======================================================================= 
         v10_37b (Sep 14, 2014) 

         ***** IMPORTANT(v10_37b) ***** 

         ***** USEFUL(v10_37b) ***** 

   combine_fitres.c :
      command-line options H/R -> upper case extension .HBOOK/.ROOT.
      Command-line options h/r -> lower case extension.
      Default is lower case if no file-spec is given.
      
         ***** MISCELLANEOUS(v10_37b) ***** 

   split_and_fit.pl :
      major overhaul to use SNTABLE_LIST and to remove legacy nml variables
      after substituting the equivalent SNTABLE_LIST string. Therefore
      the legacy variables can still be used, but they are replaced
      internally here.  For text-LC files, the .FITLC extenction has been
      replaced by .LCPLOT (the table name).

      Merged extensions are now UPPER case: HBOOK, ROOT, TEXT,
      since the prefixes are all upper case.

      Fix bug in making optional SALT2mu script; include SNANA_LOGIN_SETUP
      command in first line.

   sntools_output_text.c:
      TEXT-format extension is [tableName].TEXT instead of TEXT.[tableName]
      so that the format is alway the last extension.


# ======================================================================= 
         v10_37c (Sep 30 2014) 

         ***** IMPORTANT(v10_37c) ***** 

         ***** USEFUL(v10_37c) ***** 

         ***** MISCELLANEOUS(v10_37c) ***** 

   split_and_fit.pl : fix a few bugs based on longer batch jobs using root.
        [this changes was added to released v10_37b]

   sntools_output_text.c :
     move all the fitres-read functions here (out of sntools.c[h])

   SALT2mu.c, combine_fitres.c :
     Replace access to SNTOOLS_FITRES struct with call to
     SNTABLE_GET_VARINFO().

   snlc_sim.c:
     Suppress GENMAG_SMEAR command-line override if mag-smear
     has already been set for NONIa ... allows using GENMAG_SMEAR
     for Ia (and not for NONIa) when doing mixed Ia+CC sims.



# ======================================================================= 
         v10_37d (Sep 30, 2014) 

         ***** IMPORTANT(v10_37d) ***** 

         ***** USEFUL(v10_37d) ***** 

         ***** MISCELLANEOUS(v10_37d) ***** 

    sntools_output_text.c:  in previous version, forgot to test
       with root option using c++; so here a few compilier bugs
       are fixed to allow for root.



# ======================================================================= 
         v10_37e (Oct 11 2014) 

         ***** IMPORTANT(v10_37e) ***** 

         ***** USEFUL(v10_37e) ***** 

   New source code files multiseason.c[h] to compute number of
   seasons with transient activity. 

   snana.car: See new MULTISEASON_XXX nml variables, 
      and call to MULTISEASON().

   snana.car : new nml variable MJDRANGE_SETPKMJD to restrict
               PKMJDINI fit (e.g., for multi-season data)

         ***** MISCELLANEOUS(v10_37e) ***** 

   snlc_fit.car: fix rare bug in which DELCHI2 outside FITWIN_TREST
      window is from 1st iteration and not from 2nd iteration.
      Makes no difference unless using FUDGEALL_ITER1_MAXFRAC 
      that inflates errors on 1st iteration.
      See fix in function FCNSNLC.

   snana.car : always write HOSTMASS to output table, even if it's
         not defined in the data file; see INIT_TABLE_SNANAVAR

   psnid*.h[c]  replace MXEPOCH with MXEP_PSNID in all psnid codes.
      Previously MXEP_PSNID was set to 10*MXEPOCH, but not sure why ?
      Now we just have MXEP_PSNID = MXEPOCH.

   snana.car, sndata.h, sntools_output.h :
      MXEPOCH -> 1000 (was 600) in anticipation of more epochs 
      with multi-season data. Below are the program sizes before
      and after the MXEPOCH change (using hbook, not root):

                    program size (MB) for
      Program        v10_37d     v10_37e
        snana         193 MB ->   195  (+2)
        snlc_fit      357         370  (+13)
        psnid         143         155  (+12)
        snlc_sim      310         314  (+4)


# ======================================================================= 
         v10_37f (Oct 17, 2014) 

         ***** IMPORTANT(v10_37f) ***** 

         ***** USEFUL(v10_37f) ***** 

         ***** MISCELLANEOUS(v10_37f) ***** 

   sntools_output_text.c : 
     add new utility function   NEVT=SNTABLE_NEVT_TEXT(fileName);

   sim_SNmix.pl : fix dumb bug parsing GENMODEL key in NONIa-input file.

   combine_fitres.c : fix bug with extra call to SNTABLE_GET_VARINFO().

   sntools_output* : add SNTABLE_READ* functions to prepare for re-factor.
             These new functions are not yet used.


  problem to fix: FLUXCAL_SIM exists in real-data ntuple ??

# ======================================================================= 
         v10_37g (Oct 22, 2014) 

         ***** IMPORTANT(v10_37g) ***** 

         ***** USEFUL(v10_37g) ***** 

   snana.car:
      OPT_SETPKMJD += 16  --> save FITPKMJD params in SNANA table.

         ***** MISCELLANEOUS(v10_37g) ***** 

   genmag_SEDtools.c :  return flux=0 when Trest is outside SIMSED range.
              Fixes crazy-interpolated fluxes from models that have 
              very short lifetime.


# ======================================================================= 
         v10_37h (Oct 23 2014) 

         ***** IMPORTANT(v10_37h) ***** 

         ***** USEFUL(v10_37h) ***** 

         ***** MISCELLANEOUS(v10_37h) ***** 

   sntools_output.c[h]: new function STORE_TABLEFILE_COMMENT
     to store global comments. So far only the TEXT format
     writes out these comments at the top of the file;
     HBOOK and ROOT ignore these comments.
     Needed to write snana version and photometry version.


# ======================================================================= 
         v10_38 (Nov 2, 2014) 

         ***** IMPORTANT(v10_38) ***** 
   
   First of all, don't panic yet ! Current namelist files still
   work without making any changes. However, you should slowly
   migrate to defining table-outputs (including ascii) with the 
   new &SNLCINP variable SNTABLE_LIST (Sec 12.1 of snana manual).
   If you notice any problems, please contact the developer ASAP.

   For table-output defaults, all legacy options are now turned off
   (e.g., LTUP_SNANA=F, LTUP_FITRES=F) and the new default is
        SNTABLE_LIST = 'SNANA FITRES LCPLOT'
   which will replicate the previous legacy defaults within the
   new system. Legacy variables still work if explicitly defined 
   in a namelist and if SNTABLE_LIST is not specified in the namelist.   
   This change affects snana.exe, snlc_fit.exe, psnid.exe .
         !!! READ SEC 12.1 OF SNANA MANUAL !!!
   
   Both ROOT and HBOOK are included in the default snana release
   (previously only HBOOK was included). To remove ROOT or HBOOK 
   dependence, see snana-manual Sec 12.1 or see install-guide Sec 2.

   WHY: the table-output refactoring is designed to define & read 
    all table formats (TEXT,ROOT,HBOOK) in a uniform manner. In
    particular, after creating an output table in any format, 
    secondary programs (e.g., SALT2mu, wfit) will be able to read 
    tables in any format without format-specific commands in the code.

         ***** USEFUL(v10_38) ***** 

   sntools.c, snlc_sim.c:  if  $SNSED_NON1A exists then use it to point
      to the NON1A seds ... no longer use NON1A_ROOT that includes a kcor
      subdir since the _non1a model is no longer supported.

   genmag_NON1ASED.c : if DAY-range > 0 then shift DAY array so that
        DAY=0 at peak --> properly fills MAGT0_[band] in SIMGEN_DUMP.


         ***** MISCELLANEOUS(v10_38) ***** 

    + refactor table-reading in sntools_output_hbook.c
    + refactor table-reading in sntools_output_root.c
    + remove legacy fitres* calls in sntools_output_text.c
    + refactor table-reading in sntools_nearnbr.c and nearnbr_maxFoM.c
    + for NN method, and add DES test to SNANA_TESTER
    + replace fitresVar* calls in combine_fitres.c
    + replace fitresVar* calls in SALT2mu
    + restore fitresAutoStore feature (for NN) as 
        SNTABLE_AUTOSTORE_INIT[READ] functions.

    Minor problem/bug: when using both root and hbook, the char(0) 
    added to strings (because of root option) causes lots of extra
    blank-padding in the hbook ntuple; therefore selections like 
    "cut 1 field='X3'  " won't work when the associated root 
    file is create from the same job.
   

# ======================================================================= 
         v10_38b (Nov 11, 2014) 

         ***** IMPORTANT(v10_38b) ***** 

         ***** USEFUL(v10_38b) ***** 

     snana.car :
       New &SNLCINP variable PRIVATE_CUTWIN_STRING to define cuts
        on private variables.

         ***** MISCELLANEOUS(v10_38b) ***** 

    mkfitplots.pl : misc updates 

    mkfitplots_root.c : lots of pretty-plot updates from Eve.

    snana.car : new SNANA table option to select CUTFLAG_SNANA mask,
            SNTABLE_LIST = 'SNANA(cutmask:[mask])
            e.g., mask=1 --> table has only events passing snana cuts.
            e.g., mask=2 --> table has only events passing fit cuts
            Default mask=63 -> table has everything.

   util/sntools.pm :
      In get_namelistValue(), remove comment lines starting with
      '#, !, %' so that comments don't interfere with valid keys.


# ======================================================================= 
         v10_38c (Nov 11, 2014) 

         ***** IMPORTANT(v10_38c) ***** 

   sntools.c  : in getInfo_PHOTOMETRY_VERSION(), check lcmerge/[VERION]
                directory so that data files can go into a folder
                the same way as the simulated data files. Still works
                on files in lcmerge/

   SNDATA_ROOT/   move all data files into folders ... SNANA_tester
                  gives lots of OLD-ABORT errors since the old snana
                  code cannot find the data files in folders.

         ***** USEFUL(v10_38c) ***** 

         ***** MISCELLANEOUS(v10_38c) ***** 
  
   backup_SNDATA_ROOT.pl: minor updates to find version sub-dir.


# ======================================================================= 
         v10_38d (Nov 12, 2014) 

         ***** IMPORTANT(v10_38d) ***** 

         ***** USEFUL(v10_38d) ***** 

         ***** MISCELLANEOUS(v10_38d) ***** 

   argh, fix split_and_fit.pl to work with data folders !!!
   (includes fixing split_version.pl)


# ======================================================================= 
         v10_38e (Nov 20, 2014) 

         ***** IMPORTANT(v10_38e) ***** 

         ***** USEFUL(v10_38e) ***** 

   kcor.c : new command-line key  
                 FILTER_LAMSHIFT g 5  r 8  i 10
            to define arbitray filter-lambda shifts.
            There is no text-file key; command-line only.
            WARNING: this feature is not well tested.

         ***** MISCELLANEOUS(v10_38e) ***** 

   snlc_fit.car: fix bug in function IPAR_PARNAME_STORE to identify
                 'zPHOT' as well as 'z' . Affects NEARNBR training
                 with zPHOT instead of spec-'z'.


# ======================================================================= 
         v10_38f (Nov 28, 2014) 

         ***** IMPORTANT(v10_38f) ***** 

         ***** USEFUL(v10_38f) ***** 

   sntools_trigger.c (for sim):
   In SEARCHEFF_PIPELINE_[survey].DAT file, can set optional
     PHOTFLAG_DETECT: <maskValue>
   so that each detection has the mask value under the PHOTFLAG column
   in the data files.

   snana.car/sntools_fitsio.c :
     Read optional epoch-column variable PHOTPROB ... analogous
     to PHOTFLAG, but PHOTPROB is a continuous Figure-of-merit
     variable (e.g., from 0 to 1). Can store machine-learning (ML)
     score, or any generic fit-prob from a PSF fit.

         ***** MISCELLANEOUS(v10_38f) ***** 

   snlc_fit.car:
     +  PHOTOZ_ANA : fix print comments for dropped/adding filters.
     +  FITINI_PHOTOZ: for 2-band fit with photo-z, fix photo-z 
             during 2-band fit.


# ======================================================================= 
         v10_38g (Dec 6, 2014) 

         ***** IMPORTANT(v10_38g) ***** 

         ***** USEFUL(v10_38g) ***** 

         ***** MISCELLANEOUS(v10_38g) ***** 

    snana.car, functio PARSE_EPOCH: 
       real MJD --> real*8 MJD8.

       Fix NEARNBR_SEPMAX_IGNORE option. Was working in v10_34e,
       then was mistakenly removed during some refactoring.

    snlc_fit.car, FITRESTMAG_PREP:
       for photo-z fit, set Z=ZPHOT to use for finding
       the bounding filters.

    

# ======================================================================= 
         v10_38h (Dec 9, 2014) 

         ***** IMPORTANT(v10_38h) ***** 

         ***** USEFUL(v10_38h) ***** 

  SALT2mu.c : new input option zVARNAME=zPHOT to use zPHOT[ERR]
      in fit. Beware: does not use zPHOT covariances in fit.

         ***** MISCELLANEOUS(v10_38h) ***** 

  combine_fitres.c :
    +  skip duplicate FIELD key(s).
    +  fix subtle bug by adding CCID on first [CID] var.

  split_and_fit.pl: fix bug copying simgen-dump file for sim.

  sntable_dump.c : fix to abort on missing variable in --v option.


# ======================================================================= 
         v10_38i (Dec 13 2014) 

         ***** IMPORTANT(v10_38i) ***** 

         ***** USEFUL(v10_38i) ***** 

         ***** MISCELLANEOUS(v10_38i) ***** 

    snlc_fit.car, FITRESTMAG_INI :
       after 2-band fits, do 2 more fits (instead of 1) to get
       better agreement with fit that does not have FITRESTMAG_INI.
       Not yet clear if it's better, or just randomly different.
       Code needs to be refactored so that final fits  are exctly
       the same with or without rest-frame M0_B (2-band) fit.
       

       in SETBINS_FITINI_PHOTOZ, for SALT2 hard-write color range
       to be -0.3 to +0.6 rather than using INIBND from -1.0 to 0.5.
          --> very small zPHOT change in the SNANA_Tester script.

       New &FITINP nml variable FITWIN_ZPHOT. Initial use is to
       remove events with zPHOT=0 in SN-only photo-z fits.


# ======================================================================= 
         v10_38j (Dec 20 2014) 

         ***** IMPORTANT(v10_38j) ***** 

   Makefile now takes care of root/hbook dependencies so that
   you don't have to manually edit files. Makefile uses new script
   defineOutputFlags.pl to set C pre-processor flag in 
   sntools_output.h


         ***** USEFUL(v10_38j) ***** 

   snana.car,  subroutine INIT_SURVEY:
     Fix string bug identifying survey ... amazing that
     it ever worked. Finally failed at NERSC/carver.

   split_and_fit.pl :
      if OUTDIR arg has no slashes, create sub-dir under `pwd`
      
         ***** MISCELLANEOUS(v10_38j) ***** 

   snana.car:
      new SUBROUTINE SNANA_NEARNBR_RDPATH(PATH) to read path
      from file if &NNINP variable NEARNBR_TRAINING_PATH is
      a fileName instead of a path. This is prep-work for an
      NN-pipeline script to allow multiple sims and fit-options
      for systematics, and always get the correct association
      between version and TRAINING_PATH.


# ======================================================================= 
         v10_38k (Dec 26 2014) 

         ***** IMPORTANT(v10_38k) ***** 

         ***** USEFUL(v10_38k) ***** 

    New script NEARNBR_pipeline.pl ; more file for instructions.

    genmag_SALT2.c : 
         fix aweful bug extrapolating past Trest>50 days.
         Was giving constant mag (at T=50) for all Trest>50 days.


         ***** MISCELLANEOUS(v10_38k) ***** 

    sim_SNmix.pl: 
        new input key TOPDIR_SIMLOGS: to push SIMLOGS_XXX under
        a different directory. Expected to use in nearNbr_pipeline.
        Misc. updates for NEARNBR_pipeline.pl.

    split_and_fit.pl: new option  "GZIP_FLAG: 4"  create SPLIT_JOBS.tar.gz
        and removes SPLIT_JOBS/



# ======================================================================= 
         v10_38l (Dec 31 2014) 

         ***** IMPORTANT(v10_38l) ***** 

         ***** USEFUL(v10_38l) ***** 

   snlc_fit.car : 
     fix bug setting rest-frame filter when FITRESTMAG option is used.
     Affects setting [SALT2] rest-frame band and flux in output LCPLOT table.

         ***** MISCELLANEOUS(v10_38l) ***** 

   NEARNBR_pipeline.pl : lots of tweaking.

   split_and_fit.pl: if merge fails, try again (just one retry) ...
                     mainly for occasional merge_hbook  failures.


# ======================================================================= 
         v10_38m (Jan 6, 2015) 

         ***** IMPORTANT(v10_38m) ***** 

         ***** USEFUL(v10_38m) ***** 

         ***** MISCELLANEOUS(v10_38m) ***** 
    
   NEARNBR_pipeline.pl : more tweaking & debugging

   snlc_fit.car : fix initialization bug that affected writing out
                  rest-frame mags when FITRESTMAG is used.
                  See new call to FITINI_EPVAR(-1).

   split_and_fit.pl : fix DONE_STAMP to appear after SALT2mu jobs.

   Remove ancient  util/CIDLIST_extract.cmd --> use sntable_dump instead.
   Remove obsolete util/check_ignore_files.cmd
   Remove ancient  util/simid_renumber.pl (doesn't work for fits format)


# ======================================================================= 
         v10_38n (Jan 12 2015) 

         ***** IMPORTANT(v10_38n) ***** 

         ***** USEFUL(v10_38n) ***** 

         ***** MISCELLANEOUS(v10_38n) ***** 

  NEARNBR_pipeline.pl, nearnbr_maxFoM.c :
     Write SEPMAX-boundary warnings to NNSTAGE04.

  sntable_dump.pl: minor udpate.
  
  sntools_output_text.c : bug fix to work with root.

  snana.car : new &SNLCINP variable SIM_PRESCALE


# ======================================================================= 
         v10_38o (Jan 29 2015) 

         ***** IMPORTANT(v10_38o) ***** 

         ***** USEFUL(v10_38o) ***** 

         ***** MISCELLANEOUS(v10_38o) ***** 

   wfit.c : write out %8.4 instead of %8.3

   nearnbr_maxFoM.c : for SEPMAX boundary warning, replace 
        asterisk (*) with + or - for hi or lo SEPMAX boundary.

   snlc_sim.c:  in PREP_SIMGEN_DUMP(), allow RA_SN and DEC_SN
     to avoid conflict with HOSTLIB coords.

   sntools_host.c[h]: allow RA or RA_HOST or RA_GAL in HOSTLIB,
      and same for DEC.


# ======================================================================= 
         v10_38p (Feb 6, 2015) 

         ***** IMPORTANT(v10_38p) ***** 

         ***** USEFUL(v10_38p) ***** 

         ***** MISCELLANEOUS(v10_38p) ***** 

   sntools_trigger.c: new function gen_SEARCHEFF_DEBUG(),
     accessed only by hard-coding INPUTS_SEARCHEFF.FUNEFF_DEBUG
     in snlc_sim.c .

   sntools_output_text.c : write MJD,RA,DEC with specific format to ascii

   snlc_sim.c : 
     + write MJD,RA,DEC to specific format to SIMGEN_DUMP file.
     + fix FLATRAN bug in genz_hubble().

   sntools_host.c[h]: int GALID -> long long GALID in many places.


# ======================================================================= 
         v10_38q (Feb 10, 2014) 

         ***** IMPORTANT(v10_38q) ***** 

         ***** USEFUL(v10_38q) ***** 

         ***** MISCELLANEOUS(v10_38q) ***** 

   psnid.car:  allow using $SNDATA_ROOT in PRIVATE_TEMPLATES_PATH

   sntools.c : fix getInfo_PHOTOMETRY so that PRIVATE_DATA_PATH
               and PRIVATE_DATA_PATH/VERSION are both checked.
               E.g., allows PRIVATE_DATA_PATH = '.' with a version
               directory.

   snana.car : PRIVATE_CUTWIN_STRING can be passed on command-line,
               but only 1 cutwin.

   snana.car & split_and_fit.pl : 
       PRIVATE_DATA_PATH = 'pwd' allows using data folder
       in current directory, and works on any cluster since
       the pwd string is replaced by the actual `pwd`.


# ======================================================================= 
         v10_39 (Feb 19, 2015) 

         ***** IMPORTANT(v10_39) ***** 
 
   minuit.F & now part of snana; no longer need external $MINUIT_DIR .

         ***** USEFUL(v10_39) ***** 

         ***** MISCELLANEOUS(v10_39) ***** 

   Makefile creates ../obj/minuit.o and no longer uses $SNANA_DIR
      (so that $SNANA_DIR can be defined after 'make' )

   snana_install.pdf : MINUIT discussion removed since it's now part
       of the snana make.

   snana.car: in INIT_SNVAR, abort if $SNDATA_ROOT is not defined.

   sntools.c : fix the way null getenv() is checked in INIT_SNPATH().


# ======================================================================= 
         v10_39b (Feb 21, 2015) 

         ***** IMPORTANT(v10_39b) ***** 

         ***** USEFUL(v10_39b) ***** 

    Allow using ENV for input file names (see examples below).

         ***** MISCELLANEOUS(v10_39b) ***** 

    Allow using ENV for input file names. See new function
    ENVreplace(char *name)  in sntools.c[h], and also in snana.car.
    e.g.,  SIMLIB_FILE: $MYSIMPATH/BLA.SIMLIB
    Also used for namelist variables PRIVATE_DATA_PATH and 
    PRIVATE_TEMPLATES_PATH

    Fix snmake.pl to use minuit.o .


# ======================================================================= 
         v10_39c (Feb 26, 2015) 

         ***** IMPORTANT(v10_39c) ***** 

         ***** USEFUL(v10_39c) ***** 

         ***** MISCELLANEOUS(v10_39c) ***** 

   snana.car: new &SNLCINP string FUDGE_MAG_COVERR to fudge a
       calibration covariance as a block-diagonal for each band.
    
       END_WRFITS: catenate each original README file into final
          README file.
  
   snlc_fit.car: new function COVFUDGE_DATA() to implement
       FUDGE_MAG_COVERR ... Beware, not tested !

   sntools_host.h:  set DEBUG_WGTFLUX2 = 0 instea of 0.6;
     had left this old debug flag on accidentally for years,
     but it would only take effect when using two Sersic
     profiles.

  sntools.c :  fix getInfo_PHOTOMETRY_VERSION() so that for private
       DATADIR it will also check $SNDATA_ROOT/SIM. Allows using
       split_and_fit with PRIVATE_DATA_PATH option for data and 
       including sims.

  split_and_fit.pl : fix logic to work using PRIVATE_DATA_PATH   
      for data, and $SNDATA_ROOT/SIM for sims.


# ======================================================================= 
         v10_39d (Mar 6, 2015) 

         ***** IMPORTANT(v10_39d) ***** 

    Fixed bug simulating Poisson-noise  from HOST, and SBFLUX.
      [was previously under-estimated by factor of few]

    New sim-option HOSTNOISE_FILE: <file>
      to add extra instrumental scatter based on SB.

    New &SNLCINP namelist option FUDGE_HOSTNOISE_FILE = 'file'
       to inflate flux-errors based on SB.

         ***** USEFUL(v10_39d) ***** 

         ***** MISCELLANEOUS(v10_39d) ***** 

   sntools_host.c:
      fix aweful index bug set FGAL_TOT in double get_GALFLUX_HOSTLIB(..).
      This bug resulted in large UNDER-estimate of host-noise,
      but did not affect host location or any other HOSTLIB features.

      Compute SB_FLUX and SB_MAG here instead of in snlc_sim.

    
   snlc_sim.c : 
     + allow new SIMGEN_DUMP variables SBFLUX_[band]
     + fix bug writing to terse/ascii output.

   Simulated SBFLUX distribution verified with DES fakes vs. DES SIM. 
     For the fakes, SBFLUX was measured from real template images, 
     while for DES SIM the SBFLUX is calculated fom the host Sersic
     profile and catalog mag.

   sntools_imageNoiseModels.c[h]:
     New SB_ERRSCALE model to scale the sky-noise as a function
     of SBMAG. Can use in simulation now ... later will incorporate
     into fitting program to inflate data errors.

     Example of format for HOSTNOISE_FILE key in sim-input file:

        LIBID: 1 
        BAND: g    FIELD: E1+E2+S1+S2+C1+C2+X1+X2 
        #          SBMAG  ERRSCALE  
        HOSTNOISE:  20.50  3.60 
        HOSTNOISE:  21.50  3.14 
        HOSTNOISE:  22.50  1.84 
        HOSTNOISE:  23.50  1.59 
        HOSTNOISE:  24.50  1.10 
        HOSTNOISE:  25.50  1.04 
        HOSTNOISE:  26.50  0.99 
        HOSTNOISE:  27.50  0.98 
        HOSTNOISE:  28.50  0.98 

   sim_SNmix.pl: copy HOSTNOISE_FILE



# ======================================================================= 
         v10_39e (Mar 15, 2015) 

         ***** IMPORTANT(v10_39e) ***** 

         ***** USEFUL(v10_39e) ***** 

    SALT2mu.c: new option to add extra fit-iteration with 2log(sigma) term.
       fitflag_sigmb=1  ! same as old sig1fit=1; vary sigmB
       fitflag_sigmb=2  ! idem, but with extra fit adding 2log(sigma).

       Allow sigmb or sigmB  key in the input file.

         ***** MISCELLANEOUS(v10_39e) ***** 

   snlc_sim.c: 
    * new option SIMLIB_MINOBS: <MINOBS> to specify minimum NOBS to use.
    * for SNDATA.HOST* variables, use (float) cast.

   snana.car/snlc_fit.car :
      for &SNLCINP SNFIELD_LIST, allow the following
      to all work the same way,
         SNFIELD_LIST = 'E1', 'E2', 'S1', 'S2'
         SNFIELD_LIST = 'E1 E2 S1 S2'
         SNFIELD_LIST = 'E1 E2', 'S1 S2'
      This allows using the command-line override to specify
      multiple fields.

   minuit.F : protect array bound around line 9042.


# ======================================================================= 

         v10_39f (Mar 22, 2015) 


         ***** IMPORTANT(v10_39f) ***** 

         ***** USEFUL(v10_39f) ***** 

   New option to select early epochs for LC fitting (psnid, snlc_fit, snana).
   See &SNLCINP namelist string EARLYLC_STRING in manual.


         ***** MISCELLANEOUS(v10_39f) ***** 

   snlc_sim.c : 
      + make some fixes for SIMLIB_DUMP option.
      + New sim-input key SIMLIB_FIELDLIST:  C1+C2+C3

   snana.car:
     In SNRECON, remove call to CHECK_EPOCH_IGNORE.
     Move this call upstream so that ignored epochs are
     not even stored.

     In CHECK_EPOCH_IGNORE, add new call to SELECT_EARLYLC
     to allow option for selecting only the early part of an LC.

     New &SNLCINP variable to select early part of LC; e.g., 
        EARLYLC_STRING = 'MAXOBS 4  FILTERS riz PHOTPROBMIN .5'
        EARLYLC_STRING = 'MAXOBS 4  FILTERS riz SNRMIN 5.0'

   Fix a few compilation warnings found by D.Crawford:
     wfit.c, genmag_SIMSED.c, SIMSED_extractSpec.c


# ======================================================================= 
         v10_39g (Apr 6, 2015) 

         ***** IMPORTANT(v10_39g) ***** 

         ***** USEFUL(v10_39g) ***** 

   wait_for_files.pl: new NOSTAMP option

         ***** MISCELLANEOUS(v10_39g) ***** 

   sntools_output.c[h] :
     fix to properly abort when HFILE_OUT is specified without 
     compiling HBOOK, or when ROOTFILE_OUT is given without 
     compiling ROOT.
     See new function TABLEFILE_notCompiled_ABORT(...).

   snana.car : new EARLYLC_STRING option MAXNIGHT_EARLYLC
          (see manual)

   split_and_fit.pl : update DELAY_SUBMIT logic; can how specify
      delay between each batch job, and a separate delay between
      each VERSION/FITOPT.


# ======================================================================= 
         v10_39h (Apr 25 2015) 

         ***** IMPORTANT(v10_39h) ***** 

         ***** USEFUL(v10_39h) ***** 

         ***** MISCELLANEOUS(v10_39h) ***** 

  snana.car : fix to make PHOTPROB and PHOTFLAG optional
              instead of required variables.

  kcor.c[h] : allow command-line override for primary SED

  snlc_sim.c[h]
    New WRONGHOST_XXX params, and z-dependence.

  sntools_outout.c     : call CLOSE_TEXTFILE
  sntools_output_text.c: add CLOSE_TEXTFILE() function.


# ======================================================================= 
         v10_39i (May 19, 2015) 

         ***** IMPORTANT(v10_39i) ***** 

         ***** USEFUL(v10_39i) ***** 

   snlc_sim.c:
      new FUDGE_SNRMAX option "r=100" to force SNRMAX=100 in r-band,
      and then use same EXPOSURE_TIME in all bands. Updated manual
      section for this option.


         ***** MISCELLANEOUS(v10_39i) ***** 

   snlc_sim.c :  
     + modify reading of NON1A keys so that NONIA and SIMSED models 
       can be defined in the same input file, and toggling GENMODEL 
       will switch.
     + Fix dumb bug reading WRONGHOST_FRAC on command line.
     + Fix WRONGHOST logic so that WRONHOST_FRAC=0 on command-line
          turns it off.
     + print full command (snlc_sim.exe + args) to stdout.

     + fixed FUDGE_SNRMAX logic to use true/generated SNRMAX to
       compute the required EXPOSURE_TIME ... no longer uses
       measured SNRMAX that has random fluctuations. See new
       GENLC.SNRMAX_TRUE[ifilt_obs]

   sim_SNmix.pl : copy SEARCHEFF_SPEC_FILE only if it exists.
  

# ======================================================================= 
         v10_39j (Jun 18 2015) 

         ***** IMPORTANT(v10_39j) ***** 

         ***** USEFUL(v10_39j) ***** 

         ***** MISCELLANEOUS(v10_39j) ***** 

   Update manual Sec 9.4 for SIMSED.

   backup_SNDATA_ROOT.pl: include SIMSED models specified in
                          SIMSED/AAA_PUBLIC_VERSIONS.README 

   sncl_fit.car: replace FITWIN_AV with FITWIN_COLOR in &FITINP.

   snana.car: add new option 'NDAYADD' to the EARLYLC_STRING;
         search EARLYLC in manual.


# ======================================================================= 
         v10_39k (June 25, 2015) 

         ***** IMPORTANT(v10_39k) ***** 

    Must install this new file: 
        $SNDATA_ROOT/simlib/Sersic_bn.dat 
    to use HOSTLIB feature of choosing SN pos near host.

         ***** USEFUL(v10_39k) ***** 

         ***** MISCELLANEOUS(v10_39k) ***** 

   split_and_fit.pl : 
       + for APPEND_FITRES key, internally swap 7788 <--> FITRES 
         if needed to avoid abort.
       + fix bug when just 1 core per job.

   sntools_host.c: 
      + improve R/Re test at F/FTOT=0.5 by interpolating
        instead of using integral bin closest to 1/2.
      + for n<0.36 use exact calc from table create by R.Gupta.
        Must have this file: $SNDATA_ROOT/simlib/Sersic_bn.dat 

   sntools_host.h:
       SERSIC_INDEX_MIN   ->  0.15 (was 0.35)
       SERSIC_INDEX_MAX   ->  8.00 (was 5.0)
       NBIN_RADIUS_SERSIC ->  200  (was 60)

       Add new parameter MXBIN_SERSIC_bn.


# ======================================================================= 
         v10_39l (July 20 2015) 

         ***** IMPORTANT(v10_39l) ***** 

         ***** USEFUL(v10_39l) ***** 
 
  snlc_sim.c: new key HOSTLIB_MINDAYSEP_SAMEGAL to specify
     min PEAKMJD separation for re-using a galaxy. See manual.

         ***** MISCELLANEOUS(v10_39l) ***** 

   split_and_fit.pl : 
      + check for abort for APPEND_FITRES option to give clear
        message for invalid variable name.
      + new input option "DO_FITOPT000: 0" to suppress FITOP000.

   snana.car : trap zero-length data file and abort.


# ======================================================================= 
         v10_39m (Jul 23 2015) 

         ***** IMPORTANT(v10_39m) ***** 

         ***** USEFUL(v10_39m) ***** 

  snana.exe/snlc_fit.exe/psnid.exe :
     new &SNLCINP input  
        PRIVATE_REDSHIFT_CMD = 'name redshift key'
     to use private redshift value in analysis/fitting.

     See manual Sec 6.5 for updates on using PRIVATE variables.

         ***** MISCELLANEOUS(v10_39m) ***** 

   snana.car 
    + remove obsolete subroutine CHECK_ZEXTRA
        [checked who had access to BOSS redshifts]
 
   sntools.c[h] : make fortran-mangled zhelio_zcmb_translator function.


# ======================================================================= 
         v10_39n (Jul 31 2015) 

         ***** IMPORTANT(v10_39n) ***** 

         ***** USEFUL(v10_39n) ***** 

   sntools_genSmear.c[h] : new intrinsic scatter model
      GENMAG_SMEAR_MODELNAME:  BIMODAL_UV

         ***** MISCELLANEOUS(v10_39n) ***** 

    snana.car : 
     + make fix to make FITRESTMAG compatible with FILTER_UPDATE_PATH;
       see new array DOFLAG_FILTER_UPDATE(ifilt).  Needed to fit SNLS
       with FITRESTMAG and still use the SN-dependent filters.

    snlc_fit.car : 
       fix output for SNMJD_INTERP option. 
       See subroutine DMP_SNMJD_INTERP().
       Rest-frame info is no longer output, but can be
       added if needed. 
     

# ======================================================================= 
         v10_39o (Aug 11 2015) 

         ***** IMPORTANT(v10_39o) ***** 

         ***** USEFUL(v10_39o) ***** 

         ***** MISCELLANEOUS(v10_39o) ***** 

   sntools_output_text.c : fix bug to write correct header for LC plot.

   genmag_SEDtools.h: 
          MXBIN_LAMFILT_SEDMODEL -> 1500 (was 900) for WFIRST W band

   sntools.c[h]: make mangled version of checkval_I(...).

   snana.car: when reading ITERSE_XXX, call CHECKVAL_I() on required
        columns to make sure all are defined.

        New &SNLCINP inputs
          CUTWIN_MJD_EXCLUDE  ( changed from EXCLUDE_MJD)
          CUTWIN_MJD_INCLUDE  ( new, rejects LC if no obs in this range)
        See manual section 5.21.4


# ======================================================================= 
         v10_39p (Aug 12, 2015) 

         ***** IMPORTANT(v10_39p) ***** 

         ***** USEFUL(v10_39p) ***** 

   genmag_SIMSED.c : call new function shiftPeakDay_SEDMODEL() so that
                     DAY=0 at bolometric peak flux. Called only if
                     all DAY values are > 0.

   snlc_sim.c[h]: new input key "GENMAG_OFF_GLOBAL: <mag_off>"
                  to define a single mag-offset for all bands.
                  
         ***** MISCELLANEOUS(v10_39p) ***** 

   genmag_NON1ASED.c[h]:  remove shift_NON1A_DAY() and use
                          utility shiftPeakDay_SEDMODEL().


# ======================================================================= 
         v10_39q (Aug 18, 2015) 

         ***** IMPORTANT(v10_39q) ***** 

    genmag_SEDtools.c : 
      Fixed interpolation bug when TREST range is different for each SED.
      Was using last-read DAY-array instead of SED-dependent DAY-array.
      Bug probably there since a big refactoring. See new local DAYLIST 
      array in interp_flux_SEDMODEL() that is made from SED-dependent 
      DAYMIN and DAYSTEP.
      Bug was caught by negative peak-fluxes for BK13 models.
      For SNANA_tester, the two FLASH1 jobs are slightly different,
      as expected with this bug fix. Fortunately the NON1A-tester 
      jobs show no change, so hopefully the NONIA sims are ok.
      For SIMSED models, this bug had affected MAGT0_[band] in the 
      SIMGEN-dump file, and could truncate early epochs for seds 
      whose min TREST is before that of the last-read SED. This bug
      did NOT affect SIMSED models with a uniform TREST grid.


         ***** USEFUL(v10_39q) ***** 

   sntools_host.c, snlc_sim.c :
       new hostlib key  HOSTLIB_ZPHOTEFF_FILE to specify efficiency
       (vs. ZTRUE) if getting a host photo-z.

         ***** MISCELLANEOUS(v10_39q) ***** 

   genmag_SIMSED.c :
     If SIMSED_GRIDONLY is used for all parameters, then interp_flux_SIMSED()
     function finds the exact SED instead of interpolating. Shouldn't make
     any difference, but always safer to avoid interpolation when possible.

   snlc_sim.h : remove OPTMASK_SISED_XXX parameters and move them into
                genmag_SIMSED.h to use them in both snlc_sim.c and also
                in genmag_SIMED.c (no more hard-wired flag-values in the
                interp_flux_SIMSED function).


# ======================================================================= 
         v10_40 (Aug 23 2015) 

         ***** IMPORTANT(v10_39r) ***** 

         ***** USEFUL(v10_39r) ***** 

    + Add  psnid_private.cra
  
    + split_and_fit.pl : if executable (from JOBNAME_LCFIT key) is
                         in current directory, then use it; else use
                         public/snana program in user $path.
 
         ***** MISCELLANEOUS(v10_39r) ***** 

    sntools_host.c : fix bug to allow re-using host without
                     aborting from overflowing array bound.

    psnid.car : rename USRXXX routines to PSNIDXXX routines
                so that USRXXX can be used.
    snana.car : call PSNIDXXX routines inside +IF=PSNID patchy flag.

    snmake.pl : update to work with psnid_private

    all *.cra files: add new user-routine USRCUTS so that users
                     can apply more cuts before SET_CUTMASK.


# ======================================================================= 
         v10_40b (Aug 23 2015) 

         ***** IMPORTANT(v10_40b) ***** 

         ***** USEFUL(v10_40b) ***** 

         ***** MISCELLANEOUS(v10_40b) ***** 

   snana.car : call CHECK_LINE_ARGS after USRINI() call to allow
               reading new nml from private code
   snlc_fit.car, psnid.car: remove call to CHECK_LINE_ARGS

   psnid.car : new &PSNIDINP variable  MJDFIT_RANGE(2)


# ======================================================================= 
         v10_40c (Aug 26 2015) 

         ***** IMPORTANT(v10_40c) ***** 

         ***** USEFUL(v10_40c) ***** 

   split_and_fit.pl : 
      new optional key "MIN_SNANA_VERSION: <version>" causes abort
      if using lower version. Useful to prevent mistakes when 
      distributing input files to other collaborators and computing 
      platforms.

         ***** MISCELLANEOUS(v10_40c) ***** 

   snlc_sim.c[h] , sntools_host.c[h]:
     When HOSTLIB_MINDAYSEP_SAMEGAL is set, do NOT abort when
     host can't be found. Modify GENRANGE_CUT() function to
     skip events with SNHOSTGAL.ZTRUE < 0.  However, when
     the number of events with ZTRUE<0 exceeds 2*NGEN_WRITE,
     abort to avoid infinite loop trying to find a non-existant
     host-galaxy. Initial use is to generate fakes and
     re-use each nearby galaxy multiple times with >25 day
     separation between each PEAKMJD.   


# ======================================================================= 
         v10_40d (Sep 10 2015) 

         ***** IMPORTANT(v10_40d) ***** 

         ***** USEFUL(v10_40d) ***** 

   New split_and_fit.pl key
    VERSION_AFTERBURNER: <user command to run inside each /VERSION subdir>

         ***** MISCELLANEOUS(v10_40d) ***** 

   NEARNBR_pipeline.pl: new input key WFALSE: <wfalse>

   wfit.c : read zHD and zHEERR

   sntools_imageNoiseModels.c : use snana_read utility to check
       $SNDATA_ROOT/simlib for noisemodel file.

   psnid_BEST.c:  fix trest1 index bug in call to hunt() function from
                  the PSNID_BEST_GET_FITFUN() function.



# ======================================================================= 
         v10_40e (Sep 14 2015) 

         ***** IMPORTANT(v10_40e) ***** 

         ***** USEFUL(v10_40e) ***** 

   snlc_sim.c[h] : expand FIXMAG option sim-input file (Sec 9.6 of manual)
        FIXMAG:  20       ! fixmag=20
        FIXMAG:  20:24    ! random fixmag between 20 and 24
        RANMAG:  20:24    ! same as above

         ***** MISCELLANEOUS(v10_40e) ***** 
 
   sntools_host.c[h] new funtion FREEHOST_GALID(IGAL) to free
      host to ge used again. Called by snlc_sim.exe when generated
      event is rejected.

   snlc_sim.c: refactor a little with new function gen_event_reject().

   psnid_tools.c:
      set len1 & len2 argument to function call
         get_snana_versions__(ptrSNANA, ptrPHOT, len1, len2);

   Previously len1 and len2 were not initialized.
   This is a best-guess fix to the following v10_40c error found by
   "Rahman Amanullah" <rahman@fysik.su.se>  :
       At line 82568 of file ../src/psnid.f
       Fortran runtime error: Actual string length is shorter than 
       the declared one for dummy argument 'version_photom' (0/200)


# ======================================================================= 
         v10_40f (Sep 17 2015) 

         ***** IMPORTANT(v10_40f) ***** 

         ***** USEFUL(v10_40f) ***** 

   sntools_host.c[h] : if FIELD column is in hostlib, transfer FIELD to 
                       data files.

         ***** MISCELLANEOUS(v10_40f) ***** 

   snana.car:   fix bug in routine FUDGE_FLUXCAL(); see D_ZP.
 
   sntools_host.c: fix malloc bug in function USEHOST_GALID().
                   See MXUSE_SAMEHOST in malloc.

   snlc_sim.c: new key GENLIST_PEAKMJD_FILE to specify list of
               "PEAKMJD FIELD" to force PEAKMJD values,
               e.g., to lie near observations.


# ======================================================================= 
         v10_40g (Sep 30, 2015) 

         ***** IMPORTANT(v10_40g) ***** 

         ***** USEFUL(v10_40g) ***** 

         ***** MISCELLANEOUS(v10_40g) ***** 

  snlc_sim.c : 
    + for ascii format, write PSF column.
    + add crazy-value protection in SIMLIB_read_templateNoise

  sntools_host.h:
      increase some array bounds for WFIRST studies.

  snana.car:  
     fix bug in UPD_WRFITS() by increasing STRINGVAL size from
     2,000 to 20,000 bytes to allow for many epochs from 
     multi-season surveys. Bug found processing 2+ seasons of DES.

     Add new &SNLCINP parameters  
       MAGOBS_SHIFT_ZP_PARAMS 
       MAGOBS_SHIFT_PRIMARY_PARAMS. 
     See end of manual section
       5.22 Mag-Shifts in Zero Points and Primary Reference Star


# ======================================================================= 
         v10_40h (Oct 2 2015  ) 

         ***** IMPORTANT(v10_40h) ***** 

         ***** USEFUL(v10_40h) ***** 

         ***** MISCELLANEOUS(v10_40h) ***** 

   snana.car :
      a small refactor for the MAGOBS_SHIFT_XXX parameters
      in previous version

      Increase a few string arrays to handle reading
      events with >500 epochs.

      sntools.c: fix set_SNDATA() so that localString cannot be overwritten.


# ======================================================================= 
         v10_40i (Oct 22, 2015) 

         ***** IMPORTANT(v10_40i) ***** 

         ***** USEFUL(v10_40i) ***** 

         ***** MISCELLANEOUS(v10_40i) ***** 

  sntools_fitsio.c:  for IAUC_NAME, specify "16A" instead of "8A".
                     Fixes truncation of TRANSIENT_NAME in DES.
                     Increase SNID from 12A to 16A

  snana.car :
    + init SNLC_IAUC = '' to fix bug of using last IAUC_NAME
      if not specified in text data file.

    + SET_PKMJD: remove .NOT.LSET requirement at end of routine.

    + read optional GAIN from ascii format. See ITERSE_GAIN

  psnid_BEST.c : fix memory leak bug in PSNID_BEST_GET_FITFUN().

  snlc_sim.c:  fix VT_redshift() to work with "DNDZ: FLAT" option
               and print Number per season --> will work with sim_SNmix.


# ======================================================================= 
         v10_40j (Oct 22 2015) 

         ***** IMPORTANT(v10_40j) ***** 

         ***** USEFUL(v10_40j) ***** 

         ***** MISCELLANEOUS(v10_40j) ***** 

   snana.car: add 26 new filter characters '!@#$%^&*()_+-={}[]|/:;<>?~'
              for IFU sims. Do not use comma, quotes or backslash.

      program         size
      snana.exe      193 MB --> 193 MB
      snlc_fit.exe   378 MB --> 379 MB
      snlc_sim.exe   322 MB --> 334 MB
      kcor.exe        25 MB -->  28 MB

      sndata.h  : MXFILTINDX -> 100 (was 80)
      kcor.h    : MXFILTDEF  -> 100 (was 60)
      snana.car : MXFILT_OBS ->  92 (was 62)
      snana.car : MXFILT_ALL -> 100 (was 80)

   Note that the sim random sequence changes, so there
   are slight discrepencies with SNANA_tester.

   Most of the new characters are not compatible with FITS;
   kcor.exe runs with the new chars, but fv crashes on the
   output FITS file.

# ======================================================================= 
         v10_40k (Oct 26, 2015) 

         ***** IMPORTANT(v10_40k) ***** 

         ***** USEFUL(v10_40k) ***** 

   snlc_sim.c: new sim-input key  "NGEN_SEASON:  <n>"

         ***** MISCELLANEOUS(v10_40k) ***** 
   
   snlc_sim.c[h]:  new input key TGRIDSTEP_MODEL_INTERP to interpolate
                   mags on an epoch grid. Note that this is an 
                   intentional degradation.

   genmag_SALT2.c: new optional key in SALT2.INFO file,
           RESTLAM_FORCEZEROFLUX:  lam1 lam2
           e.g., force g-band flux to zero at small lambda.


# ======================================================================= 
         v10_40l (Nov 1, 2015) 

         ***** IMPORTANT(v10_40l) ***** 

         ***** USEFUL(v10_40l) ***** 

   snlc_sim.c : New sim-input key  "FUDGEOPT_FLUXERR: <opt>"
                to use C code function to fudge errors.
                Fudge codes are in sntools_fluxErrModels.c[h].
                The name of the simlib is the primary option key.

         ***** MISCELLANEOUS(v10_40l) ***** 



# ======================================================================= 
         v10_40m (Nov 12, 2015) 

         ***** IMPORTANT(v10_40m) ***** 

         ***** USEFUL(v10_40m) ***** 

   sncl_sim.c :  new simlib key under each LIBID to specify z-range
                    REDSHIFT_RANGE: <z1> <z2>
                 See manual 4.5.2 SIMLIB Options for each LIBID

         ***** MISCELLANEOUS(v10_40m) ***** 

   sntools_output_text.c : remove LIBID check on row key and char cast.

   snlc_sim.c[h] : new key NGEN_SCALE_NON1A  to scale only the NON1A;
                   can be used in sim_SNmix input file.

  sntools_output_text.c : TEXFILE_PREFIX is always a prefix, 
                          even if there is a dot.

  snana.car: fix bug reading CUTWIN_NFILT_SNRMAX and CUTWIN_NFILT_SNRMAX2
          from the command-line; read upper bound for each.

  sntools_host.c:  fix few bugs in GEN_SNHOST_POS(), found by Ravi.
                   SN coords near host and SN-host sep were not 
                   computed correctly. No effect at equator, but 
                   gets worse going north or south.


# ======================================================================= 
         v10_40n (Nov 20 2015) 

         ***** IMPORTANT(v10_40n) ***** 

         ***** USEFUL(v10_40n) ***** 

         ***** MISCELLANEOUS(v10_40n) ***** 

  sntools_host.c: fix bug computing SN-host angle sep;
                  use exact angSep function.

  sntools_output_text.c : 
      un-do change in previous version, since it introduced a bug.
      Data or sim versions with a dot are not allowed.

  sim_SNmix.pl: abort if any GENVERSION has a dot. The sims run fine
      with a dot, but the split_and_fit merge phase has problems
      with a dot.


# ======================================================================= 
         v10_40o (Nov 24, 2015) 

         ***** IMPORTANT(v10_40o) ***** 

         ***** USEFUL(v10_40o) ***** 

  snlc_sim.c[h]: new input key HOSTLIB_DZTOL to select tolerance on
                 zSN-zGAL vs. redshift. Default is similar to prefious default.
                 See manual.

         ***** MISCELLANEOUS(v10_40o) ***** 

   snana.car: fix bug in PRIVATE_CHECK so that the private
              redshift option works.

              Add CUTFLAG_SNANA to ascii SNANA table.

   sntools_host.c : when transferring zgal to zSN, 
                    compute ZCMB from ZHELIO=ZTRUE(GAL).

                    In zptr_HOSTLIB(), fabsf -> fabs for zdif;
                    fixed a seemingly harmless bug.


# ======================================================================= 
         v10_40p (Nov 24, 2015) 

         ***** IMPORTANT(v10_40p) ***** 

         ***** USEFUL(v10_40p) ***** 

         ***** MISCELLANEOUS(v10_40p) ***** 

   sntools_host.c : fix a few bugs implementing HOSTLIB_DZTOL
                    from the previous version.



# ======================================================================= 
         v10_40q (Dec 18 2015) 

         ***** IMPORTANT(v10_40q) ***** 

         ***** USEFUL(v10_40q) ***** 

  snlc_sim.c : new sim-input key "GENPAR_SELECT_FILE: <filename>"

         ***** MISCELLANEOUS(v10_40q) ***** 

  convertsnana2salt2.pl : minor fix

  snana.car : upgrade so that IAUC names can be used in SNCID_LIST_FILE;
              in this case, the IAUC names are written out as the CID
              in the output files.

              new SNTABLE_LIST option to write out CID=IAUC name 
              instead of SNID. See manual section
                12.1.4 Working with IAUC names
  
  snlc_sim.c : new keys  
     GENPAR_SELECT_FILE  (ranges of z,PKMJD,RA,DEC,FIELD)
     SIMLIB_NREPEAT      (repeat each LIBID NREPEAT times to reduce reading)


# ======================================================================= 
         v10_41 (Dec 19 2015) 

         ***** IMPORTANT(v10_41) ***** 

   snlc_sim.c[h]: Refactor WRONGHOST model to change ZHOST that is passed
                  to SNHOST_DRIVER(ZHOST,PEAKMJD). Previously WRONGHOST
                  redshift was applied only to final redshifts, and the
                  HOSTGAL_PHOTOZ value was wrong.
                  See manual Sec 4.20 Simulating Mis-Matched Host Galaxy

         ***** USEFUL(v10_41) ***** 

         ***** MISCELLANEOUS(v10_41) ***** 

   snlc_sim.c: random sync changed for WRONGHOST refactor, so SNANA_tester
               has discrepancies.


# ======================================================================= 
         v10_41b (Dec 27 2015) 

         ***** IMPORTANT(v10_41b) ***** 

         ***** USEFUL(v10_41b) ***** 

         ***** MISCELLANEOUS(v10_41b) ***** 

  sntools_wronghost.c : minor fix 
 
  sntools_fitsio.c : 
    + header key SIMLIB -> SIMLIB_FILE
    + add SIMLIB_MSKOPT
    + header key HOSTLIB -> HOSTLIB_FILE

  Several small fixes so that snana codes read older
  sims that don't have SIMLIB_MSKOPT or SIMLIB_FILE keys.

  snlc_sim.c : 
    + refactor genz_hubble() -> genz_hubble(zmin,zmax).
    + genz_hubble aborts if zmin or zmax < 1E-9
    + geneff_calc(): modify STOPGEN logic to be less frequent
    + comment out STOPGEN logic
    + sim-input key OPT_SIMLIB key -> SIMLIB_MSKOPT (see manual).
    + "SIMLIB_MSKOPT: 2" will keep re-using the same LIBID
        until an event is accepted. Add NGEN_LIBID to 
        SIMGEN-dump file, data files and SNTABLE(s) to see how
        many were generated for each accepted event. Initial
        motivation is to generate sims with ABC method.
    + add MJD_TRIGGER to list in PREP_SIMGEN_DUMP().

    + add new sim-input key SEARCHEFF_PIPELINE_LOGIC_FILE
    + accept either SEARCHEFF_PIPELINE_FILE or SEARCHEFF_PIPELINE_EFF_FILE


    + snlc_sim.h:  "#define MXGEN_LIBID 10000" specifies when to abort
      to avoid infinite loop on LIBID with zero efficiency.
  
  sim_SNmix.pl: check if SIMLIB_FILE arg is local; if so then
      copy it so it gets used.


# ======================================================================= 
         v10_42 (Jan 4, 2016) 

         ***** IMPORTANT(v10_42) ***** 

         ***** USEFUL(v10_42) ***** 

   snlc_fit.exe : 
      if MINUIT Cov matrix is bad on last iteration, fit one 
      more time to try and get proper cov matrix. 
      See SNANA manual Sec 5.3.1 MINUIT Covariances .

      Here is the impact on DES simulations with NFIT_ITERATION=3 :

                        Ncuts    Ncuts    Final frac with MNSTAT_COV=
          z-prior      v10_41b  v10_42     0      1      2       3 
          - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
          spec           1395 -> 1395      0    2.2%   0.7%   97.2%
          host zPhot     1351 -> 1357      0    2.8%   2.1%   95.1%
          none           1379 -> 1384      0    2.0%   2.9%   95.1%
          - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 

    Comments for spec-z prior: Comparing MNSTAT_COV=3 vs. MNSTAT_COV<3,
       there is no significant RMS difference for DELMU or c-simc.

    Comments for host zPhot prior:
      There are slighly more events after cuts (6) with extra fit attempt.  
      RMS(zPhot-simz) is the same for MNSTAT_COV=3 and  MNSTAT_COV<3. 
      For the zphoterr spike at 0.05, however, almost half have MNSTAT_COV<3.


         ***** MISCELLANEOUS(v10_42) ***** 

   kcor.c[h] refactor to prepare for reading IFU.

   snlc_sim.h: MXOBS_SIMLIB -> 5000 (was 2000)

   snlc_fit.car: 
      + update NEARNBR functions to allow
        using parameter errors: e.g., cERR, x1ERR, etc ...

      + remove obsolete ERRFLAG_FITPREP_INVERTCOV

      + FITPAR_ANA: for photo-z fit, if cov matrix is bad
             then fit again. See new global MNSTAT_COV
             and MNSTAT_COV in FITRES table.


# ======================================================================= 
         v10_42b (Jan 6 2016) 

         ***** IMPORTANT(v10_42b) ***** 

         ***** USEFUL(v10_42b) ***** 

         ***** MISCELLANEOUS(v10_42b) ***** 

   snana.car: in RDSNNML, if NMLFILE='NOFILE' then skip reading
              nmlFile and jump to command-line override. This allows
              running snana with only command-line options and no file.
              Initial use to dump LC in ascii without an NML FILE.

   snlc_sim.c[h]: 
       compute CPU time, NGEN/sec and NWRITE/sec.
       Write CPU info at end of readme.

       Fix MJDTMP-malloc bug reading simlib. Remove malloc and
       define global struct SIMLIB_LIST_forSORT.MJD/INDEX_SORT.


# ======================================================================= 
         v10_42c (Jan 9 2016) 

         ***** IMPORTANT(v10_42c) ***** 

         ***** USEFUL(v10_42c) ***** 

    snlc_sim.c:
      Fix parsing sim-input file so that anything after '#' is ignored.

         ***** MISCELLANEOUS(v10_42c) ***** 

    snlc_sim.c:
      Using  "SIMLIB_MSKOPT: 2" to repeat same LIBID until accept,
      fix logic to handle NGEN_LIBID >= MXGEN_LIBID --> force event
      to be accepted so that NGEN_LIBID is stored, but set NOBS=NEPOCH=0
      so that event will fail any analysis cuts.



# ======================================================================= 
         v10_42d (Jan 19 2016) 

         ***** IMPORTANT(v10_42d) ***** 

         ***** USEFUL(v10_42d) ***** 

         ***** MISCELLANEOUS(v10_42d) ***** 

   snlc_sim.c, sntools_fitsio.c : write SIM_REDSHIFT_HOST to data files
 
   snlc_sim.c: 
     + tweak readme_doc() to NOT write NON1a info at start since it's
       all written in the summary at the end. 
   snlc_sim.h: MXDOCLINE -> 400 (was 300)

   snana.car : read SIM_REDSHIFT_HOST and include SIM_ZHOST in SN tables.
        For wrong host, SIM_ZHOST != SIM_ZHELIO(sn)

   SALT2mu.c : 
      refactor to allow doing Hubble fit with one z-bin and floating
      cosmo params.  Works so far floating OmegaM with wde fixed to -1.
      See new cosPar array (OL,Ok,wde,wa) passed to cosmodl, rombint,
      and inc functions.

      Read optional simfile_bias=<fileName> from input file; used to
      apply mB-bias vs. redshift correction to fit model.

      Next version will process "simfile_ccprior" to get CC prior,
      and test floating both OM and wde.


# ======================================================================= 
         v10_42e (Jan 29 2016) 

         ***** IMPORTANT(v10_42e) ***** 

         ***** USEFUL(v10_42e) ***** 

   Makefile: add -O1 optimizer 

         ***** MISCELLANEOUS(v10_42e) ***** 

   NEARNBR_pipeline.pl : remove APPEND_FITRES key from REF and TRAIN

   snana.car: add NN_FRAC_CELL to ascii fitres file.


# ======================================================================= 
         v10_42f (Feb 8 2016) 

         ***** IMPORTANT(v10_42f) ***** 

         ***** USEFUL(v10_42f) ***** 

         ***** MISCELLANEOUS(v10_42f) ***** 

   sntools_output_root.c: 
       in SNTABLE_READPREP_ROOT, add missing return(NVAR) at end. 
       This bug was tripped up by the recent -O1 optimization, but
       amazingly seemed to work on other machines

       Add MJD to SNLCPAK tree, so that we don't have to use the 
       clumsy method pf MJD = PEAKMJD+TOBS.
 
      

# ======================================================================= 
         v10_42g (Feb 19 2016) 

         ***** IMPORTANT(v10_42g) ***** 

   SALT2mu.c : major refactor and update to implement BEAMS-like
               fit using simulation to define the CC prior.
               See new inputs: simfile_ccprior and varname_p1a
               
         ***** USEFUL(v10_42g) ***** 

   New plotting function $SNANA_DIR/util/ovdatamc.py (by D.Jones)
   operates on ascii FITRES files from data and sim.
   Overlays simulation separately for SNIa and SNCC.

   snana.car: new SNLCINP namelist SIMLIB_OUT = 'bla.simlib'
              will create simlib file from data.

         ***** MISCELLANEOUS(v10_42g) ***** 

  snlc_sim.c, sntools_host.c:
     New sim-input key
        HOSTLIB_GALID_PRIORITY: 0 500000
     to give priority to GALID range.

     Fix minor bug in gen_AV() [found by D.Jones]

  split_and_fit.pl : new key SALT2mu_SIMVERSION to pass simFile
                     to SALT2mu program (for bias cor and CCprior).


# ======================================================================= 
         v10_42h (Feb 23, 2016) 

         ***** IMPORTANT(v10_42h) ***** 

         ***** USEFUL(v10_42h) ***** 

         ***** MISCELLANEOUS(v10_42h) ***** 

   split_and_fit.pl : add new key 
      SALT2mu_SIMVERSION: <version>
           or
      SALT2mu_SIMVERSION: <iversion>  ! integer list number

  snlc_fit.car: 
     in function  INIT_TABLE_SNFITEP, always tack on extra 
     epoch variables (PSF, ZP, etc ...) if
                 +RESIDUALS is specified.

  sntools_nearnbr.c[h]: refactor NEARNBR_GETRESULTS to return
      list of trueTypes and NCELL for each type. Allows getting
      prob for each type or group of types.

  snlc_sim.c[h] : 
     add new key  GENGAUPEAK_AV to allow Gaussian to peak away 
     from zero (Request by D.Jones). Other key changes to better
     names,
           GENTAU_AV -> GENEXPTAU_AV
           GENSIG_AV -> GENGAUSIG_AV
     Both the old and new key names are allowed.

   
  snana_manual.pdf : new section 12.1.5 about ovdatamc.py


# ======================================================================= 
         v10_42i (Feb 29 2016) 

         ***** IMPORTANT(v10_42i) ***** 

         ***** USEFUL(v10_42i) ***** 

   SALT2mu.c : minor refactor and finish getting CCprior to work.
               sigmB is computed using a 1a-chi2 from a subset
               with probCC/Prob_SUM < 0.10 .

         ***** MISCELLANEOUS(v10_42i) ***** 

   snlc_sim.c : new sim-input key 
        SALT2BETA_cPOLY:  b0 b1 b2
      --> beta = b0 + b1*c + b2*c^2
      works with GENSIGMA_SALT2BETA:  sig-     sig+
                 GENRANGE_SALT2BETA:  betamin  betamax



# ======================================================================= 
         v10_42j (Mar 13 2016) 

         ***** IMPORTANT(v10_42j) ***** 

         ***** USEFUL(v10_42j) ***** 

         ***** MISCELLANEOUS(v10_42j) ***** 

   snlc_sim.c : 
     + fix a few compilation bugs found by C.Lidman
     + fix bug writing SKY_SIG_T to data files.
       Both SKY_SIG and SKY_SIG_T are written in FLUXLCAL/pixel units.

     + remove MODEL_non1a and change MODEL_NON1A -> MODEL_NON1ASED
         [to prepare for new MODEL_NON1AGRID]

   split_and_fit.pl : minor fix to make sure "Done." is not
                      written until all merging is finished.

   sim_SNmix.pl: minor fix with SIMnorm done logic to make
                 sure that norm-log is complete before checking it.

 
  snana_manual.pdf & snana_install.pdf :
    Fix section about how to compile with/without HBOOK or ROOT.
    See Sec 4 of install guide and Sec 12 of manual.
    Thanks to Seppo for finding these inconsistencies.


# ======================================================================= 
         v10_42k (Mar 15, 2016) 

         ***** IMPORTANT(v10_42k) ***** 

         ***** USEFUL(v10_42k) ***** 

         ***** MISCELLANEOUS(v10_42k) ***** 

   remove genmag_non1a.c[h] and all '_non1a' references in Makefile.

   Refactor sntools_grid.c -> sntools_gridgen.c & sntools_gridread.c
   and compile each [instead of including]. Including only works if
   one genmag_xxx function does, but now genmag_snoopy.c and 
   genmag_NON1AGRID.c conflict if they both include sntools_gric.c.
 
   Finish genmag_NON1AGRID.c[h] to handle new NON1AGRID model.
   See new manual section 9.6.

                      size (MB)
       program    v10_42j  -> v10_42k
     snana.exe      193    ->  193
     snlc_fit.exe   379    ->  379
     snlc_sim.exe   335    ->  335
     psnid.exe      153    ->  153


# ======================================================================= 
         v10_42l (Mar 19, 2016) 

         ***** IMPORTANT(v10_42l) ***** 

         ***** USEFUL(v10_42l) ***** 

         ***** MISCELLANEOUS(v10_42l) ***** 

   snlc_sim.c : 
     + refactor with new function genamg_offsets() so that 
       GENRANGE_PEAKMAG can be applied before digitization. 
       Unfortunately there is no speed-up for NON1A model.
     + Fix bug related to SIMLIB_NREPEAT option.
     + new sim-input key GENMAG_OFF_NON1A = GENMAG_OFF_GLOBAL
       only for NON1A. Useful with sim_SNmix to apply a mag offset
       only to the NON1A without changing the SNIa.
   
     + new default area for NON1AGRID models under
          $SNDATA_ROOT/models/NON1AGRID/

   sim_SNmix.pl, NEARNBR_pipeline.pl :
      few tweaks to work with NON1AGRID model and SIMLIB_NREPEAT option.

   manual:  SIMLIB_NREPEAT option.


# ======================================================================= 
         v10_42m (Mar 24, 2016) 

         ***** IMPORTANT(v10_42m) ***** 

         ***** USEFUL(v10_42m) ***** 

         ***** MISCELLANEOUS(v10_42m) ***** 

   snlc_sim.c: fix  DNDZ_SCALE_NON1A to work with NON1AGRID model.

   snlc_sim.h: add new typedef structures INPUTS_NON1ASED_DEF and
               GENLC_NON1ASED_DEF. To be used in next snana version
               with refactor. Goal is to clean up NON1ASED spaghetti.

   SALT2mu.c : add bias correction to x1 and c.

   genmag_NON1ASED.c : add "#define SNGRIDGEN" to include critical code.
                       Affects making NON1AGRID after recent refactor.

   

# ======================================================================= 
         v10_42n (Mar 25 2016) 

         ***** IMPORTANT(v10_42n) ***** 

         ***** USEFUL(v10_42n) ***** 

         ***** MISCELLANEOUS(v10_42n) ***** 

   snlc_sim.c, genmag_NON1ASED.c[h] :
      Refactor to clean up spagetti in genmag_NON1ASED.c ; see usage
      of typedef structures INPUTS_NON1ASED and GENLC_NON1ASED.

      Default sim-input keys are now "NON1ASED:" and "NON1ASED_KEYS:",
      but the legacy keys (NON1A & NON1A_KEYS) are still accepted.
      New sim-input key 
          PATH_NON1ASED: <path>
      specifies an alternate location for the NON1ASED files.
      NON1A_ROOT and SNSED_PATH are no longer valid keys or ENV.


# ======================================================================= 
         v10_42o (Apr 1 2016) 

         ***** IMPORTANT(v10_42o) ***** 

         ***** USEFUL(v10_42o) ***** 

         ***** MISCELLANEOUS(v10_42o) ***** 

   SALT2mu.c : 
      more devel, write out [prefix].M0DIF file.
      fitflag_sigmb=2 now uses log(sigma) term for each iteration;
      works fine if also making bias correction.

   sntools_output.c[h]: 
    + MXVAR_TABLE -> 240 (was 200)  to handel FITRES+RESIDUALS
        with photo-z fit
    + use NVAR_ADDCOL_TOT to abort when MXVAR_TABLE is exceeded.

   snana.car :
    +  add lots of char-len checking for $SNDATA_ROOT,
       $SNANA_DIR and auxiliary filenames.
    + fix bug in INIT_FUDGE_FLUXCAL by replacing
       cFILE*100 -> cFILE*(MXCHAR_FILENAME)
       [bug found by A.Moller]


# ======================================================================= 
         v10_42p (Apr 9, 2016) 

         ***** IMPORTANT(v10_42p) ***** 

         ***** USEFUL(v10_42p) ***** 

         ***** MISCELLANEOUS(v10_42p) ***** 

    SALT2mu.c: more devel using bias corrections.

    snlc_sim.c, sntools_fitsio.c
       Fix minor bug so that SIM_MAGSMEAR_COH is written out
       for NON1AGRID model as well as NON1ASED model.

       New SIMLIB header keys GENRANGE_SALT2c and GENRANGE_SALT2x1
       to allow selecting specific c & x1 for each LIBID.

    sntools_genSmear.c: fix awful bug in get_genSmear_COH();
       had MAGSMEAR=ranGaus instead of sigma*ranGaus ,
       and thus COH smear was ~1 instead of 0.12.

    split_and_fit.pl: new key SALT2mu_BIASCOR_PATH, 
       which is set by NEARNBR_pipeline.pl .


# ======================================================================= 
         v10_43 (April 14 2016) 

         ***** IMPORTANT(v10_43) ***** 

         ***** USEFUL(v10_43) ***** 

         ***** MISCELLANEOUS(v10_43) ***** 
  
   init_SEARCHEFF_zHOST: 
      if HOSTEFF keys not found, read again as 2-column file 
      with no keys. Allows reading same file format as
      HOSTLIB_ZPHOTEFF_FILE.
                         
   NEARNBR_pipeline.pl : 
     add optional SYMLINKS_FLAG key so that symlinks can be
     turned off.

   SALT2mu_fit.pl  : revive it to work again.

  snlc_sim.c: need to refactor to prepare for reading c,x1
       from SIMLIB header. Move gen_shapepar() into gen_event()
       before the SIMLIB_read call, instead of after.
       This refactor changes the random sync, so all of the
       SIMGEN-related SNANA_tester jobs fail. In the next snana 
       version,  will continue debugging the c,x1 read from header ... 
       here I just want to release this versino ASAP so that the
       SNANA_tester script is usable again.

  Next version, also Need to clarify in manual that
     HOSTLIB_ZPHOTEFF_FILE: --> for host photo-z 
          (does NOT set bit 4 of SIM_EFFMASK)
     SEARCHEFF_zHOST_FILE   --> for host spec-z
          (does set bit 4 of SIM_EFFMASK)


# ======================================================================= 
         v10_43b (Apr 14 2016) 

         ***** IMPORTANT(v10_43b) ***** 

         ***** USEFUL(v10_43b) ***** 

         ***** MISCELLANEOUS(v10_43b) ***** 

   snlc_sim.h:
      SIMLIB_MXGEN_LIBID -> 1000 (was 10,000) to speed up

   snlc_sim.c: finish debugging update to read GENRANGE_XXX and
     GENSIGMA_XXX keys from SIMLIB header. Works for PEAKMJD,
     SALT2x1, SALT2c. 

   

# ======================================================================= 
         v10_43c (Apr 20 2016) 

         ***** IMPORTANT(v10_43c) ***** 

         ***** USEFUL(v10_43c) ***** 

   wfit.exe : 
     If MUDIF & MUDIFERR columns are specified in fitres file,
     then internally set MU = MU(ref) + MUDIF, where MU(ref)
     is computed from -wref and -omref. Allows fitting a 
     MU-residual file, such as from the output of SALT2mu.

   SALT2mu.exe :
      If simfile_ccprior=H11 then use Hlozek 2011 form of CC prior
      in which mu(z) -> mu(z) + polynomial(z).


         ***** MISCELLANEOUS(v10_43c) ***** 

   SALT2mu.exe
     + fix parsing bug so that FITOPT: keys with really long file names
       are also skipped.

   snlc_sim.c, sntools.c[h]:
      New option with asymmetric Gaussian to define grid,
          GENGRID_XXX:  <NGRID>


# ======================================================================= 
         v10_43d (April 26, 2016) 

         ***** IMPORTANT(v10_43d) ***** 

         ***** USEFUL(v10_43d) ***** 

         ***** MISCELLANEOUS(v10_43d) ***** 

  snlc_sim.c : few fixes for GENGRID_XXX option.

  snana.car : add SIMalpha to output tables for sim.

  NEARNBR_pipeline.pl : add two new stages 
     fit BIASCOR (allows alpha,beta bins)
     fit CCPRIOR (fit CC subset in REF

  SALT2mu.c: more devel so that biasCor also depends on alpha,beta.



# ======================================================================= 
         v10_43e (April 26 2016) 

         ***** IMPORTANT(v10_43e) ***** 

         ***** USEFUL(v10_43e) ***** 

    New non-linearity package for simulation; see sim-input key
      NONLINEARITY_FILE:  <fileName>

         ***** MISCELLANEOUS(v10_43e) ***** 

    new source code files  sntools_nonlinearity.c[h]


# ======================================================================= 
         v10_43f (May 3 2016) 

         ***** IMPORTANT(v10_43f) ***** 

         ***** USEFUL(v10_43f) ***** 

         ***** MISCELLANEOUS(v10_43f) ***** 

   kcordump.cra: add args K_xy and REST_COLOR. See top of file for syntax.
                 AVwarp now computed from REST_COLOR.

   SALT2mu.c : add more error checking on indices


# ======================================================================= 
         v10_43g (May 9, 2016) 

         ***** IMPORTANT(v10_43g) ***** 

         ***** USEFUL(v10_43g) ***** 

         ***** MISCELLANEOUS(v10_43g) ***** 

   snana.car & SALT2mu.c: Clean up SIMxxx names in output tables,
      SIMx1    -> SIM_x1
      SIMc     -> SIM_c
      SIMbeta  -> SIM_beta
      SIMalpha -> SIM_alpha
      SIM_mb   -> SIM_mB
      SIMZ     -> remove legacy variable
   so now they are all of the form SIM_xxx

   snana.car :
     + OPT_REFORMAT_FITS=3 will ignore bad epochs to determine
       PKMJDINI, but still include bad epochs in FITS output.
       See REFORMAT_SAVE_BADEPOCHS logical.

     + in SET_PEAKMJD, always apply bad-epoch mask (CHECK_EPOCH_IGNORE)
       to epochs used, to avoid using a crazy-large flux from a 
       bad epoch.


# ======================================================================= 
         v10_43h (May 17, 2016) 

         ***** IMPORTANT(v10_43h) ***** 

         ***** USEFUL(v10_43h) ***** 

         ***** MISCELLANEOUS(v10_43h) ***** 

   sntable_dump.pl: 
     + for hbook file, allow passing string-names of root tables
       SNANA or FITRES (translated back to ntuple IDs 7100 or 7788).

   snana.car:  
     + fix PKMJD in SNLCPLOT so that plot macro (snana#fitres)
       works properly for Bazin-like fit.

     + in subroutine SET_PKMJD, reject PSF>2'' epochs to compute
       FLUXMAX; avoids crazy estimate to find seed PKMJD for Bazin fit.

     + add FLUXCALMAX_[band] to snana table.

 
  SALT2mu.c : more refactor to include bias correction on muErr
              since the muRMS decreases after the muBias correction.


# ======================================================================= 
         v10_43i (May 24 2016) 

         ***** IMPORTANT(v10_43i) ***** 

         ***** USEFUL(v10_43i) ***** 

         ***** MISCELLANEOUS(v10_43i) ***** 

   snana.car : 
     + minor fix to PARSE_FILTSTRING

   snlc_fit.car
     + pass FLUXCAL_SIM to SNLCPAK

   sntools_output_root.c:  
     + include FLUXCAL_SIM in LCPLOT table.
 
   SALT2mu: 
     + lots of fiddling to biasCor correction,
       mainly to use bin-average instead of bin center
       for interpolation.


# ======================================================================= 
         v10_43j (May 31 2016) 

         ***** IMPORTANT(v10_43j) ***** 

         ***** USEFUL(v10_43j) ***** 

   SALT2mu: 
      fix bug using z,zERR[=zHELIO]: instead use zHD,zHDERR.
      See details below.

         ***** MISCELLANEOUS(v10_43j) ***** 

   snlc_sim.c: fix bug propagating nonLinearity feature.
               See "scale_nonLin".

   SALT2mu: 
     + reject event if any cov term is undefined (ie.., =-9)
     + fix bug reading z,zERR[=zHELIO] and read zHD,zHDERR.
       Not sure when this happened,probably during a refactor.
       zHD = zCMB for now, but eventually zHD could have a
       correction for v_pec.

   snana.car:
     + z,zERR no longer written to text output; added zCMB[ERR]
       to text-fitres output. For now zHD=zCMB, but eventually
       zHD could include a peculiar velocity correction.

   sntools_nonlinearity.c[h]: 
     + change model to use total flux (ignore readout rate).
     + write NONLIN info to sim-readme
     + add DUMPFLAG option in nonLinearity input file


# ======================================================================= 
         v10_43k (Jun 7 2016) 

  
         ***** IMPORTANT(v10_43k) ***** 

         ***** USEFUL(v10_43k) ***** 

   snana.car: add NEPOCH_BADPHOT to output tables;
              = NEPOCH rejected by PHOTFLAG_MSKREJ

         ***** MISCELLANEOUS(v10_43k) ***** 

   moved $SNDATA_ROOT to new disk on des41@fnag.gov

   SALT2mu_fit.pl: 
     new option  "WFITMUDIF_OPT: <wfit options>"
     to fit M0 vs. z with wfit.

   SALT2mu.c : finally working with biasCor, with perhaps
               ~1% bias on alpha & beta


   sntools_nearnbr.c : fix to work with either z:F or zHD:F

   sim_SNmix.pl :  at end of jobs, make SIMLOBS.tar of  misc logs;
                   then remove misc logs. Leave ALL.DONE and
                   SIMJOB_SUMMARY.

   split_and_fit.pl: 
      + default GZIP_FLAG=4 to create and gzip SPLIT_JOBS.tar


# ======================================================================= 
         v10_43l (Jun 11 2016) 

         ***** IMPORTANT(v10_43l) ***** 

         ***** USEFUL(v10_43l) ***** 

         ***** MISCELLANEOUS(v10_43l) ***** 

   SALT2mu.c : few more tweaks

   snana.car : new function CHECKSTRING_CCID to abort if SN name
               contains invalid char,  BADCHAR_LIST = ':;!@#$%^&*()=?'

   split_and_fit.pl : 
     + gzip SIMGEN.DAT file

    snlc_sim.c :
     + new function override_SNPARVAL_from_SNHOST() to fix bugs
       with the HOSTLIB_MKSOPT+=64 option to use SN params in HOSTLIB.


   To do: trap split_and_fit error if there is invalid variable
          in the APPEND_FITRES list.


# ======================================================================= 
         v10_43m (Jun 14 2016) 

         ***** IMPORTANT(v10_43m) ***** 

         ***** USEFUL(v10_43m) ***** 

         ***** MISCELLANEOUS(v10_43m) ***** 

   NEARNBR_pipeline.pl: allow VERSION_DATA to be data or sim

   sntools_nearnbr.c: fix bug and remove z:F . only check for zHD.

   snlc_sim.c : fix setting MAGSMEAR_COH to work for
          GENMAG_SMEAR:  0.13
          GENMAG_SMEAR_MODELNAME: COH
          GENMAG_SMEAR_MODELNAME: G10


# ======================================================================= 
         v10_44 (Jun 18, 2016) 

         ***** IMPORTANT(v10_44) ***** 

   Numerous LEGACY keys will cause abort -->
   Must cleanup up garbage keys.

         ***** USEFUL(v10_444) ***** 

         ***** MISCELLANEOUS(v10_44) ***** 

   Update input files in   $SNDATA_ROOT/sample_input_files/

   sntools_fitsio.c: always write SIM_MAGSMEAR_COH

   snlc_fit.c : fix bug for HOSTLIB containing c & x1;
                re-compute x0 and mB after override.

   sntools.c:
     + make better error message for non-uniform bins in 
       init_interp_GRIDMAP(). Note that error checks works
       only if 1st or last bin is off ... should be fixed
       to be more robust.


     Sim Legacy keys that now make abort:
        SPECTYPE:     	     --> no longer does anything
	HUMAN_SEARCHEFF_OPT: --> SEARCHEFF_SPEC_FILE:
	EXTINC_MILKYWAY      --> OPT_MWEBV
	GEN_SNDATA_SIM       --> FORMAT_MASK
	RVMW                 --> RV_MWCOLORLAW
	NGRID_LUMIPAR        --> NGRID_SHAPEPAR

     snana/snlc_fit legacy keys that are no longer allowed 
     and make abort:
        LTUP_SNANA        LTUP_FITRES        LTUP_RESIDUAL
        FITRES_DMPFILE    LDMP_SNFLUX        OPT_LCPLOT


# ======================================================================= 
         v10_44b (Jun 20 2016) 

         ***** IMPORTANT(v10_44b) ***** 

         ***** USEFUL(v10_44b) ***** 

         ***** MISCELLANEOUS(v10_44b) ***** 

   split_and_fit.pl: remove legacy arguments turning off legacy keys,
                     since this now causes abort.
     
   SALT2mu.c:     use ENVreplace to allow ENV in any input file name.
   SALT2mu_fit.pl allow ENV in the INPDIR arg.


# ======================================================================= 
         v10_44c (Jun 22 2016) 

         ***** IMPORTANT(v10_44c) ***** 

   Fix bug computing Efficiency in nearnbr_maxFoM.c.
   Purity calc was ok.
   --> Previous NN trainings were probably slightly
       off the true optimization. 

         ***** USEFUL(v10_44c) ***** 

         ***** MISCELLANEOUS(v10_44c) ***** 

   snlc_sim.c: 
     + no longer read snlc_sim.defaults input file.
     + fix "DNDZ: HUBBLE" (was aborting)

   SALT2mu.c, SALT2mu_fit.pl: few minor fixes.

   Major fixes in $SNDATA_ROOT/SNANA_TESTER/inputs :
    no longer uses info from snlc_sim.defaults

   sntools_nearnbr.c : compute Bayesian NN_PROB_IA accounting
       for NN cut. Keep NN_PTRAIN_IA = prob before NN cut
       which is used to select type.  Fix initialization bug
       that may have affected probabilities.


# ======================================================================= 
         v10_44d (June 23 2016) 

         ***** IMPORTANT(v10_44d) ***** 

         ***** USEFUL(v10_44d) ***** 

         ***** MISCELLANEOUS(v10_44d) ***** 

    sntools_nearnbr.c : undo changes in previous version.
 
    snlc_sim.c, sntools_trigger.c 
      + for specEff map, add variables HOSTMAG_[band] and SBMAG_[band].
        Should abort if proper HOSTLIB is not used.
      + for SIMGEN_DUMP, add SBMAG_[band]
      
    sntools_trigger.c :
      + abort on non-uniform bins in spec-eff map.


# ======================================================================= 
         v10_44e (July 2 2106  ) 

         ***** IMPORTANT(v10_44e) ***** 

         ***** USEFUL(v10_44e) ***** 

         ***** MISCELLANEOUS(v10_44e) ***** 

   SALT2mu.c : 
      + few more tweaks, plus refactor.
      + add new input  to implement z-dependent biasCor
           opt_biascor=1  ! WGT=1 for <muBias>
           opt_biascor=2  ! WGT=1/MUERR^2 for <muBias>

   New utility code:  sntools_spectrograph.c[h]
     Called by kcor.c, but currently does nothing.
     Intended for WFIRST/IFU development, and to generate
     arbitrary spectra from follow-up instruments.


# ======================================================================= 
         v10_44f (Jul 5 2016) 

         ***** IMPORTANT(v10_44f) ***** 

         ***** USEFUL(v10_44f) ***** 

         ***** MISCELLANEOUS(v10_44f) ***** 

  snana.car: 
    + modify READ_FITS_HEAD to read optional spectrograph keys
    + modify GET_FILTMAP to have new option to return list if
       synthetic filters defined by spectrograph

  SALT2mu.c: new input arg sigma_cell_biascor=50

  kcor.c, sntools_spectrograph.c[h]: more updates for IFU option.

  snlc_sim.c: 
    +   abort on legacy key "SMEARFLAG_HOSTGAL:"
    +   check for spectrograph filters in kcor_ini()

  sntools_spectrograph.c[h] : more devel work.


# ======================================================================= 
         v10_44g (July 7 2016) 

         ***** IMPORTANT(v10_44g) ***** 

         ***** USEFUL(v10_44g) ***** 

         ***** MISCELLANEOUS(v10_44g) ***** 

  kcor.c, sntools_spectrograph.c[h] : more development.
  snlc_sim.c: refactor SIMLIB_read() to allow for SPECTROGRAPH option.


# ======================================================================= 
         v10_44h (Jul 17, 2016) 

         ***** IMPORTANT(v10_44h) ***** 

         ***** USEFUL(v10_44h) ***** 

   SNTABLE_LIST = 'SNANA FITRES  NOSIMVAR'  will suppress all SIM_xxx
        variables in table output; see manual.

         ***** MISCELLANEOUS(v10_44h) ***** 

   SALT2mu_fit.pl :  
     + add  command-line arg  NOPROMPT 
     + allow fit-option after each INPDIR specific only to that INPDIR.
       First use is to have a unique simfile_biascor for each INPDIR.

   SALT2mu.c : new inputs  
        binscale_x1_biascor=1.0
        binscale_c_biascor=1.0
       and lots of tweaking the 5D interpolation

   snana.car :
     + fix INIT_SNTABLE to bail if any reformat option is set.
     + remove obsolete analysis variables SIM_AVTAU & SIM_AVRV
     + remove obsolete &SNLCINP input LSIM_BLINDTEST
     + add 'NOSIMVAR' option to SNTABLE_LIST; to suppress SIM_xxx output

   split_and_fit.pl:  can use wild-card for simulated versions,
                       VERSION:  MYSIMJOBS_TEST*

   sim_SNmix.pl : abort if comment appears on same line as GENOPT key

   genmag_SALT2.c[h]: 
      add RV_host and AV_host argument to genmag_SALT2() to allow
      simulating Kaisey's BAYESN model that includes host extinction
      on top of SALT2 model. Call new function fill_TABLE_HOSTXT_SEDMODEL
      to efficiently compute and store host XT vs. lambda.

   genmag_SEDtools.c[h]: 
     + new function fill_TABLE_HOSTXT_SEDMODEL(RV,AV,z)

   sntools_fitsio.c
     + no longer write SIM_AVTAU (since it's a constant population param)


# ======================================================================= 
         v10_44i (July 19, 2016) 

         ***** IMPORTANT(v10_44i) ***** 

         ***** USEFUL(v10_44i) ***** 

         ***** MISCELLANEOUS(v10_44i) ***** 

   snlc_sim.c: 
     run valgrind debugger and fix a few things, including a memory 
     leak in genmag_SEDtools.c, from fill_TABLE_HOSTXT_SEDMODEL()
     that was added last SNANA version.

   snana.car: 
     + remove obsolete SNLC_FITCID(MXSNLC) array (12 MB).
     + fix small bug in GET_FILTMAP by adding RETURN statements.

   sntools_output_text.c :
     + reove obsolete OVERRIDE variables and functions.
     + fix subtle bug loading CVAL from .ptr_C .


# ======================================================================= 
         v10_44j (July 22, 2016) 

         ***** IMPORTANT(v10_44j) ***** 

         ***** USEFUL(v10_44j) ***** 

   sntable_dump.pl[c] : allow "--o stdout" to dump output to screen.

         ***** MISCELLANEOUS(v10_44j) ***** 

   SNANA_tester.pl : SNTABLE_DUMP_xxx tests are done last to make
                     sure all fitting jobs finish to produce the
                     input HBOOK or ROOT file.

   SALT2mu.c : 
     + more refactoring to implement biasCor vs. IDSAMPLE.
     + CCprior is now a function of IDSAMPLE.
     + errmask_write=-9 --> suppress SN lines in fitres output file.

   sntools_genSmear.c :  
     for BIMODAL_UV (Milne15) model, MAGU_SPLIT -> 0.55 (was 0.65) 
     to better match M15 paper.                        

   sim_SNmix.pl: fix bug so that CIDOFF is used when NOT using
                 the CIDRAN feature.
 

# ======================================================================= 
         v10_44k (July 29 2016) 

         ***** IMPORTANT(v10_44k) ***** 

         ***** USEFUL(v10_44k) ***** 

         ***** MISCELLANEOUS(v10_44k) ***** 

   snlc_sim.c[h]:
     + remove obsolete GENMODEL_TWEAK input and associated code.

     + re-factor for spectra: randoms for Poisson noise moved
       before GETMAGS, so one SNANA_tester job is different:
           059-SIMFIT_FUDGE_SNRMAX:
     + spectrograph spectra written to TEXT format only,
       and SNR=10 is hard-wired. Next version, need to compute
       SNR from the user-input SPECTROGRAPH table.
 
   genmag_SALT2.c[h]: refactor for spectrograph.
  
   sntools_output_text.c: 
      abort if repeated NVAR key has different value 
      compared to first NVAR key.

   sntools_genSmear.c : 
     + new utility exec_genSmear_override().
       use for existing VCR, and add new overrides for BIMODAL_UV.


# ======================================================================= 
         v10_44l (Aug 1 2016) 

         ***** IMPORTANT(v10_44l) ***** 

         ***** USEFUL(v10_44l) ***** 

     snlc_sim.c:  
       SPECTROGRAPH spectra written in TEXT format (but no in FITS).
       Works with SPECTROGRAPH key(s) in SIMLIB file.
       See "spectrograph" in manual.

     genmag_SALT2.c:
        in fill_SALT2_TABLE_SED(), check for uniform bins.
        Now catches missing LAM=8490 bin in SALT2.Guy10_UV2IR.

         ***** MISCELLANEOUS(v10_44l) ***** 

   Still do do for SPECTROGRAPH:
    + determine primaryMag(lambda) from interpolating/extrapolating
      primary mag vs. broadband-<lambda>
    + write in FITS format, and make it work with sim_SNmix
    + add feature to pick random spectra with +-DTSPEC of peak
    + define function Texpose(z) for random spectrum
      
# ======================================================================= 
         v10_44m (Aug 3 2016) 

         ***** IMPORTANT(v10_44m) ***** 

         ***** USEFUL(v10_44m) ***** 

         ***** MISCELLANEOUS(v10_44m) ***** 

   sntools_fitsio.c[h]:
    + write spectrograph spectra to separate SPEC.FITS file:
      See table descriptions in manual section 
          4.22 Simulating a SPECTROGRAPH.

      The three tables are
      TABLE 1: LAMINDEX  LAMMIN LAMMAX
               [wavelength map]

      TABLE 2: sumary table, one row per spectrum
                [SNID, MJD, Texpose, pointers to flux table]

      TABLE 3: INDEX_LAMBDA(I*2), FLUX(F), FLUXERR(F), 100*GENMAG(I2)
                [the BIG flux table]

      Disk Space for 1000 wavelength bins, 10 spec per SN, 10k event:
          (1000 x 10 x 10^4) x (2+4+4+2) =
          10^8 x 12 = 1.2 GB.
      Beware that FITS file limit is 2 GB for cfitsio version < 3.

    + Large scale test writing to FITS format: wrote
       * 46,000 events 
       * 184,000 spectra 
       * 64 million spec-flux rows
       * 777 MB  SPEC.FITS file

    + still to do:
        * generate spectra for NON1ASED model.
        * include host-galaxy noise
        * check compatibility with sim_SNmix (should work with no changes)
        * add option to pick random MJD_spec, with z-dependent Texpose        
        
# ======================================================================= 
         v10_44n (Aug 10 2016) 

         ***** IMPORTANT(v10_44n) ***** 

         ***** USEFUL(v10_44n) ***** 

         ***** MISCELLANEOUS(v10_44n) ***** 

   SALT2mu.c:
   + flag biasCor SNIa with SIM_NONIA_INDEX=0  instead of SIM_TYPE_INDEX=1.
   + for 1DZ option, allow interpolation past user zmax.

   snlc_sim.c[h] : 
     do NOT write filter-transmission files by default, since this
     consumes lots of ascii files. Add option with
       FORMAT_MASK:  288   # 32=FITS, 256=write filterTrans
     The filter-trans files were written only for non-SNANA
     programs, since SNANA programs do not use this.


# ======================================================================= 
         v10_44o (Aug 14 2016) 

         ***** IMPORTANT(v10_44o) ***** 

         ***** USEFUL(v10_44o) ***** 

         ***** MISCELLANEOUS(v10_44o) ***** 

   sim_SNmix.pl : comment out code that copies .FILTERS subDir.

   snlc_sim.c : 
     + allow new PEC1A keys in sim-input file and NON1A.LIST
       --> include peculiar SNIa in NON1ASED model.
       Note separate DNDZ_PECIA: key to specify different
       rate-vs-redshift models for NON1A and PEC1A.

       See manual section 9.5.1


# ======================================================================= 
         v10_44p (Aug 22 2016) 

         ***** IMPORTANT(v10_44p) ***** 

         ***** USEFUL(v10_44p) ***** 

         ***** MISCELLANEOUS(v10_44p) ***** 

   genmag_NON1A*  & snlc_sim.c :
     + more refactoring and updates so that NON1AGRID
       works with NON1A+PEC1A.

   SALT2mu.c: 
     + remove PROC(CC) re-scale based on NN cut.
     + new input key surveygroup_biascor
     + new input key surveylist_nobiascor='xxx,yyy'
     + protect input strings by removing quotes (' or ")
        file='bla.txt' and file=bla.txt both work.

   SALT2mu_fit.pl : add NOPROMPT option


# ======================================================================= 
         v10_44q (Aug 24 2016) 

         ***** IMPORTANT(v10_44q) ***** 

         ***** USEFUL(v10_44q) ***** 

         ***** MISCELLANEOUS(v10_44q) ***** 

   SALT2mu.c : lots of refactoring and updates to allow
               user-binning for biasCor.


# ======================================================================= 
         v10_44r (Aug 30 2016) 

         ***** IMPORTANT(v10_44r) ***** 

         ***** USEFUL(v10_44r) ***** 

   SALT2mu.c
     + new input key sigmb_biascor=bla
     + new input key powzbin so that fit zbinSize ~ (1+z)^powzbin

         ***** MISCELLANEOUS(v10_44r) ***** 
   SALT2mu.c:
     + refactor to sort SAMPLES in fixed order regardless
       of order in data.
     + new option opt_biascor=8 to make 1DZWGT corretion,
        but apply cut requiring 5D cor to exist.

   snana.car:  call ENVreplace(NEARNBR_TRAINFILE_PATH)
  
   split_and_fit.pl :
      + new input key  "WAIT_CHECK_DONE: xx"
      + if NSPLIT==1, use copy [cp] instead of merge job.


# ======================================================================= 
         v10_44s (Aug 31, 2016) 

         ***** IMPORTANT(v10_44s) ***** 

         ***** USEFUL(v10_44s) ***** 

         ***** MISCELLANEOUS(v10_44s) ***** 

   sntools.c[h]: 
     + add SKEWNORMAL option to input distributions.
     + leave blank funtion skewNormalGauss(par[3]) to be
        completed in next version.

   snlc_sim.c[h]: some refactoring for SKEWNORMAL.



# ======================================================================= 
         v10_44t (Sep 1 2016) 

         ***** IMPORTANT(v10_44t) ***** 

         ***** USEFUL(v10_44t) ***** 

         ***** MISCELLANEOUS(v10_44t) ***** 

   SALT2mu.c :  new opt_biasCor bit-option for MUCOV scale,
                to allow turning it off.

   genmag_SALT2.c: fix genSpec to bail when Trest is outside epoch range.

   snlc_sim.c : add spectrograph feature to FIXRAN model.

   snana.car: fix string declarations in get_primary and get_filttrans
               [called by simulation].  


# ======================================================================= 
         v10_44u (Sep 2 2016) 

         ***** IMPORTANT(v10_44u) ***** 

         ***** USEFUL(v10_44u) ***** 

         ***** MISCELLANEOUS(v10_44u) ***** 

   Lots of reFactoring to incorporate skewNormal distribution
   into simulation. Added new code files,
      sntools_genGauss_asym.c[h]
      skewNormal.c

   The skewNormal.c file has template functions,
   but python calls still need to be added to make it 
   work on XXX with the following sim-input key
     GENSKEWNORMAL_XXX:  <loc> <scale> <skew>
  

# ======================================================================= 
         v10_44v (Sep 5 2016) 

         ***** IMPORTANT(v10_44v) ***** 

         ***** USEFUL(v10_44v) ***** 

         ***** MISCELLANEOUS(v10_44v) ***** 

   snlc_sim.c : 
    + add missing return(SNsum) in SNcount_model().

   sntools_spectrograph.c[h] and kcor.c :
     + add spectral rebinning option with kcor key
         SPECTROGRAPH:  file(rebin=3)
       [see manual update]
   
   SALT2mu.c : 
     + add input key  host_logmass_split and re-purpose p5 & u5 
       [gamma] to represent the host mag offset. 
       NOT TESTED YET.


# ======================================================================= 
         v10_44w (  ) 

         ***** IMPORTANT(v10_44w) ***** 

         ***** USEFUL(v10_44w) ***** 

  split_and_fit.pl:  
    + new input  "FITOPT: ->FITOPT000"
      to make symbolic link instead of running job.
    + allow comment string after FITOPT, e.g.,
          FITOPT: OPT_COVAR 1  # use model covar
    + Add VPEC_FILE to list of COPY_INPUTFILE_KEYS (not tested!)


   SALT2mu.c: 
     + finish debugging host_logmass used to fit
           gamma = magoff(host_logmass).

     + new input keys:
            zpecerr     vpecerr (km/sec)    lensing_zpar 
            iflag_duplicate 
       Legacy key 'pecv = zpecerr' is still allowed. 

     + iflag_duplicate=0  ! print duplicates, but take no action
     + iflag_duplicate=1  ! default => abort on duplicate
     + iflag_duplicate=2  ! merge duplicates by averaging SALT2 params

         ***** MISCELLANEOUS(v10_44w) ***** 

  SALT2mu_fit.pl : fix bug related to grepping FITOPT000.

  skewNormal update from EJ:
       snlc_sim.c sntools_genGauss_asym.c skewNormal.c

  sntools_output.c[h]: allow reading a column into two separate
         arrays ... for SALT2mu to read CUTWIN variable that has
         already been read. 


# ======================================================================= 
         v10_44x (Sep 23 2016) 

         ***** IMPORTANT(v10_44x) ***** 

   SALT2mu:
     + fix bug computing chi2/dof to get sigma_int.
         [NDOF was NSN - NZ - MXCOSPAR, with MXCOSPAR=20]

         ***** USEFUL(v10_44x) ***** 

    snlc_fit.car:
      + new &FITINP cuts on fitted covariances.  
        To avoid crazy fits, default cuts are
          FITWIN_MB_ERR      =  0.0 ,  1.0
          FITWIN_COV_OFFDIAG = -8.0 , +8.0

        Other optional fit-err cuts are
          FITWIN_MJD_ERR, FITIN_SHAPE_ERR, FITIN_COLOR_ERR

   SALT2mu:
     + new input option min_per_zbin (default=5) --> drop z-bins
       with fewer than this many.

         ***** MISCELLANEOUS(v10_44x) ***** 

    SALT2mu.c:  
      + fixes for 1D cor with multiple IDSAMPLEs

    wfit.c: H0->70 (was 65) 


# ======================================================================= 
         v10_45 (  ) 

         ***** IMPORTANT(v10_45) ***** 

         ***** USEFUL(v10_45) ***** 

         ***** MISCELLANEOUS(v10_45) ***** 

  snlc_sim.c : 
   + fix abort bug when generating only shallow fields
                [NOBS_SKIP logic]
   + fix bug related to GENGAUSS_NGRID in sntools_genGauss_asym.c

  SALT2mu.c : 
   + more clear blinding message for data, and give BLINDPAR and 
     COS(z*BLINPAR) function to allow other programs to un-do 
     blind offset.
   + Fix a few dumb parsing bugs for lensing_zpar & 
   + add input snrmin_siginit_biascor
   + u5 and u6 fit gamma0 and gamma1 (z-dependence on host step)
   + u7 and u8 -> logmass_cen & logmass_tau for FermiFunc
        [input host_logmass_split is now obsolete]
   + "CUTWIN(NOABORT) BLA min max" will not abort if BLA is
        missing from any of the data/biascor/CCprior files.
   + few fixes for alpha1 and beta1 (z-slopes for alpha & beta)
     to work with 5D biasCor. WARNING: not well tested.

  SALT2mu_fit.pl: 
    + new input key OUTDIR_PREFIX
    + fix bug parsing STRINGMATCH_IGNORE



# ======================================================================= 
         v10_45b (Oct 17 2016) 

         ***** IMPORTANT(v10_45b) ***** 

         ***** USEFUL(v10_45b) ***** 

         ***** MISCELLANEOUS(v10_45b) ***** 
   
    SALT2mu.c: few fixes. 
    sntools_spectrograph.c[h]: read LAMRES_LIST, write to fits.
    snlc_sim.c : implement spectral smear with LAMRES_LIST.


# ======================================================================= 
         v10_45c (Oct 19 2016) 

         ***** IMPORTANT(v10_45c) ***** 

         ***** USEFUL(v10_45c) ***** 

         ***** MISCELLANEOUS(v10_45c) ***** 

   snlc_sim.c[h], sntools_spectrograph.c[h]: 
     + update GENSPEC_xxx functions.
     + new sim-input key SPECTROGRAPH_OPTMASK: <mask>
        (see new manual section 4.22.1)


# ======================================================================= 
         v10_45d (Oct 25 2016) 

         ***** IMPORTANT(v10_45d) ***** 

         ***** USEFUL(v10_45d) ***** 

         ***** MISCELLANEOUS(v10_45d) ***** 

   snlc_sim.c[h], sntools_spectrograph.c[h], manual:
     + add option to inflate noise from template subtraction.
       See manual section 4.5.2 .


# ======================================================================= 
         v10_45e (Oct 28 2016) 

         ***** IMPORTANT(v10_45e) ***** 

         ***** USEFUL(v10_45e) ***** 

         ***** MISCELLANEOUS(v10_45e) ***** 

   sntools_spectrograph.c:
     + fix bug in get_FILTERtrans_spectrograph() to protect 
       interpolation at edges.

   snlc_sim.c:
     + fix abort-bug in init_zvariation() by defining SKEWNORMAL[0,1,2]
       SKEWNORMAL still doesn't work, but has to be defined as part
       of the GENGAUSS_ASYM structure.
     + allow correlated template noise from both normal filters
       and from synthetic spectrograph filters.


# ======================================================================= 
         v10_45f (Nov 18 2016) 

         ***** IMPORTANT(v10_45f) ***** 

         ***** USEFUL(v10_45f) ***** 

         ***** MISCELLANEOUS(v10_45f) ***** 

   snlc_sim.c :
    + fix bug writing NVAR to ascii format; now includes SIM_MAGOBS.
      Before, SIM_MAGOBS was not read in ascii format.
    + fix bug setting SKYSIG_T for spectrograph; now it's scaled
      by ratio of Search/template exposure times.
    + update NON1ASED model to work with SPECTROGRAPH. 
      Quite a bit of re-factoring in genmag_NON1ASED.c and
      genmag_SEDtools.c

      BEWARE THAT SPECTROGRAPH WAS DEBUGGED WITH GAIN=1;
      MAY NEED FIXING FOR GAIN > 1.


# ======================================================================= 
         v10_45g (Nov 22 2016) 

         ***** IMPORTANT(v10_45g) ***** 

         ***** USEFUL(v10_45g) ***** 

         ***** MISCELLANEOUS(v10_45g) ***** 

   SALT2mu.c : add 1/0 protection for bias errors.

   snlc_fit.car, genmag_SALT2.c[h]:
      + new table option to store spectrum for each epoch,
           SNTABLE_LIST = 'FITRES SPECTRA'

   snlc_sim.c :
     new input keys to fudge errors in mag-space,
        FUDGE_MAGERR:  .02  ! add .02 magErr to all epochs
          or
        FUDGE_MAGERR_FILTER: gr .01   ! add .01 err to g & r only


# ======================================================================= 
         v10_45h (Dec 1, 2016) 

         ***** IMPORTANT(v10_45h) ***** 

         ***** USEFUL(v10_45h) ***** 

         ***** MISCELLANEOUS(v10_45h) ***** 

   SALT2mu.c : 
     + replace parab errors with MINOS errors that are a bit larger,
       particularly when stats are low.
    
     + add input key "maxprobcc_for_sigint" and fix fcn bug
       that effectively multiplied this by 0.15/sqrt(2pi) = 0.375.
     + use weighted chi2 and weighted Ndof to get sigma_int
        for BEAMS LH.

   snlc_sim.c :
     + add MJDMIN and MJDMAX to simlib-dump file
         (for 'SIMLIB_DUMP 1' option)

   snana.car: 
     + PARSE_WORDS now splits on space or comma.
     + new option  HEADER_OVERRIDE_FILE to override
       header values such as VPEC, LOGMASS, etc ...
       See new manual subsection 5.27
     + refactor functions REDSHIFT_HD() and RD_VPEC_FILE().
       REDSHIFT_HD() now works no matter how VPEC is computed
       or read in.
     + always include VPEC, VPEC_ERR in tables.

  snlc_fit.car: 
     + fix index bug computing inputs to SPECTRA table.


# ======================================================================= 
         v10_45i (Dec 7 2016) 

         ***** IMPORTANT(v10_45i) ***** 

         ***** USEFUL(v10_45i) ***** 

         ***** MISCELLANEOUS(v10_45i) ***** 

   sim_SNmix.pl : abort if all RANSEEDS are same but 
                  CIDran bit is not set.

   SALT2mu.c: 
     + little re-factoring in fcn so that all of the
       iflag==3 stuff is in one place.
     + misc fixes & refactoring to apply min_per_zbin cut
       to include biasCor=exist cut.
   
   SALT2mu_fit.pl : 
     + bug-fix to exec SNANA_LOGIN_SETUP using NODELIST
     + write code-parsable summay to FITJOBS_SUMMARY.DAT
         (using fitres-format)


   sntools_output_text.c, combine_fitres.c
     + allow VERSION column as char

   snana.car: 
     + add SNLCINP input  MAGCOR_FILE to apply mag correction
       to every epoch without re-making data files.


# ======================================================================= 
         v10_45j (Dec 15 2016) 

         ***** IMPORTANT(v10_45j) ***** 

         ***** USEFUL(v10_45j) ***** 

    SALT2mu.c:  new opt_biascor bit 128 --> use only 2x2 alpha x beta grid
                corresponding to boundary nodes.

    snlc_sim.c new DNDZ options "CC_S15" and "CC_MD14".
               See manual section on volumetric rates.

         ***** MISCELLANEOUS(v10_45j) ***** 


# ======================================================================= 
         v10_45k (Jan 8 2017) 

         ***** IMPORTANT(v10_45k) ***** 

         ***** USEFUL(v10_45k) ***** 

    NEW PROGRAM   "sntable_combine.c"


         ***** MISCELLANEOUS(v10_45k) ***** 

   snana.car : 
    +remove obsolete "ZEXTRA_SOURCE" and all associated variables 
     and code (PARSE_ZEXTRA). Alternate redshifts can be added
     with the HEADER_OVERRIDE_FILE feature.
               
   sntools.h:  add ZMAX_SNANA parameter

   SALT2mu.c:  refactor with SIGINT -> another name to avoid
                conflict with Mac that defines SIGINT.

   split_and_fit.pl : 
     + add CLEAN option to remove un-needed files created by
       split_and_fit. Works on all subDirs under where command
       is run, so no input file is given.
    
  snlc_sim.c: command line override now works for
        GENMODEL  NON1AGRID <FILENAME>               
        GENMODEL  RANMAG    <RANMAG>
        GENMODEL  FIXMAG    <FIXMAG>

  sim_SNmix.pl:
     + for Ia, remove GENOPT with NON1a keys.
     + for NONIa, remove GENOPT with Ia keys.
     + if simulating only Ia and there are duplicate GENOPT,
       then make symLinks instead of wasting CPU to re-generate.
       Intended use is redundant BIASCOR-Ia withing NEARNBR script.

  sntools_output.c[h]: 
    + update AUTOSTORE feature to hold multiple files. Needed for
      new sntable_combine program.

  sntable_combine.c : NEW PROGRAM
    + combine multuple table files into one. Analogous to
      combine_fitres (for ascii only), but this new program
      works with any format (root,hbook,text).


# ======================================================================= 
         v10_45l (Jan 8 2017) 

         ***** IMPORTANT(v10_45l) ***** 

         ***** USEFUL(v10_45l) ***** 

         ***** MISCELLANEOUS(v10_45l) ***** 

   snlc_sim.c, sntood_grid* :
    + for NON1AGRID, fix to pass user SNTAG to GRID so that
      correct SNTYPE appears in simulation.

   remove debug flag Makefile (accidentally left in last version)


# ======================================================================= 
         v10_45m (Jan 11 2017) 

         ***** IMPORTANT(v10_45m) ***** 

         ***** USEFUL(v10_45m) ***** 

         ***** MISCELLANEOUS(v10_45m) ***** 

   nearnbr_apply.c:  new program to read data file and
                     apply NN. 

   sntools.c:  fix trim_blank_spaces to catch termination string so
               that it works on hbook files created from a C program.

   kcor.c, sntools,c: fix lots of compile errors found by MatS.

   genmag_SEDtools.c : fix return statement in init_primary_SEDMODEL().

 

# ======================================================================= 
         v10_45n (Jan 11 2017) 

         ***** IMPORTANT(v10_45n) ***** 

         ***** USEFUL(v10_45n) ***** 

         ***** MISCELLANEOUS(v10_45n) ***** 

   fix lots more compile bugs found by MatS.


# ======================================================================= 
         v10_46 (Jan 16 2017) 

         ***** IMPORTANT(v10_46) ***** 

         ***** USEFUL(v10_46) ***** 

   kcor.c[h]: fixed to work without specifiying SNSED,
              if there are no K-corrections.

         ***** MISCELLANEOUS(v10_46) ***** 

   kcor.c : 
     + works witout SNSED if there are no K-corrections.
     + Can specify  "AB_SED:  bla.dat", analogous to BD17_SED key.

   all .c files: make with -Wall and fix all warnings.
   snana.car:    fix most warnings with -Wall.

   sntools_output.c[h]:
      + call TABLEFILE_CLOSE() at end of SNTABLE_AUTOSTORE_INIT().
    
   snana.car
     + RD_VPEC_FILE: abort on zero rows in VPEC_FILE
     + INIT_HEADER_OVERRIDE: abort on zero rows
     + few fixes to work with k-cor file that has no SN SED
     + add few missing array bound checks in RDKCOR_FITS_xxx routines.
     + extend MXLAMBIN from 3000 to 4000.


# ======================================================================= 
         v10_46b (Jan 17 2017) 

         ***** IMPORTANT(v10_46b) ***** 

         ***** USEFUL(v10_46b) ***** 

         ***** MISCELLANEOUS(v10_46b) ***** 

   genmag_SALT2.c: 
    + for spectrograph option, return F_LAM instead of F_LAM*LAM.
         --> it's a feature-Fix !


# ======================================================================= 
         v10_46c (Jan 20 2017) 

         ***** IMPORTANT(v10_46c) ***** 

         ***** USEFUL(v10_46c) ***** 

   New feature to simulate a single spectrum; 
   See manual "4.22.2 Simulating a Single High-S/N Spectrum"
   
         ***** MISCELLANEOUS(v10_46c) ***** 

   genmag_SALT2.c  : another SPECTROGRAPH fix
   genmag_NON1ASED : 
     + fix NON1ASED spectra to give F_LAM
     + works with one spectrum (i.e., one epoch)

   sntools_output.c: minor fixes to compile WITHOUT HBOOK.


# ======================================================================= 
         v10_46d (Jan 27 2017) 

         ***** IMPORTANT(v10_46d) ***** 

   In snlc_fit.exe, turn MINOS error OFF for default.
   &SNLCINP variable USE_MINOS=T turns MINOS on and
   fits are much slower.

         ***** USEFUL(v10_46d) ***** 

   &SNLCINP input SIMLIB_OUT now works for low-z :
   See new manual section "12.3.3 Creating a SIMLIB from Data"

         ***** MISCELLANEOUS(v10_46d) ***** 

   sntools_trigger.c[h]:
     + update to allow for field-dependent HOSTEFF map 
       for host redshifts. Add key "FIELDLIST: C1+C2+C3"
       above each map in the file specified by 
       SEARCHEFF_zHOST_FILE.

   split_and_fit.pl: allow ENV in OUTDIR name.

   snlc_sim.c[h]: 
    + fix SIMLIB_NREPEAT logic to be compatible with reading
      PEAKMJD from SIMLIB header. See new ISOURCE_PEAKMJD variable.
    + Can turn off PEC1A rate model with 
        snlc_sim.exe  <inFile>  DNDZ_PEC1A NONE
    + if DNDZ_PEC1A is specified, but there are no PEC1A SEDs,
      then turn off PEC1A rate model to avoid crash. Allows
      DNDZ_PEC1A key to work with NON1ASED list that does/doesn't 
      include PEC1A.

   snana.car:
     + for &SNLCINP input SIMLIB_OUT, if there is no meta-data,
       call new subroutine COMPUTE_SIMLIB_INFO(...) to estimate 
       PSF,SKYSIG,ZP for each SIMLIB row. 
       Initial goal is low-z SIMLIB.
   
     + call new routine PARSE_SURVEY_NAME to determine both 
       SURVEY_NAME and SUBSURVEY_NAME, where the latter can
       optionally be embedded in (); e.g., in the data file
       header,
           SURVEY:  LOWZ(CFA3)

     + for &SNLCINP input variable, USE_MINOS, set default to
       FALSE (intead of TRUE) so that fitting runs several
       times faster.
 
  WARNING: for SIMLIB_OUT, check PSF & SKYSIG UNITS
           when meta data exists.


# ======================================================================= 
         v10_46e (Feb 1 2017) 

         ***** IMPORTANT(v10_46e) ***** 

         ***** USEFUL(v10_46e) ***** 

         ***** MISCELLANEOUS(v10_46e) ***** 

   sntools_nearnbr.c :
     + fix refactor bug that messed up the training mode.

   NEARNBR_pipeline.pl :
     + write formatted outFile, FITOPT[nnn]_NNSPEMAX.TABLE

   split_and_fit.pl :
     + write SNANA version to catenated ascii fitres file.
     + abort after 24 hr
     + print wall time in MERGE.LOG

   snlc_sim.c[h]: remove obsolete INPUTS.GENRANGE_DMPNOISE

   genmag_NON1ASED.c: 
    + fix prep_NON1ASED to properly handle NGENTOT < NSED
    + fix genSpec_NON1ASED to apply host AV.

   sntools_spectrograph.c :
    + fix index bugs in get_FILTERtrans_spectrograph()


# ======================================================================= 
         v10_47 (Feb 2 2017) 

         ***** IMPORTANT(v10_47) ***** 

   Simulation fixes:
    + fixed spectra units to be FLAM instead of FLUX.

    + fix spectrograph template noise mistake of NOT scaling
     template noise to search ZP.

    + fix long-standing mistake in scaling template-SKYSIG^2 for
      broadband filters. Scaling was 10^(0.4(ZP_S-ZP_T), which
      is correct for template_SKYSIG, but not correct for the
      square. The correct template-SKYSIG^2 scaling  is 
      10^(0.8(ZP_S-ZP_T). 

         ***** USEFUL(v10_47) ***** 

         ***** MISCELLANEOUS(v10_47) ***** 

   snlc_sim.c: see zparg in gen_smearFlux()


# ======================================================================= 
         v10_47b (Feb 7 2017) 

         ***** IMPORTANT(v10_47b) ***** 

         ***** USEFUL(v10_47b) ***** 

         ***** MISCELLANEOUS(v10_47b) ***** 

   *nearnbr* codes: 
     + more updates to prepare for calling nearnbr_apply.exe
       as after-burner in split_and_fit. Training outFile
       now includes extra keys for VARNAME_TRUE and TRAIN_FILENAME
       so that all training info is stored in 1 outFile.


# ======================================================================= 
         v10_47c (Feb 9, 2017) 

         ***** IMPORTANT(v10_47c) ***** 

         ***** USEFUL(v10_47c) ***** 

         ***** MISCELLANEOUS(v10_47c) ***** 

   split_and_fit.pl & NEARNBR_pipeline.pl :
     + refactor and updgrade to post-process both MLAPPLY and SALT2mu.
     + NN pipeline now runs split_and_fit with MLAPPLY_INFILE key
       so that ML is applied after LC fitting.
     + final NN step (for next version) is to replace BIASCOR fitting
       with symbolic links for duplicate sim-versions ; should save
       lots of CPU.

   sntools_fitsio.c:
     +  fix bug writing spectra: column name FLUX[ERR] -> FLAM[ERR]


# ======================================================================= 
         v10_47d (Feb 13 2017) 

         ***** IMPORTANT(v10_47d) ***** 

         ***** USEFUL(v10_47d) ***** 

         ***** MISCELLANEOUS(v10_47d) ***** 

   split_and_fit.pl :
     + finish refactor/upgrade from previous version. Check 
       symbolic link from TRAILMARK option and skip fitting
       if already fit.  This TRAILMARK feature is used 
       under-the-hood by the NEARNBR_pipeline script and is
       not intended to be used by explicitly by SNANA users.

   psnid_BEST.c:
     + add IIb to hard-coded list of sub-types.
     + add PEC1A as 4th type (after Ia,II,Ibc), and lots of refactoring.
     + add "fragile" comment everywhere hard-coded if-block
        should be replaced by loop.
     + fix psnid to work if any type has NO templates.

   sntools_gridread.c: 
     + for PEC1A, ITYPE_AUTO->3 (instead of 1) to be distinguished
       from CC-Ibc. I had set this to 1 last year as a hack to make
       it work for newly-added PEC1A.


# ======================================================================= 
         v10_47e (Feb 16 2017) 

         ***** IMPORTANT(v10_47e) ***** 

         ***** USEFUL(v10_47e) ***** 

         ***** MISCELLANEOUS(v10_47e) ***** 

   psnid_BEST.c :
     + fix cut-logic to determine best type
         (forgot to do this last version)

       Validated with 1700 SDSS SNe comparing v10_47c and v10_47e:
	  N[ ALL                  ] =   1694  (100.00 %) 
	  N[ PSNID-Type=Ia        ] =    326  ( 19.24 %) 
	  N[ PSNID-Type=Ibc       ] =     19  (  1.12 %)
          N[ PSNID-Type=II        ] =    552  ( 32.59 %) 
	  N[ PSNID-Type=UNKNOWN   ] =    797  ( 47.05 %) 

   ovdatamc.py: update from D.Jones

   snana.car : upgrade SIMLIB_OUT with
     + screen dump of fixed params: PSF, PIXSIZE, SKYMAG.
     + identify SPACE or GROUND, and pick parms accordingly.
    
   snlc_fit.car:
     + fix MBERR calculation in subroutine SALT2_STORE
       MBERR calc is OK in SALT2mu, so no change there. 


# ======================================================================= 
         v10_47f (Feb 17 2017) 

         ***** IMPORTANT(v10_47f) ***** 

         ***** USEFUL(v10_47f) ***** 

   new script:  combine_dataVersions.py

         ***** MISCELLANEOUS(v10_47f) ***** 

   snana.car
     + if subSurvey exists, then SURVEY need not exist in SURVEY.DEF.
       e.g., for "SURVEY: LOWZ_COMBINED(CFA3K)"  then sub-survey 
       CFA3K must be defined, but LOWZ_COMBINED need not be defined.

   sntools_fitsio.c[h]:
     + write global header flag SUBSURVEY_FLAG
     + if SUBSURVEY_FLAG>0, then include SUBSURVEY column.

   sndata.h:  SURVEYNAME and SUBSURVEYNAME both go inside SNDATA struct.


# ======================================================================= 
         v10_47g (Feb 19 2017) 

         ***** IMPORTANT(v10_47g) ***** 

         ***** USEFUL(v10_47g) ***** 

         ***** MISCELLANEOUS(v10_47g) ***** 

  psnid_BEST.c : fix memory leak.

  snana.car
    + change &SNLCINP input FILTER_REMAP -> FILTER_REPLACE;
      avoids confusion with new SNTABLE_FILTER_REMAP input.

    + add &SNLCINP namelist string SNTABLE_FILTER_REMAP 
      e.g,  SNTABLE_FILTER_REMAP = 'abc->B def->V ghi->R'
      results in BVR in output tables instead of abcdefghi.
      Initial use for combined-lowz. Works for SNANA table;
      will update FITRES table next version of snana.



# ======================================================================= 
         v10_47h (Feb 21 2017) 

         ***** IMPORTANT(v10_47h) ***** 

         ***** USEFUL(v10_47h) ***** 

   sntools_trigger.c :
      + new feature to specify peakmag list in map                        
               VARNAMES:   a+b+c+d   SPECEFF
        will take average PEAKMAG among a,b,c,d bands.

   snana.car:  MAGOBS_SHIFT_ZP[PRIMARY] now accept band-strings:
         'gri .1' is equivalent to 'g .01 r .01 i .01'

         ***** MISCELLANEOUS(v10_47h) ***** 

   manual: new Sec 7.2 explaining how to combine surveys.
   
    To do:  read SUBSURVEY from SIMLIB -> SIM output.


# ======================================================================= 
         v10_47i (Feb 22, 2017) 

         ***** IMPORTANT(v10_47i) ***** 

         ***** USEFUL(v10_47i) ***** 

   Can now specify MODEL with full path such as
     GENMODEL:  $WFIRST_ROOT/models/SALT2/SALT2.test  # sim-input

    &FITINP
       FITMODEL_NAME = '$WFIRST_ROOT/models/SALT2/SALT2.test'  

         ***** MISCELLANEOUS(v10_47i) ***** 

   snana.car : 
     + before closing SIMLIB_OUT, use system call to write
       SUBSURVEY_LIST at top of file (with sed -i).

   snlc_sim.c: 
     + check for SUBSURVEY_LIST key to enable SUBSURVEY output column
       in data files.

   backup_INTERNAL.pl :
     + copy only to $SNDATA_BACKUP. No URL copy.

   genmag_xxx.c, snlc_sim.c, snlc_fit.car:
     + refactor to allow full path in model name.
     + tested for SALT2, but should work for 
         mlcs,snoopy,stretch,SIMSED


# ======================================================================= 
         v10_47j (Feb 28 2017) 

         ***** IMPORTANT(v10_47j) ***** 

         ***** USEFUL(v10_47j) ***** 

  sncl_sim.c:
    + new sim-input  HOSTLIB_GENZPHOT_FUDGEPAR (see manual 4.19)
    + new sim-input  SPECTROGRAPH_SCALE_TEXPOSE: xxx

         ***** MISCELLANEOUS(v10_47j) ***** 

  combine_fitres.c
    + fix to avoid writing duplicate CIDint
    + fix integer check on CCID

  split_and_fit.pl: 
    + abort if any VERSION has a dot.
      Avoids confustion with TEXT output.

  snana.car: 
    + MXCHAR_CUTNAME->120 (was 100) for Dan.
    + for skymag-vs-lambda (MAKE_SIMLIB option), 
       extend lambda -> 20,000 A for SPACE


# ======================================================================= 
         v10_47k (Mar 1 2017) 

         ***** IMPORTANT(v10_47k) ***** 

         ***** USEFUL(v10_47k) ***** 

         ***** MISCELLANEOUS(v10_47k) ***** 

   snlc_fit.car :
     + add MAGDIF into RESIDUAL part of FITRES table.
     + in subroutine INIT_FUDGE_FITERR, remove RETURN statement
       after FUDGEALL_MAXFRAC so that it can mix with other
       FUDGE_FITERR options.

   snlc_sim.c, genmag_SIMSED.c :
     + pass RV,AV to genmag_SIMESD to analytically compute 
       compute host extinction from _AV and _RV inputs.


# ======================================================================= 
         v10_47l (Mar 2 2017) 

         ***** IMPORTANT(v10_47l) ***** 

         ***** USEFUL(v10_47l) ***** 

         ***** MISCELLANEOUS(v10_47l) ***** 

   SALT2mu.c :
    + write blinding function in M0DIF file.
   
   genmag_SEDtools.c :
     + fix fill_TABLE_HOSTXT_SEDMODEL() to work with SPECTROGRAPH.

   nearnbr_apply.c:
     + computation of NN_PROB_IA to work even if ITYPE_BEST<0.
       Fixes other bug in which NN_PROB_IA = PROB of ITYPE_BEST,
       not necessarily for IA.

   snana.car
     + fix PKMJDCOM so that 'snmake.pl xxx_private' works.       

   snmake.pl : 
     + minor fix to work with snlc_fit_private.


# ======================================================================= 
         v10_47m (Mar 10, 2017) 

         ***** IMPORTANT(v10_47m) ***** 

         ***** USEFUL(v10_47m) ***** 

   psnid.exe 
     New &PSNIDINP option  OPT_SIMCHEAT=0  will exclude
     PSNID CC-template that matches the CC template in 
     a sim event. No effect on real data.

   snlc_fit.exe: new &FITINP keys to cut on fitted sigma/(1+z):
      FITWIN_PEAKMJD_ERRz1 = 0, 2.0
      FITWIN_MB_ERRz1      = 0, 0.3
      FITWIN_SHAPE_ERRz1   = 0, 1.0
      FITWIN_COLOR_ERRz1   = 0, 0.2

    Note that FITWIN_MJD_ERR has been changed to FITWIN_PEAKMJD_ERR

         ***** MISCELLANEOUS(v10_47m) ***** 

   split_and_fit.pl :
     + define BATCH_MEM_XXX separately for XXX = LCFIT, SALT2mu, MLAPPLY.
     + tar and gzip  SPLIT_JOBS_MLAPPLY/  and SPLIT_JOBS_SALT2mu/

   sntools_output_root.c :
     + read rows in groups of 20,000, and then delete tree so
       that memory usage does not go so high. Mainly affects
       sntable_combine operating on large biasCor sample.

   genmag_SEDtools.c, genmag_NON1ASED.c :
     + refactor to work for SIMSED model, but failed.
       Problem is that TEMP_SEDMODEL array does not 
       keep all of the SIMSED SEDs, so the SIMSED spectra
       are lost after initialization.

   combine_fitres.c 
     + few updates, mainly to skip duplicate variables
       only after first SNANA file is found.

   sim_SNmix.pl: check for ENV in sim-input fileNames.


# ======================================================================= 
         v10_47n (Mar 13 2017) 

         ***** IMPORTANT(v10_47n) ***** 

         ***** USEFUL(v10_47n) ***** 

         ***** MISCELLANEOUS(v10_47n) ***** 

   SALT2mu_fit.pl : 
     + if FITRES files are gzipped, unzip them (See $fgzip).
       Works on directories cleaned with 'split_and_fit.pl CLEAN'
 
     + $OUTDIR is based on longest matching subDir instead of
       longest matching string --> avoids creating new outdir
       that includes common prefix of split_and_fit subDirs.
 
     + common prefixes are removed to construct outDir name:
       OUTFIT_LOWZ & OUTFIT_SDSS -> OUTDIR = SALT2mu_LOWZ+SDSS

   SALT2mu.c :
     + count NPASS vs. stage in biasMapSelect; if 0 events
       pass biasCorSelect, print map to see which cut always
       fails.

   sim_SNmix.pl:
     + abort if NGEN_LC key is combined with random CIDs.

   snlc_sim.c[h]:
     + new sim-input  keys TAKE_SPECTRUM: to specify
       spectra w.r.t peakMJD, instead of specifying
       absolute MJDs in the SIMLIB.  Still debugging
       option to compute TEXPOSE from user SNR;
       will update manual next SNANA version.


# ======================================================================= 
         v10_47o (Mar 14 2017) 

         ***** IMPORTANT(v10_47o) ***** 

         ***** USEFUL(v10_47o) ***** 

         ***** MISCELLANEOUS(v10_47o) ***** 

  kcor.c :
    + for SPECTROGRAPH, abort if SNR is NOT monotically increasing
      with T_expose.

  snlc_sim.c, sntools_spectrograph.c :
    + might have utility working to determine T_expose from SNR
      in the TAKE_SPECTRUM key. Need a monotonic SNR-vs-Texpose
      table to finish testing.

# ======================================================================= 
         v10_47p (Mar 14 2017) 

         ***** IMPORTANT(v10_47p) ***** 

         ***** USEFUL(v10_47p) ***** 

         ***** MISCELLANEOUS(v10_47p) ***** 

    snlc_sim.c, sntools_spectrograph.c[h] :
     + finish debugging TAKE_SPECTRUM inputs.
     + Automatically write TAKE_SPECTRUM info to SIMGE_DUMP file.
     + Timing test with 800 events from WFIRST sim:
         No  TAKE_SPECTRUM keys: 24 sec
         5   TAKE_SPECTRUM keys: 35 sec
     + note that TAKE_SPECTRUM keys cannot mix with SPECTROGRAPH
       keys in simlib, otherwise it aborts. Mixing works fine
       to generate spectra, but problem is that TAKE_SPECTRUM
       info-addresses cannot be initialized for the SIMGEN_DUMP.

# ======================================================================= 
         v10_48 (Mar 15 2017) 

         ***** IMPORTANT(v10_48) ***** 

         ***** USEFUL(v10_48) ***** 

     sim-input includes TAKE_SPECTRUM keys; see manual.

         ***** MISCELLANEOUS(v10_48) ***** 

   snlc_sim.c :
     + add ABORT traps for TAKE_SPECTRUM option.
     + new key  TAKE_SPECTRUM_DUMPCID: <cid>
     + new key  TAKE_SPECTRUM:  TEMPLATE_TEXPOSE_SCALE(1.2)

   doc/snana_manual.pdf : 
     + update SPECTROGRAPH explanations.
     + describe sim-input TAKE_SPECTRUM keys.


# ======================================================================= 
         v10_48b (Mar 19, 2017) 

         ***** IMPORTANT(v10_48b) ***** 

         ***** USEFUL(v10_48b) ***** 

         ***** MISCELLANEOUS(v10_48b) ***** 

   snlc_sim.c :
    + for SIMGEN_DUMP and  and TEXT output, write each row to
      string, and then write string to file. This refactor is
      to reduce disk access.

    + fix index bugs related to TAKE_SPECTRUM keys.
      Tested with TAKE_SPECTRUM keys in increasing order and
      then in random order; output TEXT files are the same
      because of internal MJD-ordering.

    + fix dumb refactor bug in GENSPEC_DRIVER (related to GENSPEC_INIT)

    + refactor so that synthetic filters are NOT needed
      to generate SPECTROGRAPH spectra


  SNANA_TESTER:
    + Add test for SPECTROGRAPH (in SIMLIB) and TAKE_SPECTRUM keys
      (in sim-input file). Only affects pre-release testing.


# ======================================================================= 
         v10_48c (Mar 27 2017) 

         ***** IMPORTANT(v10_48c) ***** 

   simulation suppresses epochs where model wavelength range
   does NOT span the filter-wavelength range. See new table
   variable SIM_NOBS_UNDEFINED. This affects, for example,
   NIR bands for NON1A and SIMSED models.

         ***** USEFUL(v10_48c) ***** 

         ***** MISCELLANEOUS(v10_48c) ***** 

   snlc_sim.c
     + fix bug passing VAL_DUMMY to store_SIMLIB_SPECTROGRAPH
     + suppress epochs having undefined mags due to filter trans
       extending beyond model lambda range; e.g.,  NON1A
       in the NIR. Add new table variable SIM_NOBS_UNDEFINED 
       to count number of suppressed obs.

   snana.car: 
    + in RDVERSION_FITS, abort if NROW > MXSNLC(=3 million)
    + new &SNLCINP  input  USE_SNHOST_ZPHOT=T

   convertSMP2snana.py : 
     + new script to convert output of SMP into SNANA-formatted
       data files.  NOT FINISHED !!!

   SALT2mu:
     + minor fix in setup_zbins_CCprior to avoid abort.

   genmag_SEDtools.c :
    + in init_flux_SEDMODEL(), set FLUX=0 if any part of filter trans
      is outside model range --> undefined mag instead of mag based
      on partial integral.  Main effect is for NON1A and SIMSED models.

   
   SALT2mu_fit.pl:
     + new command line arg NOSUBMIT
     + abort if there are zero jobs, and print list of version
       names and '4match' strings, to help users visually 
       identify version that doesn't  "4match" the others.


# ======================================================================= 
         v10_48d (Mar 29 2017) 

         ***** IMPORTANT(v10_48d) ***** 

         ***** USEFUL(v10_48d) ***** 

         ***** MISCELLANEOUS(v10_48d) ***** 

   snana.car : update to read FLT or BAND key from ascii data files.
               Affects snana.exe, snlc_fit.exe, psnid.exe .

   snlc_sim.c:
     + add NOBS_UNDEFINED to SIMGEN_DUMP list
     + make sure undefined mags have MAG_UNDEFINED=666 

     + add 2nd peak to GENGAUSS_ASYM. Can add sim-inputs
          GENPROB2_SALT2x1:   0.2
          GENPEAK2_SALT2x1:  -1.5
          GENSIGMA2_SALT2x1:  0.3
       See manaul update in Sec 9.2

# ======================================================================= 
         v10_48e (April 7 2017) 

         ***** IMPORTANT(v10_48e) ***** 

         ***** USEFUL(v10_48e) ***** 

         ***** MISCELLANEOUS(v10_48e) ***** 

   snana.car:
    + for SIMLIB_OUT option and no ZP info in data files, 
      ZPERR->0.01 instead of 0.001.
    + remove check for "BAND" key in RDFITS since
      Sam found a case where it aborts. Comment out
      BAND check and just check FLT.
    + remove SET_CIDMASK and CIDMASK(MXCID); use sntools
      utility EXEC_CIDMASK().

   snlc_sim.c[h]:
    + "DNDZ: CC_MD14" -> "DNDZ: MD14" (for more generality),
       but still allow legacy CC_MD14 option.

    + in init_GENLC, move more stuff before USE_SAME_SIMLIB call.
      Fixes SIMLIB_NREPEAT problem when CUTWIN_XXX are used.

    + init_CIDRAN(): use new function exec_cidmask to set CIDs
      with bit-mask instead of 2-byte int.
    
   sntools.[ch]: 
    + new utility exec_cidmask(mode,CID) to store each CID
      in a bit-mask, and to check if was already stored.
      Need for duplicate checking in both sim and snana.
       
   SALT2mu.c :
     + fix "ALL" option by setting redshift info.
 

# ======================================================================= 
         v10_48f (Apr 10 2017) 

         ***** IMPORTANT(v10_48f) ***** 

         ***** USEFUL(v10_48f) ***** 

         ***** MISCELLANEOUS(v10_48f) ***** 

   snlc_sim.c[h]:
     + fix BLIND option (FORMAT_MASK += 8). See INPUTS.WRITE_FLAG.

     + init_CIDRAN: change CIDRAN algorithm to pick CID closest
                    to CIDRAN; guarantees finding CIDRAN

     + fix bug writing LIST file for TEXT format. See AUX->FP_LIST.      

   sim_SNmix.pl:
     + new option "RESET_CIDOFF: 2" to make each GENVERSION
       have unique random CIDs. Added for LSST classification
       challenge (LCC).

   snana.car:
     + make sure snana.exe & snlc_fit.exe work  on sim 
       generated with BLINDFLAG.

   Misc TO DO: 
     - reduce size of CIDRAN_LIST in snlc_sim.c; should NOT
       contain CIDs before CIDOFF.
   

# ======================================================================= 
         v10_48g (Apr 11 2017) 

         ***** IMPORTANT(v10_48g) ***** 

         ***** USEFUL(v10_48g) ***** 

         ***** MISCELLANEOUS(v10_48g) ***** 

   snlc_sim.c:
     + in function init_CIDRAN, malloc CIDRAN_LIST using only
       the number of new CIDs, not all previous and current CIDs.
       Will significantly reduce memory consumption for very
       large sims that are broken up over multiple cores.

     + new sim-inputs
          GENTYPE:  <typeSpec>
          GENTYPES: <typeSpec>  <typePhot>
       Mainly for SIMSED model, or other non-SN models.
       Note that GENTYPE over-rides any other SN-type.

  sim_SNmix.pl :
     + more refactor for "RESET_CIDOFF: 2" --> unique CID
       for each GENVERSION.

  sntools_fitsio.c:  SIM_MODEL_NAME -> A32 (was A20)


# ======================================================================= 
         v10_48h (Apr 13 2017) 

         ***** IMPORTANT(v10_48h) ***** 

         ***** USEFUL(v10_48h) ***** 

         ***** MISCELLANEOUS(v10_48h) ***** 

   snana.car:
    + new &SNLCINP option SIMLIB_ZPERR_LIST = 'abc .01 deb .02 etc...'
      Works with SIMLIB_OUT option; see manual.
    + read SIM_LENSMAG from sim-data file, and store in SNTABLE.

   sim_SNmix.pl:
     + fix refactor bug
     + refactor to prepare for lensMag. See new function
       gen_distanceMag(z, &MU, &LENSMAG). Note that GENLC.MU
       includes MU + LENSMAG.  GENLC.LENSMAG=0, but next version
       can finish gen_lensMag(z) funtion.

   genmag_S11DM15.c[h] : 
     + call new function malloc_S11DM15_SEDMODEL() to fix broken model.

   combine_dataVersions.py 
     + add new key SIMLIB_ZPERR_LIST to specify ZPERR in the SIMLIB
       for each band. 


# ======================================================================= 
         v10_48i (Apr 17 2017)

         ***** IMPORTANT(v10_48i) ***** 

         ***** USEFUL(v10_48i) ***** 

         ***** MISCELLANEOUS(v10_48i) ***** 

    snana.car:
      + fix HEADER_OVERRIDE_FILE option to check redshift[_err]
        variables.
      + new &SNLCINP input NONLINEARITY_FILE -->
         call functions in sntools_nonlinearity.c[h]
        Arguments to get_nonlin(...) still need testing !!!!

    SALT2mu.c:  
     + new input  prescale_simdata=3.0 --> pre-scale only sim, not data.
     + ABORT if command-line item is not recognized.

    Create sntools_lensing.c[h]


# ======================================================================= 
         v10_48j (Apr 17 2017) 

         ***** IMPORTANT(v10_48j) ***** 

         ***** USEFUL(v10_48j) ***** 

         ***** MISCELLANEOUS(v10_48j) ***** 

   snlc_sim.c:
      + write SKY_SIG[_T] in units of  ADU/pix, no longer FLUXCAL/pix.
        See function snlc_to_SNDATA(). I don't remember why the
        SKY_SIG unit had been changed to FLUXCAL in the output 
        data files.
    
   snana.car:
     + new &SNLCINP input ABORT_ON_BADFILTER=T/F ; used in 
       PARSE_NML_FILTER in snlc_fit.car.

     + new &SNLCINP input  NONLINEARITY_FILE = 'nonlin.txt' 
       It works the same way as in the simulation.


# ======================================================================= 
         v10_48k (Apr 21, 2017) 

         ***** IMPORTANT(v10_48k) ***** 

         ***** USEFUL(v10_48k) ***** 

         ***** MISCELLANEOUS(v10_48k) ***** 

   snana.car:
     + force Fpe_source > 0 for argument to GET_NONLIN.

   SALT2mu.c :
     + new input dumpflag_nobiasCor=1 to dump info for
       each data event that is rejected because there 
       is no biasCor.
     + fix nasty beta-index bug in function storeDataBias().
       Bug was problaby there in the BBC paper.

   snlc_sim.c:
     + in VT_redshift(), TOTsum *= NGEN_SCALE if NGEN=0 -->
       sim_SNmix includes NGEN_SCALE in computing NGEN.
     + new sim-input "DNDZ_SCALE: <scaleIa> <scaleNON1A>
       Works with sim_SNmix.pl
     + few fixes so that ZVARIATION works with RV,AV 
       in SALT2 model.

   snlc_sim.h: MXPAR_ZVAR->100 (was 50)

   sim_SNmix.pl:
    + if NGEN(NON1A)<10, set it to 10 to avoid abort. Allows 
      setting  "GENOPT: DNDZ_SCALE_NON1A 1.0E-8" to turn 
      off NON1A.

    + Add prefix  "TMP_[whoami]_"  to all temporary versions.
      In case of failure, the temp versions can be manually 
      identified and deleted by the user.  


# ======================================================================= 
         v10_48l (Apr 27 2017) 

         ***** IMPORTANT(v10_48l) ***** 

         ***** USEFUL(v10_48l) ***** 

         ***** MISCELLANEOUS(v10_48l) ***** 

   SALT2mu_fit.pl :
     + fix to gunzip FITOPT[nnn].FITRES.gz files.

   snlc_sim.c[h]:
     + new function store_SIMLIB_SEASON(MJDrange) to compute
       season info, and return MJDrange to select SIMLIB MJD-rows.
       Default is the usual range defined by GENRANGE_TREST.
       But new option
          SIMLIB_MSKOPT +=4
       will include the entire season if any part of Trest
       range overlaps season.
     + gen-zsmear(): if zerr>.999 then skip generation of random z
       since RESHIFT_FINAL[_ERR] -> -9.
       Fixes rare abort on ZGEN_MIN when GENSIGMA_REDSHIFT = 1.0
     + few fmodf -> fmod (float->double) to handle very large NGENTOT_LC

  sim_SNmix.pl:  fix parsing GENMODEL for NON1A

  sntools.c:
    + exec_cidmask(): fmodf -> fmod (bug fix)

  snana.car:
    + new option to prescale entries filled in SNTABLE:
           SNTABLE_LIST = 'SNANA(ps:100)'
      will pre-scale the SNANA table by 100.
    + new internal logical STDOUT_UPDATE to limit screen output
      for large jobs. After 2000 events, screen output is made
      with pre-scale = 100.
     

# ======================================================================= 
         v10_48m (May 1 2017) 

         ***** IMPORTANT(v10_48m) ***** 

         ***** USEFUL(v10_48m) ***** 

   LENSING now working by reading dMU distribution vs. redshift.

         ***** MISCELLANEOUS(v10_48m) ***** 

   snana.car:
     + fix casting bug calling REJECT_PRESCALE(N,SIM_PRESCALE)
        -> REJECT_PRESCALE(N,DBLE(SIM_PRESCALE))
     + abort on crazy MAGCOR in subroutine EXEC_MAGCOR().
     + check valgrind on snlc_fit.exe, and fix minor bug 

   SALT2mu.c:
     + MXa,MXb -> 2 (was 5) max number of alpha,beta bins.
     + Aborts if more than 2 biasCor a,b bins are found.
   
   sntools_output.c:
      minor fix in  SNTABLE_READPREP_VARDEF so that abort
      checks are made.

   snlc_sim.c:
     + new code files sntools_lensing.c[h].
     + new sim-input key 
          LENSING_PROBMAP_FILE: LENSING_PROBMAP_LogNormal+MICE.DAT
       Current default is NONE (i.e., no lensing) until more testing 
       is done.
  

# ======================================================================= 
         v10_49 (May 5 2017) 

         ***** IMPORTANT(v10_49) ***** 

         ***** USEFUL(v10_49) ***** 
   
   Release SNDATA_ROOT tarFile with Lensing info.

         ***** MISCELLANEOUS(v10_49) ***** 

   sim_SNmix.pl : 
     + fix bug writing CIDRAN_MAX to simgen command line

   sntools_host.c :
     + use user-input HOSTLIB_SBRADIUS to determine SB_FLUX/MAG.
       Changing the radius only changes the reporte SBFLUX,
       but has no impact on the noise.


# ======================================================================= 
         v10_49b (May 12 2017) 

         ***** IMPORTANT(v10_49b) ***** 

         ***** USEFUL(v10_49b) ***** 

         ***** MISCELLANEOUS(v10_49b) ***** 

   snlc_sim.c: 
     +  burn lensing random regardless of whether lensing is used.
     +  new sim-input key  "LENSING_DMUSCALE: 1"
  
   snana.car: fix reading SIM_LENSDMU

   sntools_output.c :
    + fix AUTOSTORE utility so that HEADER_OVERRIDE_FILE and
      VPEC_FILE can both be used. Abort if any variable appears
      in more than one AUTOSTORE file.

   fix snana_install.pdf

   SALT2mu.c:
      + fix benign bug in set_ERRMASK() related to host_logmass.
        Now it properly rejects events with logmass < 1

          *** Lingering SALT2mu problem ***
       Dan found case resulting in all MINOS errors=0,
       although parabolic (approx) errors look OK:
         NDATA~1000, NBIASCOR~3E6, redchi2_tol=.001
       MINOS errors empirically fixed by
          - reducing NBIASCOR to 1E6, or
          - increasing redchi2_tol=0.002 (1 less fit iteration)


# ======================================================================= 
         v10_49c (May 17 2017) 

         ***** IMPORTANT(v10_49c) ***** 

         ***** USEFUL(v10_49c) ***** 

         ***** MISCELLANEOUS(v10_49c) ***** 

   split_and_fit.pl: 
     + new feature to add [nickName] for each FITOPT, e.g., 
          FITOPT: [r-SDSS] MAGSHIFT_ZP 'r .01'

   SALT2mu_fit.pl:
     + change FITOPT: key to MUOPT:, but still accept 
       legacy FITOPT key.

     + New feature to reduce computing:
         MUOPT:  <SALT2mu args> FITOPT=0   # apply MUOPT only to FITOPT=0
         MUOPT:  <SALT2mu args> FITOPT=0,4 # apply MUOPT only to FITOPT=0,4


# ======================================================================= 
         v10_49d (May 19 2017) 

         ***** IMPORTANT(v10_49d) ***** 

         ***** USEFUL(v10_49d) ***** 

         ***** MISCELLANEOUS(v10_49d) ***** 

   split_and_fit.pl :
     in FITOPT.README file,
        FITOPT: 000 NONE -> FITOPT: 000 [DEFAULT] NONE

   SALT2mu_fit.pl: in summary log,
      MUOPT000: [DEFAULT] NONE -> MUOPT: 000 [DEFAULT] NONE 

   snana.car:
     + call TABLE_ADDCOL_LOAD from SNRECON so that it's called
       before filling FITRES table.  Note potential problem 
       with FITRES table filled before SNANA table.


# ======================================================================= 
         v10_49e (May 24 2017) 

         ***** IMPORTANT(v10_49e) ***** 

         ***** USEFUL(v10_49e) ***** 

         ***** MISCELLANEOUS(v10_49e) ***** 

  snlc_sim.c:
    + in MJDGAP(), use parameter to dimension INDEX_SORT
    + read optional CCDNUM from SIMLIB header, write in data file.
  
  sntools_fitsio.c[h]: read/write CCDNUM

  SALT2mu_fit.pl  sim_SNmix.pl  split_and_fit.pl :
    + allow for BATCH_TEMPLATE file name to use ENV.


# ======================================================================= 
         v10_49f (May 26, 2017) 

         ***** IMPORTANT(v10_49f) ***** 

         ***** USEFUL(v10_49f) ***** 

         ***** MISCELLANEOUS(v10_49f) ***** 

   kcor.c[h] :
     new input  "DUPLICATE_LAMSHIFT_GLOBAL: 10"
     to prepare duplicate filter set with lambda shift.

   snana.car:
     + new &SNLCINP input  FILTLIST_LAMSHIFT = 'g'
       --> use lam-shifted filter for g-band. Works with
           DUPLICATE_LAMSHIFT_GLOBAL option in kcor input.

   snana_manual.pdf: New Sec 5.25 explains filter lam-shifts


# ======================================================================= 
         v10_49g (Jun 13 2017) 

         ***** IMPORTANT(v10_49g) ***** 

   analysis codes check for repeate MJD+BAND

         ***** USEFUL(v10_49g) ***** 

   kcor.c[h]:
    + new function parse_MAGREF() to parse mathematical function
      with + and - signs: e.g.,  
         FILTER: DES-g   20130322_g.dat   0.014-0.020
      will result in AB mag of -0.006 

         ***** MISCELLANEOUS(v10_49g) ***** 

   snlc_sim.c:
    + fix z-variation feature to work with 2nd Gaussian .
    + fix command-line override to accept 2nd Gaussian.

  snana.car:
    + allow TYPE or SNTYPE key in TEXT format. This is because
      previous TEXT format had SNTYPE key, while output TEXT
      TABLE had TYPE key. With HEADER-OVERRIDE feature, 
      the TYPE key in a table can become the TYPE key in
      a data file.

   + allow ENV in VPEC_FILE 

   + For SNANA sim, VPEC_FILE->'' so that same input file can
      be used for data and sim.

   + minor fix initialize SNLC_NXPIX=-9, and setting CCDNUM.

   + new subroutine CHECK_DUPLICATE_MJDBAND checks for repeated
     MJD+BAND.

  sntools_spectrograph.c :
    + better error checking to trap and abort on SNR=0 when 
      building kcor file.

 

# ======================================================================= 
         v10_50 (Jun 19, 2017) 

         ***** IMPORTANT(v10_50) ***** 
 
   + Fixed synthetic SPECTROGRAPH fluxes with SNR_ZPOLY option.
   + New lensing section in manual, Sec 4.14.2

         ***** USEFUL(v10_50) ***** 

   New RANSYSTPAR_XXX inputs to simulate systmatic errors.
   See new manual section 
       4.34 Applying Systematic Errors (RANSYSTPAR)

         ***** MISCELLANEOUS(v10_50) ***** 

   snlc_sim.c[h]:
    + new sim-input  NSUBSAMPLE_MARK: nnn
      See new manual section 4.33

    + new funcdtion parse_input_KEY_PLUS_FILTER(...)
       to simplify parsing of filter-dependent inputs.

    + GENMAG_OFF_AB key -> GENMAG_OFF_ZP, but still allow
      legacy key.

    + call GENSPEC_DRIVER before GENFLUX_DRIVER so that
      after computing TEXPOSE(spec), the ZPT and SKYSIG
      are updated for synthetic bands. In previous versions,
      the spectra SNR were correct with SNR_ZPOLY, but the
      associated sythetic fluxes were mistakenly computed
      with the max TEXPOSE rather than computed TEXPOSE.


# ======================================================================= 
         v10_50b (Jun 20 2017) 

         ***** IMPORTANT(v10_50b) ***** 

         ***** USEFUL(v10_50b) ***** 

         ***** MISCELLANEOUS(v10_50b) ***** 

   simlib_coadd.c: 
     + MJD -> double (instead of float)
     + write MJD as %.4f instead of %.3f.

   snana.car, snlc_fit.car :
     + new &SNLCINP input  FILTER_LAMSHIFT = 'g -3.4 r 8.2 i 5.2'
       to specify arbitray filter shifts. See new subroutine
       SHIFT_FILTTRANS(...).

   snlc_sim.c:
     + new input  RANSYSTPAR_FILTER_LAMSHIFT


# ======================================================================= 
         v10_50c (Jun 23 2017) 

         ***** IMPORTANT(v10_50c) ***** 

         ***** USEFUL(v10_50c) ***** 

         ***** MISCELLANEOUS(v10_50c) ***** 

   snlc_sim.c :
     + new sim-input key  "MWEBV_SCALE: 1.04"

   SALT2mu.c :
     + fix bug writing NVAR to M0DIF file. Was writing
       "NVAR: 4" instead of "NVAR: 6", which messed up
       cosmo fitters reading file.
     + skip all events with ERRMASK>0
     + fcn_M0: protect interpolation into undefined z-bin.
         (only for uM0=2 option)
     + optional 2nd arg for powzbin to avoid too-large bins at hi-z.

   wfit.c: fix bug by initializing IWD_NBIN=-9


# ======================================================================= 
         v10_50d (June 27, 2017) 

         ***** IMPORTANT(v10_50d) ***** 

  SALT2mu.c: fix awful z-index bugs that messed up the M0-vs-z
             output when some z-bins where emtpy and thus not
             included in the fit.  Worked OK when all z-bins
             were populated.

         ***** USEFUL(v10_50d) ***** 

         ***** MISCELLANEOUS(v10_50d) ***** 

   minuit.F : MNI->70 (was 50) to allow more z-bins in SALT2mu.
   SALT2mu.c : 
     + abort if NFITPAR > MAXPAR_MINUIT
     + fix awful cospar index bug in setup_MUZMAP_CCprior().
     + for M0DIF file, compute binned redshift from inverting
       <mu>, the wgted-average distance in each bin.

   SALT2mu_fit.pl: 
     + increase batch memory to 1000mb (was 500mb)
     + new keys WFIT_OPT and FITOPT000_ONLY; see top of file for usage.
       Allows running wfit on both the binned (M0DIF) and unbinned
       (FITRES) file. Can also debug on FITOPT000 only.
     + pass -label arg to wfit
     + write MUERR_INCLUDE keys to output fitres/M0DIF file
       to inform downstream cosmo fitter what is/isn't included
       already in MUERR.

   wfit.c: 
     + new input arg "-label <label>" to add label  in .cospar file.
     + read MUERR_INCLUDE flags.


# ======================================================================= 
         v10_50e (July 3 2017) 

         ***** IMPORTANT(v10_50e) ***** 

    Refactor SALT2mu to clean up awful indexology.

         ***** USEFUL(v10_50e) ***** 

         ***** MISCELLANEOUS(v10_50e) ***** 

   new files: genmag_LCLIB.c[h]

   snana.car: 
     + fix bug in SNRECON by calling COUNTFIELDS before epoch loop;
       duplicate checker now writes out correct FIELDLIST.


# ======================================================================= 
         v10_50f (July 11, 2017) 

         ***** IMPORTANT(v10_50f) ***** 

         ***** USEFUL(v10_50f) ***** 

   sim_SNmix.pl:
     + new keys  RANSEED_REPEAT and RANSEED_CHANGE
       See manaul Section 12.3.1 and Fig 8.

         ***** MISCELLANEOUS(v10_50f) ***** 

   SALT2mu.c, sntools.c[h] :
     Move read_SURVEY() and get_IDSURVEY functions out of
     SALT2mu and into sntools.c. Allows simulation to use
     these functions.

   snana.car: 
     + SET_CUTMASK(), pass REAL*8 argument to REJECT_PRESCALE
        instead of INT*8 arg.

   sntools_output.c:
     + in SNTABLE_AUTOSTORE_INIT(), 'CCID CID' -> 'CID CCID' so that
       it works with ML_APPLY in NN pipeline.


# ======================================================================= 
         v10_50g (July 18 2017) 

         ***** IMPORTANT(v10_50g) ***** 

         ***** USEFUL(v10_50g) ***** 

   many fixes below are related to generating and fitting hundreds 
   of sim-versions for systematics tests.

         ***** MISCELLANEOUS(v10_50g) ***** 

   NEARNBR_pipeline.pl : check for RANSEED or RANSEED_REPEAT

   kcor.c: call ENVreplace for primary SED

   SALT2mu_fit.pl: increase memeory from 1->2 GB

   split_and_fit.pl
    + double the memory for SALT2mu and MLAPPLY stages
    + if NJOB > NCORE, then add 'wait_for_file.pl' calls to
      wait on DONE files. This ensures that no more than
      BATCH_NCORE jobs are in the queue at any given time.
    + wild-card version now checks $PRIVATE_DATA_PATH if
      nothing found in $SNDATA_ROOT/SIM

   SALT2mu.c: 
    + new nmax input to force number of fitted events.

   snana.car: 
    + added new &SNLCINP input MXLC_FIT in order to specify an
      exact number of events passing fit+cuts. But then I realized
      that it won't work properly with batch jobs :(

    + remove SIM_SUBSAMPLE_INDEX from TEXT table.
      It has been showing up randomly, and messing up NVAR
      totals among different simulated survey samples.
 
   sim_SNmix.pl :
    + fix bug to prevent CIDOFF from incrementing when
      each job has different RANSEED.


# ======================================================================= 
         v10_50h (Jul 24, 2017) 

         ***** IMPORTANT(v10_50h) ***** 

         ***** USEFUL(v10_50h) ***** 

   simulation: allow z-dependence on GENMAG_OFF_GLOBAL

         ***** MISCELLANEOUS(v10_50h) ***** 

   SALT2mu_fit.pl:
     NVERSION_MAX -> 9999 (was 999) 

   split_and_fit.pl:
     to reduce number of output files:
     * write FITOPT.READ only to OUTDIR (not each version subDir)
     * write input NML file to OUTDIR (not each version subDir)

   remove obsolete util/dump_lcfitOutliers.pl
   Instead, use outlier feature in sntable_dump

   snlc_fit.car:
     for fit-residual table, add BAND (see BANDEP_ALL,BANDEP_FIT).
    
   sntable_dump.c :
     + new argument "--format IGNORE" to write IGNORE file.
  
   NEARNBR_pipeline.pl
     + check for ENV in TOPDIR_OUTPUT


# ======================================================================= 
         v10_50i (July 27 2017) 

         ***** IMPORTANT(v10_50i) ***** 

         ***** USEFUL(v10_50i) ***** 

         ***** MISCELLANEOUS(v10_50i) ***** 

   snlc_sim.c :
    + abort if no valid format in FORMAT_MASK.
    + fix subtle bug in setz_unconfirmed().

   sim_SNmix.pl :
    + fixed to work with NGENTOT_LC as part of GENOPT,
      even with RANCID option.

   snlc_fit.car :
    + set zHD = zPHOT for photo-z fit. See SNLC_zHD[_ERR]



# ======================================================================= 
         v10_50j (July 29 2017) 

         ***** IMPORTANT(v10_50j) ***** 

         ***** USEFUL(v10_50j) ***** 

         ***** MISCELLANEOUS(v10_50j) ***** 

   genmag_SIMSED.c:
     + no more abort on state binary file;
       give warning and remove it with system() command.

   genmag_SEDtools.c:
     + bugfix in nearest_gridval_SIMSED().

   snlc_sim.c:
     + For GRIDONLY and FLAT distribution for SIMSED parameter,
       adjust RANGE in checkpar_SIMSED() so that each bin is
       equally populated.
     + fix NON1ASED model to work with only PEC1A keys and no NON1A keys.
       Not tested for NON1AGRID.


# ======================================================================= 
         v10_50k (July 31 2017) 

         ***** IMPORTANT(v10_50k) ***** 

         ***** USEFUL(v10_50k) ***** 

         ***** MISCELLANEOUS(v10_50k) ***** 

   genmag_SIMSED.c[h]:
     + major refactor in order to 1) use largest ASCII file to 
       determien MXDAY, and 2) read MXDAY from SED binary file.       
     + To reduce memory, still pondering whether to store FLUX-TABLE 
       as 2-byte integer (1000*mag?) instead of 4-byte float.
     + new optional key in SED.INFO,   LOGZBIN: <xxx>
       Default is 0.02.

# ======================================================================= 
         v10_50l (Aug 7 2017) 

         ***** IMPORTANT(v10_50l) ***** 

         ***** USEFUL(v10_50l) ***** 

         ***** MISCELLANEOUS(v10_50l) ***** 

   SALT2mu.c:
    + new blinding scheme for OL and w; see instructions
      at top of code for blindflag, blindpar9 and blindpar11.

   snlc_sim.h[c] :
     + SIMLIB_DUMP[MXREAD_SIMLIB] -> SIMLIB_DUMP
       to reduce more than 100MB from memory size.
     + refactor SIMLIB_DUMP_DRIVER

     + new option to dump SIMLIB in root format:
         snlc_sim.exe mysim.input SIMLIB_DUMP 4

     + start SIMLIB_read refactor to separate reading
       and processing, which will eventually allow
       reading SIMLIB from either TEXT or ROOT file.
       For now, refactored code isn't ready, but can
       bu tested with argument  'SIMLIB_MSKOPT 1'


# ======================================================================= 
         v10_50m (Aug 8 2017) 

         ***** IMPORTANT(v10_50m) ***** 

         ***** USEFUL(v10_50m) ***** 

         ***** MISCELLANEOUS(v10_50m) ***** 

   sntools.c
    + refactor rd_sedflux() and abort if DAYSTEP or LAMSTEP changes.
      Tolerances are hard-coded to be 5E-4 days and 0.01 A.
      To avoid aborting on extended SALT2 models, give WARNING
      for LAMSTEP error ... to be fixed later.

   snlc_sim.c[h]:
    + remove all FILTSUM variables and functions
    + more SIMLIB refactoring

   manual: mark FITSUM section as OBSOLETE


# ======================================================================= 
         v10_50n (Aug 9 2017) 

         ***** IMPORTANT(v10_50n) ***** 

         ***** USEFUL(v10_50n) ***** 

         ***** MISCELLANEOUS(v10_50n) ***** 

  genmag_SIMSED.c and genmag_SALT2.c:
   + hard coded LRANGE -> MAXLAM_SEDMODEL (=30000) instead of 20000.
   + for SIMSED, extend Trange to -100,500 (was -20,200).

  genmag_SEDtools.h
    + new define params
      #define MINLAM_SEDMODEL 100     // global min Lambda
      #define MAXLAM_SEDMODEL 30000   // global max Lambda 

  SALT2mu_fit.pl:
    + add new input key VERSION_EXCLUDE_STRING to exclude
      versions whose name includes this STRING.


# ======================================================================= 
         v10_50o (Aug 11 2017) 

         ***** IMPORTANT(v10_50o) ***** 

         ***** USEFUL(v10_50o) ***** 

         ***** MISCELLANEOUS(v10_50o) ***** 

  sim_SNmix.pl:
    tar up /misc dir to reduce number of output files.

  snlc_sim.c[h]:
    + MXEPSIM_PERFILT->500 (was 200)
    + in get_cutwin, replace a few hard-wired arrays with malloc.
    + MD14 rate now has 1 user parameter to define rate at z=0;
      see updated rate section in manual.
         DNDZ:  MD14  1.3E-4   #  per yr per Mpc^3
    + in snlc_to_SNDATA(), add array-bound protection to SNDATA arrays.
    + new sim-input parameter GENRANGE_MJD: <MJDmin> <MJDmax>

                             bss size (MB) of
         MXEPOCH   |  snana    snlc_fit   snlc_sim
         -------------------------------------------
           1000    |  188        323       242
           2000    |  208        356       265

    where MXPOCH was changed in sndata.h and snana.car
    Modest increase, so leave MXEPOCH=2000 to handle
    10-season LSST SIMLIB.  But should track down the
    increase, most of which is related to sntools_output.
    In sntools_output_hbook.c, HBOOK_CWNT_READROW structure
    consumes 38 MB, so doubling MXEPOCH added 19 MB.
    Maybe change this to dynamic alloc, and to sparse list
    for each cast.

  sim_SNmix.pl :
    Sam H found a gen-RANDOM bug with multiple jobs.
    He set NGENTOT_LC = 1000, which coincidentally is the
    same as the number of buffered randoms per SN event,
    and he found many duplicate values of z,c,x1.
    Changing NGENTOT_LC != 1000 fixes the problem, but
    still need to fix this robustly in the simulation. 

    The problem is as follows. Job 1 burns 1000 randoms
    to init random CIDs. Then starts random generation
    at the 1001'th randon for 1st event, 2001'th random
    for 2nd event, etc ... Next, job 2 burns 2000 randoms,
    and starts random generation of 1st event at 2001'st
    random, etc. So because NGENTOT_LC = number of buffered
    randoms, consecutive jobs can have repeated random
    sequences for events in different split jobs. 

    Fix is to re-initialize randoms after the random CIDs
    have been picked in init_CIDRAN(). The new seed is
        NEWSEED = ISEED(orig) + CIDOFF


# ======================================================================= 
         v10_50p (Aug 12 2017) 

         ***** IMPORTANT(v10_50p) ***** 

         ***** USEFUL(v10_50p) ***** 

  sim_SNmix.pl :
    new input key  "BATCH_MEM: nnnn" to change memory from default 
    (1000 MB) to nnnn MB. Needed for large SIMSED models.

         ***** MISCELLANEOUS(v10_50p) ***** 

   sntools.c :
    + new util splitString2 to read with strtok_r;
    + refactor rd_sedflux to be simpler and maybe faster


  sntools_output_hbook.c:
   + replace static mem in READROW struct  with pointers that
     are allocated. Program size (bss) reductions are:
         snana.exe     209 MB -> 170
         snlc_fit.exe  356 MB -> 318
         snlc_sim.exe  262 MB -> 224


# ======================================================================= 
         v10_50q (Aug 13 2017) 

         ***** IMPORTANT(v10_50q) ***** 

         ***** USEFUL(v10_50q) ***** 
 
   snlc_sim: 
     Non-uniform DAY bins are now allowed for SIMSED & NON1A modeles.
     But wavelength bins must still be unform.

   sim_SNmix: for SIMGEN_DUMPALL, dump file is automatically gzipped.

         ***** MISCELLANEOUS(v10_50q) ***** 

   snlc_sim.c 
     + for SED models, extend redshift safety margin to
       include +- 5 *GENSIGM_VPEC (peculiar velocity)
     + update SIMSED & NON1ASED models to work with 
       non-uniform DAY binning. Tested with current
       uniform-binned DAY arrays, so still needs testing 
       with non-uniform DAY binning. See SEDMODEL.DAY[ised][ep]
       Motivation is to reduce memory for SEDs that have
       long epoch ranges.
       No plans to allow non-uniform wavelength bins.

     + new sim-input key PRESCALE_SIMGEN_DUMP (or SIMGEN_DUMP_PRESCALE)

     + either PEAKMAG_x or MAGT0_x can be used in SIMGEN_DUMP list.

   sim_SNmix.pl :
     + new sim-input key CONVERT_SIMGEN_DUMP.
     + for SIMGEN_DUMPALL, gzip it.


# ======================================================================= 
         v10_50r (Aug 16, 2017) 

         ***** IMPORTANT(v10_50r) ***** 

         ***** USEFUL(v10_50r) ***** 

         ***** MISCELLANEOUS(v10_50r) ***** 

   snlc_sim.c[h]: 
    + increase MXSIM_CID to 199.9999 million (was 99.9999 million)
    + SIMLIB_open -> SIMLIB_INIT_DRIVER and refactor to separte
      reading and preparation.
    + internal DECL -> DEC and allow DEC or DECL for all inputs.

  sim_SNmix.pl
    + Dan found an evil bug where launching two sim_SNmix jobs
      with same PREFIX (and hence same SIMLOG_DIR) results in
      deleting all files except for SIMLIB_DIR.  Haven't yet
      found the evil remove line, but added a warning if 
      SIMLOG_DIR already exists without a DONE stamp.
  
  snana_manual.pdf 
    + add explanation of SIMLIB_FIELDLIST


# ======================================================================= 
         v10_50s (Aug 20 2017) 

         ***** IMPORTANT(v10_50s) ***** 

         ***** USEFUL(v10_50s) ***** 

         ***** MISCELLANEOUS(v10_50s) ***** 

   sim_SNmix.pl
     + fixed evil 'remove' bug from last versio. The bug was
       actual from 'mv *.*', not 'rm *.*'  Hard to explain,
       but code checks that each $SIMDIR_RAN exists before
       doing "cd $SIMDIR_RAN; mv *.* $wherever"

   sntable_dump.c:
     + "CCID ROW"  --> "CCID"  because it was writing
       'CCID ROW' for APPEND_FITRES and messing things up.
       Means we can't use sntable_dump or combine_fitres
       on SIMLIB-text or SIMLIB-root file.

   sntools_devel.c[h] :
     + new interface to allow anyone to develop sim code.
       Initial use is to compute WIDTH_[band] parameters
       for SIMGEN_DUMP.

   SALT2mu.c:
     + automatically compute SIGMA_VPEC from biasCor and
       ignore user-input vpecerr if biasCor is used.

   snana.car
     + write SIM_VPEC to text table output ; needed by
       SALT2mu to compute SIGMA_VPEC

   snlc_sim.c
     + more refactoring of SIMLIB functions, but default
       is still using legacy routines.

     + in parse_SIMLIB_GENRANGES_legacy() remove two FlatRan1
       calls that are not needed; this changes random sync.
       This FlatRan1 removal is needed to compare legaacy and 
       refactored codes.


# ======================================================================= 
         v10_50t (Aug 23 2017) 

         ***** IMPORTANT(v10_50t) ***** 

         ***** USEFUL(v10_50t) ***** 

         ***** MISCELLANEOUS(v10_50t) ***** 
 
     Release version during refactor as safety backup.

   snlc_sim.c 
    + more refactor for SIMLIB routines.
    + slight change in keep_SIMLIB_OBS changes random sync
       for a few SNANA_TESTER jobs.

   split_and_fit.pl :
     + fix bug related to PRIVATE_DATA_PATH = 'pwd'


# ======================================================================= 
         v10_50u (Aug 24 2017) 

         ***** IMPORTANT(v10_50u) ***** 

    Refactor of SIMLIB routines is done (hopefully).
    Still using legacy routines by default; plan to
    switch in 1-2 weeks.

         ***** USEFUL(v10_50u) ***** 

         ***** MISCELLANEOUS(v10_50u) ***** 

   snlc_sim.c
    + more REFACTORING of SIMLIB. SIMLIB-SPECTROGRPAH option
      works exactly the same (no bugs found).
      Fixed several bugs found related to TAKE_SPECTRUM where
      user requests SNR. 

    + for SIMLIBs with REDSHIFT and/or PEAKMJD keys in header,
      values failing cut now result in reading next LIBID as 
      if the failed LIBID didn't exist.
      This changes the meaning of NGENTOT_LC; it is now the 
      number of Cadences whose header passes cuts. Before 
      NGENTOT_LC included all Cadences, including
      those failing header cuts.

    + for SNANA_tester, add SIMFIT jobs to check synthetic
      bands made from SPECTROGRAPH. Corresponding SIMGEN
      jobs only check for aborts, but SIMFIT is sensitive
      to changing synthetic mags.

    + Starting with this SNANA version, both LEGACY (default)
      and REFACTOR version of SIMLIBS codes work. Run REFACTOR
      code with "SIMLIB_MSKOPT: 1" .  The LEGACY code has
      some minor refactor to re-use some of the routines. 
      Plan is to switch to refactored code in a week or two.


# ======================================================================= 
         v10_50v (Aug 27 2017) 

         ***** IMPORTANT(v10_50v) ***** 

         ***** USEFUL(v10_50v) ***** 

         ***** MISCELLANEOUS(v10_50v) ***** 

   sntools_fitsio.c: 
     + abort if writing blank string to table. Should avoid
       confusing abort on read-back from fitting code.

   SALT2mu_fit.pl
    + minor fix related to VERSION_EXCLUDE_STRING
    + write beta1 & beta1_err to SUMMARY-DAT file.

   genmag_NON1ASED.c :
    + allow user to provide full file name or prefix in
      NON1A.LIST file.


  psnid*: few fixes to work without SNIA templates, and use only
          NON1A templates.


# ======================================================================= 
         v10_51 (Aug 29 2017) 

         ***** IMPORTANT(v10_51) ***** 

         ***** USEFUL(v10_51) ***** 

    Simulation: hopefully finished refactoring codes for
                reading and processing SIMLIB.

    PSNID: finished updates to 
         1) can leave out SNIa templates 
             [i.e., can specify only NON1A templates]
         2) use finer Tmax grid if Trest bin size < 1 day,
             [previously Tmax grid hard-coded to 1 day]
         3) add generic types: MODEL1, MODEL2, MODEL3, MODEL4.
             [in addition to Ia, II, Ibc, PEC1A]
         4) only used types/models show up in output tables
             [avoids cluttering table with unused types]

        Updates motivated by fast-declining 91bg.

         ***** MISCELLANEOUS(v10_51) ***** 


# ======================================================================= 
         v10_51b (Aug 30 2017) 

         ***** IMPORTANT(v10_51b) ***** 

         ***** USEFUL(v10_51b) ***** 

   SIMFIT_IDEAL_PRESCALE (see manual)

         ***** MISCELLANEOUS(v10_51b) ***** 

   snana.car:  
     + new &SNLCINP variable USESIM_TRUEFLUX=T will replace
       measured flux with true flux. Intended to use in LC
       fits to measure intrinsic scatter matrix for sims.

   snlc_sim.c:
    + new sim-input key  "DNDZ_ALLSCALE: <scale>"  to scale
      rate for any model. This avoids confusion between
      Ia and NON1A for models like SIMSED which can be either.

   snlc_fit.car :
     + new &FITINP  SIMFIT_IDEAL_PRESCALE to include
       both IDEAL and normal fit results. See manual
       section 5.31


# ======================================================================= 
         v10_51c (Sep 5, 2017) 

         ***** IMPORTANT(v10_51c) ***** 

         ***** USEFUL(v10_51c) ***** 

         ***** MISCELLANEOUS(v10_51c) ***** 

   snana.car
     + init SNLC_IAUC = 'NULL' instead of ''
     + suppress SIM_VPEC in output tables
        (meant to do that in previous version)

   snlc_sim.c :
    + fix bug wjere USE_SIMLIB_PEAKMJD=1 was turning on
      USE_SIMLIB_REDSHIFT. Now each USE_SIMLIB_XXX option
      is independent.
  
   SALT2mu_fit.pl:
     + fix to work with or without leading space in MERGE.LOG

   SALT2mu.c:
     + begin major refactor to use intrinsic-scatter matrix
       from IDEAL fit params in biasCor sample. Not done yet.

     + to reduce memory, biasCor inputs read into float instead 
       of double: 83MB -> 49MB memory usage from biasCor struct.
       All calculations are still done in double.
         beta(F)/beta(D)   = 3.08974/3.09050 = 0.99975
         alpha(F)/alpha(D) = 0.15368/0.15349 = 1.0012
       The memory reduction will hopefully keep total mem < 2GB
       after adding arrays for IDEAL params and for COV_FITVAL[3][3].


# ======================================================================= 
         v10_52 (Sep 11 2017) 

         ***** IMPORTANT(v10_52) ***** 

    SIMULATION: flip REFACTOR switch for reading SIMLIB :
         INPUTS.SIMLIB_LEGACYFLAG = 0 ;
  
         ***** USEFUL(v10_52) ***** 
   
         ***** MISCELLANEOUS(v10_52) ***** 
   
   sim_SNmix.pl 
    + abort if comment symbol (#) is found on GENOPT_GLOBAL line

   snlc_sim:
    + incorporate new LCLIB model for pre-computed light-curve magnitudes.
      LCLIB just interpolates mag to each epoch.
    
   SALT2mu.c:
    + numerical fix to work with powzbin=1.0
    + MAXBIN_z -> 85 (was 50)
    + fix parameter-bound bug for BININFO_DEF (MXpar -> MXz)

   minuit.F :  MNI->110 (was 80)

 

# ======================================================================= 
         v10_52b (Sep 16 2017) 

         ***** IMPORTANT(v10_52b) ***** 

         ***** USEFUL(v10_52b) ***** 

         ***** MISCELLANEOUS(v10_52b) ***** 

   SALT2mu:
    + fix conceptual mistake in muresid_biasCor() :
      Compute muDif based on MU(z_meas), not with SIM_DLMAG.
      Affects sigInt when peculiar velocities are simulated,
      particularly for C11 model. Problem was found by DanS,
      whose SALT2mu jobs aborted when RMS(MUdif) < <muErr>.

    + fix to work if host mag-step (p5) is fixed to non-zero value, 
      but not floated. See INPUTS.USE_GAMMA0.

   kumacs/snana.kumac :
     + update from my private dir

   sim_SNgrid.pl : allow reading ENVs in front of file names.

   snlc_sim.c
     + Abort if NON1A key appears after PEC1A key

   snana.car:
     new &SNLCINP option,
          EARLYLC_STRING = 'MAXOBS 3   PHOTMASK_START 4096'
          EARLYLC_STRING = 'MAXOBS 3   SNR_START 5'
     which takes first 4 obs starting at epoch with PHOTFLAG 
     containing 4096 (detection bit). See manual Sec ??

   psnid.car :
    + new &PSNIDINP inputs with defaults
        TMAX_START = -40, -15, -5   ! days
        TMAX_STOP  = +60, +15, +5
        TMAX_STEP  =  10,  3,   1


# ======================================================================= 
         v10_52c (Sep 18, 2017) 

         ***** IMPORTANT(v10_52c) ***** 

    snlc_sim/SALT2mu:
     + fix subtle bug: write true SIM_DLMAG instead of lensing-corrected
       DLMAG to data file so that SALT2mu make proper bias correction
       w.r.t. true distance.

         ***** USEFUL(v10_52c) ***** 
 
     &SNLCINP input REQUIRE_EPOCHS_STRING

         ***** MISCELLANEOUS(v10_52c) ***** 

   sncl_sim.c :
    + new lensing model input
        LENSING_DSIGMADZ:  .05  # symmetric Gaussian sigma = 0.05*z
    + SIM_DLMU -> true DLMU, not corrected DLMU. Change needed so
      that SALT2mu computes correct biasCor w.r.t. DLMU_TRUE instead
      of w.r.t, DLMU_LENSCOR.
    + GENLC.DLMU -> GENLC.DLMU_TRUE and GENLC.DLMU_LENSCOR

   snana.car:
     new &SNLCINP  REQUIRE_EPOCHS_STRING  to select fast-declining
     transients that are above detection threshold for much less
     time than typical SN.
         To do: add section in manual


# ======================================================================= 
         v10_52d (Sep 18 2017) 

         ***** IMPORTANT(v10_52d) ***** 

         ***** USEFUL(v10_52d) ***** 

         ***** MISCELLANEOUS(v10_52d) ***** 

    snlc_sim.c[h]:
      + add LENSDMU as a global MAGOFF in genmag_offsets(), 
        rather than defining effective MU with lensCor. 
        This change is needed to protect 'true'quantities (mB,MU) 
        that are used in SALT2mu to compute bias corrections.


# ======================================================================= 
         v10_52e (Sep 20 2017) 

         ***** IMPORTANT(v10_52e) ***** 

         ***** USEFUL(v10_52e) ***** 

         ***** MISCELLANEOUS(v10_52e) ***** 

   snlc_sim.c 
    + fix refactor bug related to setting IDSURVEY when
      there are SUBSURVEYs from combining surveys into
      one SIMLIB. Fix in function snlc_to_SNDATA().

    + fix misc logic related to setting SUBSURVEY.

   snana.car :
     + update string argument for REQUIRE_EPOCHS_STRING,
       so that it includes keys. See manual Section
         12.4.11 Selecting Epoch Ranges for Fast Transients 


# ======================================================================= 
         v10_52f (Sep 24 2017) 

         ***** IMPORTANT(v10_52f) ***** 

         ***** USEFUL(v10_52f) ***** 

         ***** MISCELLANEOUS(v10_52f) ***** 

   snana.car :
     new &SNLCINP input DUMP_STRING to specify 
     FUNCTION, CID(s), FILTER(s), MJDRANGE.
     Implemented only for FLUCERRCALC, but will expand
     slowly to other functions.  

     New utility for user codes to append variables to SNANA table.
     Allows snana_private and snlc_fit_private to append variables
     via TABLEVARNAME_USER  and TABLEVALUE_USER

  sntools.c[h] :  
    + new funtions INIT_SNANA_DUMP, CHECK_SNANA_DUMP, ABORT_SNANA_DUMP.
      Utility can be used by simulation or fitting programs.
      See usage instrunctions at top of INIT_SNANA_DUMP.      

  snlc_sim.c:
     + SIMLIB_DUMP_DRIVER:  force SIMLIB_NREPEAT=1

     + new sim-inputs
         MJD_TEMPLATE:  <MJD>
         MJD_TEMPALTE_FILTER:  iz <MJD>
       to subtract template flux from signal flux.
          !!! NOT DEBUGGED YET !!!

     + bug fix in  keep_SIMLIB_OBS();
        [was NOT respecting SIMLIB_FIELDLIST request]

  Strange bug found by Dan:
    When psnid creates FITRES table in a ROOT file, sntable_dump
    crashes.  However, the SNANA and LCPLOT tables in the same
    ROOT file work fine. This bug seems to have been there for a
    very long time. I can examine the FITRES table from root,
    so the table is probably OK. I suspect a problem in the
    sntable_dump code.  All works fine with HBOOK, and both
    HBOOK and ROOT work fine using snlc_fit (instead of psnid).



# ======================================================================= 
         v10_52g (  ) 

         ***** IMPORTANT(v10_52g) ***** 

         ***** USEFUL(v10_52g) ***** 

         ***** MISCELLANEOUS(v10_52g) ***** 

    snlc_sim.c
     + finish debugging MJD_TEMPLATE
     + in gen_filtmap(), include NON1ASED in the list of
       SED models to check. Should result in fewer warnings.
       For NON1ASED_SDSS, results in 185 events instead of 183 ?
       For NON1ASED_DES, no change.

     + new sim-input key
         CUTWIN_EPOCHS_SNRMIN: 5 20 iz # SNR>5 for < 20 days, i or z
       to replicate the time-above-threshold part of the 
       &SNLCINP REQUIRE_EPOCHS_STRING in analysis/fitting jobs.


# ======================================================================= 
         v10_52h (  ) 

         ***** IMPORTANT(v10_52h) ***** 

         ***** USEFUL(v10_52h) ***** 

         ***** MISCELLANEOUS(v10_52h) ***** 

    SALT2mu.c:
     + for zinterp method, reject zDATA outside biasCor range,
       instead of aborting. Print reject stats for each IDSAMPLE.

    snana.car:
      + MXCID -> 300 million (was 100 million)
        Note that MXCID_CHECK remains at 100 milliom so that
        program memory does not increase.

   sim_SNmix.pl:
      + TMP* file names now use generic IA or NON1a instead of
        the actaul GENMODEL name. Avoid problems with model
        names that have a path.
      + replace (  with \( and same for ).

   snlc_sim.c :
      + can specify field with SOLID_ANGLE argument;
        see manual.


# ======================================================================= 
         v10_52i (Oct 7 2017) 

         ***** IMPORTANT(v10_52i) ***** 

         ***** USEFUL(v10_52i) ***** 

         ***** MISCELLANEOUS(v10_52i) ***** 

   genmag_LCLIB.c : fix a few things
   genmag_LCLIB.h : MXROW_LCLIB -> 200,000 ( was 100,000)

   snlc_sim.c:
     + udpate SNR_CALC if template flux is subtracted (for LCLIB)
   
   sntools_trigger.c:
     + fix buggy trigger logic in gen_SEARCHEFF_PIPELINE().
       May effect triggers formed on same night.

  

# ======================================================================= 
         v10_52j (Oct 18 2017) 

         ***** IMPORTANT(v10_52j) ***** 

         ***** USEFUL(v10_52j) ***** 

         ***** MISCELLANEOUS(v10_52j) ***** 

   genmag_LCLIB, snlc_sim:
     + add extra LCLIB params for EVENT_ID and template mags.
       --> shows up in the output data files.
     + new function set_TobsRange_LCLIB(Trange) that is called once
       per event to set the global range for all bands.

  wfit.c: fix a few places to blind results to stdout.

  snana.car:
    if there is CCDNUM column in TEXT, read CCDNUM for each
    epoch, and include CCDNUM in EPOCHS part of SNANA+EPOCHS
    table. Otherwise use header CCDNUM.  The CCDNUM-vs-epoch
    works only for TEXT, not for FITS format.

  snlc_sim.c :
    + new sim-input key  GENBIAS_REDSHIFT: 1.0E-4  (see manual)


# ======================================================================= 
         v10_52k (Oct 25 2017) 

         ***** IMPORTANT(v10_52k) ***** 

    sntools_fluxErrModels.c   updated for DES_SMP

         ***** USEFUL(v10_52k) ***** 

         ***** MISCELLANEOUS(v10_52k) ***** 

   manual: update section 
         4.26 Generating Redshift and Peculiar Velocity

   genmag_LCLIB: more work & debugging

   sim_SNmix.pl:
    + parse new key from simgen-master file:
         JOBANME_SIM: /mypath/snlc_sim.exe

   snlc_fit.car
     + fix FITANA_CUTS so that LC plot subDir is created
       only FIT-CUTS pass.

   combine_dataVersions.py:  comment out code for ZPERR_LIST

   sntools_fluxErrModels.c :
     Update from Dillon B to work for DES_SMP.


# ======================================================================= 
         v10_52l (Nov 2 2017) 

         ***** IMPORTANT(v10_52l) ***** 

         ***** USEFUL(v10_52l) ***** 

         ***** MISCELLANEOUS(v10_52l) ***** 

   snlc_sim.c:

    + small fix in gen_smearFlux() to prevent abort on extreme
      negative fluctuation of signal.

    + init_kcor(): fix bug with both AB and user MAGOFF so that
         both are used. Bug was using only user-MAGOGG and 
         ignoring AB offset.


# ======================================================================= 
         v10_52m (Nov 8 2017) 

         ***** IMPORTANT(v10_52m) ***** 

         ***** USEFUL(v10_52m) ***** 

  Sim: 
   + Update to make low-z sims x2.5 faster (see below)
   + bug fix SIMGEN_DUMP[ALL] to work with command-line override


  SALT2mu_fit.pl:
    + new  STRINGMATCH key to explicitly pick versions to combine.

         ***** MISCELLANEOUS(v10_52m) ***** 

   snlc_sim.c, sntools_trigger.c :
    + if spec-select trigger depends only peak mag or peak color,
      evaluate model mags at peak, and the trigger, before computing 
      model at each epoch. Goal is to speed sim when spec-efficiency
      is used.  See enw function gen_PEAKMAG_SPEC_TRIGGER().
      Had to move spec-select randoms upstream in the code,
      which changes random seed sync.
    
    + fix bug and read SIMGEN_DUMP[ALL] from command-line arg.
 

# ======================================================================= 
         v10_52n (Nov 17 2017) 

         ***** IMPORTANT(v10_52n) ***** 

         ***** USEFUL(v10_52n) ***** 

  snlc_sim.c:
    + new sim-input to re-direct output of simulated data files:
       PATH_SNDATA_SIM: <path>
           or
       snlc_sim.exe <inpFile>  PATH_SNDATA_SIM <path>

  sim_SNmix.pl :
    + new sim-master-input input to re-direct output of sim data files:
       PATH_SNDATA_SIM: <path>

         ***** MISCELLANEOUS(v10_52n) ***** 

  split_and_fit.pl :
    + fix bug for NBATCH > NCORE .AND. use of FITOPT link.
    + speed merging by reducing sleep-wait in DONE_CHECK_LCFIT().


# ======================================================================= 
         v10_52o (  ) 

         ***** IMPORTANT(v10_52o) ***** 

         ***** USEFUL(v10_52o) ***** 

         ***** MISCELLANEOUS(v10_52o) ***** 

    snana.car:
      + fix dumb bug so that CCDNUM shows up in tables.

    snlc_sim.c, sim_SNmix:
      + few minor fixes related to PATH_SNDATA_SIM input
      + sim internally creates and appends 
           $SNDATA_ROOT/SIM/PATH_SNDATA_SIM.LIST
        to keep track of user-define paths to check.
        See xxx_PATH_SNDATA_SIM functions in sntools.c[h]

    manual: 
      + add Sec 6.1 about PATH_SNDATA_SIM key.


# ======================================================================= 
         v10_53 (Nov 22, 2017) 

         ***** IMPORTANT(v10_53) ***** 

   Program speed-up based on profiling codes with -pg. See below.

         ***** USEFUL(v10_53) ***** 

         ***** MISCELLANEOUS(v10_53) ***** 

   split_and_fit.pl:
     + fix so that VERSION wildcards work with user-defined 
       PATH_SNDATA_SIMDIR.

   sntools.c
     + add call to ENVreplace(path)  when reading path from 
       PATH_SNDATA_SIM.LIST file

   sim_SNmix.pl
     + Read optional PATH_SNDATA_SIM key from sim-input file.


                   PROFILE CODES with -pg
    snlc_sim.c :
     + init_GENLC() was taking large fraction of total CPU -->
       optimize GENLC structure-init to loop over last NEPOCH instead 
       of over MXEPSIM=10,000. Sim runs ~50% faster for DES, but
       speed-up depends on trigger efficiency.

    snana.car:
      + use large-array-init trick in INIT_SNDATA().
        Speed-up for snlc_fit is small.

    SALT2mu.c:
      Inside fit-function (fcn), if cosmo params are fixed then
      replace cosmodl() call with pre-computed MUMODEL -->
      more then x2 faster for DES sim with 2400 fitted events 
      and 20 z-bins.


# ======================================================================= 
         v10_53b (Nov 24 2017) 

         ***** IMPORTANT(v10_53b) ***** 

   OMG! Finally traced slow batch sims (w.r.t, interactive)
   because of reading MWEBV from SFD98 maps. This is very old code
   from SDSS that reads FITS file for each event: will ask DES/LSST 
   for faster modern code. Temporary solution (below) is to re-compute
   MWEBV only if RA/DEC coordinates change. With SIMLIB_NREPEAT=10,
   batch jobs run WAY faster !

         ***** USEFUL(v10_53b) ***** 

         ***** MISCELLANEOUS(v10_53b) ***** 

   split_and_fit.pl:
     + fix copy_SIMGEN_DUMP() to work with gzipped dump file.

   snlc_sim.c:
     + for more speed-up, compute MWEBV only if RA,DEC have changed.
       This helps when using SIMLIB_NREPEAT since the RA,DEC are fixed
       for several events.


# ======================================================================= 
         v10_53c (Nov 27 2017) 

         ***** IMPORTANT(v10_53c) ***** 

         ***** USEFUL(v10_53c) ***** 

     Manual:  4.22 Simulating Rate vs. Galactic Coordinates

         ***** MISCELLANEOUS(v10_53c) ***** 

    snlc_sim.c:
      + new rate-dependence on galactic coords,
          DNDB:  COSBPOLY:  <b0> <b1> <b2 <b3>
        See new manual section,
          4.22 Simulating Rate vs. Galactic Coordinates

      + new command-line input
         INIT_ONLY 1   # quit after rate-init; for sim_SNmix
         INIT_ONLY 2   # quit after full init; same as NGENTOT_LC=NGEN_LC=0
        intended for internal use by sim_SNmix to get the 
        normalization.

      + New sim-input SIMLIB_MAXRANSTART to randomly start
        within a SIMLIB. See manual.  
        Useful with sim_SNmix when each job has NGEN < NLIBID.
        The random IDSTART ensures proper SIMLIB sampling.

      + move init_CIDRAN() before initializing SIMLIB.

    sim_SNmix.pl
      + for get_norm, pass "INIT_ONLY 1" argument instead of setting
        NGENTOT_LC=NGEN_LC=0.  Change made because cosB rate model
        uses NGENTOT_LC, thus setting NGENTOT_LC=0 cannot be used
        to get the LCLIB rate.


# ======================================================================= 
         v10_53d (Nov 27, 2017) 

         ***** IMPORTANT(v10_53d) ***** 

         ***** USEFUL(v10_53d) ***** 

         ***** MISCELLANEOUS(v10_53d) ***** 

   snlc_sim.c
     + fix command line arguments
          'SIMGEN_DUMP  0'   # print varList, then quit
          'SIMGEN_DUMP -9'   # turn off SIMGEN_DUMP from sim-input file

   New fit-clean arguments (see manual):
      split_and_fit.pl  CLEAN
      split_and_fit.pl  CLEANMASK <mask>
      split_and_fit.pl  CLEANMASK <mask>  NOPROMPT
  
   sntools_fluxErrModels.c
     + update for DES-SMP (from D.Brout)


# ======================================================================= 
         v10_53e (Nov 30 2017) 

         ***** IMPORTANT(v10_53e) ***** 

         ***** USEFUL(v10_53e) ***** 

         ***** MISCELLANEOUS(v10_53e) ***** 

   snlc_sim.c :
     + new option to ignore FLUXERR_COR map in SIMLIB file:
         SIMLIB_MSKOPT:  16
       And see stdout comment "SIMLIB IGNORE FLUXERR_COR map"

   SALT2mu_fit.pl:
     + new command-line arg  INPDIR+ <DIRNAME>, which overrides
       INPDIR+ keys in the input file
     + new command-line arg  STRINGMATCH: <string>
     + write gamma0[_err] to SUMMARY.DAT file

   snana.car :
     + fix bug applying MWEBV_SCALE and MWEBV_SHIFT. It worked when
       reading MWEBV fron data files, but NOT when computing
       MWEBV with modify_MWEBV() function.
       Affects snana.exe and snlc_fit.exe .

     + abort if FILTLIST_LAMSHIFT is used. Use only FILTER_LAMSHIFT.


# ======================================================================= 
         v10_53f (Dec 1 2017) 

         ***** IMPORTANT(v10_53f) ***** 

         ***** USEFUL(v10_53f) ***** 

         ***** MISCELLANEOUS(v10_53f) ***** 

   wfit.c :
    + fix so that M0DIF rows with z = -9 +_ 0 are skipped without ABORT.

   snlc_sim.c:
     + new function gen_TRIGGER_zHOST() to apply zHOST-dependent
       trigger efficiency before computing light curve. 
         --> VOLLIM-LOWZ sim goes much faster.
       Speed trick used only if SpecEff map is NOT defined.
     + for SIMGEN_DUMP, add hash (#) in front of all comments. 

   sim_SNmix.pl:
     + for catenated SIMGEN-dump file, remove duplicate NVAR and 
       VARNAMES keys.

   split_and_fit.pl :
     + fix dumb bug finding data in $SNDATA_ROOT/lcmerge.


# ======================================================================= 
         v10_53g (Dec 2 2017) 

         ***** IMPORTANT(v10_53g) ***** 

   + SALT2mu_fit.pl no longer unzips gzipped FITRES files in split_and_fit OUTDIR.

         ***** USEFUL(v10_53g) ***** 

   + Codes can read gzipped FITRES files: SALT2mu.exe, combine_fitres.exe

         ***** MISCELLANEOUS(v10_53g) ***** 

   sntools_output_text.c:
     + upgrade to check of file is gzipped, or if a gzipped version exists.
       If filename 'xyz.fitres' is passed to be opened, code automatically
       checks for xyz.fitres.gz.
 
   SALT2mu_fit.pl
     + if input FITRES files are gzipped, leave them gzipped.
     + no longer default HBOOK file; just a wast of disk space.
   sntools.pm: in parse_lines(), use zgrep on gz files.


# ======================================================================= 
         v10_53h (Dec 9 2017) 

         ***** IMPORTANT(v10_53h) ***** 

         ***** USEFUL(v10_53h) ***** 

         ***** MISCELLANEOUS(v10_53h) ***** 

    SALT2mu_fit.pl  CLEAN -->
        +  remove SALT2mu*HBOOK files
        +  gzip SALT2mu*FITRES files
        +  gzip SALT2mu*LOG    files

   sim_SNmix.pl
     + NGENTOT_LC and NGEN_LC keys are listed as last args
       instead of first args.

   combine_dataVersions.py :
     + merge each pair of duplicates into one data file (S.Hinton)
       See merged_*.dat files.  SURVEY name at top is whichever
       one is first with alphabetical list.

   snana.car
    + small bug fix in INI_WRFITS().
    + move SIM_PRESCALE call to SNANA_DRIVER so that events are rejected
      before doing Bazin/PEAKMJD fit.  For large SIM_PRESCALE, this
      change makes code MUCH MUCH faster.



# ======================================================================= 
         v10_54 (Dec 11, 2017) 

         ***** IMPORTANT(v10_54) ***** 

         ***** USEFUL(v10_54) ***** 

   SNANA_VERSION written to 
     * sim data file FITS header 
     * sim README
     * ascii FITRES file.

   New &SNLCINP input CUTWIN_TRESTRANGE (cut on TrestMax-TrestMin)

         ***** MISCELLANEOUS(v10_54) ***** 

   snana.car, snlc_fit.car:
     + SNTABLE_FILTER_REMAP now applied to LCPLOT table.
     + remove subroutine GET_SNANA_VERSIONS()
     + new &SNLCINP cut  CUTWIN_TRESTRANGE (cut on TrestMax-TrestMin)

   sntools.c[h] :
     + define SNANA_VERSION_CURRENT in sntools.h, 
       and add C function get_SNANA_VERSION().
    
   startSNANAversion.pl :
     + update to read SNANA_VERSION from sntools.h

   sntools_output_text.c:
     + For any program reading FITRES file, ABORT if both gzip 
       and unzip file exists.



# ======================================================================= 
         v10_54b (Dec 18, 2017) 

         ***** IMPORTANT(v10_54b) ***** 

         ***** USEFUL(v10_54b) ***** 

         ***** MISCELLANEOUS(v10_54b) ***** 

   SALT2mu_fit.pl :
     + if input FITRES files are gzipped, then catenated FITRES
       files are also gzipped.  Note that SALT2mu can read 
       gzipped FITRES files (few versions ago).


   wait_for_files.pl :
     if passing negative number of files (e..g, -6), interpret
     as BUSY logic and exist when there are fewer than 6 files.

   split_and_fit.pl:
    + when NJOB > NCORE, use BUSY logic instead of DONE logic
      to check when to submit another job into the queue.
      DONE logic can result in checking for thousands of files,
      and on cluster it hangs around 19,000 DONE files. There
      are fewer than 100 BUSY files, so this should be more robust.

   + speed-up tricks for NJOB >> NCORE. Mainly, if NSPLIT==1,
     use exact string match instead of wild-card --> much
     faster merging.

   snana.car, snlc_fit.car:
     + defined TRESTRANGE_FIT for FITRES table.
     + use IGNOREFILE in INIT_FUDGE_FLUXCAL()

   sntools_fluxErrModels.c :
      Restore from v10_53b. We did something bad (for DES_SMP)
      starting with v10_53c update, but not sure what.


# ======================================================================= 
         v10_54c (Dec 21 2017) 

         ***** IMPORTANT(v10_54c) ***** 

         ***** USEFUL(v10_54c) ***** 

   Fitting programs:
     + new &SNLCINP input   CUTWIN_PSF = 0.5, 2.75  ! arcsec

         ***** MISCELLANEOUS(v10_54c) ***** 

   snana.car:
     + new &SNLCINP input   CUTWIN_PSF = 0.5, 2.75  ! arcsec

     + Fix call to CHECK_EPOCH_IGNORE so that global epoch counters
       increment only once per event, and not a zillion times
       from SET_PEAKMJD fit. Does not affect analysis or fitting;
       only affects number of epohcs (bad,total) printed at end of job.

   split_and_fit.pl :
    + new key "NJOB_PER_BATCHFILE: <NJOB>"  (default is 1) 
      to combine <NJOB> jobs in each batch file submission.
      Goal is to reduce number of short batch jobs that have 
      lots of overhead.
   + minor fix for VERSION+FITOPT key

   sntools_output_text.c :
     + use fgets to speed up SNTABLE_NEVT_TEXT and general parsing.

   SALT2mu_fit.pl
    + fix STRINGMATHC_IGNORE to work with + sign in dir name.

   SALT2mu.c: 
    + minor refactor in calc_zM0_data() to make more clear
      that <mumodel> is used instead of <mu>. No change in output.


# ======================================================================= 
         v10_54d (Dec 21, 2017) 

         ***** IMPORTANT(v10_54d) ***** 

         ***** USEFUL(v10_54d) ***** 

         ***** MISCELLANEOUS(v10_54d) ***** 

    snana.car
     + new &SNLCINP input CCDNUM_LIST = 3,4,8
       to select specific CCD numbers. Later might add CCDNUM_IGNORE.


# ======================================================================= 
         v10_54e (Dec 27 2017) 

         ***** IMPORTANT(v10_54e) ***** 

         ***** USEFUL(v10_54e) ***** 

   Spec-Select function can depend on SALT2-mB

         ***** MISCELLANEOUS(v10_54e) ***** 

   sntools_trigger.c[h]:
    + allow Spec-select function to depend on mB

   SALT2mu_fit.pl :
     + if INPDIR+ argument contains FITRES files, then
       this version is fixed for all other surveys.

   genmag_LCLIB.c[h]
     + major re-factor to handle NON-RECURRING events with
       any time scale (tau << T_survey thru tau >> T_survey).
       It runs without aborting, but it's not well debugged.
       Also, gsl_ran_Poisson() doesn't work properly.
       Needs more debugging in next SNANA version.


# ======================================================================= 
         v10_55 (Dec 29 2017) 

         ***** IMPORTANT(v10_55) ***** 

   The following libraries & models can be read from 
   gzipped text files:
      SIMLIB, HOSTLIB, LCLIB, SIMSED, 
      SALT2*/*.dat, mlcs2k2*/*.dat

   Note linux commands zcat, zgrep (etc) to interrogate gzipped
   files without unzipping them.

         ***** USEFUL(v10_555) ***** 

         ***** MISCELLANEOUS(v10_55) ***** 

  sntools_trigger.c[h]:
    allow detection based on ABS(SNR) using  "ABS(SNR):" keys
    in SEARCHEFF_PIPELINE_FILE

  sntools.c :
    + fix getRan_Poisson(mean) for gennag_LCLIB (for non-recurring events)
    + move function open_TEXTgz from sntools_output_text.c to here,
      to be used by any other function (e.g., SIMSED, LCLIB, HOSTLIB ...)

  genmag_LCLIB.c[h]: more debugging after refactor.
     [still need to implement ANGLEMATCH ... ]


# ======================================================================= 
         v10_55b (Dec 31 2017) 

         ***** IMPORTANT(v10_55b) ***** 

         ***** USEFUL(v10_55b) ***** 

         ***** MISCELLANEOUS(v10_55b) ***** 

   genmag_LCLIB.c:
      + implement ANGLEMATCH_b and speed-up library-read with fgets.

   sntools_host.c:
     + speed up init: rdgalRow_HOSTLIB and zptr_HOSTLIB
     + ABORT if too few HOSTLIB GAL lines (but allow extra)


# ======================================================================= 
         v10_55c (Jan 5 2017) 

         ***** IMPORTANT(v10_55c) ***** 

         ***** USEFUL(v10_55c) ***** 

   Sim-input "USE_SIMLIB_DISTANCE: 1" will read "DISTANCE: d(Mpc)"
   from each SIMLIB header; D_L is inverted to zCMB.

         ***** MISCELLANEOUS(v10_55c) ***** 

   snana.car 
     + remove fortran PARSE_WORDS and replace with C utility
       STORE_PARSE_WORDS().  This refactor allows reading 
       gzipped data files.

     + Update SNLC_ZHD = ZCMB + ZPEC ->
 	      SNLC_ZHD = (1.0+SNLC_ZCMB) * (1.0+ZPEC) - 1.0
       (from Eq 1 in https://arxiv.org/abs/1012.2912 )

     + read VPEC & VPEC_ERR from data files (TEXT and FITS)

   sntools.c[h]:
     + added PARSE_WORDS utility to scoop up list of words
       in any file.

   snlc_sim.c :
     + remove LEGACY code to read SIMLIB.
     + remove obsolete sim-input GENRANGE_DLMAG
     + remove obsolete function genz_fromMU().
     + option to check each epoch for saturation; 
       see manual section "4.5.4 Saturation Option"
     + add sim-input key "VPEC_ERR: 200" for measured error.
     + write measured VPEC and VPEC_ERR to data file (text and FITS)
     + remove obsolete REDSHIFT_SN from fits data files.

   manual: 
    + new section 11.1 defining redshift variables in output tables
    


# ======================================================================= 
         v10_55d (Jan 6 2018) 

         ***** IMPORTANT(v10_55d) ***** 

         ***** USEFUL(v10_55d) ***** 

         ***** MISCELLANEOUS(v10_55d) ***** 

   snlc_sim.c:
    + start refactor of gen_event() so that zCMB & zHEL can
      be passed to gen_distanceMag function. Next version will
      break random sync, so cut version here for backup.
      Fundemental issue is that zCMB and MU are computed before
      SIMLIB_READ, but cannot compute z_helio until after reading
      RA & DEC from simlib event. Refactor is needed to compute
      distance after reading simlib (and after z_helio is computed), 
      instead of computing MU before simlib-read.

# ======================================================================= 
         v10_55e (Jan 6 2018) 

         ***** IMPORTANT(v10_55e) ***** 

         ***** USEFUL(v10_55e) ***** 

         ***** MISCELLANEOUS(v10_55e) ***** 

    snlc_sim.c :
     + do the main refactor in gen_event_driver by moving
       gen_distanceMag() and gen_shapepar() after SIMLIB_READ.
       No other changes.
       5 of 82 SNANA tests are different due to change
       in random sync.


# ======================================================================= 
         v10_56 (Jan 8 2018) 

         ***** IMPORTANT(v10_56) ***** 

     SIM computes dLmag with 1+zHel prefactor instead of 1+zCMB :
     DLMAG = (1+zHEL) * r(zCMB)

         ***** USEFUL(v10_56) ***** 

    util/update_data_files.pl

         ***** MISCELLANEOUS(v10_56) ***** 

    snlc_sim.c:
     + compute dLmag with 1+zHel prefactor instead of 1+zCMB
       24 of 87 SNANA tests have mis-match; typically 1 mmag
       change in x0.
       SALT2mu and wFit still use 1+zCMB prefactor, but goal
       here is to make sim more realistic so that small fitting
       mistake is the same on both data and sim.

   /util : 
    + remove obsolete scripts
         unfold_MCstaterr.pl survey_update.pl photoz_dataMC.pl
    + update PUBLIC_FILES
    + add new script  update_data_files.pl to read variables
      from a fitres file and append header in data files.
      See usage instructions at top of script.

   util/combine_dataVersions.py :
     + add input-option "VPEC_FILE:  <file>" 
       which calls update_data_files.pl .

   snana.car:
     + write zHEL[ERR] to text-fitres file. Allows computing
       D_L in comso-fit with correct (1+zHEL) prefactor.


# ======================================================================= 
         v10_56b (Jan 9 2018) 

         ***** IMPORTANT(v10_56b) ***** 

    sigma_z -> (1+z)*vpec/c in snana.exe and SALT2mu.exe

         ***** USEFUL(v10_56b) ***** 

         ***** MISCELLANEOUS(v10_56b) ***** 

    SALT2mu.c:
     + read vpec[err] stuff and input zpecerr replaces vpec/c
       from data file, not add to it. 
     + include (1+z) factor in front of zpecerr, which results
       in very tiny changes in SNANA_tester-SALT2mu jobs.

    snana.car:
     + fix sigma_z -> (1+z)*vpec/c; see Eq A1 from Davis 2012.


# ======================================================================= 
         v10_56c (Jan 11 2018) 

         ***** IMPORTANT(v10_56c) ***** 

         ***** USEFUL(v10_56c) ***** 

         ***** MISCELLANEOUS(v10_56c) ***** 

   sim_SNmix.pl
    + CIDRAN_MAX *= 1.1 so that random CID generation is more
      efficient in snlc_sim.

   snana.car:
     + new &SNLCINP input  VPEC_ERR_OVERRIDE = 300,
       intended for older samples for which VPEC[_ERR]
       are not specified in the data files.
 
   sntools.c :
     + add return argume GZIPFLAG  to open_TEXTgz and snana_openTEXT().
     + new function snana_rewind(fp,file,gzipFlag);
       for gz file, close and re-open since rewind(fp) works
       only for normal text files. Used for SIMLIB and LCLIB.


# ======================================================================= 
         v10_56d (Jan 12 2018) 

         ***** IMPORTANT(v10_56d) ***** 

         ***** USEFUL(v10_56d) ***** 

         ***** MISCELLANEOUS(v10_56d) ***** 

    sntools.c:
      + use pclose(fp) instead of fclose(fp)

    genmag_LCLIB.c
      + fix subtle memory-overwrite bugs
      + fix bug to free memory before each malloc

    snlc_sim.c :
       + use snana_rewind for reading SIMLIB file.


# ======================================================================= 
         v10_56e (Jan 16, 2018) 

         ***** IMPORTANT(v10_56e) ***** 

         ***** USEFUL(v10_56e) ***** 

   fitflag_sigmb is forced to correct value in SALT2mu's prepare_biasCor().


         ***** MISCELLANEOUS(v10_56e) ***** 

   sim_SNmix.pl :
     + Include "wrote" and Gen stats at end of summary file.
     + check for INPUT_FILE_INCLUDE among GENOPT, and copy
       to /misc.

   genmag_LCLIB.c :
    + add 1000 safety margin to malloc size to fix subtle bug.

   sntools_host.h :
     + MINLOGZ_HOSTLIB -> -2.52 (was -2.3)

   snlc_sim.c :
     + after call to gen_event_driver, continue if NEPOCH==0.

   SALT2mu.c
    + bug fix in override_parFile() so that command-line override
      works with "CUTWIN <var> <min> <max>"

    + in prepare_biasCor(), force correct fitflag_sigmb value,
      so that it works properly when opt_biascor is changed
      from 1D to 5D correction.


# ======================================================================= 
         v10_56f (Jan 17 2018) 

         ***** IMPORTANT(v10_56f) ***** 

         ***** USEFUL(v10_56f) ***** 

    new APPEND key in SIMLIB.

         ***** MISCELLANEOUS(v10_56f) ***** 

    snlc_sim.c :
     + see APPEND key in SIMLIB so that MJDs after APPEND key
       are not sorted by MJD.
     + text output data files: remove SNR,MAG,MAG_ERR; add PHOTFLAG.
     + still need to debug for SPECTROGRAPH; GENSPEC_DRIVER may
       need a separate random-number stream.

   sntools_spectrograph.h :
     #define ILIST_RANDOM_SPECTROGRAPH 2 
     and use this list under GENSPEC_DRIVER.
     Only 2 very small changes in SNANA_tester.
     Next SNANA version, ILIST_RANDOM_SPECTROGRAPH -> 3
     to be independent of other random streams.


# ======================================================================= 
         v10_57 (Jan 17 2018) 

         ***** IMPORTANT(v10_57) ***** 

         ***** USEFUL(v10_57) ***** 

         ***** MISCELLANEOUS(v10_57) ***** 

    sntools_spectrograph.h:
       ILIST_RANDOM_SPECTROGRAPH -> 3
       to use independent random number stream

    All SNANA_tester jobs fail due to change
    in random streams. 


# ======================================================================= 
         v10_57b (Jan 22, 2018) 

         ***** IMPORTANT(v10_57b) ***** 

         ***** USEFUL(v10_57b) ***** 

         ***** MISCELLANEOUS(v10_57b) ***** 

   snlc_sim.c :
    + finish debugging the SIMLIB-APPEND option when a 
      SPECTROGRAPH is used.
    + describe SIMLIB-APPEND option in manual.
    + avoid abort for SIMLIB entry with no spectrograph key.
        [so that a subset of cadences with SPECTROGRAPH is ok]


# ======================================================================= 
         v10_58 (Jan 23 2018) 

         ***** IMPORTANT(v10_58) ***** 

    +  &SNLCINP input SNTEL_LIST no longer allowed.

    +  Simulation writes compressed FITS.gz files.
       Can gzip all previously generated sim data files in 
       FITS format ... analysis programs will work.

         ***** USEFUL(v10_58) ***** 

         ***** MISCELLANEOUS(v10_58) ***** 

   sntools_fitsio.c:
    + remove a few obsolete PHOT-table variables from data files
       (TELESCOPE, MAG, MAGERR)
    + new FORMAT_MASK flag +-64 --> compact PHOT table 
        (removes RDNOISE,SKY_SIG_T,PSF_SIG2,PSF_RATIO,ZEROPT_ERR)
    + all FITS file written as compressed *FITS.gz.
      snana.exe and snlc_fit.exe can read them without any change.

   snana.car: 
     + new functino SET_MAG() computes SNLC_MAG from FLUXCAL 
         (just in case MAG is used somwhere)
     + &SNLCINP  SNTEL_LIST  no longer allowed -->
         will abort with error message to remove SNTEL_LIST
    
   sim_SNmix.pl : allow for *.FITS.gz
 

# ======================================================================= 
         v10_58b (Jan 24 2018) 

         ***** IMPORTANT(v10_58b) ***** 

         ***** USEFUL(v10_58b) ***** 

         ***** MISCELLANEOUS(v10_58b) ***** 

   sntools_fitsio.c: 
    + remove .gz extension from writint fits files  because
        * sim uses less memory to write unzip file, then
          sim_SNmix can gzip at the end
        * TEXT -> FITS translator in snana.exe should NOT gzip.

   sim_SNmix.pl :
     + gzip FITS files 
     + fix to gzip RANSEED_CHANGE as well as RANSEED_REPEAT

   snana.car:
     + update READ_HEADKEY to allow two different text formats
       for reading VAL and ERROR,
         1)  KEY:  XXX +-  XXX_ERR
              or
         2a)  KEY:      XXX
         2b)  KEY_ERR:  XXX_ERR

       Works now for 
          MWEBV[_ERR]
          HOSTGAL_LOGMASS[_ERR]
          HOSTGAL_PHOTOZ[_ERR]
       Later, can extend this feature to more header variables.


# ======================================================================= 
         v10_58c (Jan 25, 2018) 

         ***** IMPORTANT(v10_58c) ***** 

         ***** USEFUL(v10_58c) ***** 

         ***** MISCELLANEOUS(v10_58c) ***** 

    snana.car:
     + fix text-parsing bug in PARSE_SNDATA (see NWD_LOAD)
     
    snlc_sim.h: array bound changes for GW170814 (BBH event)
     + MXREAD_SIMLIB      -> 100000 (was 12000)
     + MXFIELD_OVP_SIMLIB -> 10 (was 5)
        --> changes random sync so that SNANA_tester has lots of failures.


# ======================================================================= 
         v10_58d (Jan 25 2018) 

         ***** IMPORTANT(v10_58d) ***** 

         ***** USEFUL(v10_58d) ***** 

         ***** MISCELLANEOUS(v10_58d) ***** 

    SALT2mu.c :
     + remove redshift cut in init_sigInt_biasCor_legacy()
       so that we get SNR>60 events even if user reqests
       high-z event that all have SNR<60.  See global flag
       SKIPZCUT_BIASCOR.

   snana.car 
    + for command-line override, use PARSE_INTLIST to parse 
      comma-separated lists for
         SNCID_LIST, SNTYPE_LIST, CCDNUM_LIST, SNTYPE_IGNORE
      Can now do
        FITOPT:  CCDNUM_LIST 4,12,41,55


# ======================================================================= 
         v10_58e (Jan 26 2018) 

         ***** IMPORTANT(v10_58e) ***** 

         ***** USEFUL(v10_58e) ***** 

         ***** MISCELLANEOUS(v10_58e) ***** 

   snlc_sim.c :
    + if USE_SIMLIB_DISTANCE then set wgt=1.0 so that DNDZ
      key can be left out of input file. Needed for BBH-analysis.

    + bug-fix in regen_SIMLIB_GENRANGES()

   snlc_fit.car :
     + new function SET_ZHD_PHOTOZ to translate fitted photoz
       (helio frame) into CMB frame, and to add ZPECERR.
       Note assumption that HOST_PHOTOZ is in helio frame.

   SALT2mu.c:
     + lots of refatoring to prepare for getting COV_INT(z,a,b)
       from biasCor sample. 


# ======================================================================= 
         v10_58f (Jan 27 2018) 

         ***** IMPORTANT(v10_58f) ***** 

         ***** USEFUL(v10_58f) ***** 

         ***** MISCELLANEOUS(v10_58f) ***** 

   SALT2mu.c :
     + refactor done so that (opt_biasCor & 256)>0 uses COV scale
       with sigmB fixed. Checked that varying sigmB, or varying
       SCALE_COVINT with fixed sigmB, give same results.
       Next SNANA version, will start working on COVINT_BIASCOR
       to replace sigma_int model.

   snlc_fit.car:
     + in SET_ZHD_PHOTOZ, and set SNLC_ZHELIO and SNLC_ZCMB.
     + in PRIOR_ZPULL, fix bug so that PRIOR_ZPULL=0 for noHOST.        


# ======================================================================= 
         v10_58g (Jan 28 2018) 

         ***** IMPORTANT(v10_58g) ***** 

         ***** USEFUL(v10_58g) ***** 

         ***** MISCELLANEOUS(v10_58g) ***** 

   SALT2mu.c :
     + finally works with full COVINT from biasCor sample using
       opt_biascor=368 (i.e., add 256 bit)

   snlc_fit.car:
     + few updates related to IDEAL fits:
        1) fix PKMJD = SIM_PKMJD
        2) compute mB_ideal from x0_ideal


# ======================================================================= 
         v10_58h (Feb 7 2018) 

         ***** IMPORTANT(v10_58h) ***** 

         ***** USEFUL(v10_58h) ***** 

         ***** MISCELLANEOUS(v10_58h) ***** 

   SALT2mu_fit.pl :
     + few fixes to work with INPDIR key

   snana.car:
    + new function CHECK_MAGCOR_INSTALL to avoid double-counting
      MAGCOR. Checks for header key  VERSION_INSTAL: <VERSION>
      UN-TESTED ... continue testing next version.

   split_and_fit.pl:
     + new input  'BATCH_MEM: <memoryMB>' to override 1000 MB default.

   sntools_fitsio.c :
     + add new photflag_open argument to rd_snfitsio_open(),
       so that only header file is opened during init stage
       to count events.

     + in RD_SNFITSIO_INIT, avoid opening the first PHOT file twice.
       Doesn't matter for reading unzipped FITS files, but for zipped
       files the extra open was costing up to an extra GB of memory.


# ======================================================================= 
         v10_58i (Feb 11 2018) 

         ***** IMPORTANT(v10_58i) ***** 

         ***** USEFUL(v10_58i) ***** 

         ***** MISCELLANEOUS(v10_58i) ***** 

   sim_SNmix.pl
    + fix done-logic to combine using LOCK file.


# ======================================================================= 
         v10_58j (Feb 12 2018) 

         ***** IMPORTANT(v10_58j) ***** 

         ***** USEFUL(v10_58j) ***** 

         ***** MISCELLANEOUS(v10_58j) ***** 

    Start refactor of codes to scale fluxErrors in simulation
    and in snana.exe
     + rm sntools_imageNoiseModels.c[h]
     + combine legacy codes into sntools_fluxErrModels_legacy.c[h]
     + start new code sntools_fluxErrModels.c[h]
    Goal is to treat all fluxErr maps in a unified framework 
    and make a single call, instead of the current 3 calls.
    Another problem is that while all 3 error fudges are applied
    in the simulation, only the hostNoise fudge is applied to  
    the data.

   sntools.c:
     + init_interp_GRIDMAP(): malloc gridmap here instead of outside fun.
     + refactor GRIDMAP tools so that all indices go from 0 to N-1
         (no more 1 to N)

   snana.car:
     if USE_SNHOST_ZPHOT=T, convert it to CMB frame.


# ======================================================================= 
         v10_58k (Feb 14 2018) 

         ***** IMPORTANT(v10_58k) ***** 

         ***** USEFUL(v10_58k) ***** 

         ***** MISCELLANEOUS(v10_58k) ***** 

    sntools.c
      + fix refactor bug in init_interp_GRIDMAP().

    snlc_sim.c/gen_smearFlux
      + refactor a little to clean up
      + separate SEARCH and ZP randoms instead of lumping them
         together. Allows more flexibility in how ZPTSIG noise
         is added.  Note that random sync is changed !!!



# ======================================================================= 
         v10_58l (Feb 15 2018) 

         ***** IMPORTANT(v10_58l) ***** 

         ***** USEFUL(v10_58l) ***** 

   new sim-input feature, FLUXERRMODEL_FILE: <fileName>
   to implment arbitrary collection of multi-dimensional 
   maps to scale the flux-errors.

         ***** MISCELLANEOUS(v10_58l) ***** 

   sntools_fluxErrModels.c[h]; 
     + it's working ! Tested on SDSS-SIMLIB map.
     + still do do: invoke mechanism to apply error fudge
       to sim, but not to the reported errors in data files.

   sntools_host.c : minor bug fix for MSKOPT&64

   manual:
    + added subsec 9.8 to describe LCLIB (galactic transients)


# ======================================================================= 
         v10_58m (Feb 19, 2018) 

         ***** IMPORTANT(v10_58m) ***** 

         ***** USEFUL(v10_58m) ***** 

         ***** MISCELLANEOUS(v10_58m) ***** 

   snana.car:
    + remove CCDNUM condition for output table so that
      CCDNUM is always there.

    + integrate new &SNLCINP input FLUXERRMODEL_FILE to 
      implement same error fudges as in the simulation.

   util/snmake.pl : few fixes

   snlc_sim.c :
     + protect against too-large SIMLIB_MAXRANSTART 

     + new sim-input key for correlated randoms among
       two SIMSED parameters,
          SIMSED_REDCOR(varname1,varname2): <rho>
       where -1 < rho < +1
       Code is NOT debugged yet ; next version.
       Code structure works ONLY for 2 random variables;
       for >2 random variables, requires refactor.

   sntools_genGauss_asym.c[h]:
     + add new "redCor" variables to genGauss typedef.
     
   manual: new Sec 4.11 explaining FLUXERRMODEL.


# ======================================================================= 
         v10_58n (Feb 20 2018) 

         ***** IMPORTANT(v10_58n) ***** 

         ***** USEFUL(v10_58n) ***** 

         ***** MISCELLANEOUS(v10_58n) ***** 

   snlc_sim.c
    + fix bug in function checkpar_SIMSED()/
    + get SIMSED_REDCOR feature working.

   manual: 
     + cleanup up SIMSED Section 9.4, and explain SIMSED_REDCOR.


# ======================================================================= 
         v10_58o (Feb 22 2018) 

         ***** IMPORTANT(v10_58o) ***** 

         ***** USEFUL(v10_58o) ***** 

         ***** MISCELLANEOUS(v10_58o) ***** 

   sntable_dump.pl[src] :
     + new "obs" argument to dump all observations and
       information needed to compute flux-error maps.

       For making FLUXERRMAPs, beware that a few dump variables 
       must be converted as follows:
         SBMAG = 27.5-2.5*log10(SBFLUXCAL), with protection for SBFLUX<0
         sigma_SIM   = ERRTEST * FLUXCAL_DATA_ERR
         PSF(arcsec) = PSF(sig,pixels) * 2.35*pixsize

# ======================================================================= 
         v10_58p (Feb 26 2018) 

         ***** IMPORTANT(v10_58p) ***** 

   analysis: if REDSHIFT_HELIO=-9 in data file, ZHELIO will be 
   computed from ZCMB instead of setting ZHELIO=ZCMB.

         ***** USEFUL(v10_58p) ***** 

         ***** MISCELLANEOUS(v10_58p) ***** 

   snlc_sim.c
    + fix argument in call to get_FLUXERRMODEL
    + SBmag -> min(SBmag,32) for  argument to get_FLUXERRMODEL
       --> limit size of map covering absurdly faint SB    
    + set default FLUXERRMAP extrapolation ON, and keep count
      of how many extraps are done. Print extprapolation summary
      at end of job.
    + new funtions gen_shapepar_SALT2() and gen_shapepar_SIMSED().

   SALT2mu.c :
     protect agains LOGMASS_TAU=0

   snana.car:
     + new function to set SNLC_ZHELIO if it is undefined (-9).
       Transform zCMB -> zHELIO in this case.
       Small changes in fitting old samples (LOWZ,SNLS)
       that only have CMB redshift in their data files.


# ======================================================================= 
         v10_58q (Feb 28 2018) 

         ***** IMPORTANT(v10_58q) ***** 

         ***** USEFUL(v10_58q) ***** 

         ***** MISCELLANEOUS(v10_58q) ***** 

   snlc_sim.c 
     + update SIMSED model to allow multiple covariance terms
       for Gaussian profiles, and use Cholesky decomp.
       See updated Manual section 9.4.

   snana.car/snlc_fit
     + new &SNLCINP inputs,
           CUTWIN_ZPADU = xx, yy  ! cut on ZP in ADU
               or
           CUTWIN_ZPNPE = xx, yy  ! cut on ZP in Npe
       to make epoch-cut on ZEROPT.
       Beware that ZP in EPOCH/RESIDUAL tables is ZP(ADU),
       regardless of which CUTWIN_ZP-option is used.


# ======================================================================= 
         v10_58r (Mar 1 2018) 

         ***** IMPORTANT(v10_58r) ***** 

         ***** USEFUL(v10_58r) ***** 

         ***** MISCELLANEOUS(v10_58r) ***** 

   snana.car
     + read LCLIB params and add to output table 
          (analogous to SIMSED params)

   sntools_fitsio.c 
     + fix so that analysis reads LCLIB parameters

   snlc_sim.c
     + for LCLIB model, fix nasty error-bug in gen_smearFlux().
     + fix Cholesky-COV index bugs in gen_shapepar_SIMSED 


# ======================================================================= 
         v10_58s (Mar 03 2018) 

         ***** IMPORTANT(v10_58s) ***** 

         ***** USEFUL(v10_58s) ***** 

         ***** MISCELLANEOUS(v10_58s) ***** 

   snana.car:
     + ignore FLUXERRMODEL_FILE if LSIM_SNANA=T (i.e., only for data)
     + new input SIM_FLUXERRODEL_FILE to test maps on sim data
     + protect log10(SNR) against SNR<0
     + init SNLC_SKYSIG_T(ep) = 0 inside functino INIT_SNDATA().
     + read SIM_FLUXCAL_HOSTERR from FITS file, and store in 
       SNANA+EPOCHS table.

   SALT2mu.c:  
     + include M0DIF in fitres output, along with comment
       at top of fitres output:
           MU-RESIDUAL NOTE: MURES = MU-(MUMODEL+M0DIF) 

   snlc_sim.c :
     + write out SKYSIG_T (template sky noise) scaled to search
       image. This has no effect on simulation, or LC fitting,
       but affects error-calculation that is used to tune
       simulated and data errors.  Bug had caused SKYSIG_T
       contribution to noise to be too big. There is no change
       in FLUERRCALC subroutine in snana.car, where the error 
       is calculated.
    
    + new sim-input option
        SIMLIB_MSKOPT:  16  # ignore template noise in simlib
  
    + write SIM_FLUXCAL_HOSTERR to PHOT.FITS file


# ======================================================================= 
         v10_58t (Mar 11 2018) 

         ***** IMPORTANT(v10_58t) ***** 

         ***** USEFUL(v10_58t) ***** 

         ***** MISCELLANEOUS(v10_58t) ***** 
   
   snlc_sim.c
     + SMEARFLAG_ZEROPT=0 by default
     + sim input "SMEARFLAG_FLUX: 2" reports errors
       without galaxy or source; just sky noise.
     + fix a few Mac-related issues found by D.Jones.
     + fix PIXSIZE to work with different PIXSIZE values
       in SIMLIB (SIMLIB_prepCadence, and Sec 4.8 in manual).

   sntools_trigger.c
    + new function check_APPLYMASK_SEARCHEFF() to abort
      if user requests impossible trigger mask. Example
      is requiring zHOST trigger with 100% EFFspec.

    + refactor SEARCHEFF_PIPELINE functions to allow for
       more general dependence on bands and fields.
       Begin working on PHOTPROB map.

   snana.car 
    + add few more SNANA-table variables: PHOTPROB_MIN & NEPOCH_PHOTPROB


# ======================================================================= 
         v10_59 (MAr 15 2018) 

         ***** IMPORTANT(v10_59) ***** 
 
         ***** USEFUL(v10_59) ***** 

   New PHOTPROB map option to simulate things like Machine-learning
   score.  Manul update needed next version after more testing.

         ***** MISCELLANEOUS(v10_59) ***** 

   sntools_trigger.c[h]
    + lots of refactoring to make the maps more similar among
         DETECT, PHOTPROB, SPEC, zHOST
      and to replace fortran-like indices with 0 to N-1.

    + PHOTPROB map working, although distribution is flat
      within each PHOTPROB bin.

    + if NMAP_PHOTPROB=0, write PHOTPROB=0.

   snlc_sim.c :
    + in gen_TRIGGER_zHOST(), bail of zHOST is not required
      by user --> allows generating photometric sample with
      and without spec zHOST.
 
    + new set of randoms, SEARCHEFF_RANDOMS.PHOTPROB[obs].



# ======================================================================= 
         v10_59b (Mar 15 2018) 

         ***** IMPORTANT(v10_59b) ***** 

         ***** USEFUL(v10_59b) ***** 

         ***** MISCELLANEOUS(v10_59b) ***** 

   sntools_trigger.c
     + fix computation of MJD_TRIGGER
     + new option to set PHOTFLAG bit for trigger;
         see PHOTFLAG_TRIGGER key in PIPELINE file.


# ======================================================================= 
         v10_59c (Mar 17, 2018) 

         ***** IMPORTANT(v10_59c) ***** 

   snlf_fit.car: 
    For photo-z fits, add empirical fix to pathological fit errors;
    on last iteration, shift INIVAL by INISTP/10.
    All photo-z fits are slightly changed.
    See subroutine FITINI_PHOTOZ. 

         ***** USEFUL(v10_59c) ***** 

         ***** MISCELLANEOUS(v10_59c) ***** 

   sntools_trigger.c
     + fix trigger bug related to first observations.

   snlc_sim.c :
     in setz_unconfirmed(), z -> HOST_PHOTOZ if no zHOST(spec) is found.
     In particular, SEARCHEFF_MASK=1 --> HOST_PHOTOZ, 
     while SEARCHEFF_MASK=5 --> HOST_SPECZ.
     Updated manual to explain.

     New counter on events rejected because NEPOCH < 1.
     This category is printed separately from CUTWIN failure.

  snlc_fit.car
    + INISTP_COLOR -> 0.03 (was 0.2)
    + last iteration of photo-z fit, make small shift in all INIVAL
      to avoid sitting on exact minimized values at start of 
      last fit-iter.
    

# ======================================================================= 
         v10_59d (Mar 19 2018) 

         ***** IMPORTANT(v10_59d) ***** 

   photo-z fit (snlc_fit.car); for SALT2 error calc, fix z=z(iter-1)
   to reduce pathological fit errors. See subroutine SALT2zz.

         ***** USEFUL(v10_59d) ***** 

   New sim-input "MAGMONITOR_SNR: <mag>"  to monitor SNR at fixed mag.
   See manual section 4.5.6.

         ***** MISCELLANEOUS(v10_59d) ***** 
  
   snlc_sim.c
    + store_SIMLIB_SEASON(), fix index bug stripping MJD index.
      Affects "SIMLIB_MSKOPT: 4" to keep all observations in a season.

    + new sim-input 
          MAGMONITOR_SNR:  20  # must be integer mag
      to compute and store SNR for mag=MAGMONITOR_SNR at each epoch.
      See new PHOT column  SIM_SNRMAG[mag].
      Can be used to reject poor observing conditions.

  snana.car:
    + if SIM_SNRMAG[mag] column exists in sim data files, add this
      column to the SNANA+EPOCHS table.


# ======================================================================= 
         v10_59e (Mar 20 2018) 

         ***** IMPORTANT(v10_59e) ***** 

         ***** USEFUL(v10_59e) ***** 

         ***** MISCELLANEOUS(v10_59e) ***** 
 
   snana.car, snlc_fit.car :
       New SNTABLE_LIST option 'FITRES NOZPHOT' to suppress
       ZPHOT variables from output.  Useful to make photoz
       output look the same as output from 4-parameter fits
       so that ZSPEC & ZPHOT FITRES output can be combined.
       Search NOZPHOT in manual.


# ======================================================================= 
         v10_59f (Mar 23 2018) 

         ***** IMPORTANT(v10_59f) ***** 

    SALT2mu.c:
      if OPT_PHOTOZ column exists in data & biasCor,
      automatically split biasCor into zSPEC and zPHOT.

         ***** USEFUL(v10_59f) ***** 

         ***** MISCELLANEOUS(v10_59f) ***** 

   snlc_sim.c, sntools_host.c:
     + fix bug so that SNMAGSHIFT from WGTMAP (HOSTLIB_MSKOPT+=4)
       works without also having to specify HOSTLIB_MSKOPT+=64.
       See USE1 && USE2 in functions override_SNPARVAL_from_SNHOST()
       and SNPARVAL_from_SNHOST().

    + abort of HOSTLIB_MSKOPT+=64 is set, but no SN params
      are specified in the HOSTLIB.


# ======================================================================= 
         v10_59g (Mar 27 2018) 

         ***** IMPORTANT(v10_59g) ***** 

         ***** USEFUL(v10_59g) ***** 

         ***** MISCELLANEOUS(v10_59g) ***** 

    SALT2mu.c :
     + add MUREF column in M0DIF output.

    snlc_sim.c[h] :
      SIMLIB_MSKOPT += 128 --> keep every MJD in season 
            [was +-4 in previous versions]
      SIMLIB_MSKOPT += 256 --> keep every MJD in survey
            [new option]

      fix a few compilation bugs found by Lluis.


# ======================================================================= 
         v10_59h (Mar 28 2018) 

         ***** IMPORTANT(v10_59h) ***** 

         ***** USEFUL(v10_59h) ***** 

         ***** MISCELLANEOUS(v10_59h) ***** 

   sntools_trigger.c[h]
     fix index bug for SEARCHEFF_DATA.SBMAG[ifiltobs]; 
    index is filter-index, not obs-index. Affects PHOTPROB feature.

   snlc_sim.c[h]:
     + read new sim-input  HOSTLIB_SERSIC_SCALE: <scale>  
       to scale a0 & b0 sizes.
     + read new sim-input key "HOSTLIB_GENZPHOT_BIAS: <3rd order poly>"

   sntools_host.c[h]:
     + float -> double in functions
         GEN_SNHOST_ZPHOT_from_CALC &  GEN_SNHOST_ZPHOT_from_HOSTLIB
     + implement HOSTLIB_SERSIC_SCALE & HOSTLIB_GENZPHOT_BIAS
       Beware: latter optio is NOT tested !


# ======================================================================= 
         v10_59i (Apr 2 2018) 

         ***** IMPORTANT(v10_59i) ***** 

         ***** USEFUL(v10_59i) ***** 

         ***** MISCELLANEOUS(v10_59i) ***** 

   sntools_host.c:
     fix ZPHOT_ERR in function GEN_SNHOST_ZPHOT_from_CALC();
     Reported ZPHOT_ERR = sigma_core, not true sigma.

   sntools_genSmear.h
      + MXLAM_GENSMEAR_SALT2 --> 4000 (was 1000)  
         [needed for SALT2-extended model]

   SALT2mu.c
     + add two optional fit parameters: 
        p15 = dAlpha/dlog(Mhost) 
        p16 = dBetaa/dlog(Mhost)
  
   genmag_NON1ASED.c :
     + extend hard-coded Trest_Range to -150:500 (was -30:100)

# ======================================================================= 
         v10_59j (April 4, 2018) 

         ***** IMPORTANT(v10_59j) ***** 

         ***** USEFUL(v10_59j) ***** 
 
   snlc_fit.car
     + new &FITINP input
          PRIOR_COLOR_RANGE(2)
          PRIOR_COLOR_SIGMA
       to prevent crazy color values, mainly for photo-z fit.
 
         ***** MISCELLANEOUS(v10_59j) ***** 
 
     + subtle fix in CHI2_PRIOR() to handle new PRIOR_COLOR.

   simlib_coadd.c, simlib_tools.c :
     + long int IDEXPT -> char STRINGID[20] to allow ID*NEXPOSE


# ======================================================================= 
         v10_59k (Apr 5 2018) 

         ***** IMPORTANT(v10_59k) ***** 

         ***** USEFUL(v10_59k) ***** 

         ***** MISCELLANEOUS(v10_59k) ***** 

   snlc_fit.car
     + fix bug in subroutine GET_SIMCHI2_CHEAT() so that it works
       properly when CC redshift is very different from photo-z
       fitted redshift.

   snlc_sim.c :
     + add/fix rate model.


# ======================================================================= 
         v10_60 (Apr 8 2018) 

         ***** IMPORTANT(v10_60) ***** 

         ***** USEFUL(v10_60) ***** 

   PHOTPROB simulation: implement correlations

         ***** MISCELLANEOUS(v10_60) ***** 

   sntools_trigger.c[h]:
     + refactor PHOTPROB routines to allow for correlated
       PHOTPROB values.
     + read optional REDUCED_CORR to have correlated PHOTPROB.
   
   snana_manual : add explanation of REDUCED_CORR.


# ======================================================================= 
         v10_60b (Apr 12 2018) 

         ***** IMPORTANT(v10_60b) ***** 

         ***** USEFUL(v10_60b) ***** 

         ***** MISCELLANEOUS(v10_60b) ***** 

   sntools_SEDtools.c[h]
     + found SIMSED problem writing binary file with floats because
       sometimes FLUX ~ E39 (with FLUXSCALE ~ E-41), and E39 overflows 
       float, resulting in garbage. Fix is to write FLUX*FLUXCALE, and
       after read-back, FLUX /= FLUXSCALE.       

# ======================================================================= 
         v10_60c (Apr 13 2018) 

         ***** IMPORTANT(v10_60c) ***** 

         ***** USEFUL(v10_60c) ***** 

         ***** MISCELLANEOUS(v10_60c) ***** 

    MWgaldust.c : 
       + fix Shlaffly 2011 optoin to 0.86*MWEBV, rather than
          2-tiered correction.
       + Also, error is .05*MWEBV instead if 10%.


# ======================================================================= 
         v10_60d (Apr 15 2018) 

         ***** IMPORTANT(v10_60d) ***** 

         ***** USEFUL(v10_60d) ***** 

         ***** MISCELLANEOUS(v10_60d) ***** 

   snlc_sim.c:
     new sim-input to dump fluxerrmaps:
        FLUXERRMODEL_OPTMASK: 256

   snlc_fit.car:
     new &SNLCINP input to dump fluxerrmaps 
        FLUXERRMODEL_OPTMASK = 256

   manual: update Section on fluxerrmaps.


# ======================================================================= 
         v10_60e (April 27 2018) 

         ***** IMPORTANT(v10_60e) ***** 

         ***** USEFUL(v10_60e) ***** 

         ***** MISCELLANEOUS(v10_60e) ***** 

    sntools_fitsio.c
      + For COMPACT format (FORMAT_MASK +=64), noticed that GAIN is 
        removed and thus cannot cut on CUTWIN_ZPNPE. No change made 
        here, but will think about whether GAIN should be kept for 
        COMPACT format.
        Added GAIN to list of removed items in manual.

    genmag_SEDtools.h 
      +  MXBIN_DAYSED_SEDMODEL -> 400 (was 250)

    snlc_sim.c[h]:
      + GENAV_WV07 key -> WV07_GENAV_FLAG
      + new sim-input key  "WV07_REWGT_EXPAV: xxx" will scale
        the exponent component of host exinction.


# ======================================================================= 
         v10_60f (April 30, 2018) 

         ***** IMPORTANT(v10_60f) ***** 

         ***** USEFUL(v10_60f) ***** 

         ***** MISCELLANEOUS(v10_60f) ***** 

   genmag_SIMSED.c : 
     + always call shiftPeak, not just when T[0]>0.
     + fix bugg fwrite statements.

   genmag_SEDtools,genmag_SIMSED.c[h]:
     + compute global SEDMODEL.MINDAY_ALL and SEDMODEL.MAXDAY_ALL
       so that Sinterp=0 for Trest outside this range and doesn't
       call interp_flux_SIMSED().

   sim_SNmix.pl :
      for get_normalization step, add argument "SIMLIB_MAXRANSTART 0"


# ======================================================================= 
         v10_60g (May 9 2018) 

         ***** IMPORTANT(v10_60g) ***** 

     + fix awfull VPEC parsing bug for TEXT format. 

         ***** USEFUL(v10_60g) ***** 

         ***** MISCELLANEOUS(v10_60g) ***** 

   snana.car, snlc_fit, psnid: :
     + fix VPEC parsing for TEXT format. Subroutine READ_HEADKEY().
          [was replacing VPEC = VPEC_ERR]
     + for TEXT format, can now read either VPEC & VPEC_ERR separately,
       or read "VPEC:  xxx +- yyy"
     + MNFIT_STOREPAR: init FITERRMAT=0 instead of -9

   SALT2mu_fit.pl:
     + in function cat_inpFiles(), abort if both gzipped and unzipped
       FITRES files are found.

   SALT2mu.c :  minor fixes in zerr_adjust for option to change zpecerr.

   genmag_SIMSED.c, genmag_NON1ASED.c 
     + automatically extrapolate for Trest > SEDMODEL.MAXDAY.
       Linear mag-extrap, same as for SALT2 model.

   snlc_sim.c:  
    + new sim-input to cut on saturations:
        CUTWIN_NOBS_SATURATE:   0 3  ugrizY   # reject if any band has >3 sats
        CUTWIN_NOBS_NOSATURATE: 4 500 ugrizY  
      See manual.

  misc: fix a few compilation warnings found by Rahul/


# ======================================================================= 
         v10_60h (May 10 2018) 

         ***** IMPORTANT(v10_60h) ***** 

         ***** USEFUL(v10_60h) ***** 

    See sim_SNmix updates to TOTAL_SUMMARY.LOG (below)

         ***** MISCELLANEOUS(v10_60h) ***** 

    snlc_sim.c :
     + apply CUTWIN_NOSATURATE_NOBS cut only if total number
       of observation is at least as big.

     + new sim-input key "SEARCHEFF_SPEC_SCALE: 0.2" to scale
       the spec-efficiency map read from file. Default scale=1.0.

    sim_SNmix.pl: 
     + do alphabet-sort for lines in TOTAL_SUMMARY.LOG
     + update TOTAL_SUMMARY.LOG to include NSPEC.

    sntools.c :
     + fix array bug in store_PARSE_WORDS so that more than 700 
       words in a string can be parsed.


# ======================================================================= 
         v10_60i (May 10 2018) 

         ***** IMPORTANT(v10_60i) ***** 

         ***** USEFUL(v10_60i) ***** 

         ***** MISCELLANEOUS(v10_60i) ***** 

   sntools_host.c :
    + if photo-z outlier sigma > 10 (b1 parameter in manual),
      then pick host ZPHOT from flat distribution.

   sntools_host.c:
     + extend max z range from 3.16 to 4.0 by increasing
       NZPTR_HOSTLIB and MAXLOGZ_HOSTLIB.

   snlc_sim.c:
     + new input for GENZPHOT_FUDGEPAR to specify flat
       outlier distribution and zPHOT range.


# ======================================================================= 
         v10_60j (May 15 2018) 

         ***** IMPORTANT(v10_60j) ***** 

         ***** USEFUL(v10_60j) ***** 

         ***** MISCELLANEOUS(v10_60j) ***** 

  snlc_sim.c :
    + for LCLIB model, turn off HOSTLIB.
    + new sim-input 
         OPTMASK_T0SHIFT_EXPLODE: <OPTMASK>
      to shift T=0 to be explosion time instead of peak time.
      Beware that new NON1ASED default is to shift T0 to
      time of peak brightness --> small change in SNANA_tester.


# ======================================================================= 
         v10_60k (May 18 2018) 

         ***** IMPORTANT(v10_60k) ***** 

         ***** USEFUL(v10_60k) ***** 

         ***** MISCELLANEOUS(v10_60k) ***** 

   split_and_fit.pl 
    + use wait_for_files to make sure snlc_fit.exe (or psnid.exe)
      exists before running job. Will hopefully work if the
      executables are temporarily unavailable duing the 
      'make' process.
    + print message to screen about removing old OUTDIR, 
      and to be patient.

   snlc_sim.c :
    + new input key  MJD_EXPLODE: <MJD> 
    + new input key  OPTMASK_T0SHIFT_EXPLODE: <opt> 
    + See new manual section on explosion time

   genmag_SEDtools.c:
     implement few options for OPTMASK_T0SHIFT_EXPLODE;
     define T_EXPLODE when FLUX > FLUXMAX/100 (OPTMASK=1)
     opr FLUXMAX/1000 (OPTMASK=2).
     Beware: Tested for NON1ASED, but not tested for SIMSED.

  sntools_host:
    + in GEN_SNHOST_ZPHOT_from_HOSTLIB, if either zphot or 
      zphoterr< 0, set both to -9.


# ======================================================================= 
         v10_60l (May 22 2018) 

         ***** IMPORTANT(v10_60l) ***** 

         ***** USEFUL(v10_60l) ***** 

         ***** MISCELLANEOUS(v10_60l) ***** 

   snlc_sim.c
     + ignore lensing init for LCLIB.
     + new sim-input key   "UVLAM_EXTRAPFLUX:  500"  will 
       extrapolate flux down to 500 A, avoiding UV bands
       from dropping out. Works for NON1ASED and SIMSED.
       See manual section 4.25.2 Extrapolating UV Flux.

   genmag_LCLIB.c: 
     + fix b<->l bugs
     + read b or GLAT; read l or GLON


# ======================================================================= 
         v10_60m (May 23 2018) 

         ***** IMPORTANT(v10_60m) ***** 

         ***** USEFUL(v10_60m) ***** 

         ***** MISCELLANEOUS(v10_60m) ***** 

   sim_SNmix.pl
     - new key  "FIRST_CIDOFF: 1000000" will burn 1 million random CIDs
       before starting. Combined with "RESET_CIDOFF: 2", this new key
       allows independent CIDs among multiple sim_SNmix jobs.
       Prelim test shows fewer duplicates among separate sim_SNmix jobs, 
       but not zero ??

   snana.car:
     + ISTAT_MAGCOR_ADD: skip lines with '#', since these comment
       lines were causing core dumps.

   snlc_fit.car:
     + fill new array LCERRDIF_STORE = fraction error change on
       last fit iteration. Loadd [var]ERRDIF into FITRES table.
       
     + new FITINP namelist INIVAL_SHIFT_ERRFRAC adds small
       extra shift to INIVAL after 1st iter:
          INIVAL += FITERR(last_iter) * INIVAL_SHIFT_ERRFRAC
       Goal here is to reduce pathological fit-errors.

# ======================================================================= 
         v10_60n (May 24 2018) 

         ***** IMPORTANT(v10_60n) ***** 

         ***** USEFUL(v10_60n) ***** 

         ***** MISCELLANEOUS(v10_60n) ***** 

    snlc_fit.car:
      new &FITINP variable
         FRACERRDIF_REPEATFIT = 0.5
      will repeat entire fit with MINOS if cFRACERRDIF > 0.5
      The hope is that unstable error can be cured by
      re-doing the fit with the MINOS option.


# ======================================================================= 
         v10_60o (May 29 2018) 

         ***** IMPORTANT(v10_60o) ***** 

         ***** USEFUL(v10_60o) ***** 

    sim_SNmix.pl
      + allow comment string on GENVERSION or GENOPT line:
          GENVERSION:  MYSURVEY           # bla bla
          GENOPT: GENPEAK_SALT2c  0.0044  # systematic test


         ***** MISCELLANEOUS(v10_60o) ***** 

    snana.car:
     + for re-fits with MINOS, MNSTAT_COV += 10 (see FITRES table)
     + if USE_MINOS=T, first fit-iteration uses MIGRAD to save
       some time. With this trick, USE_MINOS is x2.5 slower instead
       of x4 slower.

    snlc_sim.c
      + b,l -> l,b in GALrate function
   
    genmag_SEDtools.c
      + subtle fix in function UVLAM_EXTRAPFLUX_SEDMODEL()
        to extaploate UV flux from minLam with non-zero flux.
 


# ======================================================================= 
         v10_61 (May 31 2018) 

         ***** IMPORTANT(v10_61) ***** 

         ***** USEFUL(v10_61) ***** 

         ***** MISCELLANEOUS(v10_61) ***** 

   sntools_genSmear.c :
     + function init_genSmear_SALT2, pass path/version 
       instead of just version.

   sntools_genSmear.c
     + new option to read wavelength-dependent sigma_int
       the SALT2.INFO file: e.g., 
          SIGMA_INT(1000,9000,20000):  0.12,0.09,0.050
              or
          SIGMA_COH(1000,9000,20000):  0.12,0.09,0.050
       Motivation is to approximate reduced IR scatter
       for SALT2.P18-UV2IR.

    Created new program SIMSED_rebin.c.
    Just an empty shell to be finished next versoin.


# ======================================================================= 
         v10_61b (May 31 2018) 

         ***** IMPORTANT(v10_61b) ***** 

         ***** USEFUL(v10_61b) ***** 

    SIMSED_rebin.c : finish writing code.

         ***** MISCELLANEOUS(v10_61b) ***** 

    sntools_genSmear.c
      + silly bug fix for new SIGMA_COH-vs-lam feature.

    genmag_SEDtools.c[h]:
      + rename function malloc_TEMP_SEDMODEL -> 
           malloc_SEDFLUX_SEDMODEL(SEDMODEL_FLUX, NDAY, NLAM, NSED)
        and add arguments for optional override of default
        malloc sizes
        Initial use is new SIMSED_rebin function.


# ======================================================================= 
         v10_61c (Jun 01, 2018) 

         ***** IMPORTANT(v10_61c) ***** 

         ***** USEFUL(v10_61c) ***** 

         ***** MISCELLANEOUS(v10_61c) ***** 

    snlc_sim.c[h]:
      + new sim-input cuts
          CUTWIN_REDSHIFT_TRUE:  <zmin> <zmax>
          CUTWIN_REDSHIFT_FINAL:  <zmin> <zmax>

    genmag_LCLIB.c[h]:
      + if any PARVAL is REDSHIFT, set IPAR_REDSHIFT and REDSHIFT
        ... needed to set redshift in data file.


# ======================================================================= 
         v10_61d (Jun 2 2018) 

         ***** IMPORTANT(v10_61d) ***** 

         ***** USEFUL(v10_61d) ***** 

         ***** MISCELLANEOUS(v10_61d) ***** 

    snlc_sim.c:
      + new option "SEARCHEFF_zHOST_FILE: ZERO" will force
         default EFF_zHOST=0 instead of 1.

      + new option "SEARCHEFF_SPEC_FILE: ZERO" will force
         default EFF_SPEC=0 instead of 1.

      + For LCLIB model, set SEARCHEFF_zHOST_FILE = 'ZERO'

      + gen_TRIGGER_PEAKMAG_SPEC(): bail for LCLIB since
          peakMag is ill-defined. Probably a bug-fix

   genmag_LCLIB.c[h]
      + new function args return ztrue and zphot[err]. Default is to 
        return all zeros, unless REDSHIFT is one of the PARNAMEs in the 
        LCLIB header.
        Photo-z resolution is hard-wired to 0.05*(1+ztrue), but this
        parameter can be input later via LCLIB header.


# ======================================================================= 
         v10_61e (June 7 2018) 

         ***** IMPORTANT(v10_61e) ***** 

         ***** USEFUL(v10_61e) ***** 

         ***** MISCELLANEOUS(v10_61e) ***** 

    genmag_LCLIB/snlc_sim :
      + more redshift debugging for AGN. Make sure it works
        for both zSpec and zPhot.

    SALT2mu.c : 
      + fix few bugs found by D. Jones
         1) bug in read_biasCor; event loop missing true-SNIa requirement
         2) bug computing DZBIN_CCPRIOR in setup_zbins_CCprior

    sntools.h: 
     + MXPATH_SNDATA_SIM -> 20 (was 10)

    snlc_fit.car:
      + fix subroutine FITNML_OVERRIDE to read FITWIN_COLOR as 
        command-line override.


# ======================================================================= 
         v10_62 (Jun 9 2018) 

         ***** IMPORTANT(v10_62) ***** 

   + New mechanism to avoid ZPHOT<0  with HOSTLIB_GENZPHOT_FUDGEPAR
   + for sim-batch jobs with LCLIB, each job jumbs to random LCLIB event.

         ***** USEFUL(v10_62) ***** 

         ***** MISCELLANEOUS(v10_62) ***** 

   sntools_host.c[h]:
     + for HOSTLIB_GENZPHOT_FUDGEPAR, prevent negative photo-z
       by altering distribution to asymmetric Gaussian.
       See Sec 4.19 of manual and discussion around Eqs 17-18.

   sntools_trigger.c[h]:
     + For spec-efficiency, define BOOLEAN_AND and BOOLEAN_OR (default) 
       logicals, and modify gen_SEARCHEFF_SPEC to apply selected logic.
       Later need to provide user-input to select.

   sntools.c:
     + new function "double unix_random()" to return 0<random<1
       from native unix call. 

   genmag_LCLIB.c[h]:
     + skip to random starting point in LCLIB when JOBID>0 is
       passed to simulation. See new function set_randomStart_LCLIB().


# ======================================================================= 
         v10_62b (Jun 10 2018) 

         ***** IMPORTANT(v10_62b) ***** 

         ***** USEFUL(v10_62b) ***** 

         ***** MISCELLANEOUS(v10_62b) ***** 

    sim_SNmix.pl
     + pass  "JOBID <jobid>" to snlc_sim so that sim-job
       knows when it is in batch mode. Used to automatically
       pick different SIMLIB start point for each core.
 
    snlc_sim.c
     + use fgets to skip LIBIDs more quickly.
     + if NLIBID is in SIMLIB header, and JOBID is passed
       as argument (->batch mode), automatically skip
       some LIBIDs. Goal is to no longer require explicit 
       SIMLIB_MAXRANSTART key for batch jobs.
     + Compute SNRMAX_GLOBAL and IEPOCH_SNRMAX.
       New sim-input keys  PHOTFLAG_SATURATE and PHOTFLAG_SNRMAX;
       can be specified in sim-input file, command line, or in
       global header of SIMLIB.

   SALT2mu.c
     + add maxerr_abort_[x0,x1,c] input options to allow fitpar
       errors of zero.


# ======================================================================= 
         v10_62c (Jun 11 2018) 

         ***** IMPORTANT(v10_62c) ***** 

         ***** USEFUL(v10_62c) ***** 

         ***** MISCELLANEOUS(v10_62c) ***** 

   snlc_sim.c[h], sntools_trigger.c[h]
     + PHOTFLAG_DETECT and PHOTFLAG_TRIGGER can be specified in
       sim-input file; overrides value(s) in SEARCHEFF_PIPELINE_EFF_FILE.

   snana_manual:
     + see new manual section   "4.31.6 PHOTFLAG Mask"


# ======================================================================= 
         v10_62d (Jun 18 2018) 

         ***** IMPORTANT(v10_62d) ***** 

         ***** USEFUL(v10_62d) ***** 

         ***** MISCELLANEOUS(v10_62d) ***** 

    SALT2mu_fit.pl
     + abort if tmpGrep cannot find MERGED and ' FITOPT ' 
       from MERGE.LOG file.

    sntools_fitsio.c
     + don't abort if zero events in first HEADER file.

    snlc_sim.c:
     + sscanf_RATEPAR() function, fix bug to allow command-line
       overrides for POWERLAW models.


# ======================================================================= 
         v10_62e (Jun 19 2018) 

         ***** IMPORTANT(v10_62e) ***** 

         ***** USEFUL(v10_62e) ***** 

         ***** MISCELLANEOUS(v10_62e) ***** 

    snlc_sim.c
      + new Galactic rate option
            DNDB:  BPOLY <5th order poly>
        so can specify rate vs. b or cos(b).
        See update manual.

      + SIMLIB_DUMP option for LCLIB computes average wgt;
        needed for relative normalization in separate
        sims in different fields. See manual Sectio 4.22

      + read & apply optional "CUTWIN_SNRMAX: xx yy" in zHOST effic file.

   SALT2mu.c :
      + fix few bugs related to H11 option; works for 5D biasCor, 
         but still a problem with 1D biasCor (big biases on alpha,beta).
      + abort if any pIa is outside 0-1 range
      + new snid_mucovdump option


# ======================================================================= 
         v10_62f (Jun 21 2018) 

         ***** IMPORTANT(v10_62f) ***** 

         ***** USEFUL(v10_62f) ***** 

         ***** MISCELLANEOUS(v10_62f) ***** 

    snana.car :
      + change NML input LSIM_SEARCH -> LSIM_SEARCH_SPEC
      + add NML input LSIM_SEARCH_ZPHOT

    SALT2mu.c
      + abort if using 1D biasCor with CC likelihood
      + new option for log-spaced z bins: nlogzbin=20 


# ======================================================================= 
         v10_62g (Jun 24 2018) 

         ***** IMPORTANT(v10_62g) ***** 

         ***** USEFUL(v10_62g) ***** 

         ***** MISCELLANEOUS(v10_62g) ***** 

    snana.car, snlc_fit.car
      + fix bug and stop fit as soon as ERRFLAG_FIT>0;
        don't allow finishing remaining iterations
      + CRAZYFITERR now checks for NaN 

    snlc_sim.c
     + fix init bug in gen_cutwin() so that SNRMAX is computed
       properly when MJD_TRIGGER - PEAKMJD is large.
       Fixes rare SNRMAX=-9 in the SIMGEN_DUMP files, 
       but data files were OK.

    genmag_SALT2.c[h], snlc_sim.c[h] :
     + add infrastructure to use a mag-extrapolation model for
       late-times (>50 days) with SALT2 model. From sim-input 
       file, read
         GENMODEL_EXTRAP_LATETIME:  Extrap_LateTime_MODEL.DAT
       Model is double-exponential in flux.

    To do: read GENMODEL_EXTRAP_LATETIME key from SALT2.INFO file


# ======================================================================= 
         v10_63 (Jun 27 2018) 

         ***** IMPORTANT(v10_63) ***** 

     + Fix memory leak.
     + MXSNLC -> 4 million (was 3 million)

         ***** USEFUL(v10_63) ***** 

         ***** MISCELLANEOUS(v10_63) ***** 

    snlc_sim.c
     + in gen_MWEBV(), remove requirement forcing MWEBV<=5.0;
       problem was that MWEBV_ERR was not re-scaled, and thus
       true MWEBV could be negative.
     + default CUTWIN_MWEBV -> 0,5 (was 0,1)

    sntools.c:
      + fix memory leak in store_PARSE_WORDS()

    snana.car
      + MXSNLC -> 4 milliom (was 3 million)	
        Remove obsolete ISN_FITSROW(MXSNLC)

       program        sizeof
       snana.exe      146 MB
       snlc_fit.exe   297 MB
       snlc_sim.exe   214 MB
       psnid.exe      105 MB

# ======================================================================= 
         v10_63b (July 5 2018) 

         ***** IMPORTANT(v10_63b) ***** 

         ***** USEFUL(v10_63b) ***** 

     SALT2mu.c :
      + new input "sigint_fix" to fix sigma_int for each IDSAMPLE.
        Intended for systematic test. See usage instructions near
        top of file.

         ***** MISCELLANEOUS(v10_63b) ***** 

     snana.car
      + add call to ENVreplace(SNCID_IGNORE_LIST)

     simlib_coadd.c: 
      + fix COMMENT-add bug, and add NLIBID key in global header.

     split_and_fit.pl
      + abort if no batch or nodeList info is given.


# ======================================================================= 
         v10_63c (July 11 2018) 

         ***** IMPORTANT(v10_63c) ***** 

         ***** USEFUL(v10_63c) ***** 

         ***** MISCELLANEOUS(v10_63c) ***** 

   sntools_trigger.c 
    + fix subtle bug in check_APPLYMASK

   sim_SNmix.pl
     + fix to parse sim-input and sim-include files

    genmag_SEDtools, genmag_SIMSED :
     + for SIMSED model's  SED.INFO file, new option
          OPTFLAG_T0SHIFT_PEAKMAG:  0
       to turn off default Tshift such that T=0 at PEAKMAG.
       See update explanations in manual Section 9.4 SIMSED.

   sntools_nearnbr.c:
     + fix inputs to get_1DINDEX().

   NEARNBR_pipeline.pl:
    + fix to check PATH_SNDATA_SIM.LIST for all possible sim-paths.

   SALT2mu.c
    + fix bug for H11. Fixed sigCC -> sigCC(z) = 2nd order poly.
    + allow picking subset of H11 poly params.


# ======================================================================= 
         v10_63d (July 13 2018) 

         ***** IMPORTANT(v10_63d) ***** 

         ***** USEFUL(v10_63d) ***** 

         ***** MISCELLANEOUS(v10_63d) ***** 
 
   snlc_sim.c
    + fix PIXSIZE bug in SIMLIB_prepCadence
      (congrats to Gautham for tripping this bug with his first sim-job)
   genmag_SALT2.c :
     if genmag>99; genmag=99 = MAG_ZEROFLUX --> \ 
         avoid abort at very late time
   genmag_LCLIB.c
     + fix bug caught by Renee.


# ======================================================================= 
         v10_63e (July 18 2018) 

         ***** IMPORTANT(v10_63e) ***** 

         ***** USEFUL(v10_63e) ***** 

         ***** MISCELLANEOUS(v10_63e) ***** 

    genmag_LCLIB.c
      + restrict MAG <=31.0 to avoid I2MAG overflow.

    genmag_SALT2.c :
      + call UVLAM_EXTRAPFLUX 
      + (OPTMASK & 8) --> dump

    snlc_sim.c
      + for SIMLIB_DUMP output, include BAND: key for parsing.
      
    SALT2mu.c
     + for H11sig[1,2], open bound from {-2,2} to {-9,+9}

    kcor.c
     + add ENVreplace for SN_SED


# ======================================================================= 
         v10_63f (July 20 2018) 

         ***** IMPORTANT(v10_63f) ***** 

         ***** USEFUL(v10_63f) ***** 

         ***** MISCELLANEOUS(v10_63f) ***** 

    genmag_SEDtools.c :
       use linear interpolation vs. Trest intead of quadratic.
       Avoids crazy parabolic interpolations giving FLUX<0.
       See RATIO_DAYLIST. 

    snlc_sim.c
      + fix bug after init_genmag_LCLIB, so that GENRANGE_PEAKMJD
        is not messed up.

      + for LCLIB model, increase CRAZYFLUX threshold from E10 to E14.


# ======================================================================= 
         v10_63g (Jul 22 2018) 

         ***** IMPORTANT(v10_63g) ***** 

         ***** USEFUL(v10_63g) ***** 

         ***** MISCELLANEOUS(v10_63g) ***** 

     genmag_SIMSED.c[h]:
        + replace interp_flux_SEDMODEL calls with get_flux_SEDMODEL.
	  This fixes extrapolation bug.
	    
     genmag_SEDtools.c[h]
        + new function get_flux_SEDMODEL().

     snlc_sim.c[h]
        + OPT_MWEBV < 0 is a flag to correct the reported FLUXCAL
	  for Galactic extinction using central wavelength in filter,
	  just as an analsis would do. SIM_MAGOBS and PEAKMAGs are
          corrected too, using true MWEBV.
          See manual section 4.18.1


# ======================================================================= 
         v10_63h (July 24 2018) 

         ***** IMPORTANT(v10_63h) ***** 

         ***** USEFUL(v10_63h) ***** 

         ***** MISCELLANEOUS(v10_63h) ***** 

    snlc_sim.c[h]:
     + new sim-input CIDRAN_MIN

    sim_SNmix.pl
     + new master-input key  CIDRAN_MIN: <CIDMIN>
       so that random CIDs can be generated in restricted ranges.

    genmag_LCLIB.c
     + fix bug in magSearch_LCLIB for NON-RECURRING DAY>DAYMAX.


# ======================================================================= 
         v10_63i (July 27 2018) 

         ***** IMPORTANT(v10_63i) ***** 

         ***** USEFUL(v10_63i) ***** 

         ***** MISCELLANEOUS(v10_63i) ***** 

   genmag_LCLIB.c[h] :
     + compute first & last mags
     + for NONRECUR events, abort if firstMag != lastMag
     + fix bug setting LAST_EXTERNAL_ID

   psnid_BEST.c:
     abort if NOBS < 2; see PSNID_MINOBS

   genmag_SIMSED.c :
     fix bug related to UVLAM (fixes UV band drop outs)


# ======================================================================= 
         v10_63j (July 30 2018) 

         ***** IMPORTANT(v10_63j) ***** 

         ***** USEFUL(v10_63j) ***** 

   Allow 2 include files in snlc_sim

         ***** MISCELLANEOUS(v10_63j) ***** 

    Remove obsolete program SIMSED_prep.exe

    Add new program SIMSED_check.exe to check for ERRORS & WARNINGS.
  
    sntools_trigger.c : 
        fix bug reading 2-column for for zHOST

    snlc_sim.c[h]
      + allow 2nd include file.   
      + Refactor read_input() and how it is called.


# ======================================================================= 
         v10_63k (July 31 2018) 

         ***** IMPORTANT(v10_63k) ***** 

         ***** USEFUL(v10_63k) ***** 

         ***** MISCELLANEOUS(v10_63k) ***** 
    
    genmag_LCLIB.c/snlc_sim.c :
      + for non-recurring events, set SIM_PKMJD correctly.
      + set SIM_NON1A = EVENT_ID

    genmag_SIMSED,snlc_sim.c:
      + set SIM_NON1A = whatever SIMSED parameter contains
        string with INDEX or index or INDX

    Data column name SIM_NON1a -> SIM_NON1A_INDEX to indicate 
    template for NON1ASED, SIMSED, or LCLIB models.
    In output tables, SIM_NONIa -> SIM_NON1A_INDEX.
    It's not a great name since "template" is more descriptive,
    but don't want to make a major change here. Beware that
    SIM_MODEL_INDEX refers the model class, while SIM_NON1A_INDEX
    refers to the specific template.


# ======================================================================= 
         v10_64 (Jul 31 2018) 

         ***** IMPORTANT(v10_64) ***** 

   Beware Name change in data files and in tables !
     Data Files:    SIM_NON1a       -> SIM_TEMPLATE_INDEX
     Output Tables: SIM_NONIA_INDEX -> SIM_TEMPLATE_INDEX
   The new SIM_TEMPLATE_INDEX applies to multiple model classes:
   NON1SED, SIMSED, LCLIB; the obsolete SIM_NON1a was valid
   only for the NON1ASED model. The change should be back-compatible
   by reading previously generated data files or FITRES files.
   But new data/fitres files will have the new SIM_TEMPLATE_INDEX.

         ***** USEFUL(v10_64) ***** 

         ***** MISCELLANEOUS(v10_64) ***** 


# ======================================================================= 
         v10_64b (Aug 6 2018) 

         ***** IMPORTANT(v10_64b) ***** 

         ***** USEFUL(v10_64b) ***** 

         ***** MISCELLANEOUS(v10_64b) ***** 

   snlc_si.c[h]
     new input "SIMLIB_MINSEASON: 30" to remove seasons less than
     30 days. See new function remove_short_SIMLIB_SEASON().

   sntools.pm:
     add "cd $batchDir" in front of $batchJob in case batch system
     tries to execute in another directory.


# ======================================================================= 
         v10_64c (Aug 19 2018) 

         ***** IMPORTANT(v10_64c) ***** 

         ***** USEFUL(v10_64c) ***** 

         ***** MISCELLANEOUS(v10_64c) ***** 

    genmag_SEDtools.c
     + temp hack to allow all SED fluxes to be zero in 
       T0shift function.

    sntools_fitsio.c[h]:
      + new function GET_SNFITSIO_INFO(...) to return current
        version, head-file, phot-file, IFILE number.

    snlc_simc[h]:
      + new sim-input "CUTWIN_HOST_ZPHOT: 0 1"
      + new computation of NSKIP_SIMLIB to account for
        NJOBTOT; ensures sampling entire SIMLIB range,
        instead of only the first NGENTOT_LC entries.
        Makes no difference for properly randomized simlib,
        but may help reduce artifacts for SIMLIBs with
        structure in RA vs. LIBID.

    sim_SNmix.pl :
      pass "NJOBTOT <NJOBTOT>" argument to snlc_sim.exe

    SALT2mu.c
      + minor fix to allow setting p15,p16 (dalpha/dmass, dbeta/dmass)
        to fixed values without floating them.  NOT TESTED !!!


# ======================================================================= 
         v10_64d (Aug 22 2018) 

         ***** IMPORTANT(v10_64d) ***** 

         ***** USEFUL(v10_64d) ***** 

         ***** MISCELLANEOUS(v10_64d) ***** 

    Fix compile errors found by Patrick Kelly:
    sntools_host.c :  add    #include "sntools_genGauss_asym.h"


# ======================================================================= 
         v10_64e (Aug 23 2018) 

         ***** IMPORTANT(v10_64e) ***** 

         ***** USEFUL(v10_64e) ***** 

         ***** MISCELLANEOUS(v10_64e) ***** 

     for LCLIB model, if REDSHIFT is a parameter and HOSTLIB
     is specified, check for photo-z. Requires spagetti hack
     since photo-z has to be determined after model mags are
     generated, rather than before.


# ======================================================================= 
         v10_64f (Aug 26 2018) 

         ***** IMPORTANT(v10_64f) ***** 

         ***** USEFUL(v10_64f) ***** 

         ***** MISCELLANEOUS(v10_64f) ***** 
 
   snlc_sim.c[h]
     create new function SIMLIB_randomize_skyCoords(),
     but it doesn't yet do anything.

     New sim-input key "MINSLOPE_EXTRAPMAG_LATE: xxx" to
     force min mag/day slope for late-time extrap. 
     prevents flat extrapolations for models that mistakely 
     plateau at the end of the defined epoch range.

   SALT2mu_fit.pl
     + for CLEAN command, include lower-case SALT2mu*hbook

   genmag_SEDtools.c:
     + modify late-time extrap to fit slope through last
       5 days, instead of picking out two points. More
       robust with noisy models.


# ======================================================================= 
         v10_64g (Aug 29 2018) 

         ***** IMPORTANT(v10_64g) ***** 

         ***** USEFUL(v10_64g) ***** 

         ***** MISCELLANEOUS(v10_64g) ***** 

    snlc_sim.c
      + when aplying MWEBV correction to fluxes, make sure
        to also correct SIM_TEMPLATEMAG

    genmag_LCLIB.c[h]:
      + for PERIODIC events, apply random phase shift to LC.
      + apply Galactic extinction (had forgotten earlier)
      + remove LCLIB_TEMPLATEMAG_[band] from PARVAL_LIST,
        and instead use SIM_TEMPLATEMAG_[band].

    snana.car
      + read SIM_TEMPLATEMAG_[band] from data files.


# ======================================================================= 
         v10_64h (Aug 31 2018) 

         ***** IMPORTANT(v10_64h) ***** 

         ***** USEFUL(v10_64h) ***** 

         ***** MISCELLANEOUS(v10_64h) ***** 

    snlc_sim.c : 
      in gen_redshift_LCLIB(), get updated DLMU and LENSMU.
      The distance modulus is not used in any way, so this
      fix is just to avoid crazy SIM_DLMAG in the output.
    
      New function MWEBVfluxCor_to_SNDATA() to apply MWEBV
      correction to fluxes and mags. New feature is to also
      correct FLUXCAL uncertainty.

      gen_cutwin_PEAKMAG() refectored to handle CUTWIN_PEAKMAG (OR logic)
      and CUTWIN_PEAKMAG_ALL (AND logic).


# ======================================================================= 
         v10_64i (Sep 6 2018) 

         ***** IMPORTANT(v10_64i) ***** 

         ***** USEFUL(v10_64i) ***** 

         ***** MISCELLANEOUS(v10_64i) ***** 

   snlc_sim.c: 
     + for saturated mags, do NOT correct SIM_MAGOBS for MWEBV,
        and report correct SIM_MAGOBS instead of -7.

     + for NON1ASED model, allow more generic name such as
           GENMODEL:  $PATH/NON1ASED.BLABLA
       See udpated manual Sec 9.5

# ======================================================================= 
         v10_65 (Sep 16 2018) 

         ***** IMPORTANT(v10_65) ***** 

   Begin new simulated model : BYOSED = Build Your Own SED
   Initial use for testing SNIa training codes.
   Beware: not even close to working; just added blank functions
           to work on structure design.

         ***** USEFUL(v10_65) ***** 

         ***** MISCELLANEOUS(v10_65) ***** 

   genmag_BYOSED.c[h] 
     + new code files that do nothing.

   snlc_sim.c:
    + call new functions init_genmag_BYOSED and genmag_BYOSED.

   sntools_trigger.c
     + fix logic but in GETEFF_PIPELINE_DETECT when no
       map is found for a filter, but other bands have maps.
       Only effects surveys that define EFF-vs-SNR for a
       subset of bands (e.g., SDSS gri)

    + snana.car
       new &SNLCINP input  PHOTFLAG_DETECT -->
       count NOBS_DETECT and TLIVE_DETECT and add these to SNANA table.


# ======================================================================= 
         v10_65b (Oct 4 2018) 

         ***** IMPORTANT(v10_65b) ***** 

         ***** USEFUL(v10_65b) ***** 

         ***** MISCELLANEOUS(v10_65b) ***** 

   sim_SNmix.pl
    + abort if CIDRAN_MIN>0 but RESET_CIDOFF!=2;
      otherwise, CIRRAN_MAX is not computed properly.

    + for spectrograph option, if every lambin is the same,
      just write LAMCEN. For non-uniform binning, continue 
      writing both LAMMIN and LAMMAX. 
      See INPUTS_SPECTRO.FORMAT_MASK.

   sntools.c: array-bound bug in getInfo_PHOTOMETRY_VERSION()
     Fixes problems with more than 10 paths to check.

     Add abort trap for too many paths in 
       add_PATH_SNDATA_SIM() and in getInfo_PHOTOMETRY_VERSION()
    
   snlc_fit.car:
     in FITINI_PHOTOZ(), fix bug settig INIVAL(IPAR_ZPHOT)

   sntools_host.c
    + fix bug checking to use analytic ZPHOT model (HOSTLIB_GENZPHOT_XXX)
      Before only 1 param was checked, but now all 12 are checked.
   
    + if HOSTLIB_GENZPHOT_XXX is specified without HOSTLIB, ABORT !


# ======================================================================= 
         v10_65c (Oct 9 2018) 

         ***** IMPORTANT(v10_65c) ***** 

         ***** USEFUL(v10_65c) ***** 

         ***** MISCELLANEOUS(v10_65c) ***** 

   SALT2mu.c :
     add option to auto-compute sigInt separately for each
     IDSAMPLE (opt_biascor += 512).

   snlc_sim.c :
     new sim-input option  "GENMAG_SMEAR_SCALE: scale"  to scale
     intrinsic mag-smearing set by GENMAG_SMEAR_MODELNAME.

# ======================================================================= 
         v10_65d (Oct 23 2018) 

         ***** IMPORTANT(v10_65d) ***** 

         ***** USEFUL(v10_65d) ***** 

    SALT2mu: can determine which variable to use for HR step = gamma.
             Default is varname_gamma=HOST_LOGMASS

         ***** MISCELLANEOUS(v10_65d) ***** 

   SALT2mu.c :
     + for multiple sigInt values, determine sigint-scale
       so that chi2/dof=1

     + new option   "CUTWIN(DATAONLY) LOGMASS 5 15"  will apply cut
       only to data and not to bias Cor sim, nor to CC-prior sim.
       Beware: there is no longer automatic protection to keep 
       sim biasCor events with HOST_LOGMASS=-9.

     + new input  "varname_gamma=HOST_LOGMASS"  controls which variable
       is used to fit gamma = HR step.  Tested only on HOST_LOGMASS,
       but should work on other variables in the input FITRES file;
       e.g., Metallicity, SSFR, etc ...

   snlc_sim.c:
     + fix bug setting NSEASON in remove_short_SIMLIB_SEASON()
     + replace x0 with MU in genmag_NON1ASED call.

   genmag_NON1ASED.c :
     + replace x0 argument with MU so that SALT2x0=-9 in SIMGEN.DAT output.


# ======================================================================= 
         v10_65e (Oct 30 2018) 

         ***** IMPORTANT(v10_65e) ***** 

         ***** USEFUL(v10_65e) ***** 

         ***** MISCELLANEOUS(v10_65e) ***** 

   SALT2mu.c:
     + minor bug fix in set_DOFLAG_CUTWIN().

   snlc_sim.c : 
    + fix bug related to SIMLIB_MINOBS
    + new sim-input NPE_PIXEL_SATURATE to override value in SIMLIB header.
    + in GENFLUX_DRIVER(), fix bug setting L_SATURATE ; fixes bug
      setting NOBS_SATURATE in simgen-dump file.

    SNANA tester job 065 differs from previous version;
    looks like previous version had bug setting garbage
    HOST_ZPHOT when HOST_PHOT were not requested.


# ======================================================================= 
         v10_65f (Nov 10 2018) 

         ***** IMPORTANT(v10_65f) ***** 

         ***** USEFUL(v10_65f) ***** 

    new snlc_fit option OPT_COVAR_LCFIT=1 to fix non-invertible
    COV(mB,x1,c) in the FITRES output.

         ***** MISCELLANEOUS(v10_65f) ***** 

   remove sntools_eigen.F

   sntools.c:
     + move update_covMatrix() from SALT2mu to here. Allows
       fortran snlc_fit to call update_covMatrix too.
     + include eispack.c[h]
     + replace fortran rs_ with C version of rs

   util/snamke.pl: add -m64 -O1 flags

   snlc_fit.car
    + new &FITINP OPT_COVAR_LCFIT=1 --> fix non-invertible COV(mB,x1,c)
      See new function FIX_COVAR_LCFIT(), and OPTMASK options inside.
      Goal is to produce invertible COV to avoid need for hack-fixes
      in cosmology fitters.
    + new &FITINP OPT_COVAR_FLUX, same as legacy OPT_COVAR


# ======================================================================= 
         v10_65g (Nov 12 2018) 

         ***** IMPORTANT(v10_65g) ***** 

         ***** USEFUL(v10_65g) ***** 

         ***** MISCELLANEOUS(v10_65g) ***** 

    snana.car;
      + update subroutine WRTEXT to include more output variables.
      + new &SNLCINP input APPLY_FLUXCOR_BUG=1 by default to reproduce
        bug of setting SNRMAX variables before making flux-fudges.
        Remove with APPLY_FLUXCOR_BUG=0.


# ======================================================================= 
         v10_65h (Nov 16 2018) 

         ***** IMPORTANT(v10_65h) ***** 

         ***** USEFUL(v10_65h) ***** 

         ***** MISCELLANEOUS(v10_65h) ***** 

   snana.car: 
     update logic to control flux & fluxerr correction.
     Mainly, include flag in data files that have these
     corrections, so that the corrections are not re-applied
     by mistake.
   
   sntools_fitsio.c :
     write MASK_FLUXCOR_SNANA in header, but only for real data.

   snana_manual: Update Sec 12.4.6 to explain MASK_FLUXCOR_SNANA


# ======================================================================= 
         v10_65i (Dec 5 2018) 

         ***** IMPORTANT(v10_65i) ***** 

         ***** USEFUL(v10_65i) ***** 

         ***** MISCELLANEOUS(v10_65i) ***** 

     snana.car:
       replace "REPEAT MJD WARNING" with "DUPLICATE MJD WARNING"
       to match the end-of-job DUPLICATE warning.

    Makefile:
      check $SNANA_PYTHON_DIR flag to include python libs and include
      for snlc_sim (via genmag_BYOSED that calls python)

    genmag_BYOSED.c[h] : implement pre-proc flag USE_PYTHON

    To compile with python options:
       + edit genmag_BYOSED.h and USE_PYTHONxxx -> USE_PYTHON
       + export SNANA_PYTHON_DIR=BLA
    Later SNANA version will check for existence of SNANA_PYTHON_DIR,
    and automatically fix the USE_PYTHON pre-proc flag.

    Add new file genmag_BYOSED.py (called by genmag_BYOSED.c)


# ======================================================================= 
         v10_65j (Dec 12 2018) 

         ***** IMPORTANT(v10_65j) ***** 

         ***** USEFUL(v10_65j) ***** 

         ***** MISCELLANEOUS(v10_65j) ***** 

   split_and_fit.pl
    + remove blank lines from catenated FITRES file.
      Note that duplicate NVAR, VARNAMES and '#' already removed.

   sntools_output.h: add pre-process flag to use NVAR in text output:
       #define TEXTFILE_NVAR
   Initial debugging without NVAR works with split_and_fit,
   but to be safe leave NVAR flag set until more testing
   with cosmology pipelines.
  
  snana.car :
    new subroutine PARSE_MODELPAR_TEXT to read back 
    either SIMSED, BYOSED and LCLIB parnames and NPAR.
    These all get propagated to output tables.

  genmag_BYOSED.c[h]: 
    + fill dummary parameter names and values, and propagate to 
      data files & FITRES output.
      Python gurus will fill correct parameter names.
    + if no python, read template_0 from SALT2.JLA-B14
    + fetch_BYOSED(): for C code, return SALT2 SED at Trest
    + INTEG_zSED_BYOSED(): finish, and check that BYO-SALT2
      mags match true SALT2.JLA-B14 mags with x1=c=MWEBV_ERR=0.

  snlc_sim.c:
    in gen_MWEBV(), set MWEBV_ERR=0 if GENSIGMA_MWEBV_RATIO=0
    and MWEBV_SIG=0.


# ======================================================================= 
         v10_65k (Dec 15 2018) 

         ***** IMPORTANT(v10_65k) ***** 

         ***** USEFUL(v10_65k) ***** 

         ***** MISCELLANEOUS(v10_65k) ***** 

    + move LC-WIDTH code from sntools_devel.c[h] into sntools.c[h],
      and fix to work with FWHM option.


# ======================================================================= 
         v10_65l (Dec 17 2018) 

         ***** IMPORTANT(v10_65l) ***** 

         ***** USEFUL(v10_65l) ***** 

         ***** MISCELLANEOUS(v10_65l) ***** 

    snana.car:
     + new &SNLCINP input  SIMVAR_CUTWIN_STRING to apply
       cuts on SIM_XXX quantities. 
     + new &SNLCINP input  SIM_TEMPLATE_INDEX_LIST
       to select list of template indices.
    manual
     + Updated manual section 5.30 to explain new features.


# ======================================================================= 
         v10_65m (Dec 21 2018) 

         ***** IMPORTANT(v10_65m) ***** 

         ***** USEFUL(v10_65m) ***** 

         ***** MISCELLANEOUS(v10_65m) ***** 

   sim_SNmix.pl
    + fix setting LAST_NGEN inside simgen() function.
      Fixes duplciate CID bug with RANSEED_CHANGE option.

   snlc_sim.c, genmag_SIMSED.c, genmag_SEDtools.c
     Refactor by switching some fortran-like loops back to C ;
     i.e., start at 0 instead of 1:
       INPUTS.NPAR_SIMSED, SEDMODEL.NPAR, INPUTS.NVAR_SIMGEN_DUMP

# ======================================================================= 
         v10_65n (Dec 26 2018) 

         ***** IMPORTANT(v10_65n) ***** 

         ***** USEFUL(v10_65n) ***** 

         ***** MISCELLANEOUS(v10_65n) ***** 

   sntools_host.c :
      refactor with loops changed to run from 0 to N-1 instead
      of from 1-N.

   genmag_SIMSED.c
     fix bug introduced at v10_63g (July 2018); load *lumipar
     for GRIDONLY option. Since v10_63g, SIMSED_param
     (i.e., baggage params) were written as -9 to data files.
    

# ======================================================================= 
         v10_66 (Dec 26 2018) 

         ***** IMPORTANT(v10_66) ***** 

         ***** USEFUL(v10_66) ***** 

         ***** MISCELLANEOUS(v10_66) ***** 

   sntools_fitsio.c
     fix refactor bug: SIMSED params now run from 0 to N-1,
     but keep writing PAR01 to PAR[NN] for back compatibility.
     Use CODE_IVERSION.

   snana.car: fix refactor bugs for SIMSED, using CODE_IVERSION.


# ======================================================================= 
         v10_66b (Jan 3, 2019) 

         ***** IMPORTANT(v10_66b) ***** 

         ***** USEFUL(v10_66b) ***** 

         ***** MISCELLANEOUS(v10_66b) ***** 
  
   snlc_sim.c
     - new sim-input key  "LCLIB_DEBUG_ZERO_TEMPLATE_FLUX: 1"
       to force LCLIB template flux=0; allows looking at 
       library mags without subtracted flux.

     - new sim-input key "LCLIB_DEBUG_FORCE_NREPEAT: 1"
       will force each LCLIB event to have equal weight,
       rather than weighting by time-duration of event.

   sntools_host.c :
     + fix a few index-refactor bugs

   genmag_SEDtools.c[h]:
     + rename function fetchpar_SEDMODEL -> fetch_parInfo_SEDMODEL().
     + new function fetch_parVal_SEDMODEL to return SED param values.
     + fortran mangles for fetch_parval_sedmodel__ & fetch_parinfo_sedmodel__

   util/snmake.pl: few fixes.


# ======================================================================= 
         v10_66c (Jan 16 2019) 

         ***** IMPORTANT(v10_66c) ***** 

         ***** USEFUL(v10_66c) ***** 

         ***** MISCELLANEOUS(v10_66c) ***** 

    genmag_SIMSED.c[h]
      + function read_SIMSED_INFO() is now int function returning
        NSED, rather than void. Purpose is to pass NSED to
        fortran code.

    sim_SNmix.pl :
      in sub read_master, echo INCLUDE file names to allow for ENV.

    Makefile:
      add  -lstdc++ into link for SALT2mu.exe; needed for Midway2.

    perl functions (SALT2mu_fit.pl, split_and_fit.pl, sim_SNmix.pl):
      use clean exit(0) functions, especially for CLEAN option
      that was throwing incorrect error code. Needed for higher
      level pipeline scripts.

    Define separate error code for each C and fortran program.
    Batch-submit scripts return error code of 255.
    See explanation in Manual Sec 12.7

 
# ======================================================================= 
         v10_66d (Jan 20 2019) 

         ***** IMPORTANT(v10_66d) ***** 

         ***** USEFUL(v10_66d) ***** 

         ***** MISCELLANEOUS(v10_66d) ***** 

    genmag_NON1AGRID.c : abort on undefined filter.

    snana.car : 
      + fix obsolete error message when KCOR_FILE is not given.
      + make sure all IGNOREFILE calls have LENGTH argument.
 
    SALT2mu.c :
      + in read_data(), specify integer format for reading 
        SIM_TEMPLATE_INDEX (was reading it as double, which 
        rarely causes seg fault)

      + fcn_AlphaBeta(): fix bug setting logmass.


# ======================================================================= 
         v10_66e (Jan 23, 2019) 

         ***** IMPORTANT(v10_66e) ***** 

         ***** USEFUL(v10_66e) ***** 

         ***** MISCELLANEOUS(v10_66e) ***** 

   snlc_sim.c
    + add #ifdef TEXTFILE_NVAR around writinv NVAR key for 
       SIMGEN-dump file.

   sim_SNmix.pl
    + add NVAR check on SIMGEN-DUMP file so that it works when
       NVAR key isn't there.

   NEARNBR_pipeline.pl:
     + at stage 7, reading sigint from SALT2mu-fitres file is
       optional, not required. Needed for SN-photo-z only.

   snlc_sim.c :
     for NON1ASED model, can inlcude full path & model with
        GENMODEL:  $PATH/NON1ASED.XYZ
     and no need to use two keys any more,
       GENMODEL:      NON1ASED.XYZ
       PATH_NON1ASED: $PATH


# ======================================================================= 
         v10_66f (Jan 30, 2019) 

         ***** IMPORTANT(v10_66f) ***** 

         ***** USEFUL(v10_66f) ***** 

         ***** MISCELLANEOUS(v10_66f) ***** 

   snlc_sim.c
    + if user-input GENTYPE is specified, overwrite NON1A SNTYPE tags.
    + new sim-input WRFLAG_MODELPAR (default is 1, but can change to 0)
      allows suppressing SIMSED or LCLIB output parameters to data files.
      Needed by sim_SNmix for multiple models to ensure all data file
      output is the same. This option is used internally by sim_SNmix.      

   sim_SNmix_devel.pl (temp file for development)
     + major overhaul to
        1) allow multiple SIMGEN_INFILE_NON1a keys
        2) avoid simulation duplicate sub-models

   snana.car:
     + subtle fix in INIT_SNTABLE_OPTIONS(); bug caught on Midway2
     + define SNHOST_DLR ... will be filled later for DES.


# ======================================================================= 
         v10_66g (Feb 4 2019) 

         ***** IMPORTANT(v10_66g) ***** 

         ***** USEFUL(v10_66g) ***** 

         ***** MISCELLANEOUS(v10_66g) ***** 

   snana.car, sndata.h:  MXTYPE->1000 (was 400,200, respectively)

   snana.car:
     + new &SNLCINP  OPTMASK_LCWIDTH = option for adding LC width
        information in SNANA table.
            grep OPTMASK_LCWIDTH sntools.c

     + SNTABLE_LIST = 'SNANA+SIM_MAGOBS' -> obs-table with 
        only MJD, IFILTOBS & SIM_MAGOBS (compressed table).

   sntools.car:
     get_lightCurveWidth: add another option to return 10-100% rise time.

   kcor.c :
     new OOB key to add out-of-band transmission.

   sntools_host.c[h]:
     + compute DLR and d_DLR
     + compute SNSEP, DLR, d_DLR even if no HOSTLIB coords are given.
       Without HOSTLIB coords, use SN coords and compute galaxy center,
       and with HOSTLIB coords use galaxy center to compute SN coords.
     + for SIMGEN_DUMP input, add the following:
            GALSNSEP GALSNDLR GALSNDDLR

   SALT2mu_fit.pl : abort for interactive mode, since it doesn't work.


# ======================================================================= 
         v10_66h (Feb 6 2019) 

         ***** IMPORTANT(v10_66h) ***** 

   sim_SNmix_devel.pl -> sim_SNmix.pl: major overhaul/refactor

         ***** USEFUL(v10_66h) ***** 

   snlc_sim.c, sntools_fitsio.c:
     + propagate DDLR into sim data files: HOSTGAL_DDLR.
       Beware that this is the true DDLR without measurement noise.

         ***** MISCELLANEOUS(v10_66h) ***** 

   SALT2mu.c : minor refactor of ICC_FITCLASS_XXX

   NEARNBR_pipeline.pl:
    refactor so that each sim job is a separate stage,
    and add sim-data stage rather than pre-scaling the 
    training set for sim-data. Also add XXX_NGEN_UNIT_XXX
    keys for data and biasCor. Note that sim-data and
    training still have same NON1A model ... allowing
    different models is for next SNANA version.


# ======================================================================= 
         v10_67 (Feb 8 2019) 

         ***** IMPORTANT(v10_67) ***** 

     Store 2 HOSTGAL matches for data, 1 match for SIM.
     Also include HOSTGAL_NMATCH (e.g., NMATCH with d_DLR<4)
     HOSTGAL_NMATCH=1 for sim.

         ***** USEFUL(v10_67) ***** 

         ***** MISCELLANEOUS(v10_67) ***** 

    snlc_sim, snana.exe, snlc_fit:
       few minor fixes based on valgrind-debug tests.


# ======================================================================= 
         v10_67b (Feb 14 2019) 

         ***** IMPORTANT(v10_67b) ***** 

         ***** USEFUL(v10_67b) ***** 

         ***** MISCELLANEOUS(v10_67b) ***** 

   sntools.c, sntools_fitsio.c, snana.car"
      add HOSTGAL_NMATCH2 = Nmatch in 2nd radius or DDLR cut.

   sim_SNmix.pl:
    another significant upgrade/refactor to allow 
    different SIMGEN-input files for each GENVERSION.


# ======================================================================= 
         v10_67c (Feb 19, 2019) 

         ***** IMPORTANT(v10_67c) ***** 

         ***** USEFUL(v10_67c) ***** 

   Add HOSTGAL_RA[DEC] to data structure, and to sim-output data

         ***** MISCELLANEOUS(v10_67c) ***** 

   snlc_sim.c:
     + prep_user_input(): turn off SNIa scatter model for SIMSED model.
    
   sim_SNmix.pl:
     + for global SIMGEN_INFILE_NONIa: key, allow reading multiple
       sim-input files on one line ... just like reading this
       key under the GENVERSION block.

   snana.car:
     read/write HOSTGAL_RA, HOSTGAL_DEC, and idem for HOSTGAL2_XX
    
   split_and_fit.pl :
     if SALT2mu is in NML file, move .M0DIF file along with .FITRES file.
      
   General cleanup: DECL -> DEC everywhere. 
   But read DEC or DECL for back-compatible.


# ======================================================================= 
         v10_67d (Feb 19 2019) 

         ***** IMPORTANT(v10_67d) ***** 

         ***** USEFUL(v10_67d) ***** 

         ***** MISCELLANEOUS(v10_67d) ***** 

   snlc_sim.c[h]:
     + new input GENMODEL_MSKOPT to pass bit-mask of options
       to any model. Here it is passed only to init_genmag_BYOSED()
       and init_genmag_SIMSED(), and later could be passed to 
       other models. Meaning of bit-options is model-dependent.

   genmag_BYOSED.c:
     + define internal NEW_EVENT logical based on EXTERNAL_ID.


# ======================================================================= 
         v10_67e (Mar 1, 2019) 

         ***** IMPORTANT(v10_67e) ***** 

         ***** USEFUL(v10_67e) ***** 

         ***** MISCELLANEOUS(v10_67e) ***** 

    snlc_sim.c[h]"
      + For rate models:
        EPM -> TDE  (no longer need to hide for PLASTICC)
        IPP -> PISN (no longer need to hide for PLASTICC)

      + Remove SIMLIB_LEGACYFLAG
      + Fix bug allowing SPECTROGRAPH to work without SYNTHETIC filters.

   sntable_dump.c :
     + enable "--format csv" to output csv-format file.
     + allow CID as first extracted element.

   sntools_output*: pass SEPKEY (comma) for csv format.


# ======================================================================= 
         v10_67f (Mar 11 2019) 

         ***** IMPORTANT(v10_67f) ***** 

         ***** USEFUL(v10_67f) ***** 

         ***** MISCELLANEOUS(v10_67f) ***** 

    sntools.pm:
     + in parse_array, ignore anything past '#'

    sim_SNmix.pl
     + make sure SNIa appear before NONIa in combined LIST file
       so that analsis sees Ia params first.

    sntools.c:
      + in wr_SNDATA(), filtlist[20] -> filtlist[MXFILTINDX]
      + in open_TEXTgz(), replace 'zcat' with 'gunzip -c' to work on Mac.
            (zcat doesn't work on Mac)

   split_and_fit.pl
     + fix to abort on missing VERSION
     + fix to allow sims in multiple paths (PATH_SNDATA_SIM)
       Beware that VERSION wildcards don't work across multiple paths.
     + add time-stamp check to self-identify rogue background jobs.
       If time-stamps don't match, abort with error message in
       STOP-split_and_fit.log file.

   snana.car :
     + add HOST_OBJID to snana & fitres tables, as real*8.
       Works for hbook, but reading back root file, very large
       numbers are truncated to 4 significant digits.
       Issue posted on root forum.

   snools_output* :
     + updates to handle long long int. Beware that while root has
       Long64_t option, there is no such option for HBOOK; thus 
       store HBOOK long-long as R*8, but read-back is zero.

   kcor.c
     + fix bug opening spectrograph file.


# ======================================================================= 
         v10_70 (Mar 16 2019) 

         ***** IMPORTANT(v10_70) ***** 

    ALL: remove "NVAR:" from output FITRES files.

    sim: new EFF(zHOST) map depends on aribtrary function of 
         HOSTLIB params (sntools_trigger.c[h]).

         Lots of refactoring to use common tools for reading
         and initializing multi-D maps.
 
         ***** USEFUL(v10_70) ***** 

         ***** MISCELLANEOUS(v10_70) ***** 

   kcor.c
      fix wr_fits_PRIMARY(fp) for unused primary refs so that
      Astropy and fv don't choke on blank string or undefined flux.
      Bug found by D'Arcy.

   sntools.c[h]
     + new utility read_GRIDMAP.
  
   sntools_trigger.c[h]
     + major refactor/update to zHOST functions to read arbitrary
       funtion of HOSTLIB parameters
     + refactor other functions to use new utility read_GRIDMAP().
   
   sntools_host.c[h]
     + refactor to use new utils to read WGTMAP.
       NVAR and NVAR_WGTMAP keys in HOSTLIB are now obsolete. 
       They are ignored in the HOSTLIB, but won't cause harm.
     + print warning message to remove obsolete NVAR key(s).

   sntools_fluxErrModels.c
     + refactor to use read_GRIDMAP() function
     + read optional OPT_EXTRAP key
     + print warning message to remove obsolete NVAR_WGTMAP key


# ======================================================================= 
         v10_70b (Mar 23 2019) 

         ***** IMPORTANT(v10_70b) ***** 

         ***** USEFUL(v10_70b) ***** 

   TAKE_SPECTRUM keys allow aribtrary polynomials, not just 2nd order.
   See manual.

         ***** MISCELLANEOUS(v10_70b) ***** 

    sntools_host.c[h]:
      + fix bugs in output for "HOSTLIB_STOREPAR: <varList>" option
      + new function copy_VARNAMES_zHOST_to_HOSTLIB_STOREPAR() to cpoy
        zHOST variables to HOSTLIB_STOREPAR_LIST.

    sntools.c :
     + GaussIntegral: if nsig>10, set GINT=0 to avoid abort.
     + abort on tabs in store_PARSE_WORDS().

   snlc_sim.c[h]:
     + new sim-input GENMODEL_ARGLIST 'KEY1 VAL1 KEY2 VAL2 etc ...'
       passed only as command-line argument. Initial use is passing
       options to init_genmag_BYOSED().
     + refactor TAKE_SPECTRUM inputs to allow for arbitrary 
       polynomial instead of allowing only 2nd order.
       See GENPOLY_DEF typedef.


# ======================================================================= 
         v10_70c (Mar 25 2019) 

         ***** IMPORTANT(v10_70c) ***** 

         ***** USEFUL(v10_70c) ***** 

         ***** MISCELLANEOUS(v10_70c) ***** 

   sntools_fitsio.h:  MXFILE_SNFITSIO -> 300 (was 100)
   sntools_fitsio.c:  write optional SIM_WARP column to SPEC.FITS

   snlc_sim.c[h]: 
     + new sim-input  WARP_SPECTRUM: LAMPOLY(,,,)
     + write SIM_WARP column to spectra

   split_and_fit.pl
    + fix merging to handle SNANA table.
    + new input key "APPEND_TABLE_TEXT: <varList>" does not need
      table-name specifier. The legacy APPEND_FITRES key still 
      allowed.


# ======================================================================= 
         v10_70d (Mar 28 2019) 

         ***** IMPORTANT(v10_70d) ***** 

         ***** USEFUL(v10_70d) ***** 

         ***** MISCELLANEOUS(v10_70d) ***** 

   sntools_fitsio.c
     + for SPEC table, include SNR_COMPUTE and LAMOBS_SNR.
     
   snana.car:
     + fix index bug in RDFITSHEAD_SIM_HOSTLIB

   init_genmag_LCLIB.c now accepts OPTMASK from 
     user-input GENMODEL_OPTMASK

   sntools_host.c[h]:
     define MXCHAR_LINE_HOSTLIB 400, and replace hard-coded line-lengths
     of 200. Also set ABORT trap of HOSTLIB line > 400.


# ======================================================================= 
         v10_70e (Mar 31 2019) 

         ***** IMPORTANT(v10_70e) ***** 

         ***** USEFUL(v10_70e) ***** 

         ***** MISCELLANEOUS(v10_70e) ***** 

   genmag_SALT2.c:
     + genSpec_SALT2(): apply MAG_OFFSET to GENFLUX_LIST.
       (about 20% correction to spec fluxes).
     + fix spec-norm factor of hc

   SALT2mu_fit.pl : remove NVAR check among FITRES files.

   genmag_NON1ASED.c: fix hc factor in spectrum norm .
   genmag_BYOSED.c: fix hc factors for spectrum norm.

   sntools.c:
     + refactor ENVreplace(string) -> ENVreplace(string,callFun,ABORTFLAG)
       so that callFun decides whether or not to abort on invalid ENV.
     + getList_PATH_SNDATA_SIM() skips unknown ENV instead of ABORT.

   sim_SNmix.pl:
     + write GENSTAT_[VERSION].DAT files with stats for each
       version and submodel. Later will parse this to give
       summary of Ia and NONIa stats, accounting for skipped
       duplicates.

   snlc_sim.c:
     + "DNDZ: CC_S15" can now be "DNDZ: .3*CC_S15" or "DNDZ: CC_S15*.3"


# ======================================================================= 
         v10_70f (Apr 3 2019) 

         ***** IMPORTANT(v10_70f) ***** 

   sim_SNmix: major overhaul of output READMEs and TOTAL_SUMMARY.LOG

         ***** USEFUL(v10_70f) ***** 

         ***** MISCELLANEOUS(v10_70f) ***** 

    wfit.c : fix to work without NVAR key.

    sim_SNmix.plx
      + major overhaul of output README files, accounting
        for symoblic links to other versions.
      + if NCPU > NJOB, then set NCPU = NJOB.

    snana.car, sntools.c, sntools_fitsio.c, sndata.h:
     + add HOST_sSFR and HOST_sSFR_ERR the same way as HOST_LOGMASS


# ======================================================================= 
         v10_71 (Apr 6 2019) 

         ***** IMPORTANT(v10_71) ***** 

    PYTHON 2.7 or higher REQUIRED  
      (see call to set_Cpreproc_flags.py in src/MakeFile)

         ***** USEFUL(v10_71) ***** 

         ***** MISCELLANEOUS(v10_71) ***** 

   sim_SNmix.pl :
    + few more bug-fixes from changes in last version.

   sntools_nearnbr.c :
     + read CID to prepare for ODDEVEN option in next SNANA version.

   sntools_output*:
     change C preproc flags HBOOK,ROOT,TEXT -> USE_HBOOK,USE_ROOT,USE_TEXT.
     This change makes it easier for preproc script to identify these
     flags and not be confused by comments elsewhere.

   set_Cpreproc_flags.py:
      new util to substitute C preproc flags. Newest flag is 
      USE_BYOSED in genmag_BYOSED.h
      Legacy util/defineOutputFlags.pl is obsolete.

   sntools_host.c
    + fix aweful bug when SN coords are transferred to host;
      CMB redshift was incorrectly computed from original SN
      coords instead of from HOST coords. The crucial fix is
      getting the right distance modulus since the smeared
      redshift is computed correctly later in gen_zsmear().
    + fix harmless bug in GEN_SNHOST_ZPHOT_from_HOSTLIB -> 
      init ZPHOT and ZPHOT_ERR to -9. 
    + account for VPEC when SN coords are transferred to host coords.
      


# ======================================================================= 
         v10_71b (Apr 9, 2019) 

         ***** IMPORTANT(v10_71b) ***** 

         ***** USEFUL(v10_71b) ***** 

         ***** MISCELLANEOUS(v10_71b) ***** 

    snana.car, sntools_nearnbr.c :
     + implement NEARBNR_TRAIN_ODDEVEN=T

    set_Cpreproc_flags.py:
     + fixes for python 3.7 (from D.Jones)

    INIT_HOSTLIB:
      + call new function checkAbort_HOSTLIB to abort if SN coords
        are transferred to Gal coords without MWEBV model to 
        re-compute MWEBV at new Gal coords.

   sntools_host.c, snlc_sim.c[h]
     + more bug fixing for SN->GAL coords option. In last SNANA version,
       I mixed up the logic for zSN->zGAL option (HOSTLIB_MSKOPT=16), 
       and separate option for coord(SN)->coord(GAL), HOSTLIB_MSKOPT=8.
       Did more rigorous tests for both SN->Gal transfer options, and
       checked that they both work with VPEC.
       To fix HOSTLIB_MSKOPT=16, had to move gen_modelPar() function 
       to after HOSTLIB call, which changes random number sync.
       Thus many SNANA_tester jobs fail as expected.

   manual:
     + updated explanations of HOSTLIB_MSKOPT=8,16.


# ======================================================================= 
         v10_71c (Apr 11 2019) 

         ***** IMPORTANT(v10_71c) ***** 

   SIMULATION and SALT2mu NOW ABORT ON DUPLICATE KEY IN THE INPUT FILE !!

         ***** USEFUL(v10_71c) ***** 

         ***** MISCELLANEOUS(v10_71c) ***** 

   sntools.c[h]:  
     + new utility uniqueMatch to do key-match and abort on duplicate key.
     + new utility uniqueOverlap to match part of string.

   snlc_sim
     + use uniqueMatch to abort on duplicate key in sim-input file.
     
     + refactor ZVARIATION_POLY to use GENPOLY_DEF (comma-sep poly
       coefficients) instead of hard-coded 3rd-order poly.

   SALT2mu.c:  replace !strcmp with uniqueOverlap function to
               abort on duplicate keys.

   *nearnbr* codes:
     + propagate NEVTOT to nearnbr_maxFoM and into output trainPar file
        (for pippin)


# ======================================================================= 
         v10_71d (Apr 15 2019) 

         ***** IMPORTANT(v10_71d) ***** 

         ***** USEFUL(v10_71d) ***** 

         ***** MISCELLANEOUS(v10_71d) ***** 

    Makefile
      + LPY updates for python code
    genmag_BYOSED.c:
      + integrate intrinsic scatter models (GENMAG_SMEAR_MODELNAME key)
     
    sntools_output_text.c
      + update to close text files properly.

    snlc_sim.c[h]
     + remove unused INPUTS.MODELSMEAR_FILE
     + update so that C11 and G10 intrinsic scatter models
       work for BYOSED. Needs more testing.
     + for INIT_WRONGHOST, pass GENRANGE_REDSHIFT[min,max] instead
       of HOSTLIB_ZMIN/MAX so that WRONGHOST works with or without
       HOSTLIB.
     + if wrong-host model is used, add [VERSION].README line:
            Wrong-host fraction: 31/1303 = 0.0238
       to make snana.exe parsing easier.

    snana.car
      + read SPECTRA in text format; pass to plot-table.
      + begin code to read SPECTRA in FITS format.


# ======================================================================= 
         v10_71e (Apr 17 2019) 

         ***** IMPORTANT(v10_71e) ***** 

         ***** USEFUL(v10_71e) ***** 

         ***** MISCELLANEOUS(v10_71e) ***** 

    sntools.c
      + readint, readfloat, readdouble now abort if a string is read.
        Hope to catch sim-input mistakes.

    sntools_output_text.c
     + in SNTABLE_NEVT_TEXT(), replace rewind with snana_rewind().

    snana.car
      + new routine RDSNFITS_SPEC() to read spectra in FITS format.
        Works with one FITS file; need to test later on multiple
        SPEC.FITS files in a sim-version.

    sim_SNmix.pl
      + fix nasty index bug sorting NONIa-input files
      + refactor to ignore SIMGEN_DUMP merging if there are
        no SIMGEN_DUMP files.


# ======================================================================= 
         v10_71f (Apr 18 2019) 

         ***** IMPORTANT(v10_71f) ***** 

         ***** USEFUL(v10_71f) ***** 

         ***** MISCELLANEOUS(v10_71f) ***** 

    split_and_fit, sim_SNmix.pl : 
      + write SUCCCESS or FAILURE to DONE_STAMP file.
        Useful to higher-level pipelines.
      + replace FATAL_ERROR calls with FATAL_ERROR_STAMP calls
        which write FAILURE to DONE_STAMP file.

    sntools_fitsio.c
      + fixed to read spectra when there are multiple FITS
        files combined into a single VERSION.

    sim_SNmix.pl:
     + fix bug in parse_GENVERSION: set DOGEN_SNIa[NONIa] flags.
     + refactor with new function parse_input_GENMODEL
     + allow   GENMODEL: BYOSED  [PATH]

    genmag_BYOSED.c 
      + few updates.


# ======================================================================= 
         v10_71g (Apr 19, 2019) 

         ***** IMPORTANT(v10_71g) ***** 

    new SIM_REDSHIFT_FLAG written to data files. See manual Sec 4.31.7

         ***** USEFUL(v10_71g) ***** 

         ***** MISCELLANEOUS(v10_71g) ***** 
 
    snlc_sim.c/sndata.h
      + evaluate SNDATA.SIM_REDSHIFT_FLAG to indicate source
        of redshift. Propagate to SNANA/FITRES tables.

        grep REDSHIFT_FLAG snlc_sim.h | grep define
        #define  REDSHIFT_FLAG_NONE      0
        #define  REDSHIFT_FLAG_SNSPEC    1 
        #define  REDSHIFT_FLAG_HOSTSPEC  2
        #define  REDSHIFT_FLAG_HOSTPHOT  3
        #define  REDSHIFT_FLAG_WRONGHOST 4

    sntools_host.c: 
      + fix bug in TRANSFER_SNHOST_REDSHIFT() so that wrong host
        match is preserved.

    snana_manual.pdf:
      + new section 4.31.7 Source of Each Redshift
  

# ======================================================================= 
         v10_71h (  ) 

         ***** IMPORTANT(v10_71h) ***** 

         ***** USEFUL(v10_71h) ***** 

         ***** MISCELLANEOUS(v10_71h) ***** 

   snana.car
     + SIM_ZFLAG is now default output to TEXT FITRES table.

   snlc_fit.car
     + disable GET_SIMCHI2_CHEAT until there is a way to
       avoid aborting on extreme WRONG-host where filter
       is undefined.
   snlc_sim.c :
     + refactor to call pick_NON1ASED inside gen_modelPar().
     + get GRIDGEN working for SIMSED ... needs more testing.

   genmag_BYOSED,genmag_SALT2:
     + fix buggy 1+z factor for spectra  [caught by D.Jones]


# ======================================================================= 
         v10_71i (Apr 29 2019) 

         ***** IMPORTANT(v10_71i) ***** 

         ***** USEFUL(v10_71i) ***** 

         ***** MISCELLANEOUS(v10_71i) ***** 

    snlc_sim.c
      + GENMODEL FIXMAG expanded to fixmag (obs frame) and
        FIXMAG (rest-frame) + MU. See manual.
      + few more fixes for SIMSED to work with GRID option.

    nearnbr_apply.c
      + add optioal argument -varName_prob <name> so that
        Sam can provide column name.

    split_and_fit.pl
      + create DONE_STAMP after gzipping SPLIT_JOBS/ subdir
        (instead of creating gzip file after DONE_STAMP).

    combine_fitres.c:
      + new argument T or t to specify text-only output without
        default HBOOK file. T,t -> .TEXT/.text extension. 
        Note that t arg can be anywhere; e.g.
          combine_fitres.exe <f1> <f2> t
          combine_fitres.exe <f1> t <f2> 
          combine_fitres.exe t <f1> <f2>


# ======================================================================= 
         v10_71j (May 2 2019) 

         ***** IMPORTANT(v10_71j) ***** 

         ***** USEFUL(v10_71j) ***** 

         ***** MISCELLANEOUS(v10_71j) ***** 

   SALT2mu.c
     + for NSPLITRAN option, write summary to [prefix]_summary.out 
 
   snana.car
     + fix bug with output of Bazin fit params to SNANA table,
       and make sure PKMJDINI is output to TEXT table.
     + completely redo MULTISEASON  logic; see manaul
     + fix SNCID_LIST_FILE so that NVAR is not requred.
          (fixes in RD_SNCIDLIST)

   Makefile:
     + genmag_BYOSED links only to sim; NOT to snlc_fit.

   sntools_output.c[h]:
     + increase table-comment strings from 120 -> MXPATHLEN 
        (fixes combine_fitres crash found by Sam)

   sntools_output_text.c:
     + at end of SNTABLE_READ_EXEC_TEXT, close file and
       reset flags.

   Remove TABLEFILE_CLOSE() calls after SNTABLE_READ_EXEC().




# ======================================================================= 
         v10_72 (May 4 2019) 

         ***** IMPORTANT(v10_72) ***** 

     Switch primary repo to git on fnal cluster.

         ***** USEFUL(v10_72) ***** 

         ***** MISCELLANEOUS(v10_72) ***** 

    combine_fitres.c
      + refactor indices to start at zero instead of one.



# ======================================================================= 
         v10_72b (May 7 2019) 

         ***** IMPORTANT(v10_72b) ***** 

         ***** USEFUL(v10_72b) ***** 

         ***** MISCELLANEOUS(v10_72b) ***** 
   
    sntools_output_hbook.c:  HBOOK_MEM -> 500k (was 1 million)

    Remove lots of obsolete files in /util :
        SALT2train_biascorr.pl          SALT2train_incdata.pl  
        SALT2train_run.pl               SALT2train_extcolordisp.pl 
        SALT2train_pipeline.pl          SALT2train_translate.pl
        TRAIN_SIM.pl                    backup_SNANA_PUBLIC.pl
        diskUsage_byOwner.pl        lcmerge2SALT.py
        SIMEFF_MAPGEN.pl        SNLS_simlib_gen.pl
    and from /src, remove unfold_snpar.c

    genmag_NON1ASED.c:
      + refactor init_genmag_NON1ASED() to receive INP_NON1ASED struct
        as argument -> easier to implement new options; e.g., 
        FLUXSCALE[index].
    wfit.c
      + for MUDIF file, read and use MUREF column instead of
        internally re-computing muref(z). Allows systematics
        with redshift changes.


# ======================================================================= 
         v10_72c (May 7 2019) 

         ***** IMPORTANT(v10_72c) ***** 

         ***** USEFUL(v10_72c) ***** 

         ***** MISCELLANEOUS(v10_72c) ***** 

    Silly git test only.


# ======================================================================= 
         v10_72d (May 9 2019) 

         ***** IMPORTANT(v10_72d) ***** 

         ***** USEFUL(v10_72d) ***** 

    SALT2mu.c: new fixpar_all option to use SALT2mu as MU-calculator

         ***** MISCELLANEOUS(v10_72d) ***** 

    snana.car, sntools_output*.c
     + write Tobs in SPECLIST file 
     + write PKMJDINI to text table if OPT_SETPKMJD > 0
     + remove SNANA pre-proc flag around SPECPLOT so that
       SPECTRUM plots can be made with snlc_fit as well.
     + Internal rename ITABLE_SPECTRA -> ITABLE_MODELSPEC (for SALT2)
        to avoid confusing with ITABLE_SPECPAK that packs spectra
        from the data files.
     + fix bug reading comma-separated options for SNTABLE_LIST.
       Bug probably came with refactoring to use store_PARSE_WORDS().

   SALT2mu.c
     + fix to work with uM0=0 (fix M0=-30) and nothing
       else is fit either.
     + new fixpar_all option to use SALT2mu as MU-calculator                      

# ======================================================================= 
         v10_72e (  ) 

         ***** IMPORTANT(v10_72e) ***** 

         ***** USEFUL(v10_72e) ***** 

         ***** MISCELLANEOUS(v10_72e) ***** 

    + define ENV $SNANA_TESTS for code-regression script
    + create SNANA_Code_Tests.py 


# ======================================================================= 
         v10_72f (  ) 

         ***** IMPORTANT(v10_72f) ***** 

         ***** USEFUL(v10_72f) ***** 

         ***** MISCELLANEOUS(v10_72f) ***** 

    snana.car:
      new feature to dump snana version and $SNANA_DIR :
       snana.exe --snana_vesion
         SNANA_VERSION: v10_72f
         SNANA_DIR: /home/whoever/SNANA


# ======================================================================= 
         v10_72g (May 13 2019) 

         ***** IMPORTANT(v10_72g) ***** 

         ***** USEFUL(v10_72g) ***** 

         ***** MISCELLANEOUS(v10_72g) ***** 

   SNANA_CodeTests.py : 
     + usable on DES cluster using ssh. Still need to integrate
        with batch system.
  
   sntools_output.c
     + fix dumb bug to free SPECPAK_OUTPUT memory. Fixes valgrind
       errors, and hopefully will fix the crash Justin found on
       his laptop.
       

# ======================================================================= 
         v10_72h (May 20 2019) 

         ***** IMPORTANT(v10_72h) ***** 

         ***** USEFUL(v10_72h) ***** 

   + OPT_SETPKMJD: new Fmax-clump  method; see manaul Sec 5.4.
   + SALT2mu.exe:  can read comma-sep list of simfile_bias & simfile_ccprior.
   + psnid.exe:    increase Ntemplate bound from 100 to 1000

         ***** MISCELLANEOUS(v10_72h) ***** 

     genmag_NON1ASED.c
       + bug fix for option to select round-robin over all templates.

     SALT2mu.c: 
       + Refactor to read comma-separated list of  simfile_baiscor 
         and simfile_CCprior. 

     snana.car:
       + new OPT_SETPKMJD option to use Fmax-clump method;
         see manual section 5.4.

     psnid_BEST.c :
       + increase bound of 100 templates to 1000 templates.
         Allows using PSNID on all of the K17 models.

     Run valgrind on snana.exe,snlc_sim.exe, snlc_fit.exe, 
     SALT2mu.exe, and fix a few issues. 
     Fix compile issues found on Justin's Mac, including evil
     seg-fault bug in function openFile_PATH_SNDATA_SIM().


# ======================================================================= 
         v10_72i (May 21 2019) 

         ***** IMPORTANT(v10_72i) ***** 

         ***** USEFUL(v10_72i) ***** 

         ***** MISCELLANEOUS(v10_72i) ***** 

   snana.car
     + in SET_PEAKMJD(), return if fewer than 2 epochs.
     + for Fmax-clump method, if all epochs fail SNRCUT_SETPKMJD, 
       return instead of abort.
     + improve Fmax-clump with SNRCUT_SETPKMJD=5 and BACKUP_SNRCUT
       if SNRMAX<5.
     + MXFILT_SNRMAX -> 8 (was 10) to make room for CUTWIN_TOBS

   SNANA_CodeTest.py : ready for Midway2 and batch system.

   On FNAL-DES cluster, switch devel setup to use EUPS (no mor UPS).
   This doesn't change SNANA codes, but changes what it links to.


# ======================================================================= 
         v10_72j (May 23 2019) 

         ***** IMPORTANT(v10_72j) ***** 

   SNMAGSHIFT from HOSTCOR is applied to SIM_mB and SIM_x0.
   No impact on simulated light curves, but it affects
   BBC biasCor correction.

   HOSTPAR list passed to genmag_BYOSED.

         ***** USEFUL(v10_72j) ***** 

         ***** MISCELLANEOUS(v10_72j) ***** 

    snana.car
      + new SNTABLE option
          SNTABLE_LIST = 'SNANA(text:key,text:host)'
        to include HOSTGAL info in TEXT-tables.
      + fix casting bug writing HOST_RA[DEC] to tables.
   
    snlc_sim.c :
      + allow SNMAGSHIFT(HOSTCOR) to be in SIMGEN_DUMP list
      + SNMAGSHIFT_HOSTCOR is now added to SALT2mB, rather than
        added as a global mag shift. This has no effect on 
        output light curves, but it impacts the mB-bias computed
        in SALT2mu/BBC.  DEBUG_FLAG=55 will revert back to the
        old way.
      + pass HOSTPAR_LIST to genmag_BYOSED. Initial list is
         RV, AV, LOGMASS. Note that RV,AV are impemented 
         already with C code, so python code can start with
         HOSTPAR_LIST[2] = LOGMASS.


# ======================================================================= 
         v10_73 (May 27 2019) 

         ***** IMPORTANT(v10_73) ***** 

  New sim default: PEAKMJD-estimate uses Fmax-clump method. See manual.

         ***** USEFUL(v10_73) ***** 

         ***** MISCELLANEOUS(v10_73) ***** 

    SALT2mu_fit.pl
     + untested new key  "OUTDIR_OVERRIDE: <outDir>"

    snana.car
     + MXFILT_ALL -> 100 (was 80) to match MXFILTINDX in simulation.
     + for OPT_SETPKMJD=16 (Fmax-Clump option), re-write fortran
       subroutine into C function (get_obs_atFLUXMAX) that is used
       by both fitting programs and the simulation. This allows
       leaving PEAKMJD estimate in the sim data files using the
       same algorithm used on data, so that non-SNANA programs
       can use PEAKMJD estimate without running snana.exe.

   snlc_sim.c
     + new function gen_peakmjd_smear() to either pick random
       Gaussian smear, or use Fmax-clump option like the data.
       Default is OPT_SETPKMJD=16.
     + Beware that global GENLC.PEAKMJD_RANGauss is used to 
       preserve random sync, but eventually should move location
       of ran-Gauss generation to gen_peakmjd_smear() and break
       random sync.
     + remove obsolete input GENLIST_PEAKMJD_FILE
     + remove obsolete functions init_peakmjdList, get_peakmjd_fromList


# ======================================================================= 
         v10_73b (May 31 2019) 

         ***** IMPORTANT(v10_73b) ***** 

         ***** USEFUL(v10_73b) ***** 

    + SALT2mu_fit.pl:works with NSPLITRAN. 
    + SALT3.XYZ models recognized as SALT2 (but not yet tested)
    + Command-line options can now include comma-sep list of CID strings.

         ***** MISCELLANEOUS(v10_73b) ***** 

    snana.car:
      + apply CUTWIN_TOBS to epochs for Bazin fit.
      + fix subtle bug in LCUTEPOCH(); apply CUTWIN_TREST only
        if OPT_SETPKMJD=0; otherwise need to wait for PKMJD
        to be determined. Matters a lot when SEARCH_PEAKMJD
        in data file is way off.
      + accept command-line override with comma-separated list of 
        CCID-strings: e.g.,
          snana.exe <inFile> \
             SNCCID_LIST 2000ca,2001cn,2001el,2000E,2002bo,1992bh

    snana_manual.pdf :
      + improve Sec. 5.4 : Initial Estimate of PEAKMJD.

    SALT2mu.c
     + new input JOBID_SPLITRAN to process only 1 of the NSPLITRAN jobs.
       The summary file is created if JOBID_SPLITRAN > NSPLITRAN.
     + fix bugs re-initializing NSPLITRAN jobs. See SPLITRAN_prep_input(),
       and bug-fix in setup_zbins_fit().

    SALT2mu_fit.pl: works with NSPLITRAN. See instructions in top of file.

    genmag_BYOSED.c:
      + construct pyFORMAT_STRING_HOSTPAR to pass to python.
      + pass NAMES_HOSTPAR to init_genmag_BYOSED()

    snlc_fit.car, snlc_sim.c:
      + allow for SALT3 model, but use internal MODEL_SALT2 index.
         [not tested yet on actual SALT3.[NAME]  directory]
      + remove check on [MODEL].DEFAULT, and remove [MODEL].DEFAULT
        files from $SNDATA_ROOT/models/*.

    snlc_sim.c:
      + GENLC.PEAKMJD_RANGauss is now set locally in gen_peakmjd_smear(),
        and thus random sync has changed. Must cut new SNANA version here
        and re-generate REF for SNANA_CodeTest.


# ======================================================================= 
         v10_73c (June 13 2019) 

         ***** IMPORTANT(v10_73c) ***** 

         ***** USEFUL(v10_73c) ***** 

   Added wfit options for Pippin-integration

         ***** MISCELLANEOUS(v10_73c) ***** 

    SALTmu.c
     + major refactor to use same cutmask-function for data,biasCor,CCprior.
     + bug-fix determinig sigInt for biasCor; relaxed z cut had removed 
       global z-cut, but should have kept global z-cut and applied only
       the internal BIASCOR-z cuts dependent on IDSAMPLE. See new 
       CUTBIT_BIASCORz.
     + more refactoring to read & process data,biasCor,CCprior with 
       common tools.
     + write reduced COV matrix to output fitres file
     + For this SNANA version, leave LEGACY-code flag;
       will implment refactored SALT2mu code next version.

    SALT2mu_fit.pl
     + count ABORTS and write SUCCESS or FAIL to ALL.DONE file.

    split_and_fit.pl :
      + TOTAL_WAIT_ABORT -> 48 hr (was 24 hr)

    combine_fitres.c
      + new argument -outfile_text <outfile>

    NEARNBR_pipeline.pl
      + fix bug deleting TOPDIR_OUTPUT for -RESTART 2

    nearnbr codes:
      + new NNINP input NEARNBR_TRAINFILE_SCALE_NON1A
         (propagated to nearnbr_maxFoM and nearnbr_apply)
      + Goal is to allow increasing CC component in sim-training 
        sample, and then account for the CC-scale in the 
        training process. The I/O is added, but still need
        to implement.

    SNANA_CodeTests.py :
     +  works without a TESTINPUT key in task file.

    wfit.c :   few outfile changes to be Pippin-friendly.
      + input syntax for cospar outfile is
          -cospar <fileName>  or
          -outfile_cospar <fileName>
      + same for resid file with key -resid or -outfile_resid
      + -csv command writes cospar in csv format.
      + -outfile_resid NONE --> no resid file


# ======================================================================= 
         v10_73d (Jun 19 2019) 

         ***** IMPORTANT(v10_73d) ***** 

         ***** USEFUL(v10_73d) ***** 

         ***** MISCELLANEOUS(v10_73d) ***** 

   snlc_sim.c
     + apply NGEN_SCALE_NON1A and DNDZ_SCALE[1] to SIMSED models in 
       addition to NON1A models.

   NEARNBR_pipeline.pl :
     + new input "SIMTRAIN_NON1A_SCALE: <scale>" to scale NON1A & SIMSED
       sample sizes, keeping SNIa the same. NN-train and NN-apply have
       been modified (previous SNANA version) to correct for this scale.

   SALT2mu.c :
     Finished refactoring, but still keep LEGACY switch .

   split_and_fit.pl 
     + minor fix related to parsing wild card in VERSION key.

   sntools_nearnbr.c[h]
     + remove all instances of obsolete P_TRAIN
     + fix NEARNBR_GETRESULTS to account for SCALE_NON1A

   sntable_combine.c: 
     + fix bug closing table file after read.

   snana.car:
     + read SIM_SNMAGSHIFT_HOSTCOR from sim data files (not tested)
     + for cut-summary, include "CUTSTAT:" key so that it's easier
       to parse the split_and_fit logs to make a total cut-summary table.

   psnid.car:
    + make calls to new "BEST2" functions, which are blank.
   psnit_BEST2.c :
    + new set of blank function, to be filled in later.


# ======================================================================= 
         v10_73e (June 19 2019) 

         ***** IMPORTANT(v10_73e) ***** 

      Implement refactored SALT2mu/BBC code.

         ***** USEFUL(v10_73e) ***** 

         ***** MISCELLANEOUS(v10_73e) ***** 

  SALT2mu bugs found during refactor:
    * no z cut for biasCorsigInt calc
     (intent was remove IDSAMPLE z cuts, but keep global z cut)

    * for biasCor, use mB = -2.5*log10(x0) instead of mB in file
       (maybe difference from truncation round-off)

    * missing BAD-COV cut on biasCor and CCprior samples.

   REFACTOR-LEGACY differences for SALT2/BBC ::
              
        test       | keep bugs  |  fix bugs  |
    -----------------------------------------
         (1D)      |            | 
     dalpha/alpha  |  1.0000    |  1.0000
     dbeta/beta    |  1.0000    |  1.0000
     dgamma        |  0.0000    |  0.0000
       
         (5D)      |            |
     dalpha/alpha  |  0.99880   |  0.99875
     dbeta/beta    |  0.9993    |  0.99932
     dgamma        | -0.00014   | -0.00015
     ----------------------------------------

  To restore lagcy code and bugs:  
    LEGACY_READFILE=1
    LEGACY_BUGS=1

 

# ======================================================================= 
         v10_73f (Juj 25 2019) 

         ***** IMPORTANT(v10_73f) ***** 

   + New plot tools for LC and spectra by J. Pierel (plot_snana.py)
   + merge BYOSED stuff as well.

         ***** USEFUL(v10_73f) ***** 

         ***** MISCELLANEOUS(v10_73f) ***** 

   sntools_output_root.c
     + fix to include comma for csv-dump.

   SALT2mu.c :
     + fix bug freeing memory for CCPRIOR.
     + fix bug using varname_pIa as CUTWIN arg.
     + fix bug setting CUTBIT_IDSAMPLE for biasCor; fixes crash
        when biasCor includes samples that are not in the data

   snana.car/snlc_fit:
     + if OPT_SETPKMJD>0 is set, call new function 
       SELECT_EPOCHS_CUTWIN_TREST() after SET_PEAKMJD function
       to apply CUTWIN_TREST and reduce storage size. 
       This avoids array bound overflow for fitting arrays.

    snana.car: 
     + remove SNLC_SNLC_SKY(epoch) array since it gets computed
       in FLUXERRCALC, and it was read only from TEXT and not
       from FITS format.
     + remove obsolete arrays: 
          SNLC_AIRMASS, SNLC_CLOUDCAM_AVG, SNLC_CLOUDCAM_SIG
          SNLC_MOONDIST, SNLC_MOONPHASE, SNLC_FLUX, SNLC_FLUX_ERRTOT

   snlc_sim.c :
     + new sim-input key "BIASCOR_SALT2GAMMA_GRID: <min> <max>"
       to generate randon min & max mag shifts for each event.
       To be used later by BBC/SALt2mu in fitting for gamma.


# ======================================================================= 
         v10_73g (June 25 2019) 

         ***** IMPORTANT(v10_73g) ***** 

         ***** USEFUL(v10_73g) ***** 

         ***** MISCELLANEOUS(v10_73g) ***** 

   Forgot to update genmag_BYOSED.h in last version, so did it here
   and now sim compiles properly.


# ======================================================================= 
         v10_73h (July 5 2019) 

         ***** IMPORTANT(v10_73h) ***** 

         ***** USEFUL(v10_73h) ***** 

    new &SNLCINP input MXEVT_PROCESS (see manual)

         ***** MISCELLANEOUS(v10_73h) ***** 

   snana.car:
    + new &SNLCINP input MXEVT_PROCESS will quit after reading
     this many events.

   snlc_fit.car
    + few photo-z fixes, mainly color bound -> -0.2 instead of -0.3
      for course-grid estimates before fit.

   NEARNBR_pipeline.pl
     + new input OPT_TUNE_HOSTEFF to run only a few stages needed
       to compare data and sim.

   snlc_sim.c
    + remove input REFAC_PICK_NON1ASED and remove assocated legacy calls.
    + for NON1ASED MAGSMEAR colum, allow comma-separate sigmas for
      bifurcated Gaussian.

   sntools_host.c[h]:
     + read [new] optional HOSTLIB_SPECTEMPLATE_FILE, and parse it.

   New code files inoue_igm.c and inoue_igm.h  to simulate IGM effects for
   spectra in the simulation. Code taken and simplified from
       https://github.com/gbrammer/eazy-photoz/tree/e4a092c1e1d61c5fc4318291b451bd5d032aacb0

   sntools.c: 
     fix bug in get_obs_atFLUXMAX() so that it works with unsorted MJD_LIST


# ======================================================================= 
         v10_73i (July 12 2019) 

         ***** IMPORTANT(v10_73i) ***** 

     simulated host spectrum ready for testing.

         ***** USEFUL(v10_73i) ***** 

         ***** MISCELLANEOUS(v10_73i) ***** 

   snana.car:
     + for host spectrum, write TOBS = -9 in data file.

   sntools_host.c[h]:
     + ready to test genSpec_HOST()
     + new utility fetch_HOSTPAR_GENMODEL to get names and values
       of host params passed to BYOSED.

   SALT2mu.c: 
    + remove USECODE_LEGACY pre-proc flag.

   snlc_fit.car:
    + in FITINI_PHOTOZ, remove faulty constraint on Fmodel_scale.
    + new &FITINP input UVLAM_EXTEAPFLUX to extrapoate fit model to 
      far UV. Intended for photo-z fits to keep g-band at high-z..
      Make sure to adjust RESTLAMBDA_FITRANGE to allow smaller lambda.
    + start refactor of FITINI_PHOTOZ to have multiple options for
      initial-param estimates.

  snlc_sim.c:
    + new function GENSPEC_HOST_CONTAMINATION() to add host contam.
      to SN spectra. See new input TAKE_SPECTRUM_HOSTFRAC: <frac>
    + for BYOSED model, replace hard-wired HOSTPAR list with call
      to fetch_HOSTPAR_GENMODEL().
    + add BYOSED to list of models for which RV_host and AV_host
      are determined.

  genmag_BYOSED.*
    + merge code from Justin,D'Arcy,David.

  manual:
    + update photo-z section to include UVLAM_EXTRAP sub-sub-subsection.


# ======================================================================= 
         v10_73j (Jul 18 2019) 

         ***** IMPORTANT(v10_73j) ***** 

         ***** USEFUL(v10_73j) ***** 

         ***** MISCELLANEOUS(v10_73j) ***** 
    
   snlc_fit.car
     + new &FITINP input NEVAL_MCMC_PHOTOZ to replace course-grid
       init with MCMC burn-in. Course grid and MCMC are both 
       quick approximations before MINUIT takes over.
       Test on DES3YR with  NEVAL_MCMC_PHOTOZ=200:
         -> efficiency -> 99% (was 95% with course grid)
         -> RMS(zPhot-zSpec) is 10% worse, but may be stat fluctuation.
 
   snana.car
     + fix snana-table bug for host property errors.
     + bug dumb bug reading spectra for real data (setting NVAR_SPECTRUM)

   snlc_sim, sntools, snana.car:
      Rename SIM_SNMAGSHIFT_HOSTCOR -> SIM_gammaDM to be more
      parallel with SIM_alpha & SIM_beta. 

   SALT2mu.c:
     + start refactor for 7D biasCor. Read optional SIM_gammaDM  
       from table, and include ig (gamma) index along with ia,ib.

   New utility sntools_stronglens.c[h] with empty code-shell.
   Called by snlc_sim, but not implemented. Later, need to implement
   multuple light curves with different time shifts and magnifications.
  

# ======================================================================= 
         v10_74 (July 19 2019) 

         ***** IMPORTANT(v10_74) ***** 

         ***** USEFUL(v10_74) ***** 

   SALT2mu: 
     + new chi2max=<max> input to reject chi2-outliers (before fit)
     + chi2_beams written to output fitres file.

   genmag_snoopy.c:
    + major refactor to only read GRID (no snoopy-specific code), 
      and to read MAG-grid instead of relFlux grid. Intended to read 
      more recent snoopy model based on Burns 2018.

         ***** MISCELLANEOUS(v10_74) ***** 


# ======================================================================= 
         v10_74b (Aug 2 2019) 

         ***** IMPORTANT(v10_74b) ***** 

         ***** USEFUL(v10_74b) ***** 

    snlc_sim.c[h]:
    Simulation has new strong lens (SL) functionality for resolved sources 
    so that each lensed image produces a distinct light curve with time 
    delay, magshift, angle separation. The underlying SL model is in 
    sntools_stronglens.c[h], and is still a dummy model for testing; 
    a realistic model is under development by J.P. using a SL library.
    Plans for later include a blended SL option where all lensed LC 
    are added into one LC. However, there are no plans to simulate
    PSF-smear affects on blended photometry.

    See SIM_STRONGLENS_XXX variables in data files (TEXT and FITS format).
    These variables are NOT [yet?] read by snana analysis/fitting codes.

    snlc_sim.c:
      + new dashboard utility
          snlc_sim.exe <inFile> DASHBOARD

      + no more defaults for
          SEARCHEFF_PIPELINE_LOGIC_FILE: 
          SEARCHEFF_PIPELINE_EFF_FILE:

         ***** MISCELLANEOUS(v10_74b) ***** 

    All .c, .car files:  fix warnings with -Wall 
  
    Remove obsolete gloes.c[h] since genmag_snoopy only reads a 
    GRID and does not use Burn's code.

    snlc_sim.c
     + abort if no rate model (DNDZ key)
     + in init_kcor(), abort if rest-frame model has zero k-cor tables.

   sntools_output.c:
     + declare FMT and ENV so that compile works when 
       ROOT & HBOOK are not defined.

   sntools_trigger.c:
     + fix array overwrite in README structure.

   SALT2mu.c:
    + new input option for user redshift bins:
         zbinuser=0.05,0.10,0.15,0.20,0.25
    + add logmass dimension to some biasCor arrays, 
       along with some 'im' loops.

   genmag_snoopy.c:
     + fix declaration bug in init_genmag_snoopy__()

   snlc_fit.car:
      + fix interface problem for init_genmag_snoopy.

   TO DO: allow salt3 prefix in filenames with SALT3 in dirName.


# ======================================================================= 
         v10_74c (Aug 8 2019) 

         ***** IMPORTANT(v10_74c) ***** 
  
   Fix evil kcor bug related to k-corrections with AVwarp < 0. 
   See MWgaldust.c below.

         ***** USEFUL(v10_74c) ***** 

   RANSYSTPAR in sim now includes w and OM; see manual Sec 4.38

         ***** MISCELLANEOUS(v10_74c) ***** 

   genmag_SALT2.c[h]:
     if model name has SALT3, read filenames with salt3 prefix.
     NOT TESTED.

   snlc_sim, snana.car, sntools_fitsio.c:
     + fix snoopy sim to output SIM_STRETCH instead of SIM_DM15.
     + few more strong lens fixes. 
     + SL PROBLEM: NGENTOT_LC can clip some SL light curves for last event.
       e.g., NGENTOT_LC=10, and at 9'th event there are 3 lensed images;
       only 1 of 3 images is reported because ilc==11 & 12 are not
       generated.
    +  new RANSYSTPAR options for w and OM. Also, change the old
       keyname structure from RANSYSTPAR_FUDGESCALE_XXX to 
       RANSYSTPAR_SIGSCALE_XXX, and same for SHIFTs.
       See updated manual section
          4.38 Applying Systematic Errors (RANSYSTPAR)

   sntools_stronglens.c[h]
     + more development.

   MWgaldust.c:   
     + in GALextinct(), fix nasty bug where it returned XT=0 
       for AV<1E-9 ... should return XT=0 only if AV=0.
       Bug caused all AV<0 to return same extinction as AV=0.
       This bug has no effect for normal use of GAL-extinction,
       but it ruins the AVwarping on spectra used in k-corrections.
       This bug was introduced way back in 2013, v10_30, when the
       GALextinct codes were moved and refactored. Surprisingly,
       nobody has noticed this bug until now when we tried to
       simulate with the snoopy model.

   snana.car:
     fix calls to GET_1DINDEX() to be compatible with Feb 2018 
     refactor where indinces start at 0, not 1. Affects sim &
     fits with k-correctios. Amazingly, SNANA_CodeTest shows
     no discrepancies after fix.
 
     Fix bug setting redshift errors for HEADER_OVERRIDE

  SALT2mu.c: 
    + remove obsolete abort trap on >200 characters for command-line
      override.


# ======================================================================= 
         v10_74d (Aug 28 2019) 

         ***** IMPORTANT(v10_74d) ***** 

   SALT2mu/BBC works with 6D (added mag offset dimension)

         ***** USEFUL(v10_74d) ***** 

         ***** MISCELLANEOUS(v10_74d) ***** 

   sndata.h: increase MXPATHLEN to 300 (was 200)

   snlc_sim.c, sntools_fitsio.c:
     + add abort trap if file name (aux or FITS) will be > MXPATHLEN.

   snlc_sim.h:
     + GENVERSION and GENPREFIX -> 200 max length (was 80)
    
   genmag_SEDtools.h : 
     + MXBIN_LAMFILT_SEDMODEL -> 2400 (was 2000)

   genmag_SALT2.c[h]:
     + implmement RELAX_IDIOT_CHECK_SALT2 for P18_UV2IR to avoid abort.

   SALT2.c:
     + BBC6D works with SIM_gammaDM. Need to add logmass dimension next version.

   snana.car:
     + if SNCID_LIST of SNCID_LIST_FILE is given, internally set CUTWIN_CID=0,0

   sntools_genSmear.c
    + in init_genSmear_SALT2(), check zmin consistency.


# ======================================================================= 
         v10_74e (Sep 4, 2019) 

         ***** IMPORTANT(v10_74e) ***** 

         ***** USEFUL(v10_74e) ***** 

         ***** MISCELLANEOUS(v10_74e) ***** 

   SALT2mu.c
     + implement 7th BBC dimenstion : logmass
     + for zVARNAME, remove abort on z<0 ... user must be careful
       to apply CUTWIN so that only postive redshifts are used.

   snana.car :
    + new utility to dump info about data version:
         snana.exe GETINFO <version_photometry>
    + ANYLCFUN: force model flux to be <= 1.0E20 to avoid 
       double precision overflow for chi2.
    + for SNCCID_IGNORE_FILE, allow up to MXIGNORE_LIST=500
       (instead of MXLISTNML=52). Beware: not tested.

   snlc_sim.c
     + new command-line input +HOSTMAGS to create new HOSTLIB
       with synthetic mags. Still testing with HST.

   sntools_host.c: 
    + new function rewrite_HOSTLIB_plusMags() to implement +HOSTMAGS.
      See new manual section  4.19.3 Synthetic Host Magnitudes

   sntools_genSmear.c[h]:
     + add new code wrappers for OIR (optical+IR) 
     + fix NODE logic for last bin in init_genSmear_SALT2().


# ======================================================================= 
         v10_74f (Sep 23, 2019 ) 

         ***** IMPORTANT(v10_74f) ***** 

         ***** USEFUL(v10_74f) ***** 

    snlc_fit.exe: if PRIVATE_DATA_PATH matches any sim-dir,
       code aborts with more clear message. Previously the
       abort message incorrectly indicated that VERSION was 
       in 2 directories, which was confusing.

    SALT2mu_fit.pl: 
       + add optional DONE_STAMP key
       + fixed to work if input file name includes full path.

    SALT2mu.c: 
       + new input cid_select_file=[fileName] to select
          specific list of CIDs for data.
       + new input to force P_CC=0 and P_Ia=1 for spec-confirmed subset;
          see type_list_probcc0 and idsurvey_list_probcc0

    split_and_fit.pl:
      slurm job names are now based on NML file name rather than
      a generic  FITSPLIT prefix -->
      Easier to distinguish multiple jobs for same user.

    sntools_host.c[h]: 
      synthetic host mags (from eazy spectra) pass HST crosscheck.
     
         ***** MISCELLANEOUS(v10_74f) ***** 

   sntools_trigger.c
    + write string COMMENT_README_TRIGGER for readme file.
      Fix previous comment bug about zHOST usage.

   SALT2mu.c:
     + finally remove all traces of INPUTS.LEGACY_[BUGS,README].
     + new input cid_select_file=[fileName] to select specific
       list of CIDs for data; ignored for biasCor sim and for CC sim.
  
   SALT2mu_fit.pl
    + add optional key 
          DONE_STAMP: <fileName>
    + fix parsing to ignore comment lines (un-tested)
    + See Sep 14 2019 updates at top of source file;
      Works with more general symbolic links, and subDir name changes.

   genmag*.c[h]:    make variable names consistent:
      minlam -> lammin, maxlam -> lammax, etc ...

   sim_SNmix.pl
     + replace few remaining parse_line commands with parse_array
       so that comment lines are ignored.

   sntools_host.c[h] :
     + more fixes for host spectrum.
     + MINLOGZ_HOSTLIB -> -3.0 (zmin -> 0.001 instead of 0.003)
        for H0 studies.

   sntools.c:
     in getInfo_SNANA_VERSION(), abort if PRIVATE_DATA_PATH is
     incorrectly set to SNDATA_ROOT/SIM, or to any path in
     PATH_SNDATA_SIM.LIST file.

   genmag_SALT2.c :
     + colorDisp map reads ilam=0 to NLAM-1 (intead of 1-NLAM)
     + in get_SALT2_ERRMAP(), protect against Trest or Lam being lower 
       than ERRMAP min since ERRMAPs don't always cover SED range.
       Note that max range was aleady protected.
       Amazingly, SNANA_CodeTest shows no changes.
     + init_genmag_SALT2(), OPTMASK & 64 enables aborting on ERRMAPs
       with ranges that don't cover SED range. This feature is enabled
       with kludge: snlc_sim.exe <inFile> DEBUG_FLAG 64 so that we
       don't get aborts unless we want them.

   sntools.pm:
    + add batchName argument to make_batchFile sub.
   
   split_and_fit.pl:
     + use NML file name in new batchName argument.
       Note that anything before slashes is stripped from NML filename.
     + for non-existing path in SIM_SNDATA_PATH.LIST, give warning.

   snlc_sim.c:
     simlib reading rewinds on end-of-file or END_OF_SIMLIB key.

   combine_fitres.c
     + abort if first column is not CID.


# ======================================================================= 
         v10_74g (Oct 7 2019) 

         ***** IMPORTANT(v10_74g) ***** 
       SALT2mu_fit:
          monitor and summary tasks are launched as background job,
          so that terminal control is returned.

       combine_fitres.exe
          Uses hash table for CID matching --> much faster for large files.

         ***** USEFUL(v10_74g) ***** 

         ***** MISCELLANEOUS(v10_74g) ***** 

   SALT2mu.c 
    + in output fitres file, write SUM_PROBIa and SUM_PROBCC
      and contamination estimate, SUM_PROBCC/(SUM_PROB1a+SUM_PROBCC).
      For sim data, the contam estimate should be consistent with the 
      true contamination.
      Also include table showing contaminatoin vs. MURES, and another
      table showing contam vs. redshift.

    + add new fitres-output column PROBCC_BEAMS.

    + u13=2 replaces scalePCC fit param with scaleP1a as in Eq 4 of H11.
      Avoids negative contamination when using CC prior with 1a-only sample.
      For nominal Ia+CC mix in sim-data, alpha, beta, and contamination
      are idential with u13=1 and u13=2. For Ia-only sim-data and using
      CCprior, alpha and beta are the same, while CONTAM goes from
      small negative (-0.004) to small positive (+0.0008).
       
   SALT2mu_fit.pl :
     + subtle fix to ensure that final DONE file is created after
       everything else is finished. Previously, final DONE file
       was created before SUMMARY file and before gzipping.
     + monitor and summary are now launched as background job,
       so that terminal control is returned.

   sim_SNmix.pl:
     for RANSEED_CHANGE option, fix bug so that LIST file has
     SNIa before NONIaMODEL ... needed by fitting codes to get 
     correct SIM_xxx names in output FITRES file.

   combine_fitres.c:
     + use hash table for cid matching using uthash.h from  
          http://troydhanson.github.io/uthash/index.html 
       It's way way faster for large (e.g., biasCor) files. 
       To revert back to original slow matching method,
          combine_fitres.exe <argList>  -matchflag 1
       Beware of significant refactor.


# ======================================================================= 
         v10_74h (Oct 24 2019) 

         ***** IMPORTANT(v10_74h) ***** 

   + fix blinding in SALT2mu, and add explanation in manual Sec 10.2
   + new intrinsic scatter model for sim: COVSED based on SUGAR model.

         ***** USEFUL(v10_74h) ***** 

   + split_and_fit has new FAST10 & FAST100 option to pre-scale 
     sim data by 10 & 100.

         ***** MISCELLANEOUS(v10_74h) ***** 

   snlc_fit.car: 
     + MXFIT_DATA=1000 -> 1500. Program size = 314 MB -> 335 MB.
     + abort if photo-z fit and USE_SNHOST_ZPHOT=T. This combo
       causes something crazy in 2nd iteration of photo-z fit.

   SALT2mu.c:
     + new option to force_pIa=xx.yy to force same pIa for each event.
     + in M0DIF file, write warnings for MUDIFERR=0
     + fix bug using cutmask_write=-1
     + scalePPC bound -> -0.5 to +0.5 (was -0.1 to +0.5)
     + add user input keys for logmass_min, logmass_max, nbin_logmass
     + fix blinding.

   SALT2mu_fit.pl
     + batch name is now based on name of input file [untested->BEWARE]

   snlc_sim.c, sndata.h
     + new parameter MXLEN_VERSION_PREFIX 52 to prevent GENPREFIX
       exceeding FITS key bound. Note that FITS header keys have
       80 char bound that includes key name and quotes. E.g.,
          PHOTFILE = 'TEST_PHOT.FITS'
       counts as 27 characters, not 14.

   snana.car
     + fix SKYSIG format for make-simlib option.

   split_and_fit.pl
    + new FAST10 & FAST100 option to pre-scale sims by 10, 100
        split_and_fit.pl MYBIGJOB.NML FAST10
        split_and_fit.pl MYBIGJOB.NML FAST100
      Note that real data are not pre-scaled.

   snlc_sim.c:
     + fix bug parsing GENMODEL on command line.

   sntools_genSmear.c, snlc_sim.c:
     + add new intrinsic scatter model "COVSED" to specify 
       covariance in wave x phase bins. Start with SUGAR.
     + some refactoring of utilities to generate randoms for genSmear.
     + new repeat_genSmear() function to generate new set of 
       magSmear only when needed. G10 smear model is almost
       x2 faster, and COVSED is more than x2 faster.
   

# ======================================================================= 
         v10_74i (Oct 30, 2019) 

         ***** IMPORTANT(v10_74i) ***** 

    sim_SNmix.pl  : 
       ABORT on obsolete keys (H0 and ZRANGE)

    snana.exe/snlc_fit.exe : 
        &SNLCINP argument RESTORE_DES3YR=T to select all DEDS3YR-LOWZ

    SALT2mu_fit.pl: 
        OUTDIR_OVERRIDE works for 'INPDIR:' as well as INPDIR+:

         ***** USEFUL(v10_74i) ***** 


         ***** MISCELLANEOUS(v10_74i) ***** 

    SALT2mu.c:
     + better stdout messaing in prepare_biasCor to make more 
       clear if 1D, 5D, 6D, 7D
 
     + combine_fitres.c: fix trivial bug

     + snana.car: MXTABLE1D_KCOR = 8M -> 10M (for SNOOPY model)
       size(snana.exe,snlc_fit.exe) increase by 5M,8M, respectively.

   sim_SNmix.pl
    + Abort on obsolete 'H0:' key in master file. 
    + Abort on 'ZRANGE:' key in master file, with instructions
      to replace with GENOPT_GLOBAL:  GENRANGE_REDSHIFT <zmin> <zmax>

    + FORMAT_MASK and GENPREFIX can be specified as part of
        GENOPT_GLOBAL: FORMAT_MASK <mask> GENPREFIX <prefix>

   + Why? H0 is completely obsolete and should be removed to avoid confusion.
     ZRANGE doesn't match the GENRANGE_REDSHIFT key-name in sim-input file,
     which can also cause confusion.
     'FORMAT_MASK:' and 'GENPREFIX:' keys remain valid in both simgen-input 
     and simgen-master file, and the same syntax applies for both files. 
     The goal here is to slowly transition to defining all global sim 
     options with GENOPT_GLOBAL

   + to do later: allow NGEN_UNIT to be in GENOPT_GLOBAL argument.

   + subtle bug fix related to RANSEED_CHANGE option.

   snlc_sim.c
     + in GENSPEC_LAMSMEAR(), fix bug setting GRAN_T=0 if there is
       no template noise. Fixes valgrind errors found by D.Jones.
 
  snana.exe/snlc_fit.exe :
    + LCUTEPOCH fix back in May 2019 results in 3 LOWZ SN lost
      from DES3YR analysis. To recover these, use new restore argument,
         snlc_fit.exe <inFile>  RESTORE_DES3YR T
      or add RESTORE_DES3YR=T to &SNLCINP namelist.

   sntools_kcor.c[h]: begin refactor to translate fortran kcor-read to C.


# ======================================================================= 
         v10_74j (Nov 18 2019) 

         ***** IMPORTANT(v10_74j) ***** 

   + snlc_fit.exe aborts on obsolete &SNLCINP input CUTWIN_NBAND_THRESH
   + for SALT3, remove x1*M1/M0 term in error; see ISMODEL_SALT3.
   + See +HOSTNBR option in manual to track multuple host neighbors
   + Bug fixes computing SN positon near galaxy

         ***** USEFUL(v10_74j) ***** 

         ***** MISCELLANEOUS(v10_74j) ***** 
  
    sntools_output.c
      + better error message if NPTFIT is missing for outlier/obs dump.

    snlc_fit.car: 
      + add FLUXERRCALC_SIM to FITRES+RESIDUAL table (after ERRTEST)
      + protect table abort when there are no non-PKMJD covariances.
    sntable_dump.pl
      + include FLUXERRCALC_SIM for outlier/obs option.

    sntools_genSmear.c[h]: 
     + finally merge Sep 12 merge request, and do a little cleanup.

    SALT2mu.c
      + if float param is NaN or inf, return with chi2=1E14
      + MXBIN_LOGMASS -> 25 (was 10)

    sntable_dump.c:
       + add FLUXERRCALC_SIM to outlier dump, and fix overwrite bug.

    snlc_sim.c :
      + abort if stronglens model us used with random CID.
        See gen_event_stronglens().

    genmag_SALT2.c:
       + for SALT3, remove x1*M1/M0 term in error; see ISMODEL_SALT3.

    sntools_host.c[h]:
      + more development for +HOSTNBR option
      + start adding code to parse and use NBR_LIST column that was
        created by +HOSTNBR option. Writes up to two sets of 
        HOSTGAL with "DEBUG_FLAG 2". DDLR calculation is a dummy
        calc that needs to be fixed.
     + fix bug setting SN position in GEN_SNHOST_POS().
       Bug related to interpreting angle w.r.t. major axis.
       Replace incorrect random angle (0:2PI) with angle weighted by DLR^2.
       Restore host bug(s) with
          snlc_sim.exe <myInput> DEBUG_FLAG 3

   sim_SNmix.pl:
     + fix error trapping for failed jobs.

   split_and_fit.pl:
     + abort if APPEND_TABLE_TEXT is defined without also defining
       either HFILE_OUT or ROOTFILE_OUT.

   snana.car:
     + MXCCID_LIST -> 20k (was 10k)
     + fix bug in MOVE_SNLC_ARRAYS() to check for fakes.
     + new &SNLCINP input CUTWIN_ERRTEST to cut on ERRCALC/ERRTRUE

   combine_dataVersions.py:
     + bug fix writing AB_SED and BD17_SED


# ======================================================================= 
         v10_74k (Dec 6 2019) 

         ***** IMPORTANT(v10_74k) ***** 

         ***** USEFUL(v10_74k) ***** 
 
   + new &SNLCINP OPT_SIMLIB_OUT to write SIM_MAGOBS in MAG column
       (1st use: simulate fakes for DES)
   + new 'SIMLIB' model for sim to read true mag from last SIMLIB column
       (1st use: simulate fakes for DES)
     
         ***** MISCELLANEOUS(v10_74k) ***** 

   SALT2mu.c
     + new option interp_biascor_logmass=0 to to turn off interpolation
       along logmass dimension.
  
   snana.car:
      + MXINTERP -> 1000 (was 100)
      + for interp option using SNMJD_LIST_FILE, suppress output
        from Bazin fit if doing SALT2 fit. snana.exe gives Bazin fit
        interp, while snlc_fit.exe gives SALT2 fit interp.
      + abort on 2 or more primary refs  (subr RDKCOR_FITS_PRIMARYSED)
      + OPT_SIMLIB_OUT; see manual 12.3.3 Creating a SIMLIB from Data
      + New &SNLCINP  SIMVAR_CUTWIN_STRING = 'NEP_SIM_MAGOBS 4 9999'
        to require min number of epochs with true flux > 0
      + in output table, SIM_x1 -> SIM_SALT2x1 and SIM_c -> SIM_SALT2c
         (beware that SALT2mu needs update too)

   snlc_sim.c 
     + crazyflux *= scale_fluxerr to allow for much larger scatter.
     + new 'SIMLIB' model to read true mag from last SIMLIB column;
       initial use is to simulate fakes,
       see manaul Section 9.8 SIMLIB: Read True Mags from SIMLIB File

   sntools_genSmear.c[h]
     + update COH model to pass 1 or 2 sigma values with 
        COH(0.11) or COH(0.11+.05)
           
   sntools_spectrograph.c
     + abort if any spectrograph-table SNR values are zero.

   sntools_trigger.c
     + fix bug reading maps from zHOST file.

   sim_SNmix.pl
     + new input key LOGDIR: <dirName>

   snlc_fit.car: in DMP_SNMJD_INTERP(), remove obsolete IFILTOBS_RST.


# ======================================================================= 
         v10_74l (Dec 23 2019) 

         ***** IMPORTANT(v10_74l) ***** 

         ***** USEFUL(v10_74l) ***** 

         ***** MISCELLANEOUS(v10_74l) ***** 

   SALT2mu.c
    + read SIM_SALT2x1[c] or SIM_x1[c]
    + abort if all data events fail cuts.
    + fix 1D5DCUT option (apply 1Dcor, but require 5Dcor exists)
    + use MXCHAR_VARNAME to declare variable names.

   snana.car
    + remove obsolete input ZPOFF_FILE and all usage. ZPOFF are
      read by kcor routine, not read by analysis codes.
    + remove obsolete WRSALT2_1
    + allow HOSTGAL_DDLR in HEADER_OVERRIDE_FILE
    + for abort on too many primarys, move abort to RDKCOR_SUMMARY
      so we can examine RDKCOR dump when we get this abort.
   
   sntools_output.h: 
    + replace hard-coded [40] with [MXCHAR_VARNAME] in many places.
   sntools_output_text.c
    + for sims, write SIM_FLUXCAL to LCPLOT file.
 
   sntools.c[h]:
     update madend for better use in pipelines.

   snana.car:
     + MADABORT calls C function errmsg so that fortran and C 
       codes use same abort call.
     + MXFILT_KCOR -> 40 (was 20). For Raisin/SNoopy.

   snlc_fit.car
     + if USE_MODEL_MAGERR=F, then turn off SALT2 covariance model.

   sntable_dump.c
     For OBS option, include FLUXCAL_MODEL

   snlc_sim.c
    + define and set GENLC.ISOBS[ep] to avoid checking multiple
      logicals for each epoch.
    + refactor LOAD_SEARCHEFF_DATA and note that random sync is changed.
      Recover legacy code with "DEBUG_FLAG 55"


# ======================================================================= 
         v10_74m (Jan 08 2020) 

         ***** IMPORTANT(v10_74m) ***** 

   snlc_sim refactor resulted in 2 subtle bug-fixes for FLUXERRMODEL_MAP

         ***** USEFUL(v10_74m) ***** 

         ***** MISCELLANEOUS(v10_74m) ***** 

   sntools.c:
     + new utility print_preAbort_banner(fnam) to standardize
       header for pre-abort dumps. Goal is for higher-level
       pipelines (e.g., Pippin) to find pre-abort contents.

   snlc_sim.c
     + in genmag_boost, fix bug checking unused AV.
     + as part of refactor, fix bug in gen_smearFlux() related to
       FLUXERRMODEL_MAP; scale template error for applying noise
       to match scaling applied to reported error.
     + for call to get_FLUXERRMODEL() in function gen_smearFlux, 
       include template error in passed FLUXCALERR_in (another bug fix).
       Note very small changes when using FLUXERRMODEL_MAP.
     + rename genmag8 -> genmag, epoch8->epoch, etc ...

   SALT2mu.c:
    + in sort_IDSAMPLE, add abort trap if fieldgroup key does 
      not include all fields. Avoids ambiguity of undefined
      fields being exluded or part of survey.

   psnid:
     + pass SIM_EPFLUXCAL to SNLCPAK to be compatible with previous
       update for snana & snlc_fit.
   

# ======================================================================= 
         v10_75 (Jan 20 2020) 

         ***** IMPORTANT(v10_75) ***** 

   Sim flux correlations with REDCOV key: see manual Sec 4.11.2.
   Until refactored code is default, set OPT_DEVEL_GENFLUX: 2

   Minus-sign fixes in SALT2mu treatment of gamma. Two sign-flips 
   (mag shift and Tripp equation) cancelled for BBC5D, but not 
   for BBC7D.
   
   In sim, INPUTS.OPT_DEVEL_BBC7D=1 to use new SIM_GAMMADM code
   by default. Required for BBC7D, and works for BBC5D too.

         ***** USEFUL(v10_75) ***** 

         ***** MISCELLANEOUS(v10_75) ***** 

   snlc_sim.c[h] :
      + notation change: ZPTSIG -> ZPTERR
      + more developemnt of gen_fluxnois_xxx routines.
        REDCOR feature works, but needs more testing.
      + new sim-inoput key  OPT_DEVEL_GENFLUX
      + OPT_DEVEL_BBC7D=1 by default 

   snana_manual:
     + new sub section 4.11.2 Modeling Flux Correlations

   genmag_SALT2.c
     + fix memory leak.

   sntools_host.c
     + in GEN_SNHOST_DDLR, take wgt avg of a & b instead of using
       only the first Sersic term.
     + bug fix in malloc_HOSTLIB (uncovered by Rebekah)

   combine_fitres.c 
     + implement -mxrow option
     + add new -zcut option

   SALT2mu.c
     + fix minus sign convention for gammadm in two places:
       1) Trip equation in chi2 function, 2) and get_gammadm_host().
       

# ======================================================================= 
         v10_75b (=Jan 24 2020) 

         ***** IMPORTANT(v10_75b) ***** 
 
  simulation: release refactored code for flux-uncertainties.
     [can revert back  with "OPT_DEVEL_GENFLUX: 0" ]

         ***** USEFUL(v10_75b) ***** 

   SALT2mu: new nzbin_ccprior input

         ***** MISCELLANEOUS(v10_75b) ***** 

    snlc_sim.c
     + few refactor bug fixes, and add FIELD option for reduced flux-cov;
       see updated manual section 4.11.2.
     + for rest-frame models, include AVwarp and Kcor in data file
       (initial motiation: debug H-band problem with snoopy model)

   sntools.c:
     + in fluxcal_SNDATA, remove ZPERR addition to fluxerr;
       this was adding ZPERR to reported error even though
       SMEARFLAG_ZEROPT=1 should not. 

   snlc_fit.car
     + add AVwarp in INIT_TABLE_SNFITEP [kcor already there]

   sim_SNmix.pl
     + for GENOPT_GLOBAL, add backslash in front of () so that it
       works on command line.

   combine_fitres.c
     + MXSN->5M (was 2M), and abort if NEVT > MXSN.

   SALT2mu.c
     + new input nzbin_ccprior (was previously hard-coded at 4 bins)


# ======================================================================= 
         v10_75c (Feb 10 2020) 

         ***** IMPORTANT(v10_75c) ***** 

   + release refactored sntools_host.c for sim --> 
      allows multiple host matches.

   + new sim-input "PATH_USER_INPUT: <path>" to search both local
     dir and PATH_USER_INPUT for input files.

   + LOGMASS smearing in sim using LOGMASS_TRUE & LOGMASS_ERR,
     or using LOGMASS_TRUE and LOGMASS_OBS; see manual.

   + abort if Fitpatrick 99 color law used beyond 12,000 A.


         ***** USEFUL(v10_75c) ***** 

   + new &SNLCINP input CUTWIN_ZPERR (for snana.exe, snlc_fit, psnid);
      beware that it's NOT explicitly tested.

   + include MWEBV in TEXT tables. If you leave MWEBV in the APPEND
     argument, it will show up as MWEBV_2 in the text table.

         ***** MISCELLANEOUS(v10_75c) ***** 

    SALT2mu.c:
      + new option force_pIa=perfect -> pIa=1,0 for true SNIa,CC (sim only)
      + ignore gammaDM dimension if >5 bins to allow for a                 
         physically motivated distribution.
 
    sntools_output_hbook.c:
      + fix memcopy bug for VARLIST_FINAL.

    snana.car
      + fix evil string parse bug in PARSE_TERSE_VARLIST;
         remove check on 'ZP' to avoid conflict with 'ZPERR'.
      + in CRAZYERRCHECK, check for too-small errors along with too-large.
      + add &SNLCINP input CUTWIN_ZPERR 
      + new &SNLCINP option, FUDGE_MAG_ERROR = 'ALL 0.02'
      + write TEMPLATE info for make-SIMLIB option.
      + new &SNLCINP input CUTWIN_TREST_TRUEFLUX = -20, 70  
         to require valid true flux for fakes.
      + in SNRECON, apply PSF and ZPERR cuts on each epoch.
      + remove default BUG-KEEP flag for where to compute flux-error 
        fudges (snana.car). Now it's part of RESTORE_DES3YR. Benign.


    genmag_SALT2.c
      + in SALT2colorDisp, extrapolate if UV extrap is used.

    MWgaldust.c: 
      + For Fitzpatrick 1999 color law, abort if WAVE < 12000 A to
        avoid crazy extrapolation of Fitz99/Odon94 vs. wavelength.
        This ratio-vs-wave needs to be updated for NIR use.
        Problem uncovered by D.Jones while analyzing RAISIN data 
        with SNOOPY model. For NIR, use OPT_MWCOLORLAW = 94.

   sim:
    + new input HOSTLIB_SCALE_LOGMASS_ERR (default=1.0).
    + fixes to allow user input LOGMASS, but internally convert 
       to LOGMASS_TRUE
    + new utility abort_openTextFile() gives more info when
      input file cannot be opened.
    + allow sim-input INPUT_INCLUDE_FILE or INPUT_FILE_INCLUDE
    + add GENMODEL_EXTRAP_LATETIME to command-line override 
        (was mistakenly left out during plasticc devel)
    + new keys for FLUXERRMODEL_FILE, SCALE_FLUXERR_TRUE[DATA]
         (see manual)


# ======================================================================= 
         v10_75d (Feb 25 2020 ) 

         ***** IMPORTANT(v10_75d) ***** 

         ***** USEFUL(v10_75d) ***** 

   + SALT2mu (BBC) has new option to bias-correct mu instead of mB,x1,c.
   + new sim phase-smearing correlations; see GENMAG_SMEAR_ADDPHASECOR

         ***** MISCELLANEOUS(v10_75d) ***** 

    sntools*.c:
      + several compile fixes found by Cori compiler.

    snlc_sim.c
     + in gen_AV(), fix bug computing Gauss weight.
     + new sim input to include phase covariance in model
         GENMAG_SMEAR_ADDPHASECOR: 0.03 7.0  # magSmear, expTau(days)
     + update PHOTPROB map to include REDSHIFT and GALMAG.
     + initialize PHOTPROB to -9 (undefined) instead of 0
     + new sim input FUDGESCALE_NOISE_TEMPLATE
     + fix a few bugs related to using +HOSTNBR HOSTLIB.
         (and add +HOSTNBR sim job in snana tester)

    sntools_trigger.c
      + refactor detection to require PHOTPROB cut if CUTVAL
        is specified in SEARCHEFF_PIPELINE_FILE.

    sntools_genSmear.c, snlc_sim.c:
     + refactor correlated random Gaussians to use new utilities:
       init_Cholesky and GaussRanCorr()/

    snana.car
     + new &SNLCINP input:  MWEBV_FORCE = <val>
     + new &SNCLINP input:  FUDGE_FLUXERR_SCALE = 'g 1.02 r 1.03'
     + re-implement CUTWIN_PHOTPROB.
     + in MNFIT_STOREPAR, set NDOF_PRIOR=0 on each iteration,
       otherwise it keeps value from previous ITER (0 or 1).
       This bug affected data and sim the same way, so the fix
       slightly affects FITPROB shape, but is not expected to 
       impact data/sim agreement in FITPROB.
    
    snlc_fit.car:
     + OPT_COVAR_MWXT=1 -> full cov, =2 ->  diag only (for tests)

    SALT2mu.c
     + opt_biascor += 128 -> correct mu-sim_mu instead of mB,x1,c.
       Prelim tests show nuissance params (a,b,g) are within 0.1% 
       of default method of correcting mB,x1,c.

    psnid_tools.c[h]:
      + define INPUTS.OPT_DEBUG, and have it passed from psnid.car.
        Useful for debugging with
           psnid.exe <myInput> OPT_DEBUG <OPTVAL>


# ======================================================================= 
         v10_75e (Mar 04 2020) 

         ***** IMPORTANT(v10_75e) ***** 

   snlc_fit.car:
     For &FITINP inputs FUDGEALL_ITER1_MAXFRAC and DELCHI2_REJECT,
     fixed long-standing conflict bug where ITER1_MAXFRAC causes 
     DELCHI2_REJECT to have little or no impact. 
 
     Improve initial PKMJD-vs-CHI2 sweep in FITINI_ADJUST.

   snana.car : fix PSF cut bug introduced at v10_75c.

         ***** USEFUL(v10_75e) ***** 

         ***** MISCELLANEOUS(v10_75e) ***** 

   SALT2mu.c: bug fix for NSPLITRAN option; move chi2 cut after
              SPLITRAN summary.

   sntools_host.c[h], snlc_sim.c[h], sntools_fitsio.c :
     + overhaul simulation part that reads and processes
       HOSTNBR HOSTLIB; fix bugs and finish what was left undone.

   snlc_sim.c:
     + new sim-input HOSTLIB_MAXDDLR: 4.0 (see manual)
     + for SIMLIB model, automatically set zHOST_FILE and SPEC_FILE to NONE
     + add sim-input  RESTORE_DEDS3YR: 1  to restore DES3YR bugs in sim.

   snana.car:
     + plot 2nd host info if HOSTGAL_ANGSEP exists (data or sim)
     + modify LCUTEPOCH to replace obsolete IDTEL with IFILT,
       and reject if EPCUT_SNRMIN requires any SNR > 100.
     + wrap recent NDOF_PRIOR fix around RESTORE_DES3YR
     + fix awful bug from v10_75c ; CUTWIN_PSF was applied
       to PSF with wrong units.

   snlc_fit.car:
     + when DELCHI2_REJECT is set, apply test on DELCHI2 
       without extra FUDGEALL_ITER1_MAXFRAC so that the FUDGE 
       does not mess up the DELCHI2_REJECT feature.

     + in FITINI_ADJUST, tweak PKMJD sweep to 
         1) span -4 to +4 days, 2 day bins (was -2 to +2, 1 day bin)
         2) remove requirement that new CHI2 < 5*NEPOCH
       This change causes ~dozen snana-tester failures, but the
       changes are all in 4th or 5th significant digit, and thus OK.
       This update should make fits more robust against bad PEAKMDJINI
       estimates.


# ======================================================================= 
         v10_76 (Mar 7 2020) 

         ***** IMPORTANT(v10_76) ***** 

   SIMULATION: Default cosmology params updated from Planck 2018.

         ***** USEFUL(v10_76) ***** 

         ***** MISCELLANEOUS(v10_76) ***** 

   snlc_fit.car
     + new FITRES table variable NPTFIT_REJECT = number of obs
       withing Trest window that are rejected by DELCHI2_REJECT.
        
   sntools.h
     + define cosmology parameters with updated Planck 2018

   snlc_sim.c:
     + replace ancient cosmo params (OM,OL = 0.3,0.7) with
       Planck 2018 params ni sntools.h.

   snana.car:
     + update OMAT_DEFAULT and OLAM_DEFAULT to Planck 2018.
       These params are used only for initial amplitude estimate,  
       and in the approx DELMU Hubble residual that is not used
       anywhere in the analysis.


# ======================================================================= 
         v10_76b (March 14 2020) 

         ***** IMPORTANT(v10_76b) ***** 

    snlc_fit.exe bug fix for FUDGE_MAG_ERROR 

         ***** USEFUL(v10_76b) ***** 

         ***** MISCELLANEOUS(v10_76b) ***** 

   snana.car
    + this is a bit embarassing, but fixed awful bug related to 
      FUDGE_MAG_ERROR; was using FLUXCAL from previous epoch to
      compute FLUXERR_ADD = FUDGE_MAG_ERROR*FLUXCAL.
      Traced bug to refactor at  v10_58m (Feb 19, 2018). 
      Bug found by D.Jones when comparing split_and_fit vs. 
      snlc_fit.exe ; slight fitPar differences were found because 
      first epoch had different previous epoch based on different 
      previous event.

      RESTORE_DES3YR restores this bug. For DES3YR, this bug affects
      the following lowz fit-input:
      FUDGE_MAG_ERROR = 'u 0.01 v 0.01 w 0.01 x 0.01 y 0.01 z 0.01 A 0.01'

   nearnbr_apply.c: fix to handle zPHOT

   SALT2mu_fit.pl :
     + new option  "STRINGMATCH_IGNORE: IGNORE" to ignore string
       matches. Works only there is 1 and only 1 version per
       INPDIR. Aborts if multiple VERSIONs. 
       Still testing -> NOT yet working.
    
   snlc_sim.c
     + split gen_modelpar into REST and OBS frame ... prepare
       for REST frame to be called before get_HOSTLIB, and
       OBS frame to be called after get-HOSLTIB in case DLMU 
       is changed.
     + fix refactor bug applying FUDGESCALE_FLUXERR_FILTER and
       FUDGESCALE_FLUXERR2_FILTER
     + move rest-frame part of gen_modelPar to before GEN_SNHOST
       so that HOSTLIB-WGTMAP can depend on SN params.
       Beware: changes random sync.

  sntools_host.c:
     + begin refactor to allow x1 and c in WGTMAP using generated
       x1,c, and NOT requiring x1,c in HOSTLIB. 

  sim_SNmix.pl:
    + add NOPROMT arg to clopbber SIMLOGS even if there is no DONE
      stamp.


# ======================================================================= 
         v10_76c (Mar 28 2020) 

         ***** IMPORTANT(v10_76c) ***** 

   New Hostlib-wgtmap option to include SN params (e.g., x1, c)
   in WGTMAP that are not in the HOSTLIB. Minimal testing so far, 
   so users should run their own tests.

   wfit.c: new options -bao_sim and -cmb_sim to use sim cosmology
           for bao and cmb priors.

   sim: new EBV_HOST params (see manual Sec 9.1)

         ***** USEFUL(v10_76c) ***** 

         ***** MISCELLANEOUS(v10_76c) ***** 

   wfit.c:  
    + use cosmo params in sntools.h to sync with sim.
    + DJB add -bao_sim and -cmb_sim  flags.

   genmag_SEDtools.c[h]: 
     + check if RV changes for making grid of host MWXT.

   sntools.h: rename  _LCDM -> _DEFAULT for cosmo params.

   snana.car:
     + add SIM_RV to table output.

   new code files sntools_genExpHalfGauss.c[h]
   to implement generic expon+halfGauss profiles for AV
   or EBV_HOST.

   snlc_sim.c:
    + refactor gen_AV and include option to specify EBV_HOST
      profile, or AV profile. 
    + implement color or stretch dependent scale on scatter:
          GENMAG_SMEAR_SCALE(c): xxx,yyy,zzz
          GENMAG_SMEAR_SCALE(x1): xxx,yyy,zzz
    + refactor SALT2BETA_cPOLY to use _GENPOLY tools; untested -> BEWARE.

   SNANA_Codetests.py: bug fix for batch systems

   snana_manual.pdf:
     + in Sec 9, add new section about host-gal extinction
       and include both AV and EBV options.

   Makefile:
     + fix dependence on sntools_gridgen.c to hopefully avoid
       SNANA_Codetest problems when re-making snlc_sim.

   sim_SNmix,pl:
     + fix so that SIMGEN_INFILE_Ia need not be global if
       there is a SIMGEN_INFILE_Ia for each GENVERSION.

   genmag_SALT2.c[h]:
     + if ISMODEL_SALT3 then read SALT3.INFO instead of SALT2.INFO.

   snlc_fit.car
     + fix logic for SALT2zz so that zz=z if not photo-z fit.
       Fixes subtle interaction bug with FITRESTMAG option.
     + new &FITINP DLAMTOL_FITRESTMAG ; see manual.

   sntools_host.c:
     + in STORE_SNHOST_MISC(), fix init bug that came earlier from
       refactor to include c & x1.


# ======================================================================= 
         v10_76d (Apr 16 2020) 

         ***** IMPORTANT(v10_76d) ***** 

     + sim: refactored code (to allow EBV distrib) is now default code.

         ***** USEFUL(v10_76d) ***** 

     + $SNANA_DIR/util/get_vpec.py
     + $SNANA_DIR/util/translate_CSPDR3.py
     + kcor.exe can transform mag systems: e.g., VEGA->AB
     + snlc_fit: AV prior enabled for snoopy model.
     + SALT2mu output fitres file has warnings for biasCor loss > 2%

         ***** MISCELLANEOUS(v10_76d) ***** 

    SALT2mu.c:
      + MXFILE_[DATA,BIASCOR,CCPRIOR] -> 20 (was 10)
      + for alpha, beta, gamma, abort on inconsistent binning 
        in any IDSURVEY subset.
      + for +128 bit, sigint_biascor is computed with user-input
        alpha, beta (p1,p2) instead of SIM_ALPHA, SIM_BETA
      + if MINOS errors are zero, report parabolic error.
 
    sim_SNmix.pl
      + allow ENV reading INFILE under GENVERSION.
 
    snana.car:
      + call ENVreplace(TEXTFILE_PREFIX)
      + for SIMLIB_OUT option, extend SKY noise estimates into
        J,H,K bands using Table 3 from https://arxiv.org/pdf/0809.4988.pdf

    snlc_fit.car
      + apply AV prior for SNOOPY (same as for mkcs2k2)
      + fix INISTP_SHAPE logic for SNOOPY and MKCS2k2

    sntools_host.c
      + fix evil bug setting DEBUG_FLAG = 111 instead of testing
        DEBUG_FLAG==111. Messes up other DEBUG_FLAG settings.

    sntools_host.h
      + MXWGT_HOSTLIB -> 50,000 (was 5,000)

    snlc_sim.c
     + fix readme_doc_hostxt() to write AV or EBV info.
     + remove DEBUG_FLAG==42 wrapper for refactored code to allow EBV
       DEBUG_FLAG=41 uses legacy code.

    $SNANA_DIR/util/translate_CSPDR3.py -> new script.

    sntools_genSmear.c
      + pass version to init_genSmear_OIR(version)
        Argument of GENMAG_SMEAR_MODELNAME must be of the
        form$PATH/OIR.[suffix]
    
   kcor.h and snana.car:  MXKCOR -> 200 (was 100)

   kcor.c[h]
    + new feature to mix mag systems in the input, but transform
      them internally to common system. See new syntax
      "MAGSYSTEM: BD17->AB", and see kcor-input instructions
      at top of kcor.c.

   New utility to fetch peculiar velocities:
      $SNANA_DIR/util/get_vpec.py
   and assoicated map is
     $SNDATA_ROOT/models/VPEC/twomass++_velocity_LH11.npy


# ======================================================================= 
         v10_76e (May 10 2020) 

         ***** IMPORTANT(v10_76e) ***** 

         ***** USEFUL(v10_76e) ***** 
   
   New snana.exe option to translate sim spectra to MARZ format.
   See top of sntools_output_marz.c for details.

         ***** MISCELLANEOUS(v10_76e) ***** 

   NEW source code sntools_output_marz.c, using FITS format.
   Output file can be read by MARZ code to determine reshift
   from host spectrum.
   
   snlc_fit.car:
     + fix evil array bound bug for FITMODEL_NAME that
       includes full path. 

   snana.car
      + new &SNLCINP OVERRIDE_RESTLAM_BOUNDARY to manually
        adjust rest-frame boundaries for k-corrections.
      + allow NOBS=0 if &SNLCINP ABORT_ON_NOEPOCHS=F
      + new &SNLCINP input SIMLIB_OUT_TMINFIX
      + new &SNLCINP input SHIFT_SETPKMJD
      + new $SNLCINP MARZFILE_OUT
      + new option OPT_SETPKMJD=2048 -> PKMJDINI = SIM_PKMJDINI
      + compute new variable AREAFRAC_AVG and output to SNANA table.

   sim_SNmix:
      + abort if PATH_SNDATA_SIM does not exist. 
      + abort if NPER_SEASON string is null
      + abort if there are no SIMGEN_INFILE_[Ia,SNIa,NONIa] keys

   Makefile:
     + add LROOT logic for lCint so that it works for both
       root v5 and root v6.

   sntools_spectrograph.c:
     + fix getSNR_spectrograph to return SNR=0 if ZP is undefined.
     + fix format to write LAMMIN & LAMMAX; remove LAMCEN option because
       snana.exe read-back assumes LAMMIN & LAMMAX.

   SALT2mu.c:
    + begin refactor to allow input fitres files to have
      different columns. Still using legacy write where
      all files must have same columns.


# ======================================================================= 
         v10_77 (May 25 2020) 

         ***** IMPORTANT(v10_77) ***** 

   SALT2mu.exe, SALT2mu_fit.pl allow input FITRES files to have
     different columns; see manual Sec 10.1

         ***** USEFUL(v10_77) ***** 

   New utility sntable_cat.py (see manual Sec 10.1)

         ***** MISCELLANEOUS(v10_77) ***** 

   sntools_host.c
    + in get_Sersic_info(), allow Sersic weight truncation
      error at E-3 level; renormalize wgts.
    + fix refactor bug related to SN->GAL coord option (MSKOPT+=8)
      (see function SORT_SNHOST_byDDLR)

   snlc_sim.c
    + output REAMDE includes list of each map file with MAP: key
      so that they can be grepped.
    + fix minor spectrograph bug: ignore SPECTROGRAPH keys in 
      SIMLIB if spectrograph is not defined in kcor file.
    + fix a few harmless valgrind errors related to strongLens option.
    + add VPEC option in HOSTLIB; see manual sec 4.30.1

   sim_SNmix.pl:
    + write PATH_SNDATA_SIM in TOTAL_SUMMARY.LOG
    + fix false-ABORT bug if SIMGEN_INPUT_Ia is not global,
      but specified under GENVERSION key.

   split_and_fit.pl:
     + fix FITRES_COMBINE_FILE feature that was broken because
       execution code was accidentally removed in previous refactor.
     + fix bug causing FITRES files NOT to be gzipped, and was
       also causing VERSION_AFTERBURNER option to be skipped.

   snana.car, sntools_fitsio:
     + add REDSHIFT_QUALITYFLAG to data structure.
       This is a survey-dependent flag on spec-z (host or SN),
       and thus there is no standard set of flag definitions.
     + MXSPECTRUM     = 5     -> 20
     + MXLAM_SPECTRUM = 2000  -> 20000
     + MXTABLE1D_AVWARP -> 1.5 million for D.J (was 1 million)

   SALT2mu.c
     + new option CUTWIN(BIASCORONLY) to cut only on biasCor.
     + new option fieldlist=<list> ; see instructions at top of code file.

   sntools_fitsio.c
     + fix bug writing SIM_STRONGLENS_XXX params 

   kcor.c: 
     + new spectrograph table inputs to catch crazy SNR values,
          SNR_POISSON_RATIO_ABORT_vsMAGREF
          SNR_POISSON_RATIO_ABORT_vsTEXPOSE
       (see manual updates)
     + fix bug related to duplicate filters with lamshift.

   sntools_spectrograph.c:
     in getSNR function, if variance < 0, return SNR=0 so that
     sim simply ignores this wave bin. Can happen for very
     faint mags when SNR ~ 1 and SQSIGSKY solution is not well
     defined.


# ======================================================================= 
         v10_77b (June 5 2020) 

         ***** IMPORTANT(v10_77b) ***** 
    
         ***** USEFUL(v10_77b) ***** 

    SIMLIB_OUT option (snana.exe) adds TAKE_SPECTRUM keys in SIMLIB header
    if spectra are in the data file.

    Simulating spectra has new option to extrap TEXPOSE beyond defined range.

    New sim option to read SIMLIB exactly once.

         ***** MISCELLANEOUS(v10_77b) ***** 

    snlc_sim.c[h]: 
      + new SPECTROGRAPH_MSKOPT += 64 -> extrapolate TEXPOSE beyond 
        range defined in spectrograph table. See updated manual 
        section 4.25.3 SPECTROGRAPH Options
      + remove OPT_DEVEL_BBC7D flag
      + fux bug overriding RV from HOSTLIB
      + new input option, USE_SIMLIB_SPECTRA: 1 (see manual)
      + abort if USE_SIMLIB_XXX flags result in all LIBIDs rejected
         by GENRANGE_XXX windows. Avoids infinite loop/hang.
      + SIMLIB_MSKOPT += 4 -> stop after reading SIMLIB one time.
      + to address ringing in simulated spectra, refactor randoms to 
        allow two independent streams, where the 2nd stream is used 
        for spectrograph noise. For now, default NSTREAM_RAN=1,
        but can study impact of two streams with
          snlc_sim.exe <inFile> NSTREAM_RAN 2 
        Next SNANA version will likely have NSTREAM_RAN=2 by default,
        where stream 0 stays synced to lists, while stream 1 is not.

    SALT2mu_fit.pl
     + fix obscure ABORT  message when datfile= key is missing
        for NSPLITRAN option.
     + on abort, write FAIL to DONE file 

    SALT2mu.c
      + for ALL surveys lumped together (no 64 bit), fix bug where
        IDSAMPLE was not set and was thus -9; set all IDSAMPLE=0

    snana.car:
      + for SIMLIB_OUT option, include TAKE_SPECTRUM keys in
        SIMLIB header if spectra exist in data files.
      + fix some SPECPLOT bugs.
      + fix SPECPAK compatibility issue with using both MARZ & TEXT tables.

    sntools_output.c:
       + include sndata.h and remove some redundant #define statements
         from sntools_output.h .

    sntools.h:
      MXWORDFILE_PARSE_WORDS -> 1 million (was 500k) to handle data
      files with lots of spectra.

    sntools_spectrograph.h:
        MXLAMSMEAR_SPECTROGRAPH -> 40 (was 20) for small DIEMOS bins


# ======================================================================= 
         v10_77c (June 5 2020) 

         ***** IMPORTANT(v10_77c) ***** 

    In sim, NSTREAM_RAN = 2 (was 1) so that spectrograph noise 
    burns independent set of randoms.  Random sync changed here.

         ***** USEFUL(v10_77c) ***** 

         ***** MISCELLANEOUS(v10_77c) ***** 


# ======================================================================= 
         v10_77d (Jun 9 2020) 

         ***** IMPORTANT(v10_77d) ***** 

    snana.car: Fix awful bug in converting zCMB -> zHELIO;
      OPT flag was set with wrong sign, so it was converting
      zHELIO -> zCMB. This ONLY affects data files that have
      zCMB but not zHELIO. No impact if both REDSHIFT_HELIO
      and REDSHIFT_CMB are included in data files.
      A few affected data versions are 
          LOWZ_JRK07, SNLS_Ast06, CSPDR2
      JLA data files have both HELIO and CMB redshift, and
      were thus not affected by this bug.
      Not clear when this bug was introduced.

    sntools.h: update CMB_apex parameters using Planck 2018.

         ***** USEFUL(v10_77d) ***** 

    snana.car
      If both REDSHIFT_HELIO and REDSHIFT_CMB are read from data files,
      crosscheck zHELIO with internal calculation; abort if 
      |dz/z| > zTOL_HELIO2CMB (new &SNLCINP input).
      Goal is to catch use of approximate/additive formula.
      See manual section 12.2.5 Crosscheck zHEL -> zCMB

         ***** MISCELLANEOUS(v10_77d) ***** 

    snana.car
      + for writing TAKE_SPECTRUM keys to SIMLIB, exlcude wave bins
         where FLUXERR/FLUXERR_MEDIAN > 50
     
    combine_fitres.c
      + fix variable name match to be case insensitive.

    sntools.c
     + for FmaxClump method of initial PKMJD, sort MJD_LIST in case
       data files are not MJD-sorted. Also check that snlc_fit works
       on un-sorted data. Fix based on LSST-DC2 data files.

    SALT2mu.c
      + add abort traps for crazy IDSURVEY.


# ======================================================================= 
         v10_77e (Jun 19 2020) 

         ***** IMPORTANT(v10_77e) ***** 

   sim-input includes GENPDF_FILE with maps to describe populations
   of color, stretch, AV, RV. See manaul Sec 
   Works only in conjuction with sim-input "OPT_DEVEL_GENPDF: 1"
   Next version will remove the OPT_DEVEL_GENPDF requirement.

   Sims using asymGauss: no more using defaults, mainly for RV.

         ***** USEFUL(v10_77e) ***** 

         ***** MISCELLANEOUS(v10_77e) ***** 

   snana.car
     + do NOT apply zTOL check if SNLC_HELIO < 0.003 ... temp hack
       to protect redshift truncation in DES DIFFIMG.

   *.c: 
     + fix compile with Wall warnings.

   SALT2mu.c
     + allow iflag_duplicate=0 (ignore) to operate on sims.
     + for NSPLITRAN, include w(wfit) in summary.
     + supress abort with surveygroup_biascor_abortflag=0

   sntools_genPDF.c[h]
     + new functions to read and implement multi-D maps of PDF
       for color, stretch, RV, AV.

   snlc_sim.c
     + integrate init_genPDF & exec_genPDF
     + remove OPT_DEVEL_GENFLUX and associated code.
 
   sntools_host.c
     + for WGTMAP using SN properties, abort if SN val is outside wgtmap range.

   remove skewnormal.c and all obsolete/unused skewnormal code.

   sntools_genGauss_asym.c:
     require genGauss->USE = true to pick random from asym Gauss.

   snlc_fit.car
     + fix subtle bug setting ERRMAX_BAD for zPHOT when using
       spec-z as a prior. Fixes zPHOTERR spike at 0.05.


# ======================================================================= 
         v10_77f (Jun 30 2020) 

         ***** IMPORTANT(v10_77f) ***** 

   SALT2mu: remove redshift error from muerrz calc (use only vpec).

         ***** USEFUL(v10_77f) ***** 

         ***** MISCELLANEOUS(v10_77f) ***** 
 
    snana.car
      + abort if SIMVAR_CUTWIN_STRING variable not found.

    SALT2mu_fit.pl & SALT2mu.c:
     + refactor/update so that NSPLITRAN output goes to
       separate subdirs names 0001, 0002, etc ... 
       This change allows Pippin to run CosmoMC in each subDir.
       Interactive NSPLITRAN probably won't work,
       so must use SALT2mu_fit.pl to launch NSPLITRAN.
     + fix mu_true for opt_biascor += 128 (biasCor with MU)
       to use measured redshift instead of true redshift.
     + remove redshift error from muerrz calc (use only vpec);
        restore_sigz=1 restores original calc.
        Explanation in DES docDB note 15287.


# ======================================================================= 
         v10_77g (Jul 9 2020) 

         ***** IMPORTANT(v10_77g) ***** 

   snlc_sim: refactored code (for GENPDF options) now default.

         ***** USEFUL(v10_77g) ***** 

    Can use SALT2mu as a SUBPROCESS run by python population fit code; 
    see below.

         ***** MISCELLANEOUS(v10_77g) ***** 

   SALT2mu.c
     + abort if any IDSAMPLE has zero biasCor events passing cuts.

     + add SIM_MUz array, and opt_biascor=2 is now same as 130
       because z-only biasCor had always corrected vs. MU.

     + for opt_biascor += 2(1D) or 128(muCor), biasCor true MU
       is now computed with zHD instead of true z. For 1D biasCor,
       here is example improvement using DES sims and host-galaxy
       photo-z:
            mu_true      m0-M0avg chi2/dof
          SIM_MU(ztrue)   86.4 / 9      # old using SIM_MU(ztrue)
          SIM_MU(zHD)     16.1 / 9      # new using SIM_MU(zHD)

     + SUBPROCESS features ready to use. Get help with
          SALT2mu.exe SUBPROCESS_HELP

   snlc_sim.c
     + add GENPDF_FLAT input; see manual.
     + OPT_DEVEL_GENPDF=1 by default so that refactored code
       is now default -> many SNANA_tester jobs fail (as expected)
       because random sync has changed.

   kcor.c
     + write input file name and FILTER PATH names to output FITS header;
       can be used later to chase down DOCANA notes.

   sntools_spectrograph.c
     + add protection against numerical roundoff when F <<< SQSIGMA
       (limit of noise-dominated spectra). When running kcor.exe,
       grep HACK <stdout> to see modified SNR.
  

# ======================================================================= 
         v10_77h (Jul 20 2020) 

         ***** IMPORTANT(v10_77h) ***** 

   Fix really stupid logic bug that had slowed fits by almost
   factor of 10 ( but didn't affect results)

         ***** USEFUL(v10_77h) ***** 

   new utility to dump every allowed key (see manual):
      snlc_sim.exe KEY_DUMP
      SALT2mu.exe  KEY_DUMP

         ***** MISCELLANEOUS(v10_77h) ***** 

    sntools_genPDF.h: 
      + MXROW_GENPDF -> 15000 (was 5000)
  
    sntools.c[h]
      + new write_epoch_list_xxx functions
    snana.car
      + new &SNLCINP input OUT_EPOCH_IGNORE_FILE to write
        list of rejected epochs ... can be read by external
        classifiers. Using write_epoch_list_xxx functions.
      + for loading tables with variables vs. filter,
        reduce MXFILT to 15 (was 30) ... mainly for low-z.

    sntools_output.c
      + fix declaration bug for when CERN_DIR is not defined.
        Not sure how SNANA compiled at NERSC without CERN_DIR ?

    sntools_trigger.c
      + in zHOST effic file, add new optional key "PEAKMJD: t0 t1"
        before each map; allows season-dependent maps. See manual.

    sntools.c: 
      + in read_VARNAMES_KEYS, avoid exceeding bound with lots
        of duplicates; store only unique varnames.

    genmag_SEDtools.c
      + back at v10_76c, had introduced dumb logic bug that forced
        re-evaluating entire extinction table for every fit-iteration.
        Fixed, and now fits are almost x10 faster compared to bug.
        This bug had no impact on results; only affected speed.
 
    sntools_host.c[h]
      + automatically store WGTMAP variables in data files.

    sim_SNmix.pl
      + fix to work if user name has less than 4 characters.

    snlc_sim, SALT2mu, sntools
     + update key-matching utility to allow multiple keys in same
        input file (e.g., NON1A), and to allow a dump of all keys
        with "snlc_sim.exe KEY_DUMP". Use grep to select things,
        e.g.,  snlc_sim.exe KEY_DUMP | grep VPEC

     + use keyMatch for command-line override and allow keys
        to include or exlcude colon. Will need the colon option
        later after submit-scripts are re-written. Either of the
        following command-line args are now allowed:
            snlc_sim.exe GENMAG_SMEAR 0.1
            snlc_sim.exe GENMAG_SMEAR: 0.1

     - First attempt to compile sim & BYOSED with python, but running 
       snlc_sim.exe gives
          At line 774 of file rdkcor_fits_head.f
          Internal Error: get_unit(): Bad internal unit KIND
       Tried compiling and running on des81, which has much newer
       gfortran, and get the same error. 


# ======================================================================= 
         v10_77i (July 26 2020) 

         ***** IMPORTANT(v10_77i) ***** 

    new ERRMAP checks/ABORT in genmag_SALT2.c

         ***** USEFUL(v10_77i) ***** 

         ***** MISCELLANEOUS(v10_77i) ***** 

   snlc_sim.c
    + begin long overdue refactor of reading sim-inputs
      (for compatibility with submit-scripts re-write)
       * allow optional colon on command-line to match file-input keys
       * use same read-function (parse_input_key_driver) for both 
          file and command-line arg
       * refactor is NOT yet default, but is invoked by 
           "OPT_DEVEL_READ_INPUT 1"
     + remove obsolete GENPAR_SELECT_FILE input (wasn't implemented)
     + remove obsolute function read_SALT2mu_AlphaBeta and remove
       obsolete sim-input SALT2mu_FILE
     + remove obsolete INPUTS.GENRANGE_TYPE and GENRANGE_CID
     + remove obsolete GENKCOR_STRETCH key
     + fix so that get_random_genPDF is NOT called for LCLIB
     + for invalid SIMGEN_DUMP variable, fix abort sequence
       to be compatible with other aborts.

       around 9:30pm on July 23, lost snlc_sim.c on FNAL cluster
       when des41 hung up. Last GitHub update was 5hr earlier.
       Lost some unreleased refactor deubugging for sim-inputs,
       but didn't lose any requested updates. Submitted FNAL help
       ticket requesting restoration of most recent sim file.
       July 24 2020: heard nothing from Fermilab service, 
       so I re-debugged.

    snana.car
     + &SNLCINP input HEADER_OVERRIDE_FILE can now be a comma-sep
       list to allow multiple table files.
     + in CHECK_EPOCH_IGNORE(), skip ZP and PSF cuts if RESTORE_DES3YR=T.
     + fix array bound bug in get_PARSE_WORDS_fortran
     + protect reading spectra when some events zero spectra
     + begin refactor to read command-line args with equal signs;
       e.g., CUTWIN_SNRMAX=5,99. Refactor NOT yet default.

    SALT2mu.c
      + add logic to skip reading YAML keys 
         (YAML will be for submit script)
      + SUBPROCESS bug fix

    genmag_SALT2.c[h]
      + to help catch pathologicaly re-training, add abort checks on 
        bad error map values: nan or crazy values.  Mainly to help
        SALT3 development.


# ======================================================================= 
         v10_78 (Sep 01 2020) 

         ***** IMPORTANT(v10_78) ***** 

   + Release submit_batch_jobs.py[sh] ... for testing

   + enable refactored command line input for sim and fit ;
     allows command line input to look like input file.
     e.g., snlc_sim.exe <inputFile> NGENTOT_LC: 400
           snlc_fit.exe >inputFile> CUTWIN_SNRMAX=6,999
     Beware of sudden bugs.

  + Fix bug using GRIDONLY feature with SIMSED models (Found by M.Vincenzi).
    Bug introduced Jun 19 2020 in v10_77e; related to code requiring an
    explicit USE flag to select from AsymGaus.

         ***** USEFUL(v10_78) ***** 

         ***** MISCELLANEOUS(v10_78) ***** 

    SALT2mu.c
     + write CPU time in output fitres file
     + new input minos=0 for much faster MIGRAD; default is minos=1
     + new input write_yaml=1 for batch-sumbit script

   SALT2mu_fit.c
     + check for INCLUDE file in GENOPT_GLOBAL'

   snlc_sim.c
     + for INIT_ONLY=1, write NGENTOT_RATECALC key for easier parsing
       but submit-batch script. Also, allow missing GENVERSION arg
       since there is no output.
     + fix bug aborting on mixing TAKE_SPECTRUM keys
     + add new input "WRFLAG_YAML_FILE 1"  so that batch-submit scruot  
       can request YAML output with summary stats needed for MERGE proc.
       This avoids fragile parsing of stdout.
     + bug fix for GRIDONLY feature using SIMSED model.
     + new sim-input REQUIRE_DOCANA. Now it is 0, but later will be 1.

   snana.car
     + when passing JOBSPLIT (from batch-submit script), automatically
       create [VERSION].YAML file with stats ... avoids having to 
       parse huge log files.
     + fix CHECK_LINE_ARGS to use current MADABORT error handler.
     + add input REQUIRE_DOCANA (default = 0 -> false), and implement
       for SNCID_IGNORE_FILE, HEADER_OVERRIDE_FILE, data version README
     + new util ISTAT_FILE_DOCANA to track DOCUMENTATION and DOCUMENTATION_END
       keys; needed to parse particular input files (e.g., SNCID_IGNORE_LIST)
       where reading DOCANA keys would corrupt the parsing.

   sntools.c
     + If new sim-input REQUIRE_DOCANA=1, pass flag to snana_openText 
       to call check_openFile_docana.
     + new utility funcs check_file_docana() and check_openFile_docana().

   sntools_trigger.c
     + implement REQUIRE_DOCANA (if option is set)

   sntools.h
     + optional ONE_RANDOM_STREAM pre-proc flag; see manual.
     + MXCHARWORD_PARSE_WORDS -> 300 (was 60) to handle long file names
         (fixes segFault found by R.Chen using HEADER_OVERRIDE feature)

   snlc_fit.car
     + fix CUTFLAG_SNANA for FITRES table. No impact on fits, 
       but fix avoids confusion.

   sntable_dump.pl[c]
     + add NEVT option to print number of events in table.
       Needed in refactored submit scripts to verify table merge.

   sntools.pm:
     loadArray_fromFile aborts on 'CONFIG:' key with message to 
     use submit_batch_jobs.sh. Protects legacy batch scripts
     sim_SNmix.pl, split_and_fit.pl, SALT2mu_fit.pl.


# ======================================================================= 
         v10_78b (Sep 9, 2020) 

         ***** IMPORTANT(v10_78b) ***** 

   Tried v9.2 gcc on Midway, and got lots of compile warnings:
      "Fix Warning: Fortran 2018 deleted feature: 
       Shared DO termination label 630 at (1)"
   Fixed these warnings in old fortran codes pulled from CERNLIB;
   UTILEX in snana.car, and minuit.F. Using gcc 9.2.0, SNANA now 
   compiles without warnings.

         ***** USEFUL(v10_78b) ***** 

   SALT2mu.c: 
     new "nthread=<n>" argument splits chi2 calc using pthread_create.
     Default nthread=1 does not use pthread. Beware to allocate 
     tasks_per_node for batch jobs. Also beware of re-factored chi2
     function (fcn).

         ***** MISCELLANEOUS(v10_78b) ***** 

   snlc_sim:
     + Implement DOCANA check for SIMLIB and HOSTLIB

   submit_batch :
     + working but not yet integrated into Pippin.


# ======================================================================= 
         v10_78c (Sep 17 2020) 

         ***** IMPORTANT(v10_78c) ***** 

         ***** USEFUL(v10_78c) ***** 

   genmag_BYOSED.c[h] renamed -> genmag_PySEDMODEL.cp[h]
     (and add gensed_SNEMO.py)

         ***** MISCELLANEOUS(v10_78c) ***** 

   snana.car
     + remove MADABORT_LEGACY, SNLCINP_OVERRIDE_LEGACY
     + remove CUTBIT_USRCUTS
     + refactor LCUTEPOCH to accep EPOCH index
     + new &SNLCINP  CUTWIN_SNR_NODETECT
     + for text format, allow REDSHIFT_CMB or REDSHIFT_FINAL
         (FITS format still has REDSHIFT_HELIO and REDSHIFT_FINAL)
     + new OPT_SETPKMJD option (+32) to use Fmax-clump method with
         wgt=log10(SNR) instead of wgt=1  (see manual)

   snlc_sim.c
     + remove OPT_DEVEL_GENPDF[READ_INPUT]  
     + remove legacy input-reading functions 

   genmag_BYOSED.c[h] renamed -> genmag_PySEDMODEL.cp[h]
     + generalize to allow genmag_BYOSED.py and genmag_SNEMO.py
     + declare and parse new model SNEMO (but no SNEMO functions yet)
     + checked that PySEDMODEL params propagate to data files and 
       output tables.

   combine_fitres.c
     + new input -nullval_float <val> to override default -888

   wfit.c
    + read fitres file with openTextFile util to allow gzip input,
      and to trap error on non-existing file.

   Rename SNANA_CodeTests.py -> SNANA_code_tests.py
     (to prepare for SNANA_submit_tests.py)


# ======================================================================= 
         v10_78d (Sep 29 2020) 

         ***** IMPORTANT(v10_78d) ***** 

    SALT2mu: require central biasCor cell (containing data point)
             to have valid biasCor stats and be used for interpolation.

         ***** USEFUL(v10_78d) ***** 

         ***** MISCELLANEOUS(v10_78d) ***** 

    genmag_SALT2.c:
      + move SALT2colorlaw0 and SALT2colorlaw1 functions out of
        sntools, and into genmag_SALT2.c
      + fix reading SALT2.INFO file so that NPAR for CL poly is
        respected; previously 9 params were read regardless of
        NPAR_POLY param. This fix is for SALT3 and doesn't 
        affect the already-existing SALT2 models.

    snlc_sim.c
      + fix bug parsing DNDZ ZPOLY
      + new input RANSYSTPAR_RANSEED_GEN
      + check if KCOR_FILE exists in PATH_USER_INPUT 
          (see new find_pathfile function in sntools)

    SNANA_submit_tests.py :
      + new script to test submit_batch_jobs; 
          see $SNANA_TESTS/inputs_submit_batch

    Makefile: 
     + cc -> gcc (recommended by Midway admin for higher gcc versions)
     + for gcc v10 and higher, tack on FORTRAN_FLAGS to allow arg-mismatch.
        (preparation for moving to gcc 10.1.0 on midway)

    snana.car
      + few benign updates to reduce warnings from gcc v10.
         e.g., passing array instead of scalar to few functions.

    SALT2mu.c :
      + add new key  cid_reject_file, analogous to cid_select_file
      + both of the above can be FITRES format or un-keyed list format.
      + fix option for  simfile_ccprior=same [-> same as simfile_biascor]
      + require center cell to have enough stats to be used in biasCor.
        From SNANA_code_test, CCPRIOR sample looses few percent, and DATA 
        loses < 1%. Here are old-vs-new comparisons:
       TASK094_SALT2mu_DES_BBC5D_noCC    :  mis-match (REF != TEST)
           ==> REF:  fit-Beta = 3.0157e+00 +/- 1.5007e-01
           ==> TEST: fit-Beta = 3.0149e+00 +/- 1.5171e-01
       TASK096_SALT2mu_DES3YR_BBC5D   :  mis-match (REF != TEST)
          ==> REF:  fit-Gamma = 3.3660e-02 +/- 1.8623e-02
          ==> TEST: fit-Gamma = 3.4020e-02 +/- 1.8714e-02
       TASK097_SALT2mu_DESNN_BBC5D       :  mis-match (REF != TEST)
          ==> REF:  fit-Beta = 3.0760e+00 +/- 5.3857e-02
          ==> TEST: fit-Beta = 3.0831e+00 +/- 5.5887e-02
       TASK098_SALT2mu_DESNN_BBC5D+OPT128   :  mis-match (REF != TEST)
          ==> REF:  fit-Beta = 3.1028e+00 +/- 2.2045e-02
          ==> TEST: fit-Beta = 3.1046e+00 +/- 2.2501e-02
       TASK099_SALT2mu_DESNN_H11BBC5D   :  mis-match (REF != TEST)
          ==> REF:  fit-Beta = 3.0895e+00 +/- 8.2675e-02
          ==> TEST: fit-Beta = 3.0822e+00 +/- 8.4002e-02
        

# ======================================================================= 
         v10_78e (Oct 16 2020) 

         ***** IMPORTANT(v10_78e) ***** 

   Fix bug in placement of init_RANSYSTPAR; now it is before init_RateModel
   instead of after. Previously, random cosmology variations were used to
   generate SN mags, but NOT used in rate models.

   sim cosmology functions moved to sntools_cosmology.c[h] and refactored
   to prepare struct HzFUN_INFO. Next SNANA version will use this typedef
   in all cosmology function so that it can use either wCDM model (default), 
   or use arbitrary model read from 2-column text file. 

         ***** USEFUL(v10_78e) ***** 

  SALT2mu allows comma-sep list for cid_reject_file and cid_select_file

  Several space-separated polynominal inputs can now be input as either
  space-sep or comma-sep; latter allows arbitrary poly-order.

         ***** MISCELLANEOUS(v10_78e) ***** 

   snlc_sim.c
     + In parse_input_HOSTLIB, replace a few sscanf with
        nread = sscanf and abort if nread != 1. Apply to keys
        with mutliple arguments in case user makes mistake.
     + write SURVEY and IDSURVEY to YAML file.
     + new input MUSHIFT (distance offset)
     + use new read_genpoly() util to refactor reading polynomial 
       coefficients as either comma-sep (new default) or
       space-sep (legacy). The following sim-inputs are now 
       comma-sep, but allow legacy space-sep input (see manual):
         HOSTLIB_DZTOL:    <arg>
         ZVARIATION_POLY:  <arg>
         DNDZ_ZPOLY_REWGT: <arg>
         DNDZ: ZPOLY       <arg>
         DNDB: BPOLY       <arg>  # revice LCLIB
         DNDB: COSBPOLY    <arg>

   genmag_LCLIB.c
     + check for LCLIB file in PATH_USER_INPUT instead of obsolete ENV.
       
   sntools.c
     + new utility read_genpoly(...) to read comma-sep poly with arbitrary
       order, or to read legacy space-sep poly coeffs with fixed order. 

   sntools_output.c
     + restore ABORT option in optMask.

   ../util:  rm backup_INTERNAL.pl backup_SNDATA_ROOT.pl

   snana.car
     + fix bug implementing SNCID_IGNORE_FILE (see function LCIDSELECT)
     + for HEADER_OVERRIDE_FILE, abort if NFILE > MXFILE_ABORT
       Also, pass abort flag to AUTOSTORE_INIT so that it aborts if
       no variables are matched.
     + new &SNLCINP input OPT_YAML to force output YAML file when
        it's not a batch job

   submit_batch:
     + write SURVEY and IDSURVEY to MERGE.LOG for sim, and to
       YAML file for snana.exe.

   SALT2mu.c:
     + allow comma-sep list for cid_reject_file and cid_select_file
     + start using parse_commaSepList utility

   sntools_trigger.c :
     + fix error message when interpolation fails for zHOST map

   sntools.c[h]:
      move cosmology functions to sntools_cosmology.c[h]


# ======================================================================= 
         v10_79 (Oct 23 2020) 

         ***** IMPORTANT(v10_79) ***** 

         ***** USEFUL(v10_79) ***** 

   + sim-input cosmology allows wa_LAMBDA, or map file with H(z).
   + analysis command-line args: max string length -> 600 (was 200)
      (e.g., useful for comma-sep list of HEADER_OVERRIDE_FILES)
   + sync SALT3 error treatment with new training code


         ***** MISCELLANEOUS(v10_79) ***** 

   sntools_cosmology.c[h]: 
     + refactor to use HzINFO_INFO typedef.

   sntools.c
     + skip/ignore DOCUMENTATION keys in rd2column(...)

   sntools_output.c
     + EXEC_AUTOSTORE_READ no longer aborts on missing var;
        instead it returns *ISTAT = -2

   genmag_SALT2.c
     + refactor SALT2magerr to treat SALT3 vartot as flux,
       but SALT2 vartot as relative flux. 

   snlc_sim.c
     + check NONE argument for HOSTLIB_FILE 
     + fix confusing error message for multiple DNDZ args
     + refactor to pass HzINFO to cosmology functions.
     + new arg wa_LAMBDA (see manual)

   snana.car, submit_prog_fit.py:
     + allow user mistake setting PRIVATE_DATA_PATH = '$SNDATA_ROOT/lcmerge'
       (but still aborts if PRIVATE_DATA_PATH='$SNDATA_ROOT/SIM')
     + bug fix in TABLE_STRING_TERMINATION
     + DLMAG8_REF uses dlmag_fortC  in sntools_cosmology.c
         (fortran DLZ8 function now obsolete)

   SALT2mu.c:
     + clarify error message for undefined pIa (store_input_varnames)

   snlc_fit.car, snana.car, psnid.car, kcordump.cra
     + refactor reading command-line overrides with MATCH_NMLKEY.
     + define MXCHAR_ARG=600 as max string length for any one
       command line arg (previous string-length limit was 200)
     + remove global array LINE_ARGS(100)*200

  psnid*
    + refactor to use new cosmology functions

  NOTE: SNANA_codetest results in 10 very small differences 
         because the old DLMAG function had c=3E5, while the
         new function has exact value. This slightly affects
         initial fit-par estaimates, particularly for photo-z fits.


# ======================================================================= 
         v11_01 (Oct 26 2020) 

         ***** IMPORTANT(v11_01) ***** 

   DISABLED perl batch scripts :
       sim_SNmix.pl / split_and_fit.pl / SALT2mu_fit.pl

   SALT2mu automatically aborts on vpec sign error.
     (preparing to fix vpec sign convention)

         ***** USEFUL(v11_01) ***** 

   For SIMSED model with XYZ_INDEX column, can select subset of indices.

         ***** MISCELLANEOUS(v11_01) ***** 

   sntools_fitsio.c[h]:
     + read back SNANA_VERSION in fits header, and convert to float.
     
   snana.car:
      + read SNANA_VERSION_FLOAT 
          (might need later to switch VPEC sign convention)
      + MXFILE_LIST -> 10 (was 4) for number of HEADER_OVERRIDE files.

   sntools_genPDF.c[h]:
     + improve random selection efficiency by ignoring ranges
       where PROB=0. End of sim job writes N_ITER[MEAN,MAX] summary.

   snlc_sim.c[h]
    + new SIMSED_GRIDONLY option to select list of indices; See manual.

   SALT2mu: new inputs zmax_vpec_check=xxx to check vpec sign.
 
   sim_SNmix.pl, split_and_fit.pl, SALT2mu_fit.pl
     + write message to use submit_batch_jobs.sh, then abort.
     - When these obsolete batch-scripts are removed, should also remove
         - wait_for_files.pl
         - NEARNBR_pipeline.pl
         - split_version.pl

   Removed the following obsolete scripts:
      - get_fitresValue.pl ; use newer get_fitres_values.py
      - convertsnana2salt2.pl (convert SNANA format to snpca format)
      - convertcsv2snana.pl  ; use new convertcsv2snana.py
      - sednon1a_prep.pl
      - HOSTLIB_randomizer.pl 
      
   Scripts that should be re-written in python (future SNANA versions):
     - convertcsv2snana.pl   -> convert_text_format.py (csv <-> SNANA)
     - ypatchy.pl            -> ypatchy.py
     - startSNANAversion.pl  -> startSNANAversion.py


# ======================================================================= 
         v11_01b (Nov 2 2020) 

         ***** IMPORTANT(v11_01b) ***** 

         ***** USEFUL(v11_01b) ***** 

         ***** MISCELLANEOUS(v11_01b) ***** 

   SALT2mu.c
     + "CUTWIN varname_pIa xx yy" will substitute with arg of varname_pIa.
       Enables easy command-line override of which varname_pIa to use.

   submit_train_SALT2.py:  new method for submit_batch.
   

# ======================================================================= 
         v11_02 (Nov 3 2020) 

         ***** IMPORTANT(v11_02) ***** 

   + change VPEC sign convention codes, and in public data versions.

         ***** USEFUL(v11_02) ***** 

         ***** MISCELLANEOUS(v11_02) ***** 

    + snana.car:   RESTORE_WRONG_VPEC = .FALSE.
    + snlc_sim.c:  INPUTS.RESTORE_WRONG_VPEC = false ;
    + get_vpec.py: change sign of returned vpec 


# ======================================================================= 
         v11_02b (Nov 22 2020) 

         ***** IMPORTANT(v11_02b) ***** 

   SALT2mu.c: new vpec-flip test to catch vpec sign error

         ***** USEFUL(v11_02b) ***** 

   SALT2mu.c: new input datafile_override for vpec,vpecerr,logmass,...
   snlc_sim.c: add a few more RANSYSTPAR_XXX keys
   submit_batch : works with snpca training and TRAINOPT for calib shifts.

         ***** MISCELLANEOUS(v11_02b) ***** 

  backup_SNDATA_ROOT.py
    + add SURVEY.DEF to subdir list for tar file.
      Previous SNDATA_ROOT backups on Zenodo won't work without SURVEY.DEF

  sntools_genSmear.c:
    + fix to work with salt2 or salt3 files.

  sntools_host.c
     + in GEN_SNHOST_DDLR(), protect numerical round-off causing
       cosTH = 1 + tiny, resulting in abort.
 
  snlc_sim.c
    + refactor RANSYSTPAR_SIGSHIFT_[ZP,LAMFILT] to allow groups of bands.
    + new RANSYSTPAR_SIGSHIFT_REDSHIFT
    + new RANSYSTPAR_GENMODEL_WILDCARD
    + fix bug to NOT read TAKE_SPECTRUM keys from simlib if 
       USE_SIMLIB_SPECTRA=0

  genmag_SALT2.c
    + read optional MAGSHIFT & WAVESHIFT keys from SALT2.INFO file and
      implement calibration shifts from training.

  sntools.c[h]
    + new utility glob_file_list to return list of files from wildcard.

  doc/snana_manual.tex[pdf]
    + add section about submit_batch_jobs.sh, and remove obsolete
      sections for sim_SNmix and split_and_fit.

  SALT2mu.c
    + new input ndump_nobiascor
    + add MUERR_VPEC to output ; MUERR contributioN from VPEC_ERR
    + for vpec-flip test, require at least 70 events (was 10)
    + new input datafile_override
    + few fixes to avoid 'cat_only' conflicts

  kcor.c[h]: 
    + read optional SURVEY(s) from kcor-input and include SURVEY=%s
      in each filter comment in kcor header.

  combine_fitres.c
    + allow comma-sep or space sep list of fitres files.

  snana.car
    + fix bug parsing comma-sep list of CIDs; needed for plot_snana.


# ======================================================================= 
         v11_02c (Dec 10 2020) 

         ***** IMPORTANT(v11_02c) ***** 

    kcor-input files require SURVEY keys for each MAGSYSTEM
       (needed only for calib shifts passed from SALT2 training)

    snana, snlc_fit:
      Fixed bug trapping invalid command-line args. Last few months were
      vulnerable to invalid args that were ignored instead of causing abort.

    snlc_sim: 
      + fix nasty bug overriding HOSTLIB_MSKOPT on command line;
        it was appending MSKOPT bits instead of overriding MSKOPT.
      + Fix BYOSED bugs related to smear models G10 and C11
      + extend PSF abort value from 9.9 to 20.
      + for QUIT_NOREWIND, always start at beginning of SIMLIB

    SALT2mu.c: write Nz x Nz cov_stat matrix to [prefix].cov.
               Same format used by CosmoMC to read cov_syst.

    combine_dataVersions.py :
      + avoids duplicate filters if multiple surveys use same FILTPATH

         ***** USEFUL(v11_02c) ***** 

         ***** MISCELLANEOUS(v11_02c) ***** 

   kcor.c
     + require SURVEY keys for each MAGSYSTEM.
     + if MAGSHIFT or WAVESHIFT keys are in SALT2.INFO, abort
       if no SURVEY name for filters.

   submit_train_SALT2.py
     + skip comments lines starting with #, @, !, %.
       Some snpca transmission files have @ symbols.

   snana.car
     + read & store SURVEY from kcor-fits files
     + sync SNANA+EPOCHS table names to match those in FITRES table.

   snlc_fit.car, snlc_sim.c:
     + pass band-dependent survey to init_filter_SEDMODEL

   combine_dataVersions.py:
     + revived for pythin 3 and other misc updates.

   merge_root.c:
     + MXFILE_MERGE -> 200 (was 130)

   sntable_dump.c
     + fix to work with SNANA table.

   SALT2mu.c:
     + add IZBIN to output FITRES file.
     + write [prefix].cov (Nz x Nz bins)
     + enable recylce of output fitres to input fitres
     + new write_csv=1 option to write M0DIF for CosmoMC
     + write MUERR_RENORM to output fitres file.
     + enable survey-dependent chi2max; see details at top of code.

   submit_prog_sim.py:
     + protect against ngentot_lc=0 and do_cidran

   snana.car
     + MXCHAR_ARG -> 800 (was 600)
     + abort if any command line ARG exceeds MXCHAR_ARG

   combine_fitres.c: new -varnames 'varlist' argument.

   remove obsolete util/createCov.py
   add refactored  util/create_covariance.py (from Sam/pippin)


# ======================================================================= 
         v11_02d (Jan 4 2021) 

         ***** IMPORTANT(v11_02d) ***** 

   sim: Using FORMAT_MASK=32 in batch mode, random seed was always the
        same for each core -> fixed. Worked fine with FORMAT_MASK=48
        to get random CIDs. Fix is mainly in submit_prog_sim.py.
  
         ***** USEFUL(v11_02d) ***** 

    combine_dataVersions.py :
      + write full filter names to TEXT data files.
        FITS format still uses single-char filter names.
        Note change in snana.car to read last char of filter name.

         ***** MISCELLANEOUS(v11_02d) ***** 

    genmag_SIMSED.c[h]
      + if in batch mode and binary is stale, abort with 
        message to remake binary interactively.

    SALT2mu.c: 
     + remove obsolete SPLITRAN-summary functions.
     + more updates for datafile_override option.
     + opt_biascor += 1024 -> keep events with no biasCor.
     + new input OPT_SNCID_LIST; see manual

    snana.car
     + for reading TEXT format, allow full filter name and
       just strip off last character. This allows better
       visual inspection of text data files.
     + write SIM_gammaDM to TEXT output if first value is non-zero.

    snlc_sim.c :
     + fix bug reading HOSTLIB_GENZPHOT_BIAS
     + abort if CONFIG key is found
     + fix awful init_CIDRAN bug. Using FORMAT_MASK=32 in batch mode,
       random seed was always the same for each core !

    sntools_genPDF.c:
     + fix bug setting min/max range

    genmag_SALT2.c
     + new function setFlags_ISMODEL_SALT2 to set ISMODEL_SALT2
       and ISMODEL_SALT3

    submit_prog_base.py :
      + add small delay in each CPU*CMD file.

    submit_prog_sim.py :  
      + fix RANSEED logic for FORMAT_MASK=32

    combine_fitres.c
      + fix to allow longer VARNAME lines up to 3200 chars.


# ======================================================================= 
         v11_02e (Jan 8 2021) 

         ***** IMPORTANT(v11_02e) ***** 

         ***** USEFUL(v11_02e) ***** 

         ***** MISCELLANEOUS(v11_02e) ***** 

    submit_prog_sim.py : increase safety margin for cidadd.
   
    submit_prog_base.py: add more REPLACE_XXX keys

    submit_prog_fit.py: new OPT_SNCID_LIST feature

    simlib_coadd[tools].c:
      several updates as described at top of source code.
    
    create_covariance.py :
      refactored to include legacy JLA and new BBC methods.


# ======================================================================= 
         v11_02f (Jan 22 2021) 

         ***** IMPORTANT(v11_02f) ***** 

         ***** USEFUL(v11_02f) ***** 

         ***** MISCELLANEOUS(v11_02f) ***** 

   snlc_sim.c : 
     + abort if obsolete $SNANA_MODELPATH is set.
     + double crazyflux limit again
     + move prep_RANSYST call after SURVEY is defined
     + abort if spectra are requested but there is no 
        SPECTROGRAPH instrument (see GENSPEC_DRIVER)
     + abort if no valid HOSTLIB keys are found (was hanging)
     + abort if any RANSYSTPAR_SIGSCALE_XXX param > 0.2

   sntools_host.c
     + add more redshift diagnostics

   genmag_SALT2.c
     + fix LAMSED logic bug inside INTEG_zSED function (affects spectrograph)

   sntools.c
      + if SNANA_VERSION key is not in FITS header, assume VPEC
        sign is correct.

   submit_batch_jobs.sh:
      + for sims, add column for NSPEC_WRITE in MERGE.LOG
      + for CPU with no jobs, sleep 10sec to avoid failing npid check.
      + ignore gargabe above CONFIG block so that saltshaker can
        put [yaml] above CONFIG

   snlc_fit.car
     + fix few bugs for OPT_PHOTOZ=2 (use REDSHIFT_FINAL as prior)

   snana.car
     + increase MXSNLS from 4 million to 5 million (for Anais)

   SALT2mu.c
     + FITWGT0 option to replace cut with MUERR -> 8888  in fit.
       Almost works, but subtle bug still there.

# ======================================================================= 
         v11_02g (Feb 5, 2021) 

         ***** IMPORTANT(v11_02g) ***** 

   sim: finally fix to use exact VPEC formula instead of additive approx.
   bbc: fix duplicate flagging bugs in SALT2mu.exe

         ***** USEFUL(v11_02g) ***** 

   sim: add option to prescale by FIELD (useful for BIASCOR sim)

         ***** MISCELLANEOUS(v11_02g) ***** 

   kcor.c
    + fix index bugs related to FILTER_LAMSHIFT

   sntools_host.c
    + for VPEC, use exact formula instead of approximation.

   SALT2mu.c
     + fix to allow ENV for datafile_header_override
     + write override z-variables with %.5f format (instead of %.3f)
     + improve duplicate flagging with explicit test in SNID;
        now handles different events in the same galaxy.

  snlc_sim.c
    + fix use of INIT_ONLY flag so that global SIMLIB header is read
      before quitting; enables SOLID_ANGLE in simlib to be used for
      rate calc in submit_batch
    + remove OPT_DEVEL_READ_GENPOLY everywhere since it has been
      default for a long time
    + refactor gen_MWEBV() -> MWEBV = gen_MWEBV(RA,DEC) so that
      it can be called by genmag_LCLIB.
    + add preScale options for SIMLIB_FIELDLIST; see manual.
    + fix FIELD entry for overlaps ; e.g., X1+X3
    + fix searcheff_zHOST functions to work with overlap fields.

  genmag_LCLIB.c
    + new OPTMASK += 8 to use RA,DEC from LCLIB.

  submit_prog_sim.py: 
    + add PATH_USER_INPUT arg for rate calc. Allows using input files
      in submit-dir without specifying full path.

  submit_train_SALT3.py
    + more development


# ======================================================================= 
         v11_02h (Feb 18, 2021) 

         ***** IMPORTANT(v11_02h) ***** 

   + IGNORE file no longer required, and no longer part of sim output
       (no action necessary)

   + Fixed subtle bug for CUTWIN_PSF and CUTWIN_ZPNPE.
     Bug introduced back in July 2021, v10_77h. See details below.

         ***** USEFUL(v11_02h) ***** 

         ***** MISCELLANEOUS(v11_02h) ***** 

                       CUT-BUG FIX
   Back in v10_77h (Jul 20, 2020) an epoch-cut bug was introduced with a
   minor refactor needed to implement OUT_EPOCH_IGNORE_FILE that writes 
   a list of rejected epochs (for SNN/Pippin). For FITS-formatted data, 
   there was an index bug for CUTWIN_PSF and CUTWIN_ZPNPE because of an 
   internal unit change on ZP and PSF read from data files. TEXT data 
   format was not affected. The bug impact was to reject a few extra epochs 
   that should be kept; LC fit mB shifts were few millimag. The bug went
   undetected because these cuts were not part of the standard set of 
   SNANA test jobs (see $SNANA_TESTS) ... but now it is. I finally caught 
   the bug as part of a major I/O refactor (not yet released) because the 
   refactored code works correctly.

  snlc_sim: 
    + abort on ancient VERBOSE format (FORMAT_MASK=1)
    + no longer write empty IGNORE file 
    + rename sntools_fitsio.c[h] -> sntools_dataformat_fits.c[h]
    + begin refactoring text format with sntools_dataformat_text.c[h]
      Goal is to extract TEXT files from FITS files, make TEXT and
      FITS treatment more parallel, and simplify maintenance.
    + fix bug reading LCLIB_CUTWIN

  snana.car
    + IGNORE file now optional (not required)
    + move leagcy I/O functions into *LEGACIO patch. These functios are
      still default unless OPT_DEBUG==21 -> test refactored I/O routines.

  SALT2mu.c
    + fix array declaration bug in check_vpec_sign function

  sntools_output_text.c :
    + actually do the fclose in  SNTABLE_CLOSE_TEXT()

  create_covariance.py :
    + add lots of command line options to override contents of input
      file. Tricky option is -m to select one and only one MUOPT.


# ======================================================================= 
         v11_02i (Feb 28 2021) 

         ***** IMPORTANT(v11_02i) ***** 

   simlib_coadd: DOCUMENTATION yaml block is now required ! 
              Legacy "COMMENT:" keys in SIMLIB header result in abort.

   All analysis codes check data README file; if !REQUIRE_DOCANA, warning
   is printed; else abort. This check also prevents losing sim-data README 
   files on scratch disks with automatic purging.

   I/O refactor finished, but not yet default. Test refactor with 
   snlc_fit.exe <inputFile> OPT_DEBUG 21

         ***** USEFUL(v11_02i) ***** 

   sim has new HOSTLIB_SPECDATA_FILE feature to pick real host spectra
   rather than using eazy/PCA coefficients.

         ***** MISCELLANEOUS(v11_02i) ***** 

   genmag_PySEDMODEL.c
     + fix bug that was preventing BYOSED params from being returned.

   sntools_host.c[h]:
     + new option HOSTLIB_SPECDATA_FILE: <file> to read real
       rest-frame spectra instead of basis templates.
       Corresponing HOSTLIB column is IDSPECDATA.
       See manual update in Sec 4.21.3 Generating Host Spectra.

     + abort if ZTRUE + VPEC/c < ZMIN_HOSTLIB

   snlc_sim.c
     + fix a few bugs to allow VEL_CMBAPEX=0 (and zHEL = zCMB)
     + fix bug reading SIMLIB to allow for very long comment strings
        (e.g., file names)
     + new option TAKE_SPECTRUM_HOSTSNFRAC to force host/SN ratio for
       integrate spectra. However, this assumes variable host if there
       are multiple SN spectra per event (see manual).
   
   create_covariance.py
     + bug fix by Dillon

   SALT2mu.c
     + fix bug to avoid abort when IDSAMPLE_SELECT feature is used (Brodie)
     + for H11 prior, set NPASS_CUTMASK_POINTER to avoid crash when
        writig YAML file (Maria)

   simlib_coadd.c:
     + append DOCUMENTATION block
     + abort if no DOCUMENTATION block
     + abort on legacy COMMENT keys


# ======================================================================= 
         v11_02j (Mar 19 2021) 

         ***** IMPORTANT(v11_02j) ***** 

     Release I/O refactor Tuesday Mar 2 2021, 6pm central.
     Hopefully nobody will noticed.

     Include CCDNUM (short int) in PHOT table; no longer in header.

     if zCMB < 0 in text format data, compute it from ZHEL.
     
     Finally removed obsolete perl submit-batch scripts

         ***** USEFUL(v11_02j) ***** 

    NEA vs. PSF:
    + add option to provide NEA in SIMLIB, instead of PSF1,PSF2,PSRRATIO. 
      Also write NEA to data files instead of PSF params. (see manual).


         ***** MISCELLANEOUS(v11_02j) ***** 

    simlib_coadd.c
      + adapt to work for NEA column replacing 3 PSF columns.  
 
    submit_batch_jobs
     + finally finish merge tasks for train_SALT3
     + submit_prog_fit uses new python script sntable_dump.py
         (no longer uses perl script sntable_dump.pl)

    snlc_sim.c
     + fix parsing-refac bug for reading WARP_SPECTRUM arg.
     + fix DASHBOARD
     + fix ZPOLY rate model 
     + for BYOSED, abort if G10 scatter model has no SALT2PATH
     + for SIMLIB_DUMP option, automatically read entire SIMLIB
         regardless of NGENTOT

    snana.car
      + fix abort trap in COUNTFIELDS; write all field names
        in abort message.
      + write recomputed PEAKMJD to reformatted data file
      + new CUTWIN_SIMPULL for &SNLCINP (to reject flux outliers)
      + new OUTLIER table; see SNTABLE_LIST options in manual
      + for snana job, SNANA text table created with default key format.
      + allow disabling output files with NONE; e.g.,
           ROOTFILE_OUT NONE  HFILE_OUT NONE

    submit_batch_jobs:
      + new option "INPDIR+: None" uses datafile= argument.
      + new STRING_VERSION_IGNORE option for BBC

    sntools_dataformat_text.c
      + allow reading FWHM column for PSF.

    sntools_dataformat_fits.c
      + if there is no REDSHIFT_FINAL key, check for REDSHIFT_CMB.

    sntools.c:
      + fix memory leak in copy_SNDATA_OBS()

    genmag_PySEDMODEL.c :
      + pass "RANSEED <ISEED>" via *ARGLIST

    Makefile: add debug flag,  "make debug"

    Create sntable_dump.py (to eventually replace sntable_dump.pl)

  TODO: 
    + add simlib option to specify band-CCD as e.g., g-42,
        to simulate CCD illum.
    + with REFORMAT_FITS option, update DOCUMENTATION block.

  BEWARE: fudged fluxes and errors are NOT included if
          data files are reformatted


# ======================================================================= 
         v11_02k (Apr 02 2021) 

         ***** IMPORTANT(v11_02k) ***** 

   SALT2mu/BBC now includes human-readable BBC_SUMMARY_FITPAR.YAML

   New "make_fluxerr_model.py" to create FLUXERRMODEL_FILE maps.

   if FIELD has no name, call it 'VOID' instead of 'NULL' so that
    pandas does not mis-intepret.

         ***** USEFUL(v11_02k) ***** 

   snlc_sim: 
     + simpler way to specify alpha,beta grid; see manual Sec 9.3.1
     + allow LOG[parName] in GENPDF maps; e.g. LOGEBV or LOGAV

         ***** MISCELLANEOUS(v11_02k) ***** 

    snana.car
      + fix bug reading filter-dependent header items like
        galmag and HOSTGAL_SB_FLUXCAL.
      + fix bug setting EXIST_SNHOST_SB (test is on SBFLUXCAL, not SBMAG)
      + suppress GALID in OUT_SIMLIB since it wrote 12345 garbage for DC2
      + change default FIELD name to VOID instead of NULL since pandas
         has problems reading NULL as a string.
      + for OUTLIER table, compute and print outlier effic vs. PHOTFLAG bit.
      + new SNLCINP input PHOTFLAG_BITLIST_REJECT to enter comma-sep
         list of bits (LSB=0) and internally compute PHOTFLAG_MSKREJ.
     
   sntools_dataformat_text.c[h]
      + check for NaN when read text format; abort on NaN.

    genmag_SEDtools.c
      + new util get_LAMTRANS_SEDMODEL(ifilt,ifilt,*LAM,*TRANS)
        to return LAM and TRANS for filter or spectrograph.

    snlc_sim.c
      + new option "GENMODEL_MSKOPT: 16" to force neg Flam to Flam=0
      + new options BIASCOR_SALT2ALPHA[BETA]_GRID to replace entering
        PEAK, RANGE and SIGMA, NGRID (see manual sec 9.3.1)
      + new feature TAKE_SPECTRUM MJD([min]:[max]) ...
      + add GENSPEC.SKIP[imjd] and fix to properly skip requested spectra
         that are outside TREST model range.

    sntools_genPDF.c: 
      + allow LOG[parName] in GENPDF maps.

    submit_batch/submit_util.py
      + fix to allow dot in GENVERSION name (use .rindex instead of .index)
      + add BBC_SUMMARY_FITPAR.YAML output for human readability.


# ======================================================================= 
         v11_02l (Apr 19, 2021) 

         ***** IMPORTANT(v11_02l) ***** 

   + remove all legacy I/O code.
   + lots of fixes to properly read back spectra and extract TEXT from FITS.

         ***** USEFUL(v11_02l) ***** 

   + new script quick_commands.py to translate data format, 
     create SIMLIB from data, and other quic/miscellaneous tasks.

   + new snlc_efficiency.py script to compute eff vs. z

         ***** MISCELLANEOUS(v11_02l) ***** 

   snlc_sim.c[h]
     + enable TAKE_SPECTRUM: MJD(min:max:step) to generate spectra for
       a sequence of MJDs; see manual.  
     + abort if any error scale is < 1 to avoid sqrt(negative number)
     + new simgen dump variable DTSEASON_PEAK

   sndata.h:
      + MXSPECTRA -> 200 (was 40)

   sntools_dataformat*.c
     + fix writing spectra in text format to work after reading FITS
       format from sim.

   genamg_PySEDMODEL.c
     + fix aweful bug in stored spectrum; was missing x0 factor
         (distance modulus dimming)
     + if model does not cover filter wave range, return mag=666 so that
       undefined flux is suppressed from data file.
       [previously it returned mag=99 and flux=0, which could fool
        analysis codes]

    snana.car:
      + refactor reading spectra to read only 1 spectrum at a time to 
        save memory.  RDSPEC_DRIVER(ISPEC) reads ISPEC spectrum from 
        SNDATA struct. MXSPECTRUM -> 200 (was 40)
      + new &SNLCINP  LPROB_TRUEFLUX=T to compute PROB_TRUEFLUX_[band]
        and store in SNANA table. Used to determine anomalous flux cov.
      + for reading fits format, check legacy DECL key if DEC does
        not exist (bug fix from IO refactor)
      + write more information with GETINFO command.

   sntable_dump.py[c]
     + better abort trap when append fails.
 
   SALT2mu.c: 
     + update diagnostic MUERR_RAW output to NOT include vpec.
     + abort if SQMUERR_RAW < 0 ... happens for duplicates
       [previous abort was SQMUERR_RAW + SQMUERR_VPEC < 0,
        so SQMUERR_VPEC prevented abort]

   sntools_dataformat_fits.h: MXFILE_SNFITSIO -> 500 (was 300)

   sntools.c:
     + init HOSTGAL_SPECZ[ERR] to -9 to fix bug in reformatting.


# ======================================================================= 
         v11_02m (May 10 2021) 

         ***** IMPORTANT(v11_02m) ***** 

    Auto-check for sub-folders under lcmerge; if VERSION = PREFIX_SUFFIX,
    check for both lcmerge/PREFIX_SUFFIX and lcmerge/PREFIX/PREFIX_SUFFIX

         ***** USEFUL(v11_02m) ***** 

   sim: +HOSTAPPEND option 

         ***** MISCELLANEOUS(v11_02m) ***** 
 
   snlc_sim.c
     + write SIM_BIASCOR_MASK to header;
        +1=> alpha grid, +2=> beta grid. Need something for BS20.
     + allow comma-sep list for SIMGEN_DUMP ; see manual.
     + new input MXRADIUS_RANDOM_SHIFT for random coords (see manual)
     + MXOBS_SIMLIB -> 10000 (was 5k) to handle more synthetic bands
     + several fixes to revive synthetic filters from SPECTROGRAPH
     + abort on NaN in HOSTLIB
     + restore parsing +HOSTMAGS and +HOSTNBR (got lost in v10_78 refactor)
     + new command-line option +HOSTAPPEND (see manual)
     + new option HOSTLIB_ABMAG_FORCE (applies to galmag and host spectrum)
     + write SNR for sim spectra in TEXT format (help with testing)
     + add internal edge bins for spectrograph to account for wave resolution.
        (only with "DEBUG_FLAG 10" ... still working on refactor)

   sntools_host.c
     + add abort trap if magobs is NaN 
         (need to add NaN check for all columns)
     + abort if any synthetic band is defined in HOSTLIB

   genmag_SALT2.c
     + minor refact so that SALT3.K21 checks under $SNDATA_ROOT/models/SALT3
       (instead of under /SALT2)

   submit_batch:
     + print full command when append-varlist fails.
     + fixes to --merge_reset and -M

   snana.car
     + new veto option for private variables; see manual

   convertcsv2snana.py :
     + fix to replace '' with VOID (to avoid blank column in FITRES file)

   sntools_dataformat_fits.c
     + fix bug reading SIM_VPEC (fallout from earlier IO refactor)

   SALT2mu.c
     + fix old bug to allow colons in comments after inputs.
     + new input zspec_maxerr_idsample 


# ======================================================================= 
         v11_02n (Jun 01 2021) 

         ***** IMPORTANT(v11_02n) ***** 

   + sim: fix wave smearing for spectrograph 

         ***** USEFUL(v11_02n) ***** 

   + BBC class for submit_batch_jobs auto-detects SAME-EVENT flag from 
      LCFIT and does the same for BBC; get help with "-H BBC" args.
   + submit_batch_jobs works with SALT3 training (saltshaker)
   + add HOSTGAL_FLAG to data structure
   + snana.car: read & apply PHOTFLAG_MSKREJ in IGNORE file (or in &SNLCINP)
   + kcor.c: add LEAKAGE_CUT key to remove out-of-band trans.

         ***** MISCELLANEOUS(v11_02n) ***** 

    snlc_sim.c 
      + finish refactor to fix wave smearing in edge bins of spectrograph.
        Refactor is now default; go back to legacy code with
            snlc_sim.exe myInputFile DEBUG_FLAG -10
        Noticed that correlated template noise (for SNR_ZPOLY) in spectra 
        was broken; made some attempt to fix, but not well tested.
      + in speceff file, allow HOSTMAG_[band] or HOST_MAG_[band]
      + new key TAKE_SPECTRUM_PRESCALE (see manual)
      + refactor SEARCHEFF_zHOST to take logical OR of multiple maps.
      + optional FIELD in TAKE_SPECTRUM(FIELD) input ; see manual

    genmag_SALT2.c[h]
      + refactor inputs to genmag_SALT2 function to pass parList_SN
        and parList_HOST ... to enable passing logMass to get_genSmear
        function that is inside genmag_SALT2, and eventually to
         get_genSmear_SCALE.

    snana.car
      + restore HOST_MAG_[band] to output tables; was lost during IO refac.
      + check IGNORE file for PHOTFLAG_MSKREJ and PHOTFLAG_BITLIST_REJECT.
        This allows data release to include PHOTFLAGs so user need not
        specify these flags in their &SNLCINP.
      + add HOSTGAL_FLAG to data structure

    sntools.c
      + read_GRIDMAP bin uniformity requirement at 1E-6 instead of E-3.

    SALT2mu.c
      + fix bug with HOST_LOGMASS override. read_data_override is
        moved to before cuts are applied instead of after.
      + new debug_malloc=1 input to print each malloc/free;
         to help catch memory leaks.
      + fix bug cutting on crazy COV; cut on COV(mB,X) instead of COV(x0,X)

    submit_batch:
      + for fit mode, fix bug setting OPT_SNCID_LIST to get same
        events for all systematics.
      + for fit mode and OPT_SNCID_LIST > 0, write NEVT_COMMON
        to MERGE.LOG

    kcor.c[h]: add new input key LEAKAGE_CUT: <value> to reject
         trans/TransMax < LEAKAGE_CUT.

    util/submit_batch: 
     + finally get submit_train_SALT3.py working.
       SNANA calib info is written to SALT3.INFO file,
         but BEWARE that it's  NOT yet tested with snlc_fit.exe.

     + if BBC detects LCFIT option to use same events for systematics,
       it runs 2 iterations to sync events in BBC as well.
       Revert to legacy with "--devel_flag -20". Later need to remove
       DEVEL_SYNC_EVT flag in submit_prog_bbc.py.



# ======================================================================= 
         v11_02o (Jun 11 2021) 

         ***** IMPORTANT(v11_02o) ***** 

    + fix nasty SUBPROCESS bug in SALT2mu; REWGT cut was not reset.

    + CID matching updated to use hash table for
            SNCID_LIST_FILE  in   &SNLCINP (snana.exe, snlc_fit.exe)
            cid_select_file  for  SALT2mu.exe
       => much faster and no limit on number of CIDs. Example from Maria
          with 2 million sim events and selecting from SNCID_LIST_FILE 
          with 40k events passing 4MOST selection:
          Previous brute-force CID loop takes 116 minutes (0.2 sec/evt)
          just to read the data (no LC fitting), which is almost the same 
          time to run LC fitting. Using hash table, reading takes 5 minutes, 
          or x23 faster.
          See C-functions  match_cidlist_init[exec] in sntools.c[h].

         ***** USEFUL(v11_02o) ***** 

    + new sim input 
         GENPOP_ASYMGAUSS: <genpop_file>  <model>
       and popular models in $SNDATA_ROOT/models/SALT2/POPULATIONS.DAT

         ***** MISCELLANEOUS(v11_02o) ***** 

   SALT2mu.c
     + apply forgotten remove_quotes(s) to one of the SUBPROCESS inputs
     + for subprocess output table, allow % or * because % wreaks havoc
       with python.
     + refactor parse_cidFile_data() to use match_cidlist util 
       with hash table.

   sndata.h:
      + MXEPOCH -> 4000 (was 2000)

   sntools.c
     + new utilitiy errlog(FP, SEV, fnam, c1err, c2err)
         (has FP input argument to allow writing to log file)
     + new utility match_cidlist_init[exec] to perform CID list matching
       with hash table; 

   sntools.h
     + MXWORDFILE_PARSE_WORDS -> 2M (was 1 million) so that cid_select_file
       in SALT2mu can read large files.

   sntools_host.h
     + MXWGT_HOSTLIB -> 500,000 (was 50k) for large WGTMAPs in PLASTICCv2.
     + define MXCHAR_LINE_APPEND 300 (replace hard-wired alloc of 100)
     + for "_obs" variables, apply case-sensitive match to avoid confusing
       a_obs and A_obs, etc ... Other HOSTLIB variables still have 
       case-insensitive match
      
   snlc_sim.c[h]
     + MXEPSIM_PERFILT -> 2000 (was 1000)
     + new sim input GENPOP_ASYMGAUSS
     + fix bug setting IMJD_HOST for contamination
     + allow zero-flux host for host-contamination option.


   SALT2mu.c
     + replace all errmsg calls with errlog call.
     + debug_flag=68 -> muCOVscale is NOT applied to vpec part of MUERR
     + use hash table for cid_select_file and cid_reject_file
     + begin refactor to include logmass dependence on muCOVscale
          (develop with debug_flag=611)

   snana.car:
     + new &SNLCINP inputs HOSTGAL_PHOTOZ_SHIFT and HOSTGAL_SPECZ_SHIFT
     + MXCCID_LIST -> 75,000 (was 25k); needed for TiDES study.
     + SNCID_LIST_FILE uses new match_cidlist utility in sntools.c;
        based on hash table, it's much faster and has no max limits.


# ======================================================================= 
         v11_02p (Jun 26 2021) 

         ***** IMPORTANT(v11_02p) ***** 

    + SALT2mu: release change of NOT applying MUCOVSCALE to vpec part 
      of MUERR. Note that SALT2mu results change very slightly.
      debug_flag=-68 to go back.                             

         ***** USEFUL(v11_02p) ***** 

    + submit_batch(SIM) has new INCLUDE_FILE_LIST to apply
        independent systematic changes for each RANSEED_CHANGE.

    + SNANA_code_tester.py has new --snana_dir arg so that anyone
        can test their private snana repo.

    + new utility colnum_in_table(char *fileName, char *varName)

         ***** MISCELLANEOUS(v11_02p) ***** 

    SALT2mu.c
      + clean out some LEGACY codes from previous tag
      + new feautre cat_only/5 to prescale output
      + fix bug reading logmass in SUBPROCESS
      + new inputs force_realdata and select_trueIa
      + new input arg SUBPROCESS_OPTMASK 1 -> write fitres file each iter
      + for SUBPROCESS, supress writing muerr_renorm since it is not
          malloced or filled.

    snana.car
      + clean out some LEGACY codes from previous tag
         (remove stuff related to MXCCID_LIST)

    snlc_sim
      + new option in WGTMAP; see OPT_EXTRAP_WGTMAP in manual.
      + restore inputs SEPNBR_MAX & NNBR_WRITE_MAX
           (lost in July 2020 refactor)
      + fix bug (from May 27) reading TAKE_SPECTRUM keys from SIMLIB header.
      + define GENRANGE_TOBS_PAD = 0.1 to apply consistent MJD-select padding
      + finally fix INCLUDE_FILE logic with more clear priorities:
        1) primary input, 2) include files in primary, 
        3) include files on command line, 4) command line args
         [higher number priority overrides lower priority]
      + MXINPUT_FILE_SIM -> 4 (was 3) to allow 3 INCLUDE files.

    SNANA_code_tester.py
      + refactor and add --snana_dir arg to that anyone can
        test their private development version of snana.

   sntable_dump.c: 
     + increase file name string-length allocations
  
   genmag_LCLIB.c
     + skip COMMENT lines and DOCANA block reading LCLIB

   sntools_genGauss_asym.c[h]:
     + move a few utils from snlc_sim.c[h] to here so that
       SALT2mu can use it.

   Makefile:
    + add sntools_genGauss_asym dependence for SALT2mu

  UNRESOLVED SALT2mu ISSUES to FINISH NEXT CODE TAG:
    - for select_cid_file, match with CID+IDSURVEY to handle duplicates
         (partially started with column_in_table function)
    - debug logmass dependence
        (filled in logmass indices, but no rigorous debug yet)
    - SUBPROCESS: alpha & beta asym Gaussian profiles
       (refactored so that parse_input_GENGAUSS is visible to SALT2mu)


# ======================================================================= 
         v11_03 (July 17 2021) 

         ***** IMPORTANT(v11_03) ***** 

     + fix subtle SATL2mu bug related to chi2max cut (see details below)
     + SALT2mu: interp_biascor_logmass option applies to muCOVscale
     + REQUIRE_DOCANA=T for sim; enabled for HOSTLIB, WGTMAP, SIMLIB 
        [disable with command line arg "REQUIRE_DOCANA 0"]

         ***** USEFUL(v11_03) ***** 

    + SALT2mu matches on CID_IDSURVEY to handle duplicate CID
          from different surveys.

    + new sim input key GENPEAKRANGE_XXX to give flat top to asym Gauss.
       Initial use is bounding function for SALT2mu SUBPROCES.
       
    + train_SALT3: add SURVEY_LIST_SAMEMAGSYS[FILTER] keys

         ***** MISCELLANEOUS(v11_03) ***** 

   all codes: all random-number functions renamed with "getRan_" prefix

   genmag_LCLIB: 
      + call coord_translate_LCLIB before anglematch cut 

   sntools_host.c
     + fix index bug related to reading HOSTNBR.
     + add kludge reading gzipped HOSTLIB with HOSTNBR by
        subtracting 1 from rowNum (since first GAL key is skipped)
     + fix +HOSTNBR write and read to work for both unzpped and zipped;
         trick: after reading header, close and re-open file to avoid 
          rewind that doesn't work for gzip files.

   sntools.c
     + fix hash_table_def to declare name[20] instead of name[10];
        name[10] was stopping matches for long CID lengths.
     + for large GRIDMAP, print update every 500,000 rows.
     + add peakinterval arg to biGaussRan
     + move malloc_double2D[3D][4D] functions from SALT2mu.c to sntools.c

   SALT2mu.c
     + implement interp_biascor_logmass option for muCOVscale
         (to work same way as for biasCor)
     + suppress unecessary INFO_DATA mallocs if no biasCor.

     + when chi2max cut rejects events, call setup_zbins_fit()
       for 2nd time to update NFIT(z), and check for z-bin drop-outs.
       This fixes subtle bug if chi2max cut causes z-bin to be
       empty; empty z-bin was still included in the fit.
       Also fixes cosmetic bug for NFIT column in .M0DIF outfile.

   snana.car
     + default CUTWIN_NFILT_SNRMAX -> 0 (was 1) to show events with nothing.
     + MXLEN_EPSTRING -> 40k (was 20k) to read Roman with synthetic bands.
     + add N_SNHOST_ZSPEC[PHOT] to output yaml file if OPT_YAML=1
     + abort on TYPE < 0 (see PASS_SNTYPE function)

   snlc_sim.c
     + for pre-scaled spectra, fix logic to suppress rejected spectra
       from output that have NLAM=0.
     + On 1st event set GENLC.RA_LAST = GENLC.DEC_LAST = -999 so that LIBID 
       with  RA=DEC=0 results in NEWCOORD=T on 1st event for MWEBV calc.
         (thanks Alex and Gautham for finding this bug with IDEAL sims)
       Bug detail: RA[DEC]_LAST variables were not initialized, and
       thus took values of zero ...so RA != RA_LAST was never satisfied.
     + require DOCANA for HOSTLIB and WGTMAP (Jul6 6 2021)
     + write KCOR_FILE to FITS header.
    
   submit_train_SALT3.py:
      new keys 'SURVEY_LIST_SAMEMAGSYS and 'SURVEY_LIST_SAMEFILTER'  
       (beware: copied code snippets from train_SALT2, but not tested)

   sntools_genExpHalfGauss.c :
      + new utility parse_input_EXP_HALFGAUSS

   simlib_coadd.c
     + fix a few string bugs setting header strings.
        (caught by segfault with debug flag)


# ======================================================================= 
         v11_03b (Aug 4 2021) 

         ***** IMPORTANT(v11_03b) ***** 

    wfit.c: major overhaul to optionally fit for wa

         ***** USEFUL(v11_03b) ***** 

         ***** MISCELLANEOUS(v11_03b) ***** 

    extract GRIDMAP utils from sntools.c[h] into sntools_gridmap.c[h]
    extract SIMEFF  utils from sntools.c[h] into sntools_simeff_obsolete.c[h]

    clean out "mark"

    snlc_sim.c
      + fix bug implementing CIDRAN_MIN
      + screen_update prints GenRate every 100 sec.

    SALT2mu.c
      + more subprocess development; add Beta distribution.
      + read bounding functions from sim-input file.
      + use new utility  sigint_muresid_list
      + new option to add to COV instead of scale COV (Dillon)

    sntools_cosmology.c
     + fix dumb bug using wa in Hzfun_wCDM().

    create_covariance.py: minor fix by Dillon

    snlc_fit.car
     + new inputs INIVAL_GRIDSEARCH_DPEAKMJD and INIVAL_GRIDSEARCH_COLOR
        (min,max,bin) to find better initial values before fit.



# ======================================================================= 
         v11_03c (Aug 20 2021) 

         ***** IMPORTANT(v11_03c) ***** 

         ***** USEFUL(v11_03c) ***** 

   + sim: if hostmag errors are in HOSTLIB, propagate to data files
   + sim: refactor to prioritize GENPDF_FILE or asymGauss on command line
   + fix bug reading text files with full filter name
   + add --snana_dir arg to submit_batch_jobs and SNANA_submit_tests.py 

         ***** MISCELLANEOUS(v11_03c) ***** 

    genmag_SALT2.c
      + for MAGSHIFT key in SALT2[3].INFO file, read only last char of band.

    sntools_host.c[h]
      + if hostmag errors are in HOSTLIB, propagate to data files.

    sntools_dataformat_text.c
      + strip of last char of band to allow full filter string
        in text formatted data.

    sntools.c
      + fix splitString() to remove termination chars so that it works
        when extra pad spaces + <CR> are included.

    SALT2mu.c
     + fix conflict_check to allow zbinuser

    submit_batch_jobs     : add optoinal --snana_dir arg
    SNANA_submit_tests.py : add optional --snana_dir arg
   
    wfit.c
      + refactor write_output_cospar

    snana.car
      + for SIMLIB_OUTFILE option, write DOCANA
      + write HOST_SBMAG to output table, and HOST_SB -> HOST_SBFLUXCAL

   util/make_fluxerr_model.py : 
     + if SBMAG is used in map, reject epochs with invalid SBMAG>50.

   submit_trainSALT2.py:
     + fix stupid bug writing SNLS WAVESHIFT info to SUBMIT.INFO

   snlc_sim.c
     + refactor to prioritize GENPDF vs. asymGauss, and to
       print correct genPop source in README when GENPDF
       overrides asymGauss, or vice-versa
     + crazyflux *= 2 

   submit_prog_[fit,sim].py
     + implment optional --snana_dir to work with SIMnorm job
       and snana.exe job.


# ======================================================================= 
         v11_03d (Aug 30 2021) 

         ***** IMPORTANT(v11_03d) ***** 

         ***** USEFUL(v11_03d) ***** 

         ***** MISCELLANEOUS(v11_03d) ***** 

    + sntools_spectrograph.c: 
      in getSNR_spectrograph, interpolate ZP vs. log10(Texpose) instead
      of ZP vs. Texpose. Works much better with sparse Texpose grid.
      [issue found by comparing SNR against D.Rubin]
 
    + genmag_SALT2.c: 
      in genSpec_SALT2, remove buggy 1/z1 factor in computing GENMAG 
         from GENFLUX
   
    + snlc_fit.car:
      INIBND(color) = -1.6,1 -> -1.6,2 to allow for redder events.
      Results in very small regression test differences, so need
      to cut new version.


# ======================================================================= 
         v11_03e (Sep 19 2021) 

         ***** IMPORTANT(v11_03e) ***** 

         ***** USEFUL(v11_03e) ***** 

   + add makeDataFiles/
   + for SALT2mu, CUTWIN on command line properly overrides, allowing
      relaxed cut w.r.t. CUTIN in the input file.
   + new SIMLIB_SURVEY key to fake a different sample (e.g., LOWZ)
     with the same survey-sim.

         ***** MISCELLANEOUS(v11_03e) ***** 

   snlc_sim.c
     + refactor simlib-read to read entire line with fgets instead
       of reading each string. Hope is to speed up jobs on Cori.
     + for OPT_MWEBV=0 on command line, disable APPLYMWEBV correction.
     + prep_user_input; set HOSTLIB_MSKOPT=0 if HOSTLIB_FILE is NONE;
       fixes command line override to remove HOSTLIB by setting 
       file name to NONE
     + new input key SIMLIB_SURVEY to override SURVEY in simlib file.
       If LOWZ and high are from same survey, can split into LOWZ and
       survey name.

   sntools_host, snlc_sim:
     + add few more HOSTLIB variables to output HOSTGAL (for ELASTICC):
       OBJID2, SQRADIUS, ELLIPTICITY.
     + abort on duplicate HOSTLIB colmuns ... but disable with local
       logical until GHOSTLIBs are fixed on Cori.

   SALT2mu.c:
     + remove debug_flag=99 and integrate feature into code.
       Note that MASK_BIASCOR_MAD=2048 is automatically set
       if MASK_BIASCOR_MUCOVADD=4096 is set.

     + fix subtle bug by rejecting cells where MUCOVSCALE is not valid
       because NperCell < 5. Not clear what info was stored in these 
       cells that were not processed. The bug-fix could result in fewer 
       cells to interpolate, and possibly more rejected events. Regression 
       test on SALT2mu jobs show two small changes: 
         delta-beta/beta = 3E-5,  and delta-gamma/gamma = 3E-5

     + fix CUTWIN parsing to properly override from command line;
       allows looser CUTWIN on command line to override input file.

     + yaml output includes stats by IDSAMPLE for each
        event_type = DATA, BIASCOR, CCPRIOR

   submit_batch_jobs:
     + print NEVT_bySAMPLE to BBC_SUMMARY_FITPAR.YAML

   snana.car
     + always write SIM_gammaDM; previously it required SIM_gammaDM!=0,
       but can fail if sim has gDM = 0 and nonZero values.
     + fixes for SNCID_IGNORE_FILE: works with/without DOCANA,
       ignores comments after hash, prints 1st/last CID.

To do: set CHECK_DUPLICATE_COLUMNS=T after GHOSTLIBs are fixed.


# ======================================================================= 
         v11_04 (Oct 3 2021) 

         ***** IMPORTANT(v11_04) ***** 

    + Major refact/overhaul of wfit.c code; read top of source code.
    + create_covariance.py writes "standard" output 
      (cosmomc/ subdir still created if input "COSMOMC" key is used)

         ***** USEFUL(v11_04) ***** 

         ***** MISCELLANEOUS(v11_04) ***** 

    snana.car, sntoold_dataformat_fits.c
      + fix bug reading SIM_TEMPLATEMAG

    create_covariance.py:
      + major refac to write more standard output that is
         separate from the output for cosmomc.

    Remove obsolete sntable_dump.pl
  
    get_fitres_values.py:
      + update to work for HOSTLIB and to skip DOCANA keys

    SALT2mu.c:
      + in MNCHI2FUN, abort on muerrsq < 0
      + in check_duplicate_SNID, replace large local arrays
        with malloc to avoid weird valgrind errors.
      + in WGT_biasCor, check interp_biasCor_logmass to include
          wgt from logmass; fixes add bug found by Brodie and Dillon.
      + new input cidlist_debug_biascor
      + debug_mucovscale is now a j1d index to print info for.
      + prep SUBPROCESS output table to write STD and STD_ROBUST

  sntools.c
    + sigint_muresid_list(): reduce covfloor from 0.1^2 to 0.02^2
    + arrayStat(); fix median calculation to depend on odd or even N

  wfit.c
    + write wa info to yaml file
    + complete refactor/overhaul; read top of code.

  submit_prog_bbc.py:
    + include wa results in BBC_SUMMARY_wfit file

  create_covariance:
    + for unbinned, write CID IDSURVEY MUERR_VPEC ...

  genmag_SALT2.c:
    + remove setting magerr=5 when errfrac > 1 -> 
        5 very small changes in regression test.


# ======================================================================= 
         v11_04b (Oct 15 2021) 

         ***** IMPORTANT(v11_04b) ***** 

   create_covariance.py: 
     + write ISDATA_REAL flag to INFO.YML so that cosmology fitting
       codes can auto-detect real data and apply blinding.

   Require DOCANA in weak-lensing map.

   Add IMGNUM (image number) into data files (similar to CCDNUM); 
   this is EXPNUM for DES, VISIT_ID for LSST.
   Needed for chromatic corrections and useful for image debugging.
 
   Realized 2 problems that need be fixed next snana version:
   1) writing sim spectra to FITS; constant wave bins for each spectrum 
      is assumed to write more compact output, but this won't work for 
      real data. Need to re-write output with explicit wave column, 
      and include legacy flag.
   2) combine_dataVersions writes corrupt kcor-input file if there
      are multiple filter sets in one of the input kcor inputs.

  snlc_sim.exe <input> DEBUG_FLAG 1024
    -> require DOCANA in trigger files; will be permanent Oct 24.

         ***** USEFUL(v11_04b) ***** 

   submit_batch: 
     +  add new 'wfit' class
     +  fix logic to wait for program to exist; abort if program
        is not found after 5 minutes.
     + new --check_abort option (for sim and lcfit) 
     
         ***** MISCELLANEOUS(v11_04b) ***** 

   wfit.c : misc updates to work with submit_batch

   SALT2mu.c: 
    + write ISDATA_REAL to output yaml so that it can be
      propagated to cosmology fitters for auto-blinding.

   snlc_sim.c
     + restore parsing "WV07_REWGT_EXPAV" key
     + read WARP_SPECTRUM from simlib

   sntools_dataformat_fits.c[h]
     + split several arrays ito RD_ and WR_ so that FITS formatted
       data files can be read and re-written in FITS format after
       apply corrections to fluxes and their uncertainties.
     + pass mask for writing spectra so that it can work for
        both sim and data.

   sntools_weaklensig.c: require DOCANA

   sntools_host.c: 
     + set LOGMASS_OBS = LOGMASS_TRUE
        if LOGMASS_OBS and LOGMASS_ERR not in HOSTLIB
        avoids mysterious -9 values in data files

  snana.car
    + new &SNLCIP input MXEVT_CUTS

  combine_dataVersions.py
    + fix bug in args for snana.exe


# ======================================================================= 
         v11_04c (Nov 1 2021) 

         ***** IMPORTANT(v11_04c) ***** 

   + Sim aborts if DOCANA missing from files specified by SEARCHEFF* keys.
   + Sim aborts if OPT_MWEBV < 0 (no more correcting FLUXCAL for MWEBV)

         ***** USEFUL(v11_04c) ***** 

   + Integrate makeDataFiles into submit_batch
   + Integrate writing LSST alerts into makeDataFiles
   + Sim writes new header vars: MJD_TRIGGER, MJD_DETECT_FIRST[LAST]
   + fix I/O to handle spectra for real data

         ***** MISCELLANEOUS(v11_04c) ***** 

    sntools_dataformat*
      + fix to read/write spectra with real data (SIRAH)
      + fix bug from recent zbug writing SIM_HOSTLIB info to FITS file
   
    snlc_fit.car
      + write CCDNUM and IMGNUM to model spec table (for chromatic corr)

    snlc_sim, sntools_dataformat_*
      + write new header variables: 
           MJD_TRIGGER, MJD_DETECT_FIRST, MJD_DETECT_LAST
      + new input HOSTLIB_GALID_UNIQUE_OFFSET
      + abort if OPT_MWEBV < 0 
      + require DOCANA in trigger/search files (Oct 26 2021, 9pm)
      + if EXPOSURE_TIME>10, skip saturation check.

    wfit.c
      + begin adding modern BAO prior from Alam 2020

    submit_batch_jobs:
      + integrate makeDataFiles 
      + add optional "extra table" to MERGE.LOG

    makeDataFiles/
       + lots of development
       - tasks to complete next snana version
         1. organize LSST alerts by NITE instead of MJD
         2. try to split compression tasks among more CPUs to avoid overload


# ======================================================================= 
         v11_04d (Dec 2 2021) 

         ***** IMPORTANT(v11_04d) ***** 

    + create_covariance.py works with BEAMS for unbin and rebin
        (needs high-stat sim testing)
    + wfit's boa option is now based on Alam 2020 (no longer Eisen2006)
    + submit_batch ready with wfit (submit_batch_jobs -H WFIT)
    + Integrate skeleton gensed_BAYESN.py into sim

         ***** USEFUL(v11_04d) ***** 

    + new sim-input HOSTLIB_GENZPHOT_FUDGEMAP (see manual)
    + get_fitres_values.py works on gzip files, and on HOSTLIB

         ***** MISCELLANEOUS(v11_04d) ***** 

   snlc_sim.c:
     + new input RANSYSTPAR_GENPDF_FILE_WILDCARD
        (not yet tested)
     + can read SALT2ALPHA and SALT2BETA maps from GENPDF_FILE,
        or read asymGauss keys from GENPDF_FILE and convert to map.
     + in hostgal_to_SNDATA(), remove ancient code snippet that
        set hostmags even if there was no DDLR match.
     + for text format with spectra, write LAMRANGE_VALID key
        in data file.
     + read/apply global FIELD key simlib header.
     + abort if OPT_MWEBV < 0 (previous attempt didn't actaully abort)
     + new input  HOSTLIB_GENZPHOT_FUDGEMAP (see manual)
     + copy LCLIB_CUTWIN REDSHIFT to GENRANGE_REDSHIFT
 
   sntools_host.c:
     + adjust HOSTGAL mags for MU(zSN) - MU(zGAL)

   kcor.c:
    + For spectrograph, extend stored wavelength range of SEDs to that 
      of spectraograph.
    + fix bug reading correct wave range of primary SED.

   submit_batch_jobs:
     + check_abort is monitored after each job so no longer have
        to wait for all jobs to finish.
     
   submit_prog_sim.py:
     + strip out comments from reading sim-input files.

   submit_prog_wfit.py
     + improve WFIT_SUMMARY file

   genmag_LCLIB: fix refac bugs from Jun 23 2021 (affected AGN)

   Add gensed_BAYESN.py [begin development of new PySEDMODEL option]
 
   SALT2mu.c:
     + fix override to work when two variables (zHEL and VPEC)
       both affect zHD.
     + fix VPECERR override to affect MUERR.
     + new input prescale_simIa=3

  get_fitres_values.py:
    + fix to work on gzipped files.

  wfit.c
    + -bao and -bao_sim priors now use Alam 2020
        (no longer uses Eisenstein 2006 prior)

  create_covariance.py
    + unbinning/rebinning working with BBC(Ia+CC), but needs
      more testing with high-stat sins to measure bias.


# ======================================================================= 
         v11_04e (Dec 29 2021) 

         ***** IMPORTANT(v11_04e) ***** 

   Fixed HEADER_OVERRIDE bug that set zFit = zCMB instead of zHEL.
   New &SNLCINP input RESTORE_OVERRIDE_ZBUG restores the bug.

   sim: DEBUG_FLAG 1222 -> write refactored [GENVERSION].README
         (will become default next code version)

         ***** USEFUL(v11_04e) ***** 

   New script make_simsed_binaries.py

   Call check_EOF from store_PARSE_WORDS and host-reading;
     try to get more info about file-reading errors.

   SALT2mu prescale option now works for HOSTLIB.

         ***** MISCELLANEOUS(v11_04e) ***** 

   submit_batch_jobs:
     + new arg --merge_background

   submit_prog_wfit.py: fix few bugs

   wfit.c: 
     + new input "-speed_flag_chi2 0" to disable speed-trick.
     + for speed-trick, increase CHI2-DIAG cut from 10 to 30 sigma.

   sntools_dataformat_fits.c
     + always write XPIX and YPIX columns.
     + check HOSTGAL_USEMASK to write host mags and SB

   snana.car:
     fix REFORMAT to work when FLUXCALERR are modified by 
     FLUXERRMODEL_FILE, and when FLUXCAL are changed by MAGCOR_INFILE.

   new code-utility files sntools_data.c[h] that contain data-handling
   functions which are not format-specific. Move relevant functions
   out of sntools.c[h] and into new code file.

   snlc_sim.c
    + new default SIMSED_USE_BINARY = 0
    + new bit-mask options for SIMSED_USE_BINARY; see manual
    + if writing binary flux table, write few more items to yaml.
    + new sim-input DNDB_SCALE to scale galactic/LCLIB models
    + for batch mode FITS format, automatically gzip FITS files;
       should speed up submit_batch for sims.
    + print sim-init time before event-generation loop.
    + new sim-input "APPLYFLAG_MWEBV: 1" to correct FLUXCAL for MWEBV.
    + DEBUG_FLAG 1222 -> write refactored [GENVERSION].README
    + new option to globally override min or max redshift;
         GENRANGE_REDSHIFT 0.05 -1 # override zmin only

   genmag_SIMSED.c
     + implement new options to force creation of binaries (see manual)
     + refactor so that WR and RD binary flags are global.

   sntools.c
     + in open_textgz, if both file and file.gz exist, wait 5 sec
       and try again. Needed for pipelines where job runs while
       gzip on another core is in progress.

   SALT2mu.c
     + fix prescale option to also work with HOSTLIB.


# ======================================================================= 
         v11_04f (Jan 15 2022) 

         ***** IMPORTANT(v11_04f) ***** 

   sntools_host.c:
     + Improve IGAL search algorithm to improve speed. With few million
       galaxies in HOSTLIB, overall sim speed up is ~ x5.

   sim: release README refactor with all-yaml DOCUMENTATION block; see manual.
      (recover legacy readme with DEBUG_FLAG -1222)

   sim: prepare abort fix on duplidate keys in input files (but not released)

   sim: optional ZPHOT_QP[0,1,2...] to describe zPHOT PDF with quantiles.

   sntools_SEDtools.c:
     + fix subtle bug setting up logz bins for SIMSED model;
       see https://github.com/RickKessler/SNANA/issues/776

         ***** USEFUL(v11_04f) ***** 

         ***** MISCELLANEOUS(v11_04f) ***** 

    snlc_sim.c
      + see IMPORTANT updates avove
      + write NGEN(TOT,WRITE) for each SUBSURVEY into README 
      + add local REFAC flag (default=false) to abort on 
          duplicates in INCLUDE file

    sntools_dataformat_text.c:
      + few fixes to read TEXT files extracted from FITS created by sim
      + write out private variables (forgot in last I/O refactor)
  
    makeDataFiles/
     + fix a few bugs introduced during devel of lsst_alerts
     + refactor global params (Bruno)
 
   sntools_dataformat_fits.c:
     + read/write ZPHOT_QP* so that FITS -> TEXT conversion works.

   sntools_host:
     + protect NUSE in FREEHOST_GALID()

   ZPHOT_QP: longer term plan is to
     - read ZPHOT_QP into snana/snlc_fit
     - unpack ZPHOT_ZP into zPHOT(PDF)
     - use in photo-z LCFIT


# ======================================================================= 
         v11_04g (Jan 27 2022) 

         ***** IMPORTANT(v11_04g) ***** 

  snlc_sim: release refactor to abort on duplicate keys in 
             different input files.
            https://github.com/RickKessler/SNANA/issues/781

  snlc_sim: fix bug setting REDSHIFT_FINAL for wrong host;
        https://github.com/RickKessler/SNANA/issues/778

         ***** USEFUL(v11_04g) ***** 

   New uncombine_dataVersions.py script.

         ***** MISCELLANEOUS(v11_04g) ***** 
 
   snlc_sim.c: 
     + remove legacy readme_doc_xxx functions
     + ZPHOT_QP += (ZSN-ZGAL) 

   snana.car: release refactored HEADER_OVERRIDE 
           DEBUG_FLAG = -1210 -> LEGACY_HEADER_OVERRIDE

   submit_prog_bbc.py:
      + fix writing REJECT_FRAC_BIASCOR to BBC_SUMMARY_FITPAR.YAML
 
   SALT2mu.c
     + fix bug in SUBPROCESS reading sim-input reference file.

   quick_commands.py:
     + new option --diff_fitres to analyze stats on difference
       betweeen two fitres files:   avg, median, std, min/max

   wfit: fix speed trick to work for Pantheon that has chi2 > Ndof.

   submit_prog_wfit.py
      + new config key WEIGHT_AVG to specify computation of wgted 
        averages;  submit_batch_jobs.sh -H WFIT


# ======================================================================= 
         v11_04h (Feb 27 2022) 

         ***** IMPORTANT(v11_04h) ***** 

   Finalize [PERCENTILE]_ZPHOT_Q notation for sim and real data.
   Analysis codes reads ZPHOT quantile info and fills SNDATA struct; 
   still need to pass quantile info to snana.car.

         ***** USEFUL(v11_04h) ***** 

   sim: New README argument to print README file and quit.
        Designed for Pippin to quickly extract GENMODEL & GENTYPE info.

   wfit: fix speed trick bug (had left out analytic H0 marg)      

         ***** MISCELLANEOUS(v11_04h) ***** 
  
    ZPHOT_Q (quantiles) devel for sim read it from hostlib
      and reading it from data files.

    snlc_sim.c
     + GENFILT struct changed from 2D array to 1D array of pointers
     + new function malloc_GENFILT() 
     + MXEPSIM -> 15k (was 10k) for SCOTCH generation
     + MXEPSIM_PERFILT -> 2500 (was 2000)
     + avoid passing ran[0,1]=0.00 to weak-lens function; see
          https://github.com/RickKessler/SNANA/issues/819
          
    submit_batch_jobs: 
      + new --faster arg to process 1% (--fast still does 10%)

    sntools_host.c[h]
      + read 4 generic hostgal properties (LOGMASS, LOGSFR, LOGsSFR, COLOR)
        from HOSTLIB and write to data files.
      + abort if Sersic profile size is zero.

    sntools_data.c
      + process overrides for above hostgal properties.

    snana.car
      + read 4 generic hostgal properties and write existing ones
        to output tables (SNANA,FITRES)
      + remove legacy HEADER_OVERIDE code

    SALT2mu.c
      + subtle bug fix in sort_IDSAMPLE_biasCor() to allow survey
        in surveygroup and also allow survey's fields to be in a
        fieldgroup.
      + fix bug to enable fixing beta (u2=0)
  
    sntools.c
      + fix bug initialize HOST_LOGMASS_XXX to -9999 instead of -9.

    genmag_SALT2.c
      + modify MAGSHIFT matching logic to use base name of filter
        so that different LOWz combinations can be used compared
        to traning. E.g., suppose CFA3K-B/q is used for training
        with systematic MAGSHIFT, but CFA3K-B/n is used in light 
        curve fit. New matching logic only compares the CFA3K-B
        part (before the slash).
   
    SALT2mu.c:
      + increase DROPLIST array size to fix memory overwrite bug

    Remove util/sntools.pm


# ======================================================================= 
         v11_04i (Mar 18 2022) 

         ***** IMPORTANT(v11_04i) ***** 

   + SALT2mu: if 1 beta bin, set DUST_FLAG and set SIM_BETA = p2
       (initial beta) -> fixes BS21-model problem of chi2_red well 
       below unity from computing MUERR with SIM_BETA ~ 2 instead of 3.

         ***** USEFUL(v11_04i) ***** 

   + New option to re-write sim data without sim-truth so that it looks
     like real data; see OPT_REFORMAT_FITS = 256

   + Hopefully fixed two causes of rare batch-job aborts for sims;
     1) reading zero words from inputs and 2) running code during make.

         ***** MISCELLANEOUS(v11_04i) ***** 
   
   SALT2mu.c
     + compute internal DUST_FLAG for BS21 model (see above)
     + fix bug in prepNextFit() related to sigma_int=0
     + read and use zprior[err] if zspec_errmax is set
     + fix SUBPROCESS bug to use non-standard BBC variables in GENPDF table.
     + set default INPUTS.cmin/cmax/x1min/x1max to nominal defaults of
       +_0.3 and +_3.0 -> slight change for 2 BBC jobs in regression test.
     + Add user input nbinc_mucovscale (default=3)
     + fix bugs related to sigint_fix

   genmag_SIMSED.c
     + fix UVLAM_EXTRAP to work reading binary and text files.

   snlc_fit.car:
     + for photo-z fit, write zPRIOR and zPRIOR_ERR to output tables.
  
   sntools_host.h
     + increase SERSIC_INDEX_MAX->11 (was 8)

   simlib_coadd.c/simlib_tools.c[h]
     + refactor and add SORT_BAND option to co-add non-sequential bands

   snana.car
     + fix SNTYPE_IGNORE to work with 0 so that only spec-confirmed
       events are selected.
     + OPT_REFORMAT_FITS[TEXT] = 256  -> re-write data files without
       sim-truth so that it looks like real data
     + increase MXVERS from 12 -> 50 to handle all of ELASTICC
         for selecting training subset.

   submit_prog_sim.py
     + fix bug so that sim-input files are no longer copied for
       each merge task. Hopefully fixes the rare and mysterious abort
       from sim-batch jobs reading zero words from sim-input file.

   submit_util.py
     + replace -f with -x to check that program exists and is executable.
       Hopefully fixes problem of running code on partial exe during make.

   submit_train_SALT2.py
     + begin adding option to use Patrick's Jacobian method to perturb
       SALT2 surface as an approximation to re-training with calibration
       shifts.

   sntools_dataformat_fits.c
     + write/read SIM_MODEL_INDEX to global header so that rewriting
       FITS -> FITS can work.
     + implement MSKOPT&256 -> suppress sim-truth from output.
   
   wfit.c:
     + fix bug causing -bao_sim to be the same as -bao.

   snlc_sim.c
     + fix bug setting AV for GENAV_WV07 option (all AV were zero);
       bug found by C.Alves trying to reproduce original plasticc.
     + remove obsolete AV variables and use only the newer
        INPUTS.GENPROFILE_AV

   remove util/split_version.pl


# ======================================================================= 
         v11_04j (Apr 23 2022) 

         ***** IMPORTANT(v11_04j) ***** 

    + LCFIT stdout greatly reduced for batch jobs.
    + create_covariance cov-matrix output is gzipped.
    + wfit.c runs x5 faster with unbinned data and cov-matrix.
    + SALT2mu default updates: 
         minos->0 (was 1) and sigint_step1->0.01 (was 0.05)

         ***** USEFUL(v11_04j) ***** 

    SALT2mu: new input flag izbin_from_cid_file=1 to force same izbin
             among all FITOPT/MUOPT

    SALT2mu output distances & errors written as %.5f instead %.4f

    submit_batch recognizes --image in sbatch template 
             (to use shifter at NERSC)

         ***** MISCELLANEOUS(v11_04j) ***** 

    snlc_fit.car
      + for MODELSPEC table, include model mags for each band at each MJD;
        for calib corrections that need color.

    snana.car
      + fix bug in INIT_REFORMAT
      + HEADER_OVERRIDE_FILE for sim data gives warning instead of abort.
      + new functions IGNOREFILE_fortran() and VALIDFILENAME
      + fix VERSION_REFORMAT_FITS[TEXT] to use VALIDFILENAME

    sntools_dataformat_fits.c[h]
      + count number of written events and spectra;
        WR_SNFITSIO_END prints actual number of written events at end of job.
  
   submit_prog_base.py
     + if --image is found in sbatch-template, check for docker
       command such as shifter.

   submit_prog_bbc.py
     + write IZBIN to BBC_ACCEPT summary file; needed to preserve IZBIN
       in systematics involving z-shift.
     + try to make sync_evt logic more robust:
         https://github.com/RickKessler/SNANA/issues/874

   submit_prog_lcfit.py
     + wait for merge_root.exe to exists in case of SNANA build.

   submit_prog_sim.py
     + leave SUBMIT.INFO outside SIMLOGS.tar

   snlc_sim.c
     + fix bug reading SALT2ALPHA[BETA] asymGauss params from
       GENPDF_FILE passed as command-line arg;
        https://github.com/RickKessler/SNANA/issues/864
     + write TIME_START to output README
     + MXARGV -> 200 (was 100) to allow for many SIMGEN_DUMP args
     + change SEV_WARN to SEV_FATAL of NARG > MXARGV

   sntools_sim_readme.c
     + write TIME_START

   sntools.c[h], SALT2mu.c
     + refactor cid-matching util to enable BBC to use optional IZBIN
       column in cid_select_file.

   genmag_SALT2.h
     + MXBIN_VAR_SALT2 -> 200k (was 120k) for IR modeling.

   snana.car
     + if no events are read, create empty table text-files so that
       submit_batch does not hang.
     + include SBMAG table column if EITHER SBMAG or host-mag exists.
       
   steps to reduce wasteful/large output:
     + default MXLC_PLOT=5 (was 100) in &SNLCINP namelist for LC fitting.
     + use STDOUT_UPDATE in many places; less printout if JOBSPLIT(1)>1
     + new util remove_minuit_stdout.py used in CPU*.CMD files for snlc_fit.

    sntools_genSmear.c
      + abort if lam-range in color_dispersion file does not cover
        wave range in salt2_template file.

    SALT2mu.c:
      + write distances and errors with 5 digits after decimals instead of 4.
      + new defaults: minos=0 (was 1) and sigint_step=0.01 (was 0.05)
      + new flag izbin_from_cid_file=1 to sync izbin

    create_covariancy.py
      + write standard cov matrices gzipped. 
        Cosmomc matrix are not zipped [yet?]

    wfit: reduce number of log10 calls in cov-matrix loop
           -> runs x5 faster for unbinned data.


# ======================================================================= 
         v11_04k (Jun 5 2022) 

         ***** IMPORTANT(v11_04k) ***** 

         ***** USEFUL(v11_04k) ***** 

    snlc_fit: OPT_PHOTOZ += 4 -> use zPDF quantiles for prior

    snlc_sim: if MWEBV is LCLIB parmaeter, sim sets SIM_MWEBV=0
              but still reports MWEBV; see Manual section
              9.10.5 Special MODEL_PARNAMES Features

         ***** MISCELLANEOUS(v11_04k) ***** 

   snana.car
     + fix bug from suppressing LCPLOT table in batch; it's CSV
       attribute was mistakenly passed to FITRES table.
     + MXSNLC -> 8 million (was 5 million)

   snlc_fit.car: 
     + new &FITINP input USESIM_INIVAL
     + OPT_PHOTOZ += 4 -> use zPDF quantiles for prior

   sndata.h
     + move  HOSTGAL_PROPERTY_BASENAME_XXX from sntools_host.h to sndata.h

   sntools_dataformat_[fits,text].c
     + use HOSTGAL_PROPERTY_BASENAME_XXX instead of hard-coded names.

   SALT2mu.c:
     + refactor so that invalid varname to output tables results in
       printing list of valid varnames for SUBPROCESS.
     + improve stdout dump for events with no biasCor.

   +HOSTNBR fixes; see https://github.com/RickKessler/SNANA/issues/893

   wfit.c:
     add another speed trick; see input -speed_flag_chi2.

   create_covariancy.py
     + reduce output labels to only new row and diag; reduce file size by 50%.
     + write MUERR_SYS to hubble diagram as diagnostic

   snlc_sim.c
     + fix parsing bug for +HOSTAPPEND, and verify for GALIDs in the 
       append file that are in different order than in original HOSTLIB.
     + move INIT_HOSTLIB call inside "not LCLIB" if block
     + new input keys RANSYSTPAR_RANSEED_SYST and RANSYSTPAR_IDSURVEY
     + call get_lamrange_SEDMODEL for NON1ASED model ...
        to get u-band at high-z.
     + for LCLIB-Galactic, set redshifts to -9 for "host-less"

   sntools.c[h]
     + add varList_store arg to match_cidList_init ...
       goal is to read SALT2 params for event sync, and use
       previous SALT2 params as initial values in systematics fit.

   submit_prog_sim:
     + protect wildcard args (e.g., /bla/xyz*) by adding quotes if
       there are no quotes.

   sntools_host.c[h]
     + read optional TRUE column of HOSTLIB so that a subset is used
       for TRUE hosts while the entire library is used for DLR matching.
         [need to update manual]
     + fix char memory bug reading NBR_LIST
     + fix subtle realloc bug in malloc_HOSTLIB

   sim_SNgrid.pl: fix a few bugs.

   psnic_BEST.c: allow for Ic-BL

   sntools_zPDF_spline.c[h]: new utility used by snlc_fit.


# ======================================================================= 
         v11_04l (  ) 

         ***** IMPORTANT(v11_04l) ***** 

   snlc_sim:
      Fixed aweful index bug reading SED.BINARY for SIMSED model.
      For NDAY x NLAM SED flux-space, all fluxes read from binary
      were off by 1 in the index jflux = ilam+iday+NDAY.
      Bug was introduced in SNANA v10_60b (Aug 12 2018), and was perhaps
      part of PLASTICC. Bug only affects SIMSED models; does NOT impact
      SNIa-SALT2, SNIa-SNoopy, NON1ASED (i.e., V19 CC models).
      Bug takes affect if reading SED.BINARY to make flux-table,
      but NOT if creating both binaries simultaneously; thus it's
      not clear if/when the bug took effect.

      I checked SNIax for LSST at z=0.1:
        PEAKMAG[ugriz]: 22.53  20.87  20.46  20.44  20.44  20.47  # bug
        PEAKMAG[ugriz]: 22.48  20.88  20.47  20.45  20.44  20.48  # fixed
      -> u-band change is .05 mag, and other bands are within 0.01 mag.
      Implementing this fix requires re-making SIMSED binaries
      (preferably with make_simsed_binaries.py)


         ***** USEFUL(v11_04l) ***** 

         ***** MISCELLANEOUS(v11_04l) ***** 

   snlc_sim.c
     + avoid SIMGEN_DUMP conflict between SIMSED and HOSTLIB varnames.

END: 
